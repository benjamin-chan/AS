1                                          The SAS System              18:37 Thursday, June 21, 2018

NOTE: Copyright (c) 2016 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M5) 
      Licensed to UNIVERSITY OF ALABAMA AT BIRMINGHAM - SFA - T&R, Site 70086550.
NOTE: This session is executing on the X64_DS08R2  platform.



NOTE: Updated analytical products:
      
      SAS/STAT 14.3
      SAS/ETS 14.3
      SAS/IML 14.3
      SAS/QC 14.3

NOTE: Additional host information:

 X64_DS08R2 WIN 6.1.7601 Service Pack 1 Server

--- PEER News and Updates ---

: SECURITY REMINDER :
Please remember not to copy any data files that contain PHI (protected health identifiers) to any 
of the shared folders.

 


NOTE: SAS initialization used:
      real time           0.35 seconds
      cpu time            0.32 seconds
      
1          *  University of Alabama at Birmingham                               *
2          *  AS project                                            *
3          **********************************************************************;
4          options pagesize=74 linesize=150 pageno=1 missing=' ' date FORMCHAR="|----|+|---+=|-/\<>*";
5          * Programmer    : Benjamin Chan <chanb@ohsu.edu>
6          * Creation date :
7          * Modify date   :
8          ;
9          %let cmt=buildExposureFollowUp; * type the name of your program here (without the filename extension);
10         %let pgm=&cmt..sas;
11         %include "lib\libname.sas" ;
NOTE: Libref STDC5P was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: H:\studies\osteo\data\STD_files\5pct\
NOTE: Libref STD_SABR was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\data\std_SABER\
NOTE: Libref MPSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\mpcd\data\stddata\
NOTE: Libref UCBSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\stddata\
NOTE: Libref UCB was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB\
NOTE: Libref UCB64 was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB64\
NOTE: Libref DT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: V:\studies\AS\data
NOTE: Libref NDC was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: W:\onenote\references\drug ndcs\sas data
143        footnote "&pgm.";
144        * footnote2 "%sysfunc(datetime(),datetime14.)";
145        title1 '--- AS project ---';
146        **********************************************************************;
147        options macrogen mlogic mprint symbolgen;
148        options nomacrogen nomlogic nomprint nosymbolgen;
2                                                                   The SAS System                                       18:37 Thursday, June 21, 2018

149        
150        
151        ods html
152          body = "output\&cmt..html"
153          style = Statistical;
NOTE: Writing HTML Body file: output\buildExposureFollowUp.html
154        
155        
156        /*
157        See the *Compact Outcome Definition* worksheet in `AS Project Cohort Outcome Codebook-20170410.xlsx`
158         */
159        
160        
161        /*
162        From: Xie, Fenglong [mailto:fenglongxie@uabmc.edu]
163        Sent: Wednesday, May 17, 2017 7:03 AM
164        To: Benjamin Chan <chanb@ohsu.edu>
165        Subject: RE: AS project data
166        
167        Hi, Ben
168        
169        The data are stored at UCB library defined as below email.
170        
171        Attached please find the cohort list.
172        
173        No exclusion was done except excluded for higher level exposure in six month
174        baseline.
175        
176        You need to do appropriate censor (such as censor for discontinues of
177        exposure, switch to same level or higher lever exposure ...).
178        
179        If you have question, please let me know.
180         */
181        
182        
183        proc sql;
184          create table Work.indexLookup as
185            select case
186                     when A.exposure = "No exposure" then 0
187                     when A.exposure = "NSAID" then 1
188                     when A.exposure = "DMARD" then 2
189                     when A.exposure = "TNF" then 3
190                     else .
191                     end as exposureClass,
192                   A.*
193            from DT.indexLookup A
194            order by A.database, A.patid, A.indexDate;
NOTE: Table WORK.INDEXLOOKUP created, with 32487 rows and 14 columns.

195        /*
196        Attach exposure end dates to exposure segments
197         */
198          create table Work.temp0 as
199            select A.database,
200                   A.patid,
201                   A.enr_end_date,
202                   A.death_date,
203                   A.exposureClass as exposureClassA,
204                   A.exposure as exposureA,
205                   A.indexGNN as exposureDrugA,
206                   A.indexDate format = mmddyy10. as indexStartA,
207                   min(B.indexDate - 1, A.enr_end_date, A.death_date) format = mmddyy10. as indexEndA,
208                   B.exposureClass as exposureClassB,
209                   B.exposure as exposureB,
210                   B.indexGNN as exposureDrugB,
211                   B.indexDate format = mmddyy10. as indexStartB
212            from Work.indexLookup A left join
213                 Work.indexLookup B on (A.database = B.database &
214                                        A.patid = B.patid &
215                                        A.indexDate < B.indexDate);
NOTE: Table WORK.TEMP0 created, with 38507 rows and 13 columns.

3                                                                   The SAS System                                       18:37 Thursday, June 21, 2018

216        /*
217        Select the index start date with the earliest end date
218         */
219          create table Work.tempLookup as
220            select database,
221                   patid,
222                   indexStartA,
223                   min(indexEndA) as earliestIndexEndA
224            from Work.temp0
225            group by database,
226                     patid,
227                     indexStartA;
NOTE: Table WORK.TEMPLOOKUP created, with 32407 rows and 4 columns.

228          create table Work.temp1 as
229            select A.*
230            from Work.temp0 A inner join
231                 Work.tempLookup B on (A.database = B.database &
232                                       A.patid = B.patid &
233                                       A.indexStartA = B.indexStartA &
234                                       A.indexEndA = B.earliestIndexEndA)
235            order by A.database,
236                     A.patid,
237                     A.indexStartA;
NOTE: Table WORK.TEMP1 created, with 32577 rows and 13 columns.

238          select "Summary of Work.temp1" as table,
239                 exposureClassA,
240                 exposureClassB,
241                 count(*) as n,
242                 count(*) / (select count(*) from Work.temp1) format = percent8.1 as pct
243            from Work.temp1
244            group by exposureClassA, exposureClassB;
                                                                  --- AS project ---                                 18:37 Thursday, June 21, 2018   1

                                                                   exposure      exposure
                                        table                        ClassA        ClassB         n       pct
                                        ---------------------------------------------------------------------
                                        Summary of Work.temp1             0                    5480    16.8% 
                                        Summary of Work.temp1             0             1      2945     9.0% 
                                        Summary of Work.temp1             0             2       636     2.0% 
                                        Summary of Work.temp1             0             3       731     2.2% 
                                        Summary of Work.temp1             1                    6857    21.0% 
                                        Summary of Work.temp1             1             1      3716    11.4% 
                                        Summary of Work.temp1             1             2       586     1.8% 
                                        Summary of Work.temp1             1             3       410     1.3% 
                                        Summary of Work.temp1             2                    2614     8.0% 
                                        Summary of Work.temp1             2             1       328     1.0% 
                                        Summary of Work.temp1             2             2       555     1.7% 
                                        Summary of Work.temp1             2             3       661     2.0% 
                                        Summary of Work.temp1             3                    5552    17.0% 
                                        Summary of Work.temp1             3             1       288     0.9% 
                                        Summary of Work.temp1             3             2       106     0.3% 
                                        Summary of Work.temp1             3             3      1112     3.4% 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              buildExposureFollowUp.sas
245        /*
246        Create exposure segments
247         */
248          create table Work.tempExposureSegments as
249            select distinct
250                   A.database,
251                   A.patid,
252                   A.enr_end_date,
253                   A.death_date,
254                   A.exposureClassA as exposureClass,
255                   A.exposureA as exposure,
256                   A.exposureDrugA as exposureDrug,
257                   A.indexStartA as exposureStart,
258                   A.indexEndA as exposureEnd
259            from Work.temp1 A
260            order by A.database,
261                     A.patid,
262                     A.indexStartA;
NOTE: Table WORK.TEMPEXPOSURESEGMENTS created, with 32487 rows and 9 columns.

263        quit;
NOTE: The PROCEDURE SQL printed page 1.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.84 seconds
      cpu time            0.92 seconds
      

264        
265        
266        /*
267        Collapse exposure segments
268        
269        See *Starts and Stops: Processing Episode Data With Beginning and Ending Dates*
270        http://www2.sas.com/proceedings/sugi29/260-29.pdf
271         */
272        data DT.exposureTimeline;
273          set Work.tempExposureSegments;
274          by database patid exposureClass exposure exposureDrug notsorted;
275          format holdPeriodStart mmddyy10.;
4                                                                   The SAS System                                       18:37 Thursday, June 21, 2018

276          drop holdPeriodStart;
277          retain holdPeriodStart;
278          if first.exposureDrug then do;  /* Check the last variable in the BY group */
279            holdPeriodStart = exposureStart;
280          end;
281          if last.exposureDrug then do;  /* Check the last variable in the BY group */
282            exposureStart = holdPeriodStart;
283            output;
284          end;
285        run;

NOTE: There were 32487 observations read from the data set WORK.TEMPEXPOSURESEGMENTS.
NOTE: The data set DT.EXPOSURETIMELINE has 32487 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.04 seconds
      

286        proc sql;
287          alter table DT.exposureTimeline add daysExposed numeric;
NOTE: Table DT.EXPOSURETIMELINE has been modified, with 10 columns.
288          update DT.exposureTimeline
289            set daysExposed = exposureEnd - exposureStart + 1;
NOTE: 32487 rows were updated in DT.EXPOSURETIMELINE.

290          alter table DT.exposureTimeline add exposureID numeric;
NOTE: Table DT.EXPOSURETIMELINE has been modified, with 11 columns.
291          update DT.exposureTimeline
292            set exposureID = monotonic();
NOTE: 32487 rows were updated in DT.EXPOSURETIMELINE.

293        quit ;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.29 seconds
      cpu time            0.20 seconds
      

294        
295        
296        proc means data = DT.exposureTimeline n sum mean std min q1 median q3 max maxdec = 1;
297          class database exposureClass exposure;
298          var daysExposed;
299        run;

                                                                  --- AS project ---                                 18:37 Thursday, June 21, 2018   2

                                                                 The MEANS Procedure

                                                          Analysis Variable : daysExposed 
 
                exposure                                                                                            Lower                       Upper
database           Class  exposure     N Obs      N           Sum          Mean       Std Dev       Minimum      Quartile        Median      Quartile
-----------------------------------------------------------------------------------------------------------------------------------------------------
MPCD                   0  No exposure   1160   1160      524568.0         452.2         381.7           1.0         127.0         356.0         716.5

                       1  NSAID          799    799      242832.0         303.9         273.0           2.0          86.0         232.0         436.0

                       2  DMARD          445    445      148811.0         334.4         291.6           4.0         102.0         254.0         463.0

                       3  TNF            994    994      417716.0         420.2         318.4           1.0         162.0         335.0         606.0

Marketscan             0  No exposure   3368   3368     1189762.0         353.3         369.7           1.0          76.0         213.0         521.0

                       1  NSAID         3710   3710     1235108.0         332.9         326.5           1.0          83.0         217.0         482.0

                       2  DMARD         1760   1760      611371.0         347.4         339.4           1.0          91.0         224.5         494.0

                       3  TNF           4768   4768     2040042.0         427.9         365.4           1.0         141.0         315.5         618.0

Medicare               0  No exposure   5221   5221     4796618.0         918.7         809.6           1.0         252.0         778.0        1278.0

                       1  NSAID         7034   7034     6276516.0         892.3         739.0           1.0         268.0         794.0        1281.0

                       2  DMARD         1939   1939     1896946.0         978.3         774.2           1.0         345.0         847.0        1402.0

                       3  TNF           1289   1289     1550762.0        1203.1         814.0           8.0         671.0        1008.0        1619.0
-----------------------------------------------------------------------------------------------------------------------------------------------------

                                                           Analysis Variable : daysExposed 
 
                                                              exposure
                                              database           Class  exposure     N Obs       Maximum
                                              ----------------------------------------------------------
                                              MPCD                   0  No exposure   1160        1278.0

                                                                     1  NSAID          799        1223.0

                                                                     2  DMARD          445        1211.0

                                                                     3  TNF            994        1276.0

                                              Marketscan             0  No exposure   3368        1643.0

                                                                     1  NSAID         3710        1599.0

                                                                     2  DMARD         1760        1625.0

                                                                     3  TNF           4768        1639.0

                                              Medicare               0  No exposure   5221        3835.0

                                                                     1  NSAID         7034        3722.0

                                                                     2  DMARD         1939        3821.0

                                                                     3  TNF           1289        3819.0
                                              ----------------------------------------------------------
 
 
 
 
 
 
 
 
 
 
                                                              buildExposureFollowUp.sas
NOTE: There were 32487 observations read from the data set DT.EXPOSURETIMELINE.
NOTE: The PROCEDURE MEANS printed page 2.
NOTE: PROCEDURE MEANS used (Total process time):
      real time           0.12 seconds
      cpu time            0.09 seconds
      

300        
301        
302        ods html close;
NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           2.47 seconds
      cpu time            2.07 seconds
      
