1                                         The SAS System                17:43 Monday, May 21, 2018

NOTE: Copyright (c) 2016 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M5) 
      Licensed to UNIVERSITY OF ALABAMA AT BIRMINGHAM - SFA - T&R, Site 70086550.
NOTE: This session is executing on the X64_DS08R2  platform.



NOTE: Updated analytical products:
      
      SAS/STAT 14.3
      SAS/ETS 14.3
      SAS/IML 14.3
      SAS/QC 14.3

NOTE: Additional host information:

 X64_DS08R2 WIN 6.1.7601 Service Pack 1 Server

--- PEER News and Updates ---

: SECURITY REMINDER :
Please remember not to copy any data files that contain PHI (protected health identifiers) to any 
of the shared folders.

 


NOTE: SAS initialization used:
      real time           4.53 seconds
      cpu time            0.28 seconds
      
1          *  University of Alabama at Birmingham                               *
2          *  AS project                                            *
3          **********************************************************************;
4          options pagesize=74 linesize=150 pageno=1 missing=' ' date FORMCHAR="|----|+|---+=|-/\<>*";
5          * Programmer    : Benjamin Chan <chanb@ohsu.edu>
6          * Creation date :
7          * Modify date   :
8          ;
9          %let cmt=buildExposureFollowUp; * type the name of your program here (without the filename extension);
10         %let pgm=&cmt..sas;
11         %include "lib\libname.sas" ;
NOTE: Libref STDC5P was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: H:\studies\osteo\data\STD_files\5pct\
NOTE: Libref STD_SABR was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\data\std_SABER\
NOTE: Libref MPSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\mpcd\data\stddata\
NOTE: Libref UCBSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\stddata\
NOTE: Libref UCB was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB\
NOTE: Libref DT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: V:\studies\AS\data
NOTE: Libref NDC was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: W:\onenote\references\drug ndcs\sas data
128        footnote "&pgm.";
129        * footnote2 "%sysfunc(datetime(),datetime14.)";
130        title1 '--- AS project ---';
131        **********************************************************************;
132        options macrogen mlogic mprint symbolgen;
133        options nomacrogen nomlogic nomprint nosymbolgen;
134        
135        
136        ods html
2                                                                   The SAS System                                          17:43 Monday, May 21, 2018

137          body = "output\&cmt..html"
138          style = Statistical;
NOTE: Writing HTML Body file: output\buildExposureFollowUp.html
139        
140        
141        /*
142        See the *Compact Outcome Definition* worksheet in `AS Project Cohort Outcome Codebook-20170410.xlsx`
143         */
144        
145        
146        /*
147        From: Xie, Fenglong [mailto:fenglongxie@uabmc.edu]
148        Sent: Wednesday, May 17, 2017 7:03 AM
149        To: Benjamin Chan <chanb@ohsu.edu>
150        Subject: RE: AS project data
151        
152        Hi, Ben
153        
154        The data are stored at UCB library defined as below email.
155        
156        Attached please find the cohort list.
157        
158        No exclusion was done except excluded for higher level exposure in six month
159        baseline.
160        
161        You need to do appropriate censor (such as censor for discontinues of
162        exposure, switch to same level or higher lever exposure ...).
163        
164        If you have question, please let me know.
165         */
166        
167        
168        proc sql;
169          create table Work.indexLookup as
170            select case
171                     when A.exposure = "No exposure" then 0
172                     when A.exposure = "NSAID" then 1
173                     when A.exposure = "DMARD" then 2
174                     when A.exposure = "TNF" then 3
175                     else .
176                     end as exposureClass,
177                   A.*
178            from DT.indexLookup A
179            order by A.database, A.patid, A.indexDate;
NOTE: Table WORK.INDEXLOOKUP created, with 20956 rows and 14 columns.

180        /*
181        Attach exposure end dates to exposure segments
182         */
183          create table Work.temp0 as
184            select A.database,
185                   A.patid,
186                   A.enr_end_date,
187                   A.death_date,
188                   A.exposureClass as exposureClassA,
189                   A.exposure as exposureA,
190                   A.indexGNN as exposureDrugA,
191                   A.indexDate format = mmddyy10. as indexStartA,
192                   min(B.indexDate - 1, A.enr_end_date, A.death_date) format = mmddyy10. as indexEndA,
193                   B.exposureClass as exposureClassB,
194                   B.exposure as exposureB,
195                   B.indexGNN as exposureDrugB,
196                   B.indexDate format = mmddyy10. as indexStartB
197            from Work.indexLookup A left join
198                 Work.indexLookup B on (A.database = B.database &
199                                        A.patid = B.patid &
200                                        A.indexDate < B.indexDate);
NOTE: Table WORK.TEMP0 created, with 24846 rows and 13 columns.

201        /*
202        Select the index start date with the earliest end date
203         */
3                                                                   The SAS System                                          17:43 Monday, May 21, 2018

204          create table Work.tempLookup as
205            select database,
206                   patid,
207                   indexStartA,
208                   min(indexEndA) as earliestIndexEndA
209            from Work.temp0
210            group by database,
211                     patid,
212                     indexStartA;
NOTE: Table WORK.TEMPLOOKUP created, with 20919 rows and 4 columns.

213          create table Work.temp1 as
214            select A.*
215            from Work.temp0 A inner join
216                 Work.tempLookup B on (A.database = B.database &
217                                       A.patid = B.patid &
218                                       A.indexStartA = B.indexStartA &
219                                       A.indexEndA = B.earliestIndexEndA)
220            order by A.database,
221                     A.patid,
222                     A.indexStartA;
NOTE: Table WORK.TEMP1 created, with 21015 rows and 13 columns.

223          select "Summary of Work.temp1" as table,
224                 exposureClassA,
225                 exposureClassB,
226                 count(*) as n,
227                 count(*) / (select count(*) from Work.temp1) format = percent8.1 as pct
228            from Work.temp1
229            group by exposureClassA, exposureClassB;
                                                                  --- AS project ---                                    17:43 Monday, May 21, 2018   1

                                                                   exposure      exposure
                                        table                        ClassA        ClassB         n       pct
                                        ---------------------------------------------------------------------
                                        Summary of Work.temp1             0                    2401    11.4% 
                                        Summary of Work.temp1             0             1      1168     5.6% 
                                        Summary of Work.temp1             0             2       388     1.8% 
                                        Summary of Work.temp1             0             3       760     3.6% 
                                        Summary of Work.temp1             1                    3576    17.0% 
                                        Summary of Work.temp1             1             1      1840     8.8% 
                                        Summary of Work.temp1             1             2       368     1.8% 
                                        Summary of Work.temp1             1             3       471     2.2% 
                                        Summary of Work.temp1             2                    1571     7.5% 
                                        Summary of Work.temp1             2             1       225     1.1% 
                                        Summary of Work.temp1             2             2       295     1.4% 
                                        Summary of Work.temp1             2             3       546     2.6% 
                                        Summary of Work.temp1             3                    5589    26.6% 
                                        Summary of Work.temp1             3             1       443     2.1% 
                                        Summary of Work.temp1             3             2       148     0.7% 
                                        Summary of Work.temp1             3             3      1226     5.8% 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              buildExposureFollowUp.sas
230        /*
231        Create exposure segments
232         */
233          create table Work.tempExposureSegments as
234            select distinct
235                   A.database,
236                   A.patid,
237                   A.enr_end_date,
238                   A.death_date,
239                   A.exposureClassA as exposureClass,
240                   A.exposureA as exposure,
241                   A.exposureDrugA as exposureDrug,
242                   A.indexStartA as exposureStart,
243                   A.indexEndA as exposureEnd
244            from Work.temp1 A
245            order by A.database,
246                     A.patid,
247                     A.indexStartA;
NOTE: Table WORK.TEMPEXPOSURESEGMENTS created, with 20956 rows and 9 columns.

248        quit;
NOTE: The PROCEDURE SQL printed page 1.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.71 seconds
      cpu time            0.56 seconds
      

249        
250        
251        /*
252        Collapse exposure segments
253        
254        See *Starts and Stops: Processing Episode Data With Beginning and Ending Dates*
255        http://www2.sas.com/proceedings/sugi29/260-29.pdf
256         */
257        data DT.exposureTimeline;
258          set Work.tempExposureSegments;
259          by database patid exposureClass exposure exposureDrug notsorted;
260          format holdPeriodStart mmddyy10.;
261          drop holdPeriodStart;
262          retain holdPeriodStart;
263          if first.exposureDrug then do;  /* Check the last variable in the BY group */
4                                                                   The SAS System                                          17:43 Monday, May 21, 2018

264            holdPeriodStart = exposureStart;
265          end;
266          if last.exposureDrug then do;  /* Check the last variable in the BY group */
267            exposureStart = holdPeriodStart;
268            output;
269          end;
270        run;

NOTE: There were 20956 observations read from the data set WORK.TEMPEXPOSURESEGMENTS.
NOTE: The data set DT.EXPOSURETIMELINE has 20956 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds
      

271        proc sql;
272          alter table DT.exposureTimeline add daysExposed numeric;
NOTE: Table DT.EXPOSURETIMELINE has been modified, with 10 columns.
273          update DT.exposureTimeline
274            set daysExposed = exposureEnd - exposureStart + 1;
NOTE: 20956 rows were updated in DT.EXPOSURETIMELINE.

275          alter table DT.exposureTimeline add exposureID numeric;
NOTE: Table DT.EXPOSURETIMELINE has been modified, with 11 columns.
276          update DT.exposureTimeline
277            set exposureID = monotonic();
NOTE: 20956 rows were updated in DT.EXPOSURETIMELINE.

278        quit ;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.21 seconds
      cpu time            0.12 seconds
      

279        
280        
281        proc means data = DT.exposureTimeline n sum mean std min q1 median q3 max maxdec = 1;
282          class database exposureClass exposure;
283          var daysExposed;
284        run;

                                                                  --- AS project ---                                    17:43 Monday, May 21, 2018   2

                                                                 The MEANS Procedure

                                                          Analysis Variable : daysExposed 
 
                exposure                                                                                            Lower                       Upper
database           Class  exposure     N Obs      N           Sum          Mean       Std Dev       Minimum      Quartile        Median      Quartile
-----------------------------------------------------------------------------------------------------------------------------------------------------
MPCD                   0  No exposure    512    512      232256.0         453.6         383.9           1.0         129.5         341.5         721.0

                       1  NSAID          355    355      107633.0         303.2         273.6           2.0          90.0         225.0         433.0

                       2  DMARD          165    165       57204.0         346.7         297.8           9.0         101.0         291.0         492.0

                       3  TNF            670    670      281763.0         420.5         318.9           1.0         158.0         337.5         609.0

Marketscan             0  No exposure   1699   1699      585821.0         344.8         371.5           1.0          66.0         196.0         499.0

                       1  NSAID         1733   1733      587724.0         339.1         332.5           1.0          78.0         226.0         496.0

                       2  DMARD          777    777      263494.0         339.1         343.7           1.0          79.0         199.0         489.0

                       3  TNF           3453   3453     1500031.0         434.4         369.5           1.0         145.0         322.0         631.0

Medicare               0  No exposure   2489   2489     2165254.0         869.9         909.7           1.0         128.0         603.0        1278.0

                       1  NSAID         4147   4147     3610976.0         870.7         764.8           1.0         221.0         750.0        1257.0

                       2  DMARD         1688   1688     1651624.0         978.5         814.6           1.0         291.5         835.5        1424.0

                       3  TNF           3268   3268     3927247.0        1201.7         856.2           1.0         540.5        1004.5        1690.5
-----------------------------------------------------------------------------------------------------------------------------------------------------

                                                           Analysis Variable : daysExposed 
 
                                                              exposure
                                              database           Class  exposure     N Obs       Maximum
                                              ----------------------------------------------------------
                                              MPCD                   0  No exposure    512        1278.0

                                                                     1  NSAID          355        1181.0

                                                                     2  DMARD          165        1158.0

                                                                     3  TNF            670        1276.0

                                              Marketscan             0  No exposure   1699        1643.0

                                                                     1  NSAID         1733        1599.0

                                                                     2  DMARD          777        1625.0

                                                                     3  TNF           3453        1637.0

                                              Medicare               0  No exposure   2489        3835.0

                                                                     1  NSAID         4147        3826.0

                                                                     2  DMARD         1688        3821.0

                                                                     3  TNF           3268        3826.0
                                              ----------------------------------------------------------
 
 
 
 
 
 
 
 
 
 
                                                              buildExposureFollowUp.sas
NOTE: There were 20956 observations read from the data set DT.EXPOSURETIMELINE.
NOTE: The PROCEDURE MEANS printed page 2.
NOTE: PROCEDURE MEANS used (Total process time):
      real time           0.06 seconds
      cpu time            0.09 seconds
      

285        
286        
287        ods html close;
NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           17.70 seconds
      cpu time            1.52 seconds
      
