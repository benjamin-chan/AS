1                                                          The SAS System                          15:21 Tuesday, September 12, 2017

NOTE: Copyright (c) 2002-2012 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M1) 
      Licensed to UNIVERSITY OF ALABAMA AT BIRMINGHAM - SFA - T&R, Site 70058223.
NOTE: This session is executing on the W32_ES08R2  platform.



NOTE: Updated analytical products:
      
      SAS/STAT 13.1
      SAS/ETS 13.1
      SAS/OR 13.1
      SAS/IML 13.1
      SAS/QC 13.1

NOTE: Additional host information:

 W32_ES08R2 WIN 6.1.7601 Service Pack 1 Server

--- PEER News and Updates ---

: SECURITY REMINDER :
Please remember not to copy any data files that contain PHI (protected health identifiers) to any of the shared folders.

 


NOTE: SAS initialization used:
      real time           2.29 seconds
      cpu time            0.20 seconds
      
1          *  University of Alabama at Birmingham                               *
2          *  AS project                                            *
3          **********************************************************************;
4          options pagesize=74 linesize=150 pageno=1 missing=' ' date FORMCHAR="|----|+|---+=|-/\<>*";
5          * Programmer    : Benjamin Chan <chanb@ohsu.edu>
6          * Creation date :
7          * Modify date   :
8          ;
9          %let cmt=queryFractures; * type the name of your program here (without the filename extension);
10         %let pgm=&cmt..sas;
11         %include "lib\libname.sas" ;
NOTE: Libref STDC5P was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: H:\studies\osteo\data\STD_files\5pct\
NOTE: Libref STD_SABR was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\data\std_SABER\
NOTE: Libref MPSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: h:\studies\mpcd\data\stddata\
NOTE: Libref UCBSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\stddata\
NOTE: Libref UCB was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB\
NOTE: Libref DT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: V:\studies\AS\data
92         footnote "&pgm.";
93         * footnote2 "%sysfunc(datetime(),datetime14.)";
94         title1 '--- AS project ---';
95         **********************************************************************;
96         options macrogen mlogic mprint symbolgen;
97         options nomacrogen nomlogic nomprint nosymbolgen;
98         
99         
100        ods html
101          body = "output\&cmt..html"
102          style = Statistical;
NOTE: Writing HTML Body file: output\queryFractures.html
2                                                                   The SAS System                                   15:21 Tuesday, September 12, 2017

103        
104        
105        /*
106        FRACTURES
107        
108        See "ALGORITHMS TO ENHANCE SPECIFICITY OF FRACTURE IDENTIFICATION_ 100316.docx"
109        
110        Adapted from Lang's code in "001_fx_data.sas"
111        
112        
113        From: Chen, Lang [mailto:langchen@uabmc.edu]
114        Sent: Monday, July 24, 2017 8:56 AM
115        To: Benjamin Chan <chanb@ohsu.edu>
116        Subject: RE: fracture identification algorithm
117        
118        Here it is.
119        For 001_fx_data, find all fx related claim and run the algorithm.
120        Please ignore any code after line 476
121        Modify code from line 1 -50
122        
123        For 002_fx_epi_data
124        Define fx episode.
125        
126        Final output data is fx_dgns_&firstyr._&lastyr._4. Please let me if you have any questions.
127         */
128        
129        
130        /*
131        START OF 001_fx_data.sas
132         */
133        
134        
135        /*Assign "Broad" fracture site (fx_site) for all ICD9 diagnoses, outputting separately, so some records are cloned, then combining into one
135      !  file */
136        /*No longer using matched trauma files here*/
137        
138        %macro comballfxdgns;
139            data fx_dgns;
140                set UCB.tempFracDxMPCD (where = (diagCodeType = "Fracture code"))
141                    UCB.tempFracDxUCB (where = (diagCodeType = "Fracture code"))
142                    UCB.tempFracDxSABR (where = (diagCodeType = "Fracture code"));
143                    length fx_site $30 ;
144                    fx_site = '';
145                    if strip(DX) in: ('800' '801' '802' '803' '804') then           do; fx_site='(800-804) skull/face'; output; end;
146                    if strip(DX) in: ('805', '806') or strip(DX)='73313' then       do; fx_site='(805, 806, 73313) spine'; output; end;
147                    if strip(DX) in: ('807') then                                           do; fx_site='(807) rib/sternum/trachea'; output; end;
148                    if strip(DX) in: ('808') then                                           do; fx_site='(808) pelvis'; output; end;
149                    if strip(DX) in: ('809') then                                           do; fx_site='(809) trunk bones'; output; end;
150                    if strip(DX) in: ('810') then                                           do; fx_site='(810) clavicle'; output; end;
151                    if strip(DX) in: ('811') then                                           do; fx_site='(811) scapula'; output; end;
152                    if strip(DX) in: ('812') or strip(DX)='73311' then              do; fx_site='(812, 73311) humerus'; output; end;
153                    if strip(DX) in: ('813') or strip(DX)='73312' then              do; fx_site='(813, 73312) radius_ulna'; output; end;
154                    if strip(DX) in: ('814') then                                           do; fx_site='(814) carpal'; output; end;
155                    if strip(DX) in: ('815' '816' '817') then                           do; fx_site='(815-817) hand/fingers'; output; end;
156                    if strip(DX) in: ('818' '819') then                                     do; fx_site='(818-819) arms mult'; output; end;
157                    if strip(DX) in: ('820') or strip(DX) = '73314' then                do; fx_site='(820, 73314) hip'; output; end;
158                    if strip(DX) in: ('821') or strip(DX)='73315' then              do; fx_site='(821, 73315) femur'; output; end;
159                    if strip(DX) in: ('822') then                                           do; fx_site='(822) patella'; output; end;
160                    if strip(DX) in: ('823') or strip(DX)='73316' then              do; fx_site='(823, 73316) tib_fib'; output; end;
161                    if strip(DX) in: ('824') then                                           do; fx_site='(824) ankle'; output; end;
162                    if strip(DX) in: ('825') then                                           do; fx_site='(825) tarsal_metatarsal'; output; end;
163                    if strip(DX) in: ('826') then                                           do; fx_site='(826) foot_phalanges'; output; end;
164                    if strip(DX) in: ('827') then                                           do; fx_site='(827) lower_limb'; output; end;
165                    if strip(DX) in: ('828') then                                           do; fx_site='(828) legs+arm/rib'; output; end;
166                    if strip(DX) in: ('829') then                                           do; fx_site='(829) fx_nos'; output; end;
167                    if strip(DX) in ('73310' '73319' '7331') then                 do; fx_site='(7331) pathologic nos/nec'; output; end;
168            data fx_excare;
169                set UCB.tempFracDxMPCD (where = (diagCodeType = "Extended care code"))
170                    UCB.tempFracDxUCB (where = (diagCodeType = "Extended care code"))
171                    UCB.tempFracDxSABR (where = (diagCodeType = "Extended care code"));
172                    length fx_site $30 ;
173                    fx_site = '';
3                                                                   The SAS System                                   15:21 Tuesday, September 12, 2017

174                    /*Expanded Diagnosis Codes - Fracture Aftercare Codes*/
175                    if strip(DX) in ('V5410' 'V5420') then                          do; fx_site='(812, 73311) humerus'; output;
176                                                                                                     fx_site='(813, 73312) radius_ulna'; output;
176      ! end;
177                    if strip(DX) in ('V5411' 'V5421') then                          do; fx_site='(812, 73311) humerus'; output; end;
178                    if strip(DX) in ('V5412' 'V5422') then                          do; fx_site='(813, 73312) radius_ulna'; output;
179                                                                                                     fx_site='(814) carpal'; output; end;
180                    if strip(DX) in ('V5413' 'V5423') then                          do; fx_site='(820, 73314) hip'; output; end;
181                    if strip(DX) in ('V5414' 'V5424') then                          do; fx_site='(820, 73314) hip'; output;
182                                                                                                     fx_site='(821, 73315) femur'; output;
183                                                                                                     fx_site='(822) patella'; output;
184                                                                                                     fx_site='(824) ankle'; output;
185                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
186                    if strip(DX) in ('V5415' 'V5425') then                          do; fx_site='(820, 73314) hip'; output;
187                                                                                                     fx_site='(821, 73315) femur'; output;
188                                                                                                     fx_site='(822) patella'; output; end;
189                    if strip(DX) in ('V5416' 'V5426') then                          do; fx_site='(824) ankle'; output;
190                                                                                                     fx_site='(822) patella'; output;
191                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
192                    if strip(DX) in ('V5417' 'V5427') then                          do; fx_site='(805, 806, 73313) spine'; output; end;
193                    if strip(DX) in: ('V542') then                                       do; fx_site='(7331) pathologic nos/nec'; output; end;
194                    if strip(DX) in: ('V541') then                                       do; fx_site='(829) fx_nos'; output; end;
195            run;
196        
197            /* proc sort data=fx_dgns; by patid BEGIN_DATE fx_site; run;
198            proc sort data=fx_excare; by patid BEGIN_DATE fx_site; run; */
199        %mend;
200        %comballfxdgns;

WARNING: Multiple lengths were specified for the variable ADMIT_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable BEGIN_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DISCHARGE_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable END_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DX by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable PDX by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable code by input data set(s). This can cause truncation of data.
NOTE: There were 3372 observations read from the data set UCB.TEMPFRACDXMPCD.
      WHERE diagCodeType='Fracture code';
NOTE: There were 8996 observations read from the data set UCB.TEMPFRACDXUCB.
      WHERE diagCodeType='Fracture code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: There were 110043 observations read from the data set UCB.TEMPFRACDXSABR.
      WHERE diagCodeType='Fracture code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_DGNS has 122411 observations and 26 variables.
NOTE: DATA statement used (Total process time):
      real time           1.87 seconds
      cpu time            0.31 seconds
      


WARNING: Multiple lengths were specified for the variable ADMIT_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable BEGIN_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DISCHARGE_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable END_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DX by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable PDX by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable code by input data set(s). This can cause truncation of data.
NOTE: There were 117 observations read from the data set UCB.TEMPFRACDXMPCD.
      WHERE diagCodeType='Extended care code';
NOTE: There were 345 observations read from the data set UCB.TEMPFRACDXUCB.
      WHERE diagCodeType='Extended care code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: There were 8678 observations read from the data set UCB.TEMPFRACDXSABR.
      WHERE diagCodeType='Extended care code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_EXCARE has 20728 observations and 26 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.06 seconds
      

4                                                                   The SAS System                                   15:21 Tuesday, September 12, 2017

201        
202        /*Now, assign a more specific fracture site (e.g., closed, other) (site) that is used in the CQ algorithms*/
203        /*Since Expanded Diagnosis Codes (V Codes) apply to sub-categories of each broad fracture site, clone records for these so they appear in
203      ! both places*/
204        
205        data fx_dgns_2;
206            set fx_dgns;
207        
208            length site $30;
209        
210            site="";
211        
212            *Spine-closed and Spine-other;
213            if fx_site='(805, 806, 73313) spine' then
214                do;
215                    site = 'spine_cls'; /*Includes V Codes and 73313 here*/
216                    if substr(strip(DX),1,3) in ('805' '806') and substr(strip(DX),1,4) ^in ('8050', '8052', '8054', '8058') then
217                        site = 'spine_oth';
218                end;
219        
220            *Pelvis-closed and Pelvis-other... No V Codes;
221            if fx_site='(808) pelvis' then
222                do;
223                    site = 'pelvis_cls';
224                    if substr(strip(DX),1,3)='808' and substr(strip(DX),1,4) ^in ('8080', '8082', '8084', '8088') then
225                        site = 'pelvis_oth';
226                end;
227        
228            *Clavicle-closed and Clavicle-other.... No V Codes;
229            if fx_site='(810) clavicle' then
230                do;
231                    site = 'clv_cls';
232                    if substr(strip(DX),1,3) = '810' and substr(strip(DX),1,4) ^in ('8100') then
233                        site = 'clv_oth';
234                end;
235        
236            *Humerus-closed and Humerus-other;
237            if fx_site='(812, 73311) humerus' then
238                do;
239                    site = 'hmrs_cls'; /*Includes V Codes and 73311 here*/
240                    if substr(strip(DX),1,3)= '812' and substr(strip(DX),1,4) ^in ('8120', '8122', '8124') then
241                        site = 'hmrs_oth';
242                end;
243        
244            *Distal radius/ulna and Radius/ulna-other;
245            if fx_site='(813, 73312) radius_ulna' then
246                do;
247                 site = 'dist4arm'; /*Includes V Codes and 73312 here*/
248                    if substr(strip(DX),1,3) = '813' and substr(strip(DX),1,4) ^in ('8134', '8135') then
249                        site = 'rad_ul_oth';
250                end;
251        
252            *Carpal... V Codes present but only one category;
253            if fx_site='(814) carpal' then
254                do;
255                    site = 'carpal';
256                 end;
257        
258            *Hip-closed and Hip-other;
259            if fx_site='(820, 73314) hip' then
260                    do;
261                    site = 'hip_cls'; /*Includes V Codes and 73314 here*/
262                    if substr(strip(DX),1,3)='820' and substr(strip(DX),1,4) ^in ('8200', '8202', '8208') then
263                        site = 'hip_oth';
264                end;
265        
266            *Other femur-closed and Other femur-other;
267            if fx_site='(821, 73315) femur' then
268                do;
269                    site = 'oth_fem_cls'; /*Includes V Codes and 73315 here*/
270                    if substr(strip(DX),1,3)='821' and substr(strip(DX),1,4) ^in ('8210', '8212') then
271                        site = 'oth_fem_oth';
5                                                                   The SAS System                                   15:21 Tuesday, September 12, 2017

272                end;
273        
274            *Tib/fib-closed and Tib/fib-other;
275            if fx_site='(823, 73316) tib_fib' then
276                do;
277                    site = 'tib_fib_cls'; /*Includes V Codes and 73316 here*/
278                    if substr(strip(DX),1,3)='823' and substr(strip(DX),1,4) ^in ('8230', '8232', '8238') then
279                        site = 'tib_fib_oth';
280                end;
281        
282            *Ankle... V Codes present but only one category;
283            if fx_site='(824) ankle' then
284                do;
285                    site = 'ankle';
286                end;
287        
288            /*Assign site for other fx_sites that do not have CQ algorithm and thus no sub categories*/
289            if site = "" then do;
290                site = fx_site;
291            end;
292        
293            label site = 'CQ Algorithm Fracture Site (Specific)';
294        
295        run;

NOTE: Invalid third argument to function SUBSTR at line 248 column 50.
database=MPCD exposure=NSAID or no exposure PATID=104237646 indexGNN=NoExp indexDate=07/20/2007 age=61 SEX=M ASdate=07/20/2007
ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2009 AScohortDate=07/20/2007 DEATH_DATE= indexID=3161 ENCOUNTERID=10986231261 ENC_TYPE=AV ADMIT_DATE=
BEGIN_DATE=03/26/2007 DISCHARGE_DATE= END_DATE=03/26/2007 DX_TYPE=09 DX=813 PDX=O codeType=ICD9-DX code=813 diagCodeType=Fracture code
fx_site=(813, 73312) radius_ulna site=rad_ul_oth _ERROR_=1 _N_=2247
NOTE: There were 122411 observations read from the data set WORK.FX_DGNS.
NOTE: The data set WORK.FX_DGNS_2 has 122411 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.18 seconds
      cpu time            0.14 seconds
      

296        
297        /*###########################################################################################################*/
298        /***************************************************Intermediate Fracture Diagnosis File**********************/
299        /*Combine CQ diagnosis files*******************************************************/
300        data fx_dgns_3;
301            set fx_dgns_2
302        /*    fx_excare_*/
303                ;
304        run;

NOTE: There were 122411 observations read from the data set WORK.FX_DGNS_2.
NOTE: The data set WORK.FX_DGNS_3 has 122411 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.10 seconds
      cpu time            0.11 seconds
      

305        
306        proc freq data=fx_dgns_3;
307            tables fx_site site;
308        run;

                                                                  --- AS project ---                             15:21 Tuesday, September 12, 2017   1

                                                                  The FREQ Procedure

                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec        1115        0.91          1115         0.91  
                                    (800-804) skull/face             3038        2.48          4153         3.39  
                                    (805, 806, 73313) spine         42744       34.92         46897        38.31  
                                    (807) rib/sternum/trachea        6229        5.09         53126        43.40  
                                    (808) pelvis                     3219        2.63         56345        46.03  
                                    (809) trunk bones                  92        0.08         56437        46.10  
                                    (810) clavicle                   1862        1.52         58299        47.63  
                                    (811) scapula                     437        0.36         58736        47.98  
                                    (812, 73311) humerus             8355        6.83         67091        54.81  
                                    (813, 73312) radius_ulna         8619        7.04         75710        61.85  
                                    (814) carpal                     1625        1.33         77335        63.18  
                                    (815-817) hand/fingers           5341        4.36         82676        67.54  
                                    (818-819) arms mult                70        0.06         82746        67.60  
                                    (820, 73314) hip                11466        9.37         94212        76.96  
                                    (821, 73315) femur               3932        3.21         98144        80.18  
                                    (822) patella                    1329        1.09         99473        81.26  
                                    (823, 73316) tib_fib             4596        3.75        104069        85.02  
                                    (824) ankle                      6172        5.04        110241        90.06  
                                    (825) tarsal_metatarsal          7870        6.43        118111        96.49  
                                    (826) foot_phalanges             3388        2.77        121499        99.25  
                                    (827) lower_limb                  110        0.09        121609        99.34  
                                    (828) legs+arm/rib                  8        0.01        121617        99.35  
                                    (829) fx_nos                      794        0.65        122411       100.00  


                                                        CQ Algorithm Fracture Site (Specific)
 
                                                                                          Cumulative    Cumulative
                                    site                         Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec        1115        0.91          1115         0.91  
                                    (800-804) skull/face             3038        2.48          4153         3.39  
                                    (807) rib/sternum/trachea        6229        5.09         10382         8.48  
                                    (809) trunk bones                  92        0.08         10474         8.56  
                                    (811) scapula                     437        0.36         10911         8.91  
                                    (815-817) hand/fingers           5341        4.36         16252        13.28  
                                    (818-819) arms mult                70        0.06         16322        13.33  
                                    (822) patella                    1329        1.09         17651        14.42  
                                    (825) tarsal_metatarsal          7870        6.43         25521        20.85  
                                    (826) foot_phalanges             3388        2.77         28909        23.62  
                                    (827) lower_limb                  110        0.09         29019        23.71  
                                    (828) legs+arm/rib                  8        0.01         29027        23.71  
                                    (829) fx_nos                      794        0.65         29821        24.36  
                                    ankle                            6172        5.04         35993        29.40  
                                    carpal                           1625        1.33         37618        30.73  
                                    clv_cls                          1862        1.52         39480        32.25  
                                    dist4arm                         5977        4.88         45457        37.13  
                                    hip_cls                         11207        9.16         56664        46.29  
                                    hip_oth                           259        0.21         56923        46.50  
                                    hmrs_cls                         8246        6.74         65169        53.24  
                                    hmrs_oth                          109        0.09         65278        53.33  
                                    oth_fem_cls                      3834        3.13         69112        56.46  
                                    oth_fem_oth                        98        0.08         69210        56.54  
                                    pelvis_cls                       3133        2.56         72343        59.10  
                                    pelvis_oth                         86        0.07         72429        59.17  
                                    rad_ul_oth                       2642        2.16         75071        61.33  
                                    spine_cls                       37931       30.99        113002        92.31  
                                    spine_oth                        4813        3.93        117815        96.25  
                                    tib_fib_cls                      4410        3.60        122225        99.85  
                                    tib_fib_oth                       186        0.15        122411       100.00  
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 122411 observations read from the data set WORK.FX_DGNS_3.
NOTE: The PROCEDURE FREQ printed page 1.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.18 seconds
      cpu time            0.14 seconds
      

309        
310        proc sort data=fx_dgns_3;
311            by patid ENCOUNTERID fx_site site;
312        run;

NOTE: There were 122411 observations read from the data set WORK.FX_DGNS_3.
6                                                                   The SAS System                                   15:21 Tuesday, September 12, 2017

NOTE: The data set WORK.FX_DGNS_3 has 122411 observations and 27 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.26 seconds
      cpu time            0.31 seconds
      

313        
314        
315        /*###########################################################################################################*/
316        /*************************************************************************************************************/
317        /*Look for repair procedures and assign treatment site*******************/
318        /*This code has been updated to include hip/femur replacement with matching diagnosis code, also looked in claim strip(DX) not just primary
318      !  strip(DX)
319        /*Not accepting contiguous sites until later*/
320        /*Excluding procedures from DME files*/
321        /*******************************Select All Spine Imaging Codes from STD Procedure Files for CQ=4/5 algorithms*/
322        
323        %macro fx_prcd;
324            data fx_prcd spine_xray;
325                set UCB.tempFracPxMPCD
326                    UCB.tempFracPxUCB
327                    UCB.tempFracPxSABR;
328        
329                    length tx_site $30;
330                    length HLAT $1;
331        
332                    if strip(px) in ('21300' '21310' '21315' '21320' '21325' '21330' '21335' '21336' '21337' '21338' '21339' '21340' '21343'
332      ! '21344' '21345' '21346' '21347' '21348'
333                                         '21355' '21356' '21360' '21365' '21366' '21385' '21386' '21387' '21390' '21395' '21400' '21401' '21406'
333      ! '21407' '21408' '21421' '21422' '21423'
334                                         '21431' '21432' '21433' '21435' '21436' '21440' '21445' '21450' '21451' '21452' '21453' '21454' '21461'
334      ! '21462' '21465' '21470'
335                                         '62000' '62005' '62010')  and lengthn(strip(px)) = 5 then do;
336                        tx_site='(800-804) skull/face'; output fx_prcd; end;
337        
338                    if strip(px) in ('22305' '22310' '22315' '22318' '22319' '22325' '22326' '22327' '22328' '22520' '22521' '22522' '22523'
338      ! '22524' '22525' '76012' '76013'
339                                         'S2360' 'S2361' 'S2362' 'S2363' '72291' '72292')  and lengthn(strip(px)) = 5 then do;
340                        tx_site = '(805, 806, 73313) spine'; output fx_prcd; end;
341        
342                    if  strip(px) in ('21493' '21494' '21495' '21800' '21805' '21810' '21820' '21825' ) then do;
343                        tx_site='(807) rib/sternum/trachea'; output fx_prcd; end;
344        
345                    if strip(px) in ('27193' '27194' '27215' '27216' '27217' '27218' '27220' '27222' '27226' '27227' '27228')  and
345      ! lengthn(strip(px)) = 5 then do;
346                        tx_site = '(808) pelvis'; output fx_prcd; end;
347        
348                    if strip(px) in ('23500' '23505' '23515')  and lengthn(strip(px)) = 5 then do;
349                        tx_site = '(810) clavicle'; output fx_prcd; end;
350        
351                    if strip(px) in ('23570' '23575' '23585') then do;
352                        tx_site= '(811) scapula'; output fx_prcd; end;
353        
354                    if strip(px) in ('23600' '23605' '23615' '23616' '23620' '23625' '23630' '23665' '24500' '24505' '24515' '24516' '24530'
354      ! '24535' '24538' '24545' '24546' '24560'
355                                 '24565' '24566' '24575' '24576' '24577' '24579' '24582')  and lengthn(strip(px)) = 5 then do;
356                        tx_site = '(812, 73311) humerus'; output fx_prcd; end;
357        
358                    if strip(px) in ('25600' '25605' '25606' '25607' '25608' '25609' '25620' '25650' '25651' '25652')  and lengthn(strip(px)) = 5
358      ! then do;
359                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
360        
361                    if strip(px) in ('24650' '24655' '24665' '24666' '24670' '24675' '24685' '25500' '25505' '25515' '25520' '25525' '25526'
361      ! '25530' '25535' '25545' '25560' '25565'
362                                 '25574' '25575')  and lengthn(strip(px)) = 5 then do;
363                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
364        
365                    if strip(px) in ('25622' '25624' '25628' '25630' '25635' '25645' '25680' '25685')  and lengthn(strip(px)) = 5 then do;
366                        tx_site = '(814) carpal'; output fx_prcd; end;
367        
368                    if strip(px) in ('26600' '26605' '26607' '26608' '26615' '26645' '26650' '26665' '26720' '26725' '26727' '26735' '26740'
368      ! '26742' '26746' '26750' '26755' '26756' '26765' )
7                                                                   The SAS System                                   15:21 Tuesday, September 12, 2017

369                               and lengthn(strip(px)) = 5 then do;
370                        tx_site='(815-817) hand/fingers'; output fx_prcd; end;
371        
372                    if '27230' <= strip(px) <= '27248' and lengthn(strip(px)) = 5 then do;
373                        tx_site = '(820, 73314) hip'; output fx_prcd; end;
374        
375                    if '27500' <= strip(px) <= '27514'  and lengthn(strip(px)) = 5 then do;
376                        tx_site = '(821, 73315) femur'; output fx_prcd; end;
377        
378                    if strip(px) in ('27520' '27524')  and lengthn(strip(px)) = 5 then do;
379                        tx_site = '(822) patella'; output fx_prcd; end;
380        
381                    if ('27530' <= strip(px) <= '27536' or '27750' <= strip(px) <= '27759' or '27780' <= strip(px) <= '27784' or '27824' <=
381      ! strip(px) <= '27828') and lengthn(strip(px)) = 5  then do;
382                        tx_site = '(823, 73316) tib_fib'; output fx_prcd; end;
383        
384                    if strip(px) in ('27760' '27762' '27766' '27786' '27788' '27792' '27808' '27810' '27814' '27816' '27818' '27822' '27823'
384      ! '28430' '28435' '28436' '28445')  and lengthn(strip(px)) = 5 then do;
385                        tx_site = '(824) ankle'; output fx_prcd; end;
386        
387                    if strip(px) in ('28320' '28322' '28400' '28405' '28406' '28415' '28420' ) and lengthn(strip(px)) = 5 then do;
388                        tx_site='(825) tarsal_metatarsal'; output fx_prcd; end;
389        
390                 /********************************Hip/Femur Additions - must be matched with DGNS to be included*/
391                 /*Hip replacement codes*/
392                    /*Hip*/
393                    if strip(px) in ('27130' '27125') and lengthn(strip(px)) = 5  then do;
394                        HLAT='1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
395        
396                    /*Codes below are the only ICD9 Procedure Codes that we are using for "repair"*/
397                    if strip(px) in ('8151' '8152') and lengthn(strip(px)) = 4 then do;
398                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
399        
400                    /*Femur repair codes, assigned to both Hip and Femur treatment sites... CHECK - MAYBE WE NEED TO DO THIS THE OTHER WAY AS
400      ! WELL*/
401                    /*Hip*/
402                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
403                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
404        
405                    /*Femur*/
406                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
407                        HLAT = '1'; tx_site = '(821, 73315) femur'; output fx_prcd; end;
408                     /*spine image*/
409                        if '72010' <= strip(px) <= '72159' or '72240' <= strip(px) <= '72285' or strip(px) = '72295' then do;   /*Spine Imaging
409      ! Codes*/
410                        tx_site='(805, 806, 73313) spine';
411                        output spine_xray; end;
412        
413            run;
414        
415            data fx_prcd;
416                set fx_prcd;
417                /*To add laterality info*/
418        /*        array hcpcs{*} hcpcs_1st_mdfr_cd hcpcs_2nd_mdfr_cd hcpcs_3rd_mdfr_cd hcpcs_4th_mdfr_cd ; */
419                if HLAT='1' then do;
420                    repair_right='0'; repair_left='0';
421                end;
422        /*        if HLAT='1' then */
423        /*            do i=1 to dim(hcpcs);*/
424        /*                if hcpcs{i} = 'RT' then repair_right='1';*/
425        /*                else if hcpcs{i} = 'LT' then repair_left='1';*/
426        /*            end;*/
427            run;
428            proc sort data=fx_prcd nodupkey; by patid ENCOUNTERID px_date tx_site; run;
429        
430            data spine_xray;
431                set spine_xray;
432                keep patid px_date tx_site  ENCOUNTERID begin_date;
433            run;
434            proc sort data=spine_xray nodupkey; by patid px_date; run;
435        %mend;
436        %fx_prcd;
8                                                                   The SAS System                                   15:21 Tuesday, September 12, 2017


WARNING: Multiple lengths were specified for the variable ADMIT_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable BEGIN_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DISCHARGE_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable END_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable PX_DATE by input data set(s). This can cause truncation of data.
NOTE: There were 880584 observations read from the data set UCB.TEMPFRACPXMPCD.
NOTE: There were 4303767 observations read from the data set UCB.TEMPFRACPXUCB.
NOTE: There were 30790932 observations read from the data set UCB.TEMPFRACPXSABR.
NOTE: The data set WORK.FX_PRCD has 26787 observations and 25 variables.
NOTE: The data set WORK.SPINE_XRAY has 393415 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           3:05.14
      cpu time            1:55.19
      


NOTE: There were 26787 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK.FX_PRCD has 26787 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.10 seconds
      cpu time            0.04 seconds
      


NOTE: There were 26787 observations read from the data set WORK.FX_PRCD.
NOTE: 13338 observations with duplicate key values were deleted.
NOTE: The data set WORK.FX_PRCD has 13449 observations and 27 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.09 seconds
      cpu time            0.06 seconds
      


NOTE: There were 393415 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.SPINE_XRAY has 393415 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.35 seconds
      cpu time            0.23 seconds
      


NOTE: There were 393415 observations read from the data set WORK.SPINE_XRAY.
NOTE: 272427 observations with duplicate key values were deleted.
NOTE: The data set WORK.SPINE_XRAY has 120988 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.40 seconds
      cpu time            0.40 seconds
      

437        
438        
439        
440        data trauma (rename=(begin_date=trauma_dt));
441                set UCB.tempFracDxMPCD (where = (diagCodeType = "Trauma code"))
442                    UCB.tempFracDxUCB (where = (diagCodeType = "Trauma code"))
443                    UCB.tempFracDxSABR (where = (diagCodeType = "Trauma code"));
444        run;

WARNING: Multiple lengths were specified for the variable ADMIT_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable BEGIN_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DISCHARGE_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable END_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DX by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable PDX by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable code by input data set(s). This can cause truncation of data.
NOTE: There were 342 observations read from the data set UCB.TEMPFRACDXMPCD.
      WHERE diagCodeType='Trauma code';
NOTE: There were 1134 observations read from the data set UCB.TEMPFRACDXUCB.
      WHERE diagCodeType='Trauma code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: There were 22433 observations read from the data set UCB.TEMPFRACDXSABR.
9                                                                   The SAS System                                   15:21 Tuesday, September 12, 2017

      WHERE diagCodeType='Trauma code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.TRAUMA has 23909 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           0.25 seconds
      cpu time            0.04 seconds
      

445        proc sort data= trauma(keep=patid trauma_dt) nodupkey; by patid trauma_dt;run;

NOTE: There were 23909 observations read from the data set WORK.TRAUMA.
NOTE: 13093 observations with duplicate key values were deleted.
NOTE: The data set WORK.TRAUMA has 10816 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.03 seconds
      

446        
447        
448        /*subset the spine xray procedure claim for patients with fx diagnosis code only*/
449        /*so SAS will not run out of memory*/
450        data fx_spine_xray(keep=patid tx_site px_date ENCOUNTERID begin_date);
451        if _n_=1 then do;
452          declare hash hid(dataset:"fx_dgns_3(where=(fx_site='(805, 806, 73313) spine')))", multidata:"N", hashexp:20);
453          rc=hid.defineKey("patid");
454          rc=hid.defineDone();
455        end;
456        set spine_xray;
457        rc=hid.find();
458        if rc=0;
459        run;

NOTE: There were 42744 observations read from the data set WORK.FX_DGNS_3.
      WHERE fx_site='(805, 806, 73313) spine';
NOTE: There were 120988 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.FX_SPINE_XRAY has 29694 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.54 seconds
      cpu time            0.15 seconds
      

460        /*subset the Trauma code for patients with fx diagnosis code only*/
461        /*so SAS will not run out of memory*/
462        data fx_trauma(drop=rc);
463        if _n_=1 then do;
464          declare hash hid(dataset:"fx_dgns_3", multidata:"N", hashexp:20);
465          rc=hid.defineKey("patid");
466          rc=hid.defineDone();
467        end;
468        set trauma;
469        rc=hid.find();
470        if rc=0;
471        run;

NOTE: There were 122411 observations read from the data set WORK.FX_DGNS_3.
NOTE: There were 10816 observations read from the data set WORK.TRAUMA.
NOTE: The data set WORK.FX_TRAUMA has 6107 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.35 seconds
      cpu time            0.12 seconds
      

472        /************************************Link Fracture Claims (ICD9 Diagnosis) with Repair Claims (CPT/HCPCS, some ICD9 procedure
472      ! code)***************/
473        
474        data fx_dgns_4(drop=rc: px_date tx_site xray_date trauma_dt);
475        if _n_=1 then do;
476          declare hash hid(dataset:"fx_prcd", multidata:"N", hashexp:20);
477          rc=hid.defineKey("patid", "px_date", "tx_site");
478        /*  rc=hid.defineData("px_date", "tx_site");*/
479          rc=hid.defineDone();
10                                                                  The SAS System                                   15:21 Tuesday, September 12, 2017

480          declare hash hxray(dataset:"fx_spine_xray(rename=px_date=xray_date)", multidata:"Y", hashexp:20);
481          rc=hxray.defineKey("patid", "tx_site");
482          rc=hxray.defineData("xray_date");
483          rc=hxray.defineDone();
484          declare hash htrauma(dataset:"fx_trauma", multidata:"Y", hashexp:20);
485          rc=htrauma.defineKey("patid");
486          rc=htrauma.defineData("trauma_dt");
487          rc=htrauma.defineDone();
488        end;
489        if 0 then set fx_prcd(keep=patid px_date tx_site)
490                      fx_spine_xray(keep=patid px_date tx_site rename=px_date=xray_date)
491                      fx_trauma;
492        set fx_dgns_3;
493        length cq $4 spine_image trauma_date 4 trauma $1;
494        format spine_image trauma_date mmddyy10.;
495        cq="0000";
496        rc=hid.find(key:patid, key:begin_date,key:fx_site);
497        if rc^=0 then do;
498            px_date=.;
499            tx_site=" ";
500        end;
501        if enc_type="IP" then do;
502        /*CQ = 1 Inpatient claim with primary diagnosis code */
503            if pdx="P" then substr(cq,1,1)="1";
504        /*CQ = 2 Inpatient claim with secondary diagnosis code*/
505            else substr(cq,2,1)="2";
506        end; else do;
507        /*CQ = 3 outpatient diagnosis code AND carrier line with repair/replace HCPCS*/
508            if rc=0 then substr(cq,3,1)="3";
509            rc1=hxray.find(key:patid, key:fx_site);
510            do while (rc1 = 0);
511                if begin_date-10 <=xray_date<= begin_date then do;
512                    if enc_type in ("AV" "IF" "NH" "HH" "ER" "ED") then do;
513        /*CQ = 4 outpatient [Physician E&M codes] diagnosis code with spine image/x-ray within 10 day early*/
514                        substr(cq,4,1)="4";
515                        spine_image=min(spine_image,xray_date);
516                    end;
517                end;
518                rc1=hxray.find_next(key:patid, key:fx_site);
519            end;
520        end;
521        /*is there trauma dx within 14 days*/
522        rc2=htrauma.find(key:patid);
523        do while (rc2 = 0) ;
524            if 0<=abs(trauma_dt-begin_date)<=14 then do;
525                    trauma="1";
526                    trauma_date=min(trauma_date,trauma_dt);
527           end ;
528           rc2=htrauma.find_next(key:patid) ;
529        end;
530        
531        run;

NOTE: There were 13449 observations read from the data set WORK.FX_PRCD.
NOTE: There were 29694 observations read from the data set WORK.FX_SPINE_XRAY.
NOTE: There were 6107 observations read from the data set WORK.FX_TRAUMA.
NOTE: There were 122411 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_4 has 122411 observations and 31 variables.
NOTE: DATA statement used (Total process time):
      real time           0.51 seconds
      cpu time            0.46 seconds
      

532        proc freq data=fx_dgns_4; tables enc_type*cq fx_site*cq trauma/missing;run;

                                                                  --- AS project ---                             15:21 Tuesday, September 12, 2017   2

                                                                  The FREQ Procedure

                                                               Table of ENC_TYPE by cq

                                       ENC_TYPE(Encounter Type)     cq

                                       Frequency|
                                       Percent  |
                                       Row Pct  |
                                       Col Pct  |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       AV       |  48595 |   9664 |   2151 |    216 |      0 |      0 |  60626
                                                |  39.70 |   7.89 |   1.76 |   0.18 |   0.00 |   0.00 |  49.53
                                                |  80.16 |  15.94 |   3.55 |   0.36 |   0.00 |   0.00 |
                                                |  62.05 |  56.68 |  34.00 |  51.92 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       ED       |  16327 |   5783 |   4154 |    200 |      0 |      0 |  26464
                                                |  13.34 |   4.72 |   3.39 |   0.16 |   0.00 |   0.00 |  21.62
                                                |  61.70 |  21.85 |  15.70 |   0.76 |   0.00 |   0.00 |
                                                |  20.85 |  33.92 |  65.67 |  48.08 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       HH       |   1346 |    141 |      2 |      0 |      0 |      0 |   1489
                                                |   1.10 |   0.12 |   0.00 |   0.00 |   0.00 |   0.00 |   1.22
                                                |  90.40 |   9.47 |   0.13 |   0.00 |   0.00 |   0.00 |
                                                |   1.72 |   0.83 |   0.03 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       IP       |      0 |      0 |      0 |      0 |  14021 |   6277 |  20298
                                                |   0.00 |   0.00 |   0.00 |   0.00 |  11.45 |   5.13 |  16.58
                                                |   0.00 |   0.00 |   0.00 |   0.00 |  69.08 |  30.92 |
                                                |   0.00 |   0.00 |   0.00 |   0.00 | 100.00 | 100.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       NH       |  12052 |   1463 |     19 |      0 |      0 |      0 |  13534
                                                |   9.85 |   1.20 |   0.02 |   0.00 |   0.00 |   0.00 |  11.06
                                                |  89.05 |  10.81 |   0.14 |   0.00 |   0.00 |   0.00 |
                                                |  15.39 |   8.58 |   0.30 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       Total       78320    17051     6326      416    14021     6277   122411
                                                   63.98    13.93     5.17     0.34    11.45     5.13   100.00


 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                             15:21 Tuesday, September 12, 2017   3

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (7331) pathologi |   1012 |      0 |      0 |      0 |     82 |     21 |   1115
                                   c nos/nec        |   0.83 |   0.00 |   0.00 |   0.00 |   0.07 |   0.02 |   0.91
                                                    |  90.76 |   0.00 |   0.00 |   0.00 |   7.35 |   1.88 |
                                                    |   1.29 |   0.00 |   0.00 |   0.00 |   0.58 |   0.33 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (800-804) skull/ |   2210 |      0 |    247 |      0 |    458 |    123 |   3038
                                   face             |   1.81 |   0.00 |   0.20 |   0.00 |   0.37 |   0.10 |   2.48
                                                    |  72.75 |   0.00 |   8.13 |   0.00 |  15.08 |   4.05 |
                                                    |   2.82 |   0.00 |   3.90 |   0.00 |   3.27 |   1.96 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (805, 806, 73313 |  14880 |  17051 |     32 |    416 |   7134 |   3231 |  42744
                                   ) spine          |  12.16 |  13.93 |   0.03 |   0.34 |   5.83 |   2.64 |  34.92
                                                    |  34.81 |  39.89 |   0.07 |   0.97 |  16.69 |   7.56 |
                                                    |  19.00 | 100.00 |   0.51 | 100.00 |  50.88 |  51.47 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (807) rib/sternu |   4424 |      0 |    738 |      0 |    886 |    181 |   6229
                                   m/trachea        |   3.61 |   0.00 |   0.60 |   0.00 |   0.72 |   0.15 |   5.09
                                                    |  71.02 |   0.00 |  11.85 |   0.00 |  14.22 |   2.91 |
                                                    |   5.65 |   0.00 |  11.67 |   0.00 |   6.32 |   2.88 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (808) pelvis     |   2513 |      0 |    113 |      0 |    440 |    153 |   3219
                                                    |   2.05 |   0.00 |   0.09 |   0.00 |   0.36 |   0.12 |   2.63
                                                    |  78.07 |   0.00 |   3.51 |   0.00 |  13.67 |   4.75 |
                                                    |   3.21 |   0.00 |   1.79 |   0.00 |   3.14 |   2.44 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (809) trunk bone |     90 |      0 |      0 |      0 |      2 |      0 |     92
                                   s                |   0.07 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.08
                                                    |  97.83 |   0.00 |   0.00 |   0.00 |   2.17 |   0.00 |
                                                    |   0.11 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (810) clavicle   |   1448 |      0 |    255 |      0 |    130 |     29 |   1862
                                                    |   1.18 |   0.00 |   0.21 |   0.00 |   0.11 |   0.02 |   1.52
                                                    |  77.77 |   0.00 |  13.69 |   0.00 |   6.98 |   1.56 |
                                                    |   1.85 |   0.00 |   4.03 |   0.00 |   0.93 |   0.46 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (811) scapula    |    338 |      0 |     46 |      0 |     45 |      8 |    437
                                                    |   0.28 |   0.00 |   0.04 |   0.00 |   0.04 |   0.01 |   0.36
                                                    |  77.35 |   0.00 |  10.53 |   0.00 |  10.30 |   1.83 |
                                                    |   0.43 |   0.00 |   0.73 |   0.00 |   0.32 |   0.13 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               78320    17051     6326      416    14021     6277   122411
                                                       63.98    13.93     5.17     0.34    11.45     5.13   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                             15:21 Tuesday, September 12, 2017   4

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (812, 73311) hum |   6733 |      0 |    697 |      0 |    601 |    324 |   8355
                                   erus             |   5.50 |   0.00 |   0.57 |   0.00 |   0.49 |   0.26 |   6.83
                                                    |  80.59 |   0.00 |   8.34 |   0.00 |   7.19 |   3.88 |
                                                    |   8.60 |   0.00 |  11.02 |   0.00 |   4.29 |   5.16 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (813, 73312) rad |   6726 |      0 |   1365 |      0 |    397 |    131 |   8619
                                   ius_ulna         |   5.49 |   0.00 |   1.12 |   0.00 |   0.32 |   0.11 |   7.04
                                                    |  78.04 |   0.00 |  15.84 |   0.00 |   4.61 |   1.52 |
                                                    |   8.59 |   0.00 |  21.58 |   0.00 |   2.83 |   2.09 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (814) carpal     |   1439 |      0 |    141 |      0 |     44 |      1 |   1625
                                                    |   1.18 |   0.00 |   0.12 |   0.00 |   0.04 |   0.00 |   1.33
                                                    |  88.55 |   0.00 |   8.68 |   0.00 |   2.71 |   0.06 |
                                                    |   1.84 |   0.00 |   2.23 |   0.00 |   0.31 |   0.02 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (815-817) hand/f |   4308 |      0 |    899 |      0 |    115 |     19 |   5341
                                   ingers           |   3.52 |   0.00 |   0.73 |   0.00 |   0.09 |   0.02 |   4.36
                                                    |  80.66 |   0.00 |  16.83 |   0.00 |   2.15 |   0.36 |
                                                    |   5.50 |   0.00 |  14.21 |   0.00 |   0.82 |   0.30 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (818-819) arms m |     68 |      0 |      0 |      0 |      2 |      0 |     70
                                   ult              |   0.06 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.06
                                                    |  97.14 |   0.00 |   0.00 |   0.00 |   2.86 |   0.00 |
                                                    |   0.09 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (820, 73314) hip |   7742 |      0 |    535 |      0 |   1945 |   1244 |  11466
                                                    |   6.32 |   0.00 |   0.44 |   0.00 |   1.59 |   1.02 |   9.37
                                                    |  67.52 |   0.00 |   4.67 |   0.00 |  16.96 |  10.85 |
                                                    |   9.89 |   0.00 |   8.46 |   0.00 |  13.87 |  19.82 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (821, 73315) fem |   2932 |      0 |    195 |      0 |    513 |    292 |   3932
                                   ur               |   2.40 |   0.00 |   0.16 |   0.00 |   0.42 |   0.24 |   3.21
                                                    |  74.57 |   0.00 |   4.96 |   0.00 |  13.05 |   7.43 |
                                                    |   3.74 |   0.00 |   3.08 |   0.00 |   3.66 |   4.65 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (822) patella    |   1017 |      0 |    136 |      0 |    127 |     49 |   1329
                                                    |   0.83 |   0.00 |   0.11 |   0.00 |   0.10 |   0.04 |   1.09
                                                    |  76.52 |   0.00 |  10.23 |   0.00 |   9.56 |   3.69 |
                                                    |   1.30 |   0.00 |   2.15 |   0.00 |   0.91 |   0.78 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               78320    17051     6326      416    14021     6277   122411
                                                       63.98    13.93     5.17     0.34    11.45     5.13   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                             15:21 Tuesday, September 12, 2017   5

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (823, 73316) tib |   3795 |      0 |    296 |      0 |    341 |    164 |   4596
                                   _fib             |   3.10 |   0.00 |   0.24 |   0.00 |   0.28 |   0.13 |   3.75
                                                    |  82.57 |   0.00 |   6.44 |   0.00 |   7.42 |   3.57 |
                                                    |   4.85 |   0.00 |   4.68 |   0.00 |   2.43 |   2.61 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (824) ankle      |   4890 |      0 |    559 |      0 |    482 |    241 |   6172
                                                    |   3.99 |   0.00 |   0.46 |   0.00 |   0.39 |   0.20 |   5.04
                                                    |  79.23 |   0.00 |   9.06 |   0.00 |   7.81 |   3.90 |
                                                    |   6.24 |   0.00 |   8.84 |   0.00 |   3.44 |   3.84 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (825) tarsal_met |   7545 |      0 |     72 |      0 |    191 |     62 |   7870
                                   atarsal          |   6.16 |   0.00 |   0.06 |   0.00 |   0.16 |   0.05 |   6.43
                                                    |  95.87 |   0.00 |   0.91 |   0.00 |   2.43 |   0.79 |
                                                    |   9.63 |   0.00 |   1.14 |   0.00 |   1.36 |   0.99 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (826) foot_phala |   3329 |      0 |      0 |      0 |     55 |      4 |   3388
                                   nges             |   2.72 |   0.00 |   0.00 |   0.00 |   0.04 |   0.00 |   2.77
                                                    |  98.26 |   0.00 |   0.00 |   0.00 |   1.62 |   0.12 |
                                                    |   4.25 |   0.00 |   0.00 |   0.00 |   0.39 |   0.06 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (827) lower_limb |    107 |      0 |      0 |      0 |      3 |      0 |    110
                                                    |   0.09 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.09
                                                    |  97.27 |   0.00 |   0.00 |   0.00 |   2.73 |   0.00 |
                                                    |   0.14 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (828) legs+arm/r |      5 |      0 |      0 |      0 |      3 |      0 |      8
                                   ib               |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.01
                                                    |  62.50 |   0.00 |   0.00 |   0.00 |  37.50 |   0.00 |
                                                    |   0.01 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (829) fx_nos     |    769 |      0 |      0 |      0 |     25 |      0 |    794
                                                    |   0.63 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |   0.65
                                                    |  96.85 |   0.00 |   0.00 |   0.00 |   3.15 |   0.00 |
                                                    |   0.98 |   0.00 |   0.00 |   0.00 |   0.18 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               78320    17051     6326      416    14021     6277   122411
                                                       63.98    13.93     5.17     0.34    11.45     5.13   100.00


                                                                                Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                                         105947       86.55        105947        86.55  
                                             1            16464       13.45        122411       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 122411 observations read from the data set WORK.FX_DGNS_4.
NOTE: The PROCEDURE FREQ printed pages 2-5.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.32 seconds
      cpu time            0.28 seconds
      

11                                                                  The SAS System                                   15:21 Tuesday, September 12, 2017

533        
534        *goto 002_fx_epi.sas;
535        
536        
537        
538        
539        /*
540        START OF 002_fx_data.sas
541         */
542        
543        /*all the claims to define episode sequence */
544        data _dat0(keep=
545        PATID ENCOUNTERID ADMIT_DATE DISCHARGE_DATE BEGIN_DATE END_DATE DX DX_TYPE PDX  /* SOURCE */ ENC_TYPE fx_site px px_date
546        site cq spine_image trauma_date trauma );
547        set fx_dgns_4 fx_excare Fx_prcd(rename=tx_site=fx_site);
548        run;

WARNING: Multiple lengths were specified for the variable code by input data set(s). This can cause truncation of data.
NOTE: There were 122411 observations read from the data set WORK.FX_DGNS_4.
NOTE: There were 20728 observations read from the data set WORK.FX_EXCARE.
NOTE: There were 13449 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK._DAT0 has 156588 observations and 18 variables.
NOTE: DATA statement used (Total process time):
      real time           0.15 seconds
      cpu time            0.12 seconds
      

549        proc sort data=_dat0; by PATID fx_site BEGIN_DATE END_DATE; run;

NOTE: There were 156588 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT0 has 156588 observations and 18 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.15 seconds
      cpu time            0.29 seconds
      

550        /*for each claim define start and end date applicable to IP NH and NH*/
551        data _dat1;
552        set _dat0;
553        length start_date end_date 4;
554        format start_date end_date mmddyy10.;
555        by PATID fx_site BEGIN_DATE END_DATE;
556        start_date=min(ADMIT_DATE, BEGIN_DATE);
557        end_date=max(DISCHARGE_DATE, End_DATE);
558        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      616 at 556:12   
NOTE: There were 156588 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT1 has 156588 observations and 19 variables.
NOTE: DATA statement used (Total process time):
      real time           0.18 seconds
      cpu time            0.14 seconds
      

559        proc sort data=_dat1; by PATID fx_site start_date end_date; run;

NOTE: There were 156588 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT1 has 156588 observations and 19 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.15 seconds
      cpu time            0.26 seconds
      

560        
561        /* generate unique episode sequence ID */
562        data _dat2(drop=end_date_max lag_end_date_max _gap);
563        set _dat1;
564        length lag_end_date_max end_date_max 4;
565        format lag_end_date_max end_date_max mmddyy10.;
566        
12                                                                  The SAS System                                   15:21 Tuesday, September 12, 2017

567        by PATID fx_site start_date end_date;
568        retain seq 0;
569        
570        /*if current claims end date > all previouse claim end date in sequence, then update*/
571        end_date_max=max(end_date,end_date_max);
572        lag_end_date_max=lag(end_date_max);
573        
574        if first.fx_site then lag_end_date_max=.;
575        _gap=start_date-lag_end_date_max;
576        
577        /*if current claims start date >90 days after all previouse claim end date in sequence,
578        then start new sequence*/
579        if first.fx_site or start_date-lag_end_date_max>90 then do;
580            end_date_max=end_date;
581        
582            seq+1;
583        end;
584        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      19391 at 575:16   19391 at 579:31   
NOTE: There were 156588 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT2 has 156588 observations and 20 variables.
NOTE: DATA statement used (Total process time):
      real time           0.15 seconds
      cpu time            0.15 seconds
      

585        proc sort data=_dat2; by seq;run;

NOTE: There were 156588 observations read from the data set WORK._DAT2.
NOTE: The data set WORK._DAT2 has 156588 observations and 20 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.15 seconds
      cpu time            0.21 seconds
      

586        proc sql;
587        /*episode sequence start date*/
588        create table seq_start as
589        select patid, seq, min(start_date) as seq_start_date length=4 format=mmddyy10.
590         from _dat2
591         where substr(dx,1,4) not in ('V541' 'V542')
592         group by patid, seq
593         order by patid, seq;
NOTE: Table WORK.SEQ_START created, with 20307 rows and 3 columns.

594        /*episode sequence end date*/
595        create table seq_end as
596        select patid, seq,
597         max(start_date) as seq_end_date length=4 format=mmddyy10. from _dat2
598         group by patid, seq
599         order by patid, seq;
NOTE: Table WORK.SEQ_END created, with 24352 rows and 3 columns.

600        quit;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.60 seconds
      cpu time            0.43 seconds
      

601        /*episode sequence case qualifier indicator and trauma*/
602        data seq_cq(keep=patid seq seq_cq seq_trauma fx_site);
603        set _dat2;
604        by patid seq;
605        length seq_cq $4 seq_trauma $1;
606        retain seq_cq seq_trauma;
607        if first.seq then do;
608            seq_cq="0000";
609            seq_trauma="0";
610        end;
13                                                                  The SAS System                                   15:21 Tuesday, September 12, 2017

611        if trauma="1" then seq_trauma=trauma;
612        do i=1 to 4;
613        if substr(cq,i,1)>substr(seq_cq,i,1) then substr(seq_cq,i,1)=substr(cq,i,1);
614        end;
615        if last.seq then output;
616        run;

NOTE: There were 156588 observations read from the data set WORK._DAT2.
NOTE: The data set WORK.SEQ_CQ has 24352 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.29 seconds
      cpu time            0.12 seconds
      

617        proc freq data=seq_cq; tables seq_cq seq_trauma fx_site; run;

                                                                  --- AS project ---                             15:21 Tuesday, September 12, 2017   6

                                                                  The FREQ Procedure

                                                                                Cumulative    Cumulative
                                             seq_cq    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0000         15963       65.55         15963        65.55  
                                             0004          1502        6.17         17465        71.72  
                                             0030          1140        4.68         18605        76.40  
                                             0034            41        0.17         18646        76.57  
                                             0200          1827        7.50         20473        84.07  
                                             0204           289        1.19         20762        85.26  
                                             0230            78        0.32         20840        85.58  
                                             0234             8        0.03         20848        85.61  
                                             1000           458        1.88         21306        87.49  
                                             1004           191        0.78         21497        88.28  
                                             1030            76        0.31         21573        88.59  
                                             1034            12        0.05         21585        88.64  
                                             1200          1396        5.73         22981        94.37  
                                             1204          1062        4.36         24043        98.73  
                                             1230           250        1.03         24293        99.76  
                                             1234            59        0.24         24352       100.00  


                                             seq_                               Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0            21808       89.55         21808        89.55  
                                             1             2544       10.45         24352       100.00  


                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec         604        2.48           604         2.48  
                                    (800-804) skull/face              523        2.15          1127         4.63  
                                    (805, 806, 73313) spine          5937       24.38          7064        29.01  
                                    (807) rib/sternum/trachea        1314        5.40          8378        34.40  
                                    (808) pelvis                      506        2.08          8884        36.48  
                                    (809) trunk bones                  24        0.10          8908        36.58  
                                    (810) clavicle                    292        1.20          9200        37.78  
                                    (811) scapula                     114        0.47          9314        38.25  
                                    (812, 73311) humerus              994        4.08         10308        42.33  
                                    (813, 73312) radius_ulna         1220        5.01         11528        47.34  
                                    (814) carpal                      482        1.98         12010        49.32  
                                    (815-817) hand/fingers            861        3.54         12871        52.85  
                                    (818-819) arms mult                25        0.10         12896        52.96  
                                    (820, 73314) hip                 3319       13.63         16215        66.59  
                                    (821, 73315) femur               1103        4.53         17318        71.12  
                                    (822) patella                     624        2.56         17942        73.68  
                                    (823, 73316) tib_fib              831        3.41         18773        77.09  
                                    (824) ankle                       984        4.04         19757        81.13  
                                    (825) tarsal_metatarsal          1180        4.85         20937        85.98  
                                    (826) foot_phalanges              688        2.83         21625        88.80  
                                    (827) lower_limb                   37        0.15         21662        88.95  
                                    (828) legs+arm/rib                  7        0.03         21669        88.98  
                                    (829) fx_nos                     2683       11.02         24352       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 24352 observations read from the data set WORK.SEQ_CQ.
NOTE: The PROCEDURE FREQ printed page 6.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.12 seconds
      cpu time            0.04 seconds
      

618        
619        data seq_cq_date;
620        merge seq_cq seq_start seq_end;
621        by patid seq;
622        length site_order $1;
623        if fx_site='(820, 73314) hip' then site_order='1';
624        if fx_site='(821, 73315) femur' then site_order='2';
625        if fx_site='(808) pelvis' then site_order='3';
626        if fx_site='(805, 806, 73313) spine' then site_order='4';
627        if fx_site='(812, 73311) humerus' then site_order='5';
628        if fx_site='(813, 73312) radius_ulna' then site_order='6';
629        if fx_site='(823, 73316) tib_fib' then site_order='7';
630        if fx_site='(824) ankle' then site_order='8';
631        if fx_site='(810) clavicle' then site_order='9';
632        run;

NOTE: There were 24352 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 20307 observations read from the data set WORK.SEQ_START.
NOTE: There were 24352 observations read from the data set WORK.SEQ_END.
NOTE: The data set WORK.SEQ_CQ_DATE has 24352 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds
      

633        
634        data _tmp_combo;
635        set seq_cq_date;
636        where site_order^=" " and seq_cq^="0000" and seq_cq^=" ";
637        run;

NOTE: There were 6969 observations read from the data set WORK.SEQ_CQ_DATE.
      WHERE (site_order not = ' ') and seq_cq not in (' ', '0000');
NOTE: The data set WORK._TMP_COMBO has 6969 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.00 seconds
      

638        
639        * define combo or alone fx;
640        data seq_COMBO(
641        keep=patid seq seq_cq seq_start_date alone_combo fx_site site_order)
642        ;
643        if _n_=1 then do;
644            declare hash hpid(dataset:"_tmp_combo(where=(seq_cq^='0000' and seq_cq^=' ')
645                    rename=(seq_start_date=seq_start_date2  fx_site= fx_site_combo seq=seq_COMBO))", ordered: 'a', multidata:"Y");
646            rc=hpid.defineKey("patid");
647            rc=hpid.defineData("patid","seq_start_date2", "fx_site_combo", "seq_COMBO");
14                                                                  The SAS System                                   15:21 Tuesday, September 12, 2017

648            rc=hpid.defineDone();
649        end;
650        if 0 then set _tmp_combo(rename=(seq_start_date=seq_start_date2 fx_site= fx_site_combo seq=seq_COMBO));
651        set _tmp_combo(where=(seq_cq^="0000" and seq_cq^=" ") );
652        by patid seq;
653        length  index_fx_begin 4 alone_combo $5;
654        alone_combo="alone";
655            format index_fx_begin mmddyy10.;
656            index_fx_begin=seq_start_date;
657        
658         rc=hpid.find(key:patid);
659        
660         do while (rc = 0);
661         if rc=0 and abs(seq_start_date-seq_start_date2) <=30 and fx_site_combo^=fx_site then alone_combo= 'combo';
662         rc=hpid.find_next();
663         *hpid.has_next(result:r);
664        end;
665        if alone_combo="alone" then do;
666            seq_start_date2=.; fx_site_combo=" "; seq_COMBO=.;
667        end;
668        run;

NOTE: There were 6969 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: There were 6969 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.SEQ_COMBO has 6969 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.17 seconds
      cpu time            0.01 seconds
      

669        proc freq data=seq_COMBO; tables alone_combo; run;

                                                                  --- AS project ---                             15:21 Tuesday, September 12, 2017   7

                                                                  The FREQ Procedure

                                             alone_                             Cumulative    Cumulative
                                             combo     Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             alone         6128       87.93          6128        87.93  
                                             combo          841       12.07          6969       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 6969 observations read from the data set WORK.SEQ_COMBO.
NOTE: The PROCEDURE FREQ printed page 7.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.07 seconds
      cpu time            0.01 seconds
      

670        
671        proc sort data = Work.seq_COMBO;
672          by patid seq_start_date;
673        run;

NOTE: There were 6969 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 6969 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

674        
675        data combo_seq;
676        set seq_COMBO;
677        by patid seq_start_date;
678        length combo_fx_site $30. combo_seq 4;
679        retain combo_seq 0 combo_fx_site;
680        if first.patid or seq_start_date-lag(seq_start_date) then combo_seq=1+combo_seq;
681        where seq_cq^='0000' and seq_cq^=' ';
682        if combo_fx_site=" " or ""<site_order<lag(site_order) then combo_fx_site=fx_site;
683        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      1 at 680:33   
NOTE: There were 6969 observations read from the data set WORK.SEQ_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.COMBO_SEQ has 6969 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.10 seconds
15                                                                  The SAS System                                   15:21 Tuesday, September 12, 2017

      cpu time            0.01 seconds
      

684        
685        proc sort data = Work.seq_COMBO;
686          by patid seq;
687        run;

NOTE: There were 6969 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 6969 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.03 seconds
      cpu time            0.00 seconds
      

688        
689        data FX_CLM_DB;
690        merge _dat2 seq_start seq_end seq_cq(drop=fx_site) seq_COMBO(keep=patid seq alone_combo);
691        by patid seq;
692        run;

NOTE: There were 156588 observations read from the data set WORK._DAT2.
NOTE: There were 20307 observations read from the data set WORK.SEQ_START.
NOTE: There were 24352 observations read from the data set WORK.SEQ_END.
NOTE: There were 24352 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 6969 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.FX_CLM_DB has 156588 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           0.27 seconds
      cpu time            0.24 seconds
      

693        
694        proc sql;
695        select count(distinct seq) from FX_CLM_DB;
                                                                  --- AS project ---                             15:21 Tuesday, September 12, 2017   8

                                                                               
                                                                       --------
                                                                          24352
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
696        quit;
NOTE: The PROCEDURE SQL printed page 8.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.29 seconds
      cpu time            0.15 seconds
      

697        
698        
699        
700        
701        /*
702        Collapse to fracture episodes
703        
704        Q: Why are some seq_start_date values missing?
705         */
706        proc sort
707          data = Work.fx_clm_db
708          out = Work.fractureEpisodes (drop = seq
709                                       rename = (seq_start_date = fractureEpisodeStart
710                                                 seq_end_date = fractureEpisodeEnd
711                                                 fx_site = fractureSite))
712          nodupkey;
713          by patid seq seq_start_date seq_end_date fx_site;
714        run;

NOTE: There were 156588 observations read from the data set WORK.FX_CLM_DB.
NOTE: 132236 observations with duplicate key values were deleted.
NOTE: The data set WORK.FRACTUREEPISODES has 24352 observations and 24 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.48 seconds
      cpu time            0.25 seconds
      

715        
716        proc sql;
717          create table DT.fractureEpisodesPrev as
16                                                                  The SAS System                                   15:21 Tuesday, September 12, 2017

718            select A.database,
719                   A.exposure,
720                   A.indexGNN,
721                   A.indexDate,
722                   A.ASCohortDate,
723                   A.indexID,
724                   A.age,
725                   A.sex,
726                   B.*,
727                   case
728                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
729                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
730                     else ""
731                     end as fractureType
732            from DT.indexLookup A inner join
733                 Work.fractureEpisodes B on (A.patid = B.patid);
NOTE: Table DT.FRACTUREEPISODESPREV created, with 41021 rows and 33 columns.

734          create table Work.summaryFractureEpisodesPrev as
735            select "DT.fractureEpisodesPrev" as table,
736                   fractureType, fractureSite,
737                   count(distinct patid) as countDistinctPatid,
738                   count(*) as countFractureEpisodes
739            from DT.fractureEpisodesPrev
740            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESPREV created, with 23 rows and 5 columns.

741          select * from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                             15:21 Tuesday, September 12, 2017   9

                                                                                                                    count         count
                                                                                                                 Distinct      Fracture
               table                    fractureType                         fractureSite                           Patid      Episodes
               ------------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesPrev                                       (7331) pathologic nos/nec                532          1024
               DT.fractureEpisodesPrev                                       (800-804) skull/face                     484           885
               DT.fractureEpisodesPrev                                       (807) rib/sternum/trachea               1189          2179
               DT.fractureEpisodesPrev                                       (809) trunk bones                         24            40
               DT.fractureEpisodesPrev                                       (810) clavicle                           264           504
               DT.fractureEpisodesPrev                                       (811) scapula                            104           191
               DT.fractureEpisodesPrev                                       (814) carpal                             457           889
               DT.fractureEpisodesPrev                                       (815-817) hand/fingers                   793          1561
               DT.fractureEpisodesPrev                                       (818-819) arms mult                       25            41
               DT.fractureEpisodesPrev                                       (822) patella                            537          1147
               DT.fractureEpisodesPrev                                       (823, 73316) tib_fib                     662          1446
               DT.fractureEpisodesPrev                                       (824) ankle                              812          1784
               DT.fractureEpisodesPrev                                       (825) tarsal_metatarsal                  994          2179
               DT.fractureEpisodesPrev                                       (826) foot_phalanges                     639          1313
               DT.fractureEpisodesPrev                                       (827) lower_limb                          35            66
               DT.fractureEpisodesPrev                                       (828) legs+arm/rib                         7             8
               DT.fractureEpisodesPrev                                       (829) fx_nos                            2273          4266
               DT.fractureEpisodesPrev  Clinical vertebral fracture          (805, 806, 73313) spine                 3819          9502
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (808) pelvis                             425           794
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (812, 73311) humerus                     754          1633
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                1018          2145
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (820, 73314) hip                        2601          5647
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (821, 73315) femur                       868          1777
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
742          select "DT.fractureEpisodesPrev" as table,
743                 sum(countDistinctPatid) as sumDistinctPatid,
744                 sum(countFractureEpisodes) as sumFractureEpisodes
745            from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                             15:21 Tuesday, September 12, 2017  10

                                                                           sumDistinct   sumFracture
                                                 table                           Patid      Episodes
                                                 ---------------------------------------------------
                                                 DT.fractureEpisodesPrev         19316         41021
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
746        
747          create table DT.fractureEpisodesInc as
748            select A.database,
749                   A.ENR_END_DATE,
750                   A.DEATH_DATE,
751                   A.exposure,
752                   A.exposureStart,
753                   A.exposureEnd,
754                   A.daysExposed,
755                   A.exposureID,
756                   B.*,
757                   case
758                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
759                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
760                     else ""
761                     end as fractureType
762            from DT.exposureTimeline A inner join
763                 Work.fractureEpisodes B on (A.patid = B.patid  & A.exposureStart <= B.fractureEpisodeStart <= A.exposureEnd);
NOTE: Table DT.FRACTUREEPISODESINC created, with 10371 rows and 33 columns.

764          create table Work.summaryFractureEpisodesInc as
765            select "DT.fractureEpisodesInc" as table,
766                   fractureType, fractureSite,
767                   count(distinct patid) as countDistinctPatid,
768                   count(*) as countFractureEpisodes
769            from DT.fractureEpisodesInc
770            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESINC created, with 23 rows and 5 columns.

771          select * from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                             15:21 Tuesday, September 12, 2017  11

                                                                                                                   count         count
                                                                                                                Distinct      Fracture
               table                   fractureType                         fractureSite                           Patid      Episodes
               -----------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesInc                                       (7331) pathologic nos/nec                126           139
               DT.fractureEpisodesInc                                       (800-804) skull/face                     237           254
               DT.fractureEpisodesInc                                       (807) rib/sternum/trachea                646           701
               DT.fractureEpisodesInc                                       (809) trunk bones                         13            13
               DT.fractureEpisodesInc                                       (810) clavicle                           148           154
               DT.fractureEpisodesInc                                       (811) scapula                             62            67
               DT.fractureEpisodesInc                                       (814) carpal                             152           159
               DT.fractureEpisodesInc                                       (815-817) hand/fingers                   412           444
               DT.fractureEpisodesInc                                       (818-819) arms mult                       13            13
               DT.fractureEpisodesInc                                       (822) patella                             84           104
               DT.fractureEpisodesInc                                       (823, 73316) tib_fib                     278           334
               DT.fractureEpisodesInc                                       (824) ankle                              346           401
               DT.fractureEpisodesInc                                       (825) tarsal_metatarsal                  496           577
               DT.fractureEpisodesInc                                       (826) foot_phalanges                     333           349
               DT.fractureEpisodesInc                                       (827) lower_limb                          15            15
               DT.fractureEpisodesInc                                       (828) legs+arm/rib                         3             3
               DT.fractureEpisodesInc                                       (829) fx_nos                             134           149
               DT.fractureEpisodesInc  Clinical vertebral fracture          (805, 806, 73313) spine                 2167          2998
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (808) pelvis                             232           254
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (812, 73311) humerus                     409           494
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                 477           547
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (820, 73314) hip                        1361          1623
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (821, 73315) femur                       494           579
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
772          select "DT.fractureEpisodesInc" as table,
773                 sum(countDistinctPatid) as sumDistinctPatid,
774                 sum(countFractureEpisodes) as sumFractureEpisodes
775            from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                             15:21 Tuesday, September 12, 2017  12

                                                                           sumDistinct   sumFracture
                                                  table                          Patid      Episodes
                                                  --------------------------------------------------
                                                  DT.fractureEpisodesInc          8638         10371
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
776        quit;
NOTE: The PROCEDURE SQL printed pages 9-12.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.96 seconds
      cpu time            0.71 seconds
      
17                                                                  The SAS System                                   15:21 Tuesday, September 12, 2017


777        
778        
779        
780        
781        /*
782        CLEAN UP
783        
784        proc sql;
785          drop table UCB.tempFracDxMPCD;
786          drop table UCB.tempFracDxUCB;
787          drop table UCB.tempFracDxSABR;
788          drop table UCB.tempFracPxMPCD;
789          drop table UCB.tempFracPxUCB;
790          drop table UCB.tempFracPxSABR;
791        quit;
792         */
793        
794        
795        proc export
796          data = Work.summaryFractureEpisodes
797          outfile = "data\processed\&cmt..csv"
798          dbms = csv
799          replace;
800          delimiter = '09'x;
801        run;

ERROR: File WORK.SUMMARYFRACTUREEPISODES.DATA does not exist. 
ERROR: Export unsuccessful.  See SAS Log for details.
NOTE: PROCEDURE EXPORT used (Total process time):
      real time           1.96 seconds
      cpu time            0.14 seconds
      

802        
803        
804        ods html close;
ERROR: Errors printed on page 17.

NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           3:22.59
      cpu time            2:02.03
      
