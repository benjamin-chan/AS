1                                         The SAS System                17:45 Monday, May 21, 2018

NOTE: Copyright (c) 2016 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M5) 
      Licensed to UNIVERSITY OF ALABAMA AT BIRMINGHAM - SFA - T&R, Site 70086550.
NOTE: This session is executing on the X64_DS08R2  platform.



NOTE: Updated analytical products:
      
      SAS/STAT 14.3
      SAS/ETS 14.3
      SAS/IML 14.3
      SAS/QC 14.3

NOTE: Additional host information:

 X64_DS08R2 WIN 6.1.7601 Service Pack 1 Server

--- PEER News and Updates ---

: SECURITY REMINDER :
Please remember not to copy any data files that contain PHI (protected health identifiers) to any 
of the shared folders.

 


NOTE: SAS initialization used:
      real time           4.61 seconds
      cpu time            0.29 seconds
      
1          *  University of Alabama at Birmingham                               *
2          *  AS project                                            *
3          **********************************************************************;
4          options pagesize=74 linesize=150 pageno=1 missing=' ' date FORMCHAR="|----|+|---+=|-/\<>*";
5          * Programmer    : Benjamin Chan <chanb@ohsu.edu>
6          * Creation date :
7          * Modify date   :
8          ;
9          %let cmt=queryFractures; * type the name of your program here (without the filename extension);
10         %let pgm=&cmt..sas;
11         %include "lib\libname.sas" ;
NOTE: Libref STDC5P was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: H:\studies\osteo\data\STD_files\5pct\
NOTE: Libref STD_SABR was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\data\std_SABER\
NOTE: Libref MPSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\mpcd\data\stddata\
NOTE: Libref UCBSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\stddata\
NOTE: Libref UCB was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB\
NOTE: Libref DT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: V:\studies\AS\data
NOTE: Libref NDC was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: W:\onenote\references\drug ndcs\sas data
128        footnote "&pgm.";
129        * footnote2 "%sysfunc(datetime(),datetime14.)";
130        title1 '--- AS project ---';
131        **********************************************************************;
132        options macrogen mlogic mprint symbolgen;
133        options nomacrogen nomlogic nomprint nosymbolgen;
134        
135        
136        ods html
2                                                                   The SAS System                                          17:45 Monday, May 21, 2018

137          body = "output\&cmt..html"
138          style = Statistical;
NOTE: Writing HTML Body file: output\queryFractures.html
139        
140        
141        /*
142        FRACTURES
143        
144        See "ALGORITHMS TO ENHANCE SPECIFICITY OF FRACTURE IDENTIFICATION_ 100316.docx"
145        
146        Adapted from Lang's code in "001_fx_data.sas"
147        
148        
149        From: Chen, Lang [mailto:langchen@uabmc.edu]
150        Sent: Monday, July 24, 2017 8:56 AM
151        To: Benjamin Chan <chanb@ohsu.edu>
152        Subject: RE: fracture identification algorithm
153        
154        Here it is.
155        For 001_fx_data, find all fx related claim and run the algorithm.
156        Please ignore any code after line 476
157        Modify code from line 1 -50
158        
159        For 002_fx_epi_data
160        Define fx episode.
161        
162        Final output data is fx_dgns_&firstyr._&lastyr._4. Please let me if you have any questions.
163         */
164        
165        
166        /*
167        START OF 001_fx_data.sas
168         */
169        
170        
171        /*Assign "Broad" fracture site (fx_site) for all ICD9 diagnoses, outputting separately, so some records are cloned, then combining into one
171      !  file */
172        /*No longer using matched trauma files here*/
173        
174        %macro comballfxdgns;
175            data fx_dgns;
176                set UCB.tempFracDxAll (where = (diagCodeType = "Fracture code"));
177                    length fx_site $30 ;
178                    fx_site = '';
179                    if strip(DX) in: ('800' '801' '802' '803' '804') then           do; fx_site='(800-804) skull/face'; output; end;
180                    if strip(DX) in: ('805', '806') or strip(DX)='73313' then       do; fx_site='(805, 806, 73313) spine'; output; end;
181                    if strip(DX) in: ('807') then                                           do; fx_site='(807) rib/sternum/trachea'; output; end;
182                    if strip(DX) in: ('808') then                                           do; fx_site='(808) pelvis'; output; end;
183                    if strip(DX) in: ('809') then                                           do; fx_site='(809) trunk bones'; output; end;
184                    if strip(DX) in: ('810') then                                           do; fx_site='(810) clavicle'; output; end;
185                    if strip(DX) in: ('811') then                                           do; fx_site='(811) scapula'; output; end;
186                    if strip(DX) in: ('812') or strip(DX)='73311' then              do; fx_site='(812, 73311) humerus'; output; end;
187                    if strip(DX) in: ('813') or strip(DX)='73312' then              do; fx_site='(813, 73312) radius_ulna'; output; end;
188                    if strip(DX) in: ('814') then                                           do; fx_site='(814) carpal'; output; end;
189                    if strip(DX) in: ('815' '816' '817') then                           do; fx_site='(815-817) hand/fingers'; output; end;
190                    if strip(DX) in: ('818' '819') then                                     do; fx_site='(818-819) arms mult'; output; end;
191                    if strip(DX) in: ('820') or strip(DX) = '73314' then                do; fx_site='(820, 73314) hip'; output; end;
192                    if strip(DX) in: ('821') or strip(DX)='73315' then              do; fx_site='(821, 73315) femur'; output; end;
193                    if strip(DX) in: ('822') then                                           do; fx_site='(822) patella'; output; end;
194                    if strip(DX) in: ('823') or strip(DX)='73316' then              do; fx_site='(823, 73316) tib_fib'; output; end;
195                    if strip(DX) in: ('824') then                                           do; fx_site='(824) ankle'; output; end;
196                    if strip(DX) in: ('825') then                                           do; fx_site='(825) tarsal_metatarsal'; output; end;
197                    if strip(DX) in: ('826') then                                           do; fx_site='(826) foot_phalanges'; output; end;
198                    if strip(DX) in: ('827') then                                           do; fx_site='(827) lower_limb'; output; end;
199                    if strip(DX) in: ('828') then                                           do; fx_site='(828) legs+arm/rib'; output; end;
200                    if strip(DX) in: ('829') then                                           do; fx_site='(829) fx_nos'; output; end;
201                    if strip(DX) in ('73310' '73319' '7331') then                 do; fx_site='(7331) pathologic nos/nec'; output; end;
202            data fx_excare;
203                set UCB.tempFracDxAll (where = (diagCodeType = "Extended care code"));
204                    length fx_site $30 ;
205                    fx_site = '';
206                    /*Expanded Diagnosis Codes - Fracture Aftercare Codes*/
3                                                                   The SAS System                                          17:45 Monday, May 21, 2018

207                    if strip(DX) in ('V5410' 'V5420') then                          do; fx_site='(812, 73311) humerus'; output;
208                                                                                                     fx_site='(813, 73312) radius_ulna'; output;
208      ! end;
209                    if strip(DX) in ('V5411' 'V5421') then                          do; fx_site='(812, 73311) humerus'; output; end;
210                    if strip(DX) in ('V5412' 'V5422') then                          do; fx_site='(813, 73312) radius_ulna'; output;
211                                                                                                     fx_site='(814) carpal'; output; end;
212                    if strip(DX) in ('V5413' 'V5423') then                          do; fx_site='(820, 73314) hip'; output; end;
213                    if strip(DX) in ('V5414' 'V5424') then                          do; fx_site='(820, 73314) hip'; output;
214                                                                                                     fx_site='(821, 73315) femur'; output;
215                                                                                                     fx_site='(822) patella'; output;
216                                                                                                     fx_site='(824) ankle'; output;
217                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
218                    if strip(DX) in ('V5415' 'V5425') then                          do; fx_site='(820, 73314) hip'; output;
219                                                                                                     fx_site='(821, 73315) femur'; output;
220                                                                                                     fx_site='(822) patella'; output; end;
221                    if strip(DX) in ('V5416' 'V5426') then                          do; fx_site='(824) ankle'; output;
222                                                                                                     fx_site='(822) patella'; output;
223                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
224                    if strip(DX) in ('V5417' 'V5427') then                          do; fx_site='(805, 806, 73313) spine'; output; end;
225                    if strip(DX) in: ('V542') then                                       do; fx_site='(7331) pathologic nos/nec'; output; end;
226                    if strip(DX) in: ('V541') then                                       do; fx_site='(829) fx_nos'; output; end;
227            run;
228        
229            /* proc sort data=fx_dgns; by patid BEGIN_DATE fx_site; run;
230            proc sort data=fx_excare; by patid BEGIN_DATE fx_site; run; */
231        %mend;
232        %comballfxdgns;
NOTE: Data set UCB.TEMPFRACDXALL is in a format that is native to another host. Cross Environment Data Access will be used. This will require 
      additional CPU resources and may reduce performance.
The SAS supervisor will process queries for foreign datasets. No parallel where-clause processing will occur.

NOTE: There were 133449 observations read from the data set UCB.TEMPFRACDXALL.
      WHERE diagCodeType='Fracture code';
NOTE: The data set WORK.FX_DGNS has 133449 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.48 seconds
      cpu time            0.40 seconds
      

NOTE: Data set UCB.TEMPFRACDXALL is in a format that is native to another host. Cross Environment Data Access will be used. This will require 
      additional CPU resources and may reduce performance.
The SAS supervisor will process queries for foreign datasets. No parallel where-clause processing will occur.

NOTE: There were 9611 observations read from the data set UCB.TEMPFRACDXALL.
      WHERE diagCodeType='Extended care code';
NOTE: The data set WORK.FX_EXCARE has 21870 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.12 seconds
      cpu time            0.10 seconds
      

233        
234        /*Now, assign a more specific fracture site (e.g., closed, other) (site) that is used in the CQ algorithms*/
235        /*Since Expanded Diagnosis Codes (V Codes) apply to sub-categories of each broad fracture site, clone records for these so they appear in
235      ! both places*/
236        
237        data fx_dgns_2;
238            set fx_dgns;
239        
240            length site $30;
241        
242            site="";
243        
244            *Spine-closed and Spine-other;
245            if fx_site='(805, 806, 73313) spine' then
246                do;
247                    site = 'spine_cls'; /*Includes V Codes and 73313 here*/
248                    if substr(strip(DX),1,3) in ('805' '806') and substr(strip(DX),1,4) ^in ('8050', '8052', '8054', '8058') then
249                        site = 'spine_oth';
250                end;
251        
252            *Pelvis-closed and Pelvis-other... No V Codes;
4                                                                   The SAS System                                          17:45 Monday, May 21, 2018

253            if fx_site='(808) pelvis' then
254                do;
255                    site = 'pelvis_cls';
256                    if substr(strip(DX),1,3)='808' and substr(strip(DX),1,4) ^in ('8080', '8082', '8084', '8088') then
257                        site = 'pelvis_oth';
258                end;
259        
260            *Clavicle-closed and Clavicle-other.... No V Codes;
261            if fx_site='(810) clavicle' then
262                do;
263                    site = 'clv_cls';
264                    if substr(strip(DX),1,3) = '810' and substr(strip(DX),1,4) ^in ('8100') then
265                        site = 'clv_oth';
266                end;
267        
268            *Humerus-closed and Humerus-other;
269            if fx_site='(812, 73311) humerus' then
270                do;
271                    site = 'hmrs_cls'; /*Includes V Codes and 73311 here*/
272                    if substr(strip(DX),1,3)= '812' and substr(strip(DX),1,4) ^in ('8120', '8122', '8124') then
273                        site = 'hmrs_oth';
274                end;
275        
276            *Distal radius/ulna and Radius/ulna-other;
277            if fx_site='(813, 73312) radius_ulna' then
278                do;
279                 site = 'dist4arm'; /*Includes V Codes and 73312 here*/
280                    if substr(strip(DX),1,3) = '813' and substr(strip(DX),1,4) ^in ('8134', '8135') then
281                        site = 'rad_ul_oth';
282                end;
283        
284            *Carpal... V Codes present but only one category;
285            if fx_site='(814) carpal' then
286                do;
287                    site = 'carpal';
288                 end;
289        
290            *Hip-closed and Hip-other;
291            if fx_site='(820, 73314) hip' then
292                    do;
293                    site = 'hip_cls'; /*Includes V Codes and 73314 here*/
294                    if substr(strip(DX),1,3)='820' and substr(strip(DX),1,4) ^in ('8200', '8202', '8208') then
295                        site = 'hip_oth';
296                end;
297        
298            *Other femur-closed and Other femur-other;
299            if fx_site='(821, 73315) femur' then
300                do;
301                    site = 'oth_fem_cls'; /*Includes V Codes and 73315 here*/
302                    if substr(strip(DX),1,3)='821' and substr(strip(DX),1,4) ^in ('8210', '8212') then
303                        site = 'oth_fem_oth';
304                end;
305        
306            *Tib/fib-closed and Tib/fib-other;
307            if fx_site='(823, 73316) tib_fib' then
308                do;
309                    site = 'tib_fib_cls'; /*Includes V Codes and 73316 here*/
310                    if substr(strip(DX),1,3)='823' and substr(strip(DX),1,4) ^in ('8230', '8232', '8238') then
311                        site = 'tib_fib_oth';
312                end;
313        
314            *Ankle... V Codes present but only one category;
315            if fx_site='(824) ankle' then
316                do;
317                    site = 'ankle';
318                end;
319        
320            /*Assign site for other fx_sites that do not have CQ algorithm and thus no sub categories*/
321            if site = "" then do;
322                site = fx_site;
323            end;
324        
5                                                                   The SAS System                                          17:45 Monday, May 21, 2018

325            label site = 'CQ Algorithm Fracture Site (Specific)';
326        
327        run;

NOTE: Invalid third argument to function SUBSTR at line 280 column 50.
database=MPCD exposure=No exposure PATID=104237646 indexGNN=NoExp indexDate=07/20/2007 age=61 SEX=M ASdate=07/20/2007 ENR_START_DATE=01/01/2007
ENR_END_DATE=12/31/2009 AScohortDate=07/20/2007 DEATH_DATE= indexID=3923 ENCOUNTERID=10986231261 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=03/26/2007
DISCHARGE_DATE= END_DATE=03/26/2007 DX_TYPE=09 DX=813 PDX=O codeType=ICD9-DX code=813 PROV_TYPE=8 diagCodeType=Fracture code
fx_site=(813, 73312) radius_ulna site=rad_ul_oth _ERROR_=1 _N_=1181
NOTE: There were 133449 observations read from the data set WORK.FX_DGNS.
NOTE: The data set WORK.FX_DGNS_2 has 133449 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.29 seconds
      cpu time            0.26 seconds
      

328        
329        /*###########################################################################################################*/
330        /***************************************************Intermediate Fracture Diagnosis File**********************/
331        /*Combine CQ diagnosis files*******************************************************/
332        data fx_dgns_3;
333            set fx_dgns_2
334        /*    fx_excare_*/
335                ;
336        run;

NOTE: There were 133449 observations read from the data set WORK.FX_DGNS_2.
NOTE: The data set WORK.FX_DGNS_3 has 133449 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.23 seconds
      cpu time            0.20 seconds
      

337        
338        proc freq data=fx_dgns_3;
339            tables fx_site site;
340        run;

                                                                  --- AS project ---                                    17:45 Monday, May 21, 2018   1

                                                                  The FREQ Procedure

                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec        1163        0.87          1163         0.87  
                                    (800-804) skull/face             3312        2.48          4475         3.35  
                                    (805, 806, 73313) spine         46513       34.85         50988        38.21  
                                    (807) rib/sternum/trachea        6627        4.97         57615        43.17  
                                    (808) pelvis                     3458        2.59         61073        45.77  
                                    (809) trunk bones                  98        0.07         61171        45.84  
                                    (810) clavicle                   2003        1.50         63174        47.34  
                                    (811) scapula                     485        0.36         63659        47.70  
                                    (812, 73311) humerus             9187        6.88         72846        54.59  
                                    (813, 73312) radius_ulna         9477        7.10         82323        61.69  
                                    (814) carpal                     1727        1.29         84050        62.98  
                                    (815-817) hand/fingers           5923        4.44         89973        67.42  
                                    (818-819) arms mult                74        0.06         90047        67.48  
                                    (820, 73314) hip                12517        9.38        102564        76.86  
                                    (821, 73315) femur               4294        3.22        106858        80.07  
                                    (822) patella                    1446        1.08        108304        81.16  
                                    (823, 73316) tib_fib             5000        3.75        113304        84.90  
                                    (824) ankle                      6821        5.11        120125        90.02  
                                    (825) tarsal_metatarsal          8629        6.47        128754        96.48  
                                    (826) foot_phalanges             3740        2.80        132494        99.28  
                                    (827) lower_limb                  113        0.08        132607        99.37  
                                    (828) legs+arm/rib                  8        0.01        132615        99.38  
                                    (829) fx_nos                      834        0.62        133449       100.00  


                                                        CQ Algorithm Fracture Site (Specific)
 
                                                                                          Cumulative    Cumulative
                                    site                         Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec        1163        0.87          1163         0.87  
                                    (800-804) skull/face             3312        2.48          4475         3.35  
                                    (807) rib/sternum/trachea        6627        4.97         11102         8.32  
                                    (809) trunk bones                  98        0.07         11200         8.39  
                                    (811) scapula                     485        0.36         11685         8.76  
                                    (815-817) hand/fingers           5923        4.44         17608        13.19  
                                    (818-819) arms mult                74        0.06         17682        13.25  
                                    (822) patella                    1446        1.08         19128        14.33  
                                    (825) tarsal_metatarsal          8629        6.47         27757        20.80  
                                    (826) foot_phalanges             3740        2.80         31497        23.60  
                                    (827) lower_limb                  113        0.08         31610        23.69  
                                    (828) legs+arm/rib                  8        0.01         31618        23.69  
                                    (829) fx_nos                      834        0.62         32452        24.32  
                                    ankle                            6821        5.11         39273        29.43  
                                    carpal                           1727        1.29         41000        30.72  
                                    clv_cls                          2003        1.50         43003        32.22  
                                    dist4arm                         6581        4.93         49584        37.16  
                                    hip_cls                         12236        9.17         61820        46.32  
                                    hip_oth                           281        0.21         62101        46.54  
                                    hmrs_cls                         9068        6.80         71169        53.33  
                                    hmrs_oth                          119        0.09         71288        53.42  
                                    oth_fem_cls                      4188        3.14         75476        56.56  
                                    oth_fem_oth                       106        0.08         75582        56.64  
                                    pelvis_cls                       3369        2.52         78951        59.16  
                                    pelvis_oth                         89        0.07         79040        59.23  
                                    rad_ul_oth                       2896        2.17         81936        61.40  
                                    spine_cls                       41260       30.92        123196        92.32  
                                    spine_oth                        5253        3.94        128449        96.25  
                                    tib_fib_cls                      4803        3.60        133252        99.85  
                                    tib_fib_oth                       197        0.15        133449       100.00  
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 133449 observations read from the data set WORK.FX_DGNS_3.
NOTE: The PROCEDURE FREQ printed page 1.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.17 seconds
      cpu time            0.14 seconds
      

341        
342        proc sort data=fx_dgns_3;
343            by patid ENCOUNTERID fx_site site;
344        run;

NOTE: There were 133449 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_3 has 133449 observations and 28 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.40 seconds
      cpu time            0.54 seconds
      

345        
346        
347        /*###########################################################################################################*/
348        /*************************************************************************************************************/
349        /*Look for repair procedures and assign treatment site*******************/
350        /*This code has been updated to include hip/femur replacement with matching diagnosis code, also looked in claim strip(DX) not just primary
350      !  strip(DX)
351        /*Not accepting contiguous sites until later*/
352        /*Excluding procedures from DME files*/
353        /*******************************Select All Spine Imaging Codes from STD Procedure Files for CQ=4/5 algorithms*/
354        
355        %macro fx_prcd;
356            data fx_prcd spine_xray;
357                set UCB.tempFracPxAll;
358        
6                                                                   The SAS System                                          17:45 Monday, May 21, 2018

359                    length tx_site $30;
360                    length HLAT $1;
361        
362                    if strip(px) in ('21300' '21310' '21315' '21320' '21325' '21330' '21335' '21336' '21337' '21338' '21339' '21340' '21343'
362      ! '21344' '21345' '21346' '21347' '21348'
363                                         '21355' '21356' '21360' '21365' '21366' '21385' '21386' '21387' '21390' '21395' '21400' '21401' '21406'
363      ! '21407' '21408' '21421' '21422' '21423'
364                                         '21431' '21432' '21433' '21435' '21436' '21440' '21445' '21450' '21451' '21452' '21453' '21454' '21461'
364      ! '21462' '21465' '21470'
365                                         '62000' '62005' '62010')  and lengthn(strip(px)) = 5 then do;
366                        tx_site='(800-804) skull/face'; output fx_prcd; end;
367        
368                    if strip(px) in ('22305' '22310' '22315' '22318' '22319' '22325' '22326' '22327' '22328' '22520' '22521' '22522' '22523'
368      ! '22524' '22525' '76012' '76013'
369                                         'S2360' 'S2361' 'S2362' 'S2363' '72291' '72292')  and lengthn(strip(px)) = 5 then do;
370                        tx_site = '(805, 806, 73313) spine'; output fx_prcd; end;
371        
372                    if  strip(px) in ('21493' '21494' '21495' '21800' '21805' '21810' '21820' '21825' ) then do;
373                        tx_site='(807) rib/sternum/trachea'; output fx_prcd; end;
374        
375                    if strip(px) in ('27193' '27194' '27215' '27216' '27217' '27218' '27220' '27222' '27226' '27227' '27228')  and
375      ! lengthn(strip(px)) = 5 then do;
376                        tx_site = '(808) pelvis'; output fx_prcd; end;
377        
378                    if strip(px) in ('23500' '23505' '23515')  and lengthn(strip(px)) = 5 then do;
379                        tx_site = '(810) clavicle'; output fx_prcd; end;
380        
381                    if strip(px) in ('23570' '23575' '23585') then do;
382                        tx_site= '(811) scapula'; output fx_prcd; end;
383        
384                    if strip(px) in ('23600' '23605' '23615' '23616' '23620' '23625' '23630' '23665' '24500' '24505' '24515' '24516' '24530'
384      ! '24535' '24538' '24545' '24546' '24560'
385                                 '24565' '24566' '24575' '24576' '24577' '24579' '24582')  and lengthn(strip(px)) = 5 then do;
386                        tx_site = '(812, 73311) humerus'; output fx_prcd; end;
387        
388                    if strip(px) in ('25600' '25605' '25606' '25607' '25608' '25609' '25620' '25650' '25651' '25652')  and lengthn(strip(px)) = 5
388      ! then do;
389                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
390        
391                    if strip(px) in ('24650' '24655' '24665' '24666' '24670' '24675' '24685' '25500' '25505' '25515' '25520' '25525' '25526'
391      ! '25530' '25535' '25545' '25560' '25565'
392                                 '25574' '25575')  and lengthn(strip(px)) = 5 then do;
393                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
394        
395                    if strip(px) in ('25622' '25624' '25628' '25630' '25635' '25645' '25680' '25685')  and lengthn(strip(px)) = 5 then do;
396                        tx_site = '(814) carpal'; output fx_prcd; end;
397        
398                    if strip(px) in ('26600' '26605' '26607' '26608' '26615' '26645' '26650' '26665' '26720' '26725' '26727' '26735' '26740'
398      ! '26742' '26746' '26750' '26755' '26756' '26765' )
399                               and lengthn(strip(px)) = 5 then do;
400                        tx_site='(815-817) hand/fingers'; output fx_prcd; end;
401        
402                    if '27230' <= strip(px) <= '27248' and lengthn(strip(px)) = 5 then do;
403                        tx_site = '(820, 73314) hip'; output fx_prcd; end;
404        
405                    if '27500' <= strip(px) <= '27514'  and lengthn(strip(px)) = 5 then do;
406                        tx_site = '(821, 73315) femur'; output fx_prcd; end;
407        
408                    if strip(px) in ('27520' '27524')  and lengthn(strip(px)) = 5 then do;
409                        tx_site = '(822) patella'; output fx_prcd; end;
410        
411                    if ('27530' <= strip(px) <= '27536' or '27750' <= strip(px) <= '27759' or '27780' <= strip(px) <= '27784' or '27824' <=
411      ! strip(px) <= '27828') and lengthn(strip(px)) = 5  then do;
412                        tx_site = '(823, 73316) tib_fib'; output fx_prcd; end;
413        
414                    if strip(px) in ('27760' '27762' '27766' '27786' '27788' '27792' '27808' '27810' '27814' '27816' '27818' '27822' '27823'
414      ! '28430' '28435' '28436' '28445')  and lengthn(strip(px)) = 5 then do;
415                        tx_site = '(824) ankle'; output fx_prcd; end;
416        
417                    if strip(px) in ('28320' '28322' '28400' '28405' '28406' '28415' '28420' ) and lengthn(strip(px)) = 5 then do;
418                        tx_site='(825) tarsal_metatarsal'; output fx_prcd; end;
419        
7                                                                   The SAS System                                          17:45 Monday, May 21, 2018

420                 /********************************Hip/Femur Additions - must be matched with DGNS to be included*/
421                 /*Hip replacement codes*/
422                    /*Hip*/
423                    if strip(px) in ('27130' '27125') and lengthn(strip(px)) = 5  then do;
424                        HLAT='1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
425        
426                    /*Codes below are the only ICD9 Procedure Codes that we are using for "repair"*/
427                    if strip(px) in ('8151' '8152') and lengthn(strip(px)) = 4 then do;
428                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
429        
430                    /*Femur repair codes, assigned to both Hip and Femur treatment sites... CHECK - MAYBE WE NEED TO DO THIS THE OTHER WAY AS
430      ! WELL*/
431                    /*Hip*/
432                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
433                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
434        
435                    /*Femur*/
436                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
437                        HLAT = '1'; tx_site = '(821, 73315) femur'; output fx_prcd; end;
438                     /*spine image*/
439                        if '72010' <= strip(px) <= '72159' or '72240' <= strip(px) <= '72285' or strip(px) = '72295' then do;   /*Spine Imaging
439      ! Codes*/
440                        tx_site='(805, 806, 73313) spine';
441                        output spine_xray; end;
442        
443            run;
444        
445            data fx_prcd;
446                set fx_prcd;
447                /*To add laterality info*/
448        /*        array hcpcs{*} hcpcs_1st_mdfr_cd hcpcs_2nd_mdfr_cd hcpcs_3rd_mdfr_cd hcpcs_4th_mdfr_cd ; */
449                if HLAT='1' then do;
450                    repair_right='0'; repair_left='0';
451                end;
452        /*        if HLAT='1' then */
453        /*            do i=1 to dim(hcpcs);*/
454        /*                if hcpcs{i} = 'RT' then repair_right='1';*/
455        /*                else if hcpcs{i} = 'LT' then repair_left='1';*/
456        /*            end;*/
457            run;
458            proc sort data=fx_prcd nodupkey; by patid ENCOUNTERID px_date tx_site; run;
459        
460            data spine_xray;
461                set spine_xray;
462                keep patid px_date tx_site  ENCOUNTERID begin_date;
463            run;
464            proc sort data=spine_xray nodupkey; by patid px_date; run;
465        %mend;
466        %fx_prcd;
NOTE: Data set UCB.TEMPFRACPXALL is in a format that is native to another host. Cross Environment Data Access will be used. This will require 
      additional CPU resources and may reduce performance.

NOTE: There were 35975283 observations read from the data set UCB.TEMPFRACPXALL.
NOTE: The data set WORK.FX_PRCD has 26787 observations and 25 variables.
NOTE: The data set WORK.SPINE_XRAY has 393415 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           1:06.28
      cpu time            1:02.38
      


NOTE: There were 26787 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK.FX_PRCD has 26787 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.01 seconds
      


NOTE: There were 26787 observations read from the data set WORK.FX_PRCD.
NOTE: 13338 observations with duplicate key values were deleted.
NOTE: The data set WORK.FX_PRCD has 13449 observations and 27 variables.
8                                                                   The SAS System                                          17:45 Monday, May 21, 2018

NOTE: PROCEDURE SORT used (Total process time):
      real time           0.07 seconds
      cpu time            0.04 seconds
      


NOTE: There were 393415 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.SPINE_XRAY has 393415 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.27 seconds
      cpu time            0.23 seconds
      


NOTE: There were 393415 observations read from the data set WORK.SPINE_XRAY.
NOTE: 272427 observations with duplicate key values were deleted.
NOTE: The data set WORK.SPINE_XRAY has 120988 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.31 seconds
      cpu time            0.59 seconds
      

467        
468        
469        
470        data trauma (rename=(begin_date=trauma_dt));
471                set UCB.tempFracDxAll (where = (diagCodeType = "Trauma code"));
NOTE: Data set UCB.TEMPFRACDXALL is in a format that is native to another host. Cross Environment Data Access will be used. This will require 
      additional CPU resources and may reduce performance.
The SAS supervisor will process queries for foreign datasets. No parallel where-clause processing will occur.
472        run;

NOTE: There were 23930 observations read from the data set UCB.TEMPFRACDXALL.
      WHERE diagCodeType='Trauma code';
NOTE: The data set WORK.TRAUMA has 23930 observations and 26 variables.
NOTE: DATA statement used (Total process time):
      real time           0.09 seconds
      cpu time            0.07 seconds
      

473        proc sort data= trauma(keep=patid trauma_dt) nodupkey; by patid trauma_dt;run;

NOTE: There were 23930 observations read from the data set WORK.TRAUMA.
NOTE: 13114 observations with duplicate key values were deleted.
NOTE: The data set WORK.TRAUMA has 10816 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.09 seconds
      cpu time            0.04 seconds
      

474        
475        
476        /*subset the spine xray procedure claim for patients with fx diagnosis code only*/
477        /*so SAS will not run out of memory*/
478        data fx_spine_xray(keep=patid tx_site px_date ENCOUNTERID begin_date);
479        if _n_=1 then do;
480          declare hash hid(dataset:"fx_dgns_3(where=(fx_site='(805, 806, 73313) spine')))", multidata:"N", hashexp:20);
481          rc=hid.defineKey("patid");
482          rc=hid.defineDone();
483        end;
484        set spine_xray;
485        rc=hid.find();
486        if rc=0;
487        run;

NOTE: There were 46513 observations read from the data set WORK.FX_DGNS_3.
      WHERE fx_site='(805, 806, 73313) spine';
NOTE: There were 120988 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.FX_SPINE_XRAY has 29694 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.23 seconds
      cpu time            0.17 seconds
9                                                                   The SAS System                                          17:45 Monday, May 21, 2018

      

488        /*subset the Trauma code for patients with fx diagnosis code only*/
489        /*so SAS will not run out of memory*/
490        data fx_trauma(drop=rc);
491        if _n_=1 then do;
492          declare hash hid(dataset:"fx_dgns_3", multidata:"N", hashexp:20);
493          rc=hid.defineKey("patid");
494          rc=hid.defineDone();
495        end;
496        set trauma;
497        rc=hid.find();
498        if rc=0;
499        run;

NOTE: There were 133449 observations read from the data set WORK.FX_DGNS_3.
NOTE: There were 10816 observations read from the data set WORK.TRAUMA.
NOTE: The data set WORK.FX_TRAUMA has 6107 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.13 seconds
      cpu time            0.12 seconds
      

500        /************************************Link Fracture Claims (ICD9 Diagnosis) with Repair Claims (CPT/HCPCS, some ICD9 procedure
500      ! code)***************/
501        
502        data fx_dgns_4(drop=rc: px_date tx_site xray_date trauma_dt);
503        if _n_=1 then do;
504          declare hash hid(dataset:"fx_prcd", multidata:"N", hashexp:20);
505          rc=hid.defineKey("patid", "px_date", "tx_site");
506        /*  rc=hid.defineData("px_date", "tx_site");*/
507          rc=hid.defineDone();
508          declare hash hxray(dataset:"fx_spine_xray(rename=px_date=xray_date)", multidata:"Y", hashexp:20);
509          rc=hxray.defineKey("patid", "tx_site");
510          rc=hxray.defineData("xray_date");
511          rc=hxray.defineDone();
512          declare hash htrauma(dataset:"fx_trauma", multidata:"Y", hashexp:20);
513          rc=htrauma.defineKey("patid");
514          rc=htrauma.defineData("trauma_dt");
515          rc=htrauma.defineDone();
516        end;
517        if 0 then set fx_prcd(keep=patid px_date tx_site)
518                      fx_spine_xray(keep=patid px_date tx_site rename=px_date=xray_date)
519                      fx_trauma;
520        set fx_dgns_3;
521        length cq $4 spine_image trauma_date 4 trauma $1;
522        format spine_image trauma_date mmddyy10.;
523        cq="0000";
524        rc=hid.find(key:patid, key:begin_date,key:fx_site);
525        if rc^=0 then do;
526            px_date=.;
527            tx_site=" ";
528        end;
529        if enc_type="IP" then do;
530        /*CQ = 1 Inpatient claim with primary diagnosis code */
531            if pdx="P" then substr(cq,1,1)="1";
532        /*CQ = 2 Inpatient claim with secondary diagnosis code*/
533            else substr(cq,2,1)="2";
534        end; else do;
535        /*CQ = 3 outpatient diagnosis code AND carrier line with repair/replace HCPCS*/
536            if rc=0 then substr(cq,3,1)="3";
537            rc1=hxray.find(key:patid, key:fx_site);
538            do while (rc1 = 0);
539                if begin_date-10 <=xray_date<= begin_date then do;
540                    if enc_type in ("AV" "IF" "NH" "HH" "ER" "ED") then do;
541        /*CQ = 4 outpatient [Physician E&M codes] diagnosis code with spine image/x-ray within 10 day early*/
542                        substr(cq,4,1)="4";
543                        spine_image=min(spine_image,xray_date);
544                    end;
545                end;
546                rc1=hxray.find_next(key:patid, key:fx_site);
547            end;
10                                                                  The SAS System                                          17:45 Monday, May 21, 2018

548        end;
549        /*is there trauma dx within 14 days*/
550        rc2=htrauma.find(key:patid);
551        do while (rc2 = 0) ;
552            if 0<=abs(trauma_dt-begin_date)<=14 then do;
553                    trauma="1";
554                    trauma_date=min(trauma_date,trauma_dt);
555           end ;
556           rc2=htrauma.find_next(key:patid) ;
557        end;
558        
559        run;

NOTE: There were 13449 observations read from the data set WORK.FX_PRCD.
NOTE: There were 29694 observations read from the data set WORK.FX_SPINE_XRAY.
NOTE: There were 6107 observations read from the data set WORK.FX_TRAUMA.
NOTE: There were 133449 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_4 has 133449 observations and 32 variables.
NOTE: DATA statement used (Total process time):
      real time           0.54 seconds
      cpu time            0.46 seconds
      

560        proc freq data=fx_dgns_4; tables enc_type*cq fx_site*cq trauma/missing;run;

                                                                  --- AS project ---                                    17:45 Monday, May 21, 2018   2

                                                                  The FREQ Procedure

                                                               Table of ENC_TYPE by cq

                                       ENC_TYPE(Encounter Type)     cq

                                       Frequency|
                                       Percent  |
                                       Row Pct  |
                                       Col Pct  |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       AV       |  53602 |  10970 |   2512 |    248 |      0 |      0 |  67332
                                                |  40.17 |   8.22 |   1.88 |   0.19 |   0.00 |   0.00 |  50.46
                                                |  79.61 |  16.29 |   3.73 |   0.37 |   0.00 |   0.00 |
                                                |  62.26 |  57.54 |  35.60 |  52.43 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       ED       |  17629 |   6313 |   4522 |    225 |      0 |      0 |  28689
                                                |  13.21 |   4.73 |   3.39 |   0.17 |   0.00 |   0.00 |  21.50
                                                |  61.45 |  22.00 |  15.76 |   0.78 |   0.00 |   0.00 |
                                                |  20.48 |  33.11 |  64.09 |  47.57 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       HH       |   1356 |    142 |      2 |      0 |      0 |      0 |   1500
                                                |   1.02 |   0.11 |   0.00 |   0.00 |   0.00 |   0.00 |   1.12
                                                |  90.40 |   9.47 |   0.13 |   0.00 |   0.00 |   0.00 |
                                                |   1.58 |   0.74 |   0.03 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       IP       |      0 |      0 |      0 |      0 |  14334 |   6428 |  20762
                                                |   0.00 |   0.00 |   0.00 |   0.00 |  10.74 |   4.82 |  15.56
                                                |   0.00 |   0.00 |   0.00 |   0.00 |  69.04 |  30.96 |
                                                |   0.00 |   0.00 |   0.00 |   0.00 | 100.00 | 100.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       NH       |  13505 |   1641 |     20 |      0 |      0 |      0 |  15166
                                                |  10.12 |   1.23 |   0.01 |   0.00 |   0.00 |   0.00 |  11.36
                                                |  89.05 |  10.82 |   0.13 |   0.00 |   0.00 |   0.00 |
                                                |  15.69 |   8.61 |   0.28 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       Total       86092    19066     7056      473    14334     6428   133449
                                                   64.51    14.29     5.29     0.35    10.74     4.82   100.00


 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                    17:45 Monday, May 21, 2018   3

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (7331) pathologi |   1059 |      0 |      0 |      0 |     83 |     21 |   1163
                                   c nos/nec        |   0.79 |   0.00 |   0.00 |   0.00 |   0.06 |   0.02 |   0.87
                                                    |  91.06 |   0.00 |   0.00 |   0.00 |   7.14 |   1.81 |
                                                    |   1.23 |   0.00 |   0.00 |   0.00 |   0.58 |   0.33 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (800-804) skull/ |   2423 |      0 |    283 |      0 |    474 |    132 |   3312
                                   face             |   1.82 |   0.00 |   0.21 |   0.00 |   0.36 |   0.10 |   2.48
                                                    |  73.16 |   0.00 |   8.54 |   0.00 |  14.31 |   3.99 |
                                                    |   2.81 |   0.00 |   4.01 |   0.00 |   3.31 |   2.05 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (805, 806, 73313 |  16262 |  19066 |     36 |    473 |   7324 |   3352 |  46513
                                   ) spine          |  12.19 |  14.29 |   0.03 |   0.35 |   5.49 |   2.51 |  34.85
                                                    |  34.96 |  40.99 |   0.08 |   1.02 |  15.75 |   7.21 |
                                                    |  18.89 | 100.00 |   0.51 | 100.00 |  51.10 |  52.15 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (807) rib/sternu |   4764 |      0 |    787 |      0 |    892 |    184 |   6627
                                   m/trachea        |   3.57 |   0.00 |   0.59 |   0.00 |   0.67 |   0.14 |   4.97
                                                    |  71.89 |   0.00 |  11.88 |   0.00 |  13.46 |   2.78 |
                                                    |   5.53 |   0.00 |  11.15 |   0.00 |   6.22 |   2.86 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (808) pelvis     |   2728 |      0 |    134 |      0 |    441 |    155 |   3458
                                                    |   2.04 |   0.00 |   0.10 |   0.00 |   0.33 |   0.12 |   2.59
                                                    |  78.89 |   0.00 |   3.88 |   0.00 |  12.75 |   4.48 |
                                                    |   3.17 |   0.00 |   1.90 |   0.00 |   3.08 |   2.41 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (809) trunk bone |     96 |      0 |      0 |      0 |      2 |      0 |     98
                                   s                |   0.07 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.07
                                                    |  97.96 |   0.00 |   0.00 |   0.00 |   2.04 |   0.00 |
                                                    |   0.11 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (810) clavicle   |   1572 |      0 |    276 |      0 |    127 |     28 |   2003
                                                    |   1.18 |   0.00 |   0.21 |   0.00 |   0.10 |   0.02 |   1.50
                                                    |  78.48 |   0.00 |  13.78 |   0.00 |   6.34 |   1.40 |
                                                    |   1.83 |   0.00 |   3.91 |   0.00 |   0.89 |   0.44 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (811) scapula    |    375 |      0 |     57 |      0 |     45 |      8 |    485
                                                    |   0.28 |   0.00 |   0.04 |   0.00 |   0.03 |   0.01 |   0.36
                                                    |  77.32 |   0.00 |  11.75 |   0.00 |   9.28 |   1.65 |
                                                    |   0.44 |   0.00 |   0.81 |   0.00 |   0.31 |   0.12 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               86092    19066     7056      473    14334     6428   133449
                                                       64.51    14.29     5.29     0.35    10.74     4.82   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                    17:45 Monday, May 21, 2018   4

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (812, 73311) hum |   7479 |      0 |    794 |      0 |    609 |    305 |   9187
                                   erus             |   5.60 |   0.00 |   0.59 |   0.00 |   0.46 |   0.23 |   6.88
                                                    |  81.41 |   0.00 |   8.64 |   0.00 |   6.63 |   3.32 |
                                                    |   8.69 |   0.00 |  11.25 |   0.00 |   4.25 |   4.74 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (813, 73312) rad |   7404 |      0 |   1528 |      0 |    405 |    140 |   9477
                                   ius_ulna         |   5.55 |   0.00 |   1.15 |   0.00 |   0.30 |   0.10 |   7.10
                                                    |  78.13 |   0.00 |  16.12 |   0.00 |   4.27 |   1.48 |
                                                    |   8.60 |   0.00 |  21.66 |   0.00 |   2.83 |   2.18 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (814) carpal     |   1523 |      0 |    160 |      0 |     43 |      1 |   1727
                                                    |   1.14 |   0.00 |   0.12 |   0.00 |   0.03 |   0.00 |   1.29
                                                    |  88.19 |   0.00 |   9.26 |   0.00 |   2.49 |   0.06 |
                                                    |   1.77 |   0.00 |   2.27 |   0.00 |   0.30 |   0.02 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (815-817) hand/f |   4789 |      0 |   1001 |      0 |    115 |     18 |   5923
                                   ingers           |   3.59 |   0.00 |   0.75 |   0.00 |   0.09 |   0.01 |   4.44
                                                    |  80.85 |   0.00 |  16.90 |   0.00 |   1.94 |   0.30 |
                                                    |   5.56 |   0.00 |  14.19 |   0.00 |   0.80 |   0.28 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (818-819) arms m |     72 |      0 |      0 |      0 |      2 |      0 |     74
                                   ult              |   0.05 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.06
                                                    |  97.30 |   0.00 |   0.00 |   0.00 |   2.70 |   0.00 |
                                                    |   0.08 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (820, 73314) hip |   8697 |      0 |    594 |      0 |   1985 |   1241 |  12517
                                                    |   6.52 |   0.00 |   0.45 |   0.00 |   1.49 |   0.93 |   9.38
                                                    |  69.48 |   0.00 |   4.75 |   0.00 |  15.86 |   9.91 |
                                                    |  10.10 |   0.00 |   8.42 |   0.00 |  13.85 |  19.31 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (821, 73315) fem |   3263 |      0 |    217 |      0 |    522 |    292 |   4294
                                   ur               |   2.45 |   0.00 |   0.16 |   0.00 |   0.39 |   0.22 |   3.22
                                                    |  75.99 |   0.00 |   5.05 |   0.00 |  12.16 |   6.80 |
                                                    |   3.79 |   0.00 |   3.08 |   0.00 |   3.64 |   4.54 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (822) patella    |   1113 |      0 |    150 |      0 |    131 |     52 |   1446
                                                    |   0.83 |   0.00 |   0.11 |   0.00 |   0.10 |   0.04 |   1.08
                                                    |  76.97 |   0.00 |  10.37 |   0.00 |   9.06 |   3.60 |
                                                    |   1.29 |   0.00 |   2.13 |   0.00 |   0.91 |   0.81 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               86092    19066     7056      473    14334     6428   133449
                                                       64.51    14.29     5.29     0.35    10.74     4.82   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                    17:45 Monday, May 21, 2018   5

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (823, 73316) tib |   4152 |      0 |    314 |      0 |    361 |    173 |   5000
                                   _fib             |   3.11 |   0.00 |   0.24 |   0.00 |   0.27 |   0.13 |   3.75
                                                    |  83.04 |   0.00 |   6.28 |   0.00 |   7.22 |   3.46 |
                                                    |   4.82 |   0.00 |   4.45 |   0.00 |   2.52 |   2.69 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (824) ankle      |   5426 |      0 |    639 |      0 |    497 |    259 |   6821
                                                    |   4.07 |   0.00 |   0.48 |   0.00 |   0.37 |   0.19 |   5.11
                                                    |  79.55 |   0.00 |   9.37 |   0.00 |   7.29 |   3.80 |
                                                    |   6.30 |   0.00 |   9.06 |   0.00 |   3.47 |   4.03 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (825) tarsal_met |   8288 |      0 |     86 |      0 |    193 |     62 |   8629
                                   atarsal          |   6.21 |   0.00 |   0.06 |   0.00 |   0.14 |   0.05 |   6.47
                                                    |  96.05 |   0.00 |   1.00 |   0.00 |   2.24 |   0.72 |
                                                    |   9.63 |   0.00 |   1.22 |   0.00 |   1.35 |   0.96 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (826) foot_phala |   3682 |      0 |      0 |      0 |     53 |      5 |   3740
                                   nges             |   2.76 |   0.00 |   0.00 |   0.00 |   0.04 |   0.00 |   2.80
                                                    |  98.45 |   0.00 |   0.00 |   0.00 |   1.42 |   0.13 |
                                                    |   4.28 |   0.00 |   0.00 |   0.00 |   0.37 |   0.08 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (827) lower_limb |    110 |      0 |      0 |      0 |      3 |      0 |    113
                                                    |   0.08 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.08
                                                    |  97.35 |   0.00 |   0.00 |   0.00 |   2.65 |   0.00 |
                                                    |   0.13 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (828) legs+arm/r |      5 |      0 |      0 |      0 |      3 |      0 |      8
                                   ib               |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.01
                                                    |  62.50 |   0.00 |   0.00 |   0.00 |  37.50 |   0.00 |
                                                    |   0.01 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (829) fx_nos     |    810 |      0 |      0 |      0 |     24 |      0 |    834
                                                    |   0.61 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |   0.62
                                                    |  97.12 |   0.00 |   0.00 |   0.00 |   2.88 |   0.00 |
                                                    |   0.94 |   0.00 |   0.00 |   0.00 |   0.17 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               86092    19066     7056      473    14334     6428   133449
                                                       64.51    14.29     5.29     0.35    10.74     4.82   100.00


                                                                                Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                                         115725       86.72        115725        86.72  
                                             1            17724       13.28        133449       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 133449 observations read from the data set WORK.FX_DGNS_4.
NOTE: The PROCEDURE FREQ printed pages 2-5.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.42 seconds
      cpu time            0.28 seconds
      

561        
562        *goto 002_fx_epi.sas;
563        
564        
565        
566        
567        /*
568        START OF 002_fx_data.sas
569         */
570        
571        /*all the claims to define episode sequence */
572        data _dat0(keep=
573        PATID ENCOUNTERID ADMIT_DATE DISCHARGE_DATE BEGIN_DATE END_DATE DX DX_TYPE PDX  /* SOURCE */ ENC_TYPE fx_site px px_date
574        site cq spine_image trauma_date trauma );
575        set fx_dgns_4 fx_excare Fx_prcd(rename=tx_site=fx_site);
576        run;

NOTE: There were 133449 observations read from the data set WORK.FX_DGNS_4.
NOTE: There were 21870 observations read from the data set WORK.FX_EXCARE.
NOTE: There were 13449 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK._DAT0 has 168768 observations and 18 variables.
NOTE: DATA statement used (Total process time):
      real time           0.18 seconds
      cpu time            0.15 seconds
      

577        proc sort data=_dat0; by PATID fx_site BEGIN_DATE END_DATE; run;

NOTE: There were 168768 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT0 has 168768 observations and 18 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.31 seconds
      cpu time            0.45 seconds
      

578        /*for each claim define start and end date applicable to IP NH and NH*/
579        data _dat1;
580        set _dat0;
581        length start_date end_date 4;
582        format start_date end_date mmddyy10.;
11                                                                  The SAS System                                          17:45 Monday, May 21, 2018

583        by PATID fx_site BEGIN_DATE END_DATE;
584        start_date=min(ADMIT_DATE, BEGIN_DATE);
585        end_date=max(DISCHARGE_DATE, End_DATE);
586        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      616 at 584:12   
NOTE: There were 168768 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT1 has 168768 observations and 19 variables.
NOTE: DATA statement used (Total process time):
      real time           0.18 seconds
      cpu time            0.15 seconds
      

587        proc sort data=_dat1; by PATID fx_site start_date end_date; run;

NOTE: There were 168768 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT1 has 168768 observations and 19 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.29 seconds
      cpu time            0.51 seconds
      

588        
589        /* generate unique episode sequence ID */
590        data _dat2(drop=end_date_max lag_end_date_max _gap);
591        set _dat1;
592        length lag_end_date_max end_date_max 4;
593        format lag_end_date_max end_date_max mmddyy10.;
594        
595        by PATID fx_site start_date end_date;
596        retain seq 0;
597        
598        /*if current claims end date > all previouse claim end date in sequence, then update*/
599        end_date_max=max(end_date,end_date_max);
600        lag_end_date_max=lag(end_date_max);
601        
602        if first.fx_site then lag_end_date_max=.;
603        _gap=start_date-lag_end_date_max;
604        
605        /*if current claims start date >90 days after all previouse claim end date in sequence,
606        then start new sequence*/
607        if first.fx_site or start_date-lag_end_date_max>90 then do;
608            end_date_max=end_date;
609        
610            seq+1;
611        end;
612        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      19391 at 603:16   19391 at 607:31   
NOTE: There were 168768 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT2 has 168768 observations and 20 variables.
NOTE: DATA statement used (Total process time):
      real time           0.20 seconds
      cpu time            0.18 seconds
      

613        proc sort data=_dat2; by seq;run;

NOTE: There were 168768 observations read from the data set WORK._DAT2.
NOTE: The data set WORK._DAT2 has 168768 observations and 20 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.27 seconds
      cpu time            0.34 seconds
      

614        proc sql;
615        /*episode sequence start date*/
616        create table seq_start as
12                                                                  The SAS System                                          17:45 Monday, May 21, 2018

617        select patid, seq, min(start_date) as seq_start_date length=4 format=mmddyy10.
618         from _dat2
619         where substr(dx,1,4) not in ('V541' 'V542')
620         group by patid, seq
621         order by patid, seq;
NOTE: Table WORK.SEQ_START created, with 20307 rows and 3 columns.

622        /*episode sequence end date*/
623        create table seq_end as
624        select patid, seq,
625         max(start_date) as seq_end_date length=4 format=mmddyy10. from _dat2
626         group by patid, seq
627         order by patid, seq;
NOTE: Table WORK.SEQ_END created, with 24352 rows and 3 columns.

628        quit;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.46 seconds
      cpu time            0.59 seconds
      

629        /*episode sequence case qualifier indicator and trauma*/
630        data seq_cq(keep=patid seq seq_cq seq_trauma fx_site);
631        set _dat2;
632        by patid seq;
633        length seq_cq $4 seq_trauma $1;
634        retain seq_cq seq_trauma;
635        if first.seq then do;
636            seq_cq="0000";
637            seq_trauma="0";
638        end;
639        if trauma="1" then seq_trauma=trauma;
640        do i=1 to 4;
641        if substr(cq,i,1)>substr(seq_cq,i,1) then substr(seq_cq,i,1)=substr(cq,i,1);
642        end;
643        if last.seq then output;
644        run;

NOTE: There were 168768 observations read from the data set WORK._DAT2.
NOTE: The data set WORK.SEQ_CQ has 24352 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.17 seconds
      cpu time            0.15 seconds
      

645        proc freq data=seq_cq; tables seq_cq seq_trauma fx_site; run;

                                                                  --- AS project ---                                    17:45 Monday, May 21, 2018   6

                                                                  The FREQ Procedure

                                                                                Cumulative    Cumulative
                                             seq_cq    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0000         15963       65.55         15963        65.55  
                                             0004          1502        6.17         17465        71.72  
                                             0030          1140        4.68         18605        76.40  
                                             0034            41        0.17         18646        76.57  
                                             0200          1827        7.50         20473        84.07  
                                             0204           289        1.19         20762        85.26  
                                             0230            78        0.32         20840        85.58  
                                             0234             8        0.03         20848        85.61  
                                             1000           458        1.88         21306        87.49  
                                             1004           191        0.78         21497        88.28  
                                             1030            76        0.31         21573        88.59  
                                             1034            12        0.05         21585        88.64  
                                             1200          1396        5.73         22981        94.37  
                                             1204          1062        4.36         24043        98.73  
                                             1230           250        1.03         24293        99.76  
                                             1234            59        0.24         24352       100.00  


                                             seq_                               Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0            21808       89.55         21808        89.55  
                                             1             2544       10.45         24352       100.00  


                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec         604        2.48           604         2.48  
                                    (800-804) skull/face              523        2.15          1127         4.63  
                                    (805, 806, 73313) spine          5937       24.38          7064        29.01  
                                    (807) rib/sternum/trachea        1314        5.40          8378        34.40  
                                    (808) pelvis                      506        2.08          8884        36.48  
                                    (809) trunk bones                  24        0.10          8908        36.58  
                                    (810) clavicle                    292        1.20          9200        37.78  
                                    (811) scapula                     114        0.47          9314        38.25  
                                    (812, 73311) humerus              994        4.08         10308        42.33  
                                    (813, 73312) radius_ulna         1220        5.01         11528        47.34  
                                    (814) carpal                      482        1.98         12010        49.32  
                                    (815-817) hand/fingers            861        3.54         12871        52.85  
                                    (818-819) arms mult                25        0.10         12896        52.96  
                                    (820, 73314) hip                 3319       13.63         16215        66.59  
                                    (821, 73315) femur               1103        4.53         17318        71.12  
                                    (822) patella                     624        2.56         17942        73.68  
                                    (823, 73316) tib_fib              831        3.41         18773        77.09  
                                    (824) ankle                       984        4.04         19757        81.13  
                                    (825) tarsal_metatarsal          1180        4.85         20937        85.98  
                                    (826) foot_phalanges              688        2.83         21625        88.80  
                                    (827) lower_limb                   37        0.15         21662        88.95  
                                    (828) legs+arm/rib                  7        0.03         21669        88.98  
                                    (829) fx_nos                     2683       11.02         24352       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 24352 observations read from the data set WORK.SEQ_CQ.
NOTE: The PROCEDURE FREQ printed page 6.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.14 seconds
      cpu time            0.06 seconds
      

646        
647        data seq_cq_date;
648        merge seq_cq seq_start seq_end;
649        by patid seq;
650        length site_order $1;
651        if fx_site='(820, 73314) hip' then site_order='1';
652        if fx_site='(821, 73315) femur' then site_order='2';
653        if fx_site='(808) pelvis' then site_order='3';
654        if fx_site='(805, 806, 73313) spine' then site_order='4';
655        if fx_site='(812, 73311) humerus' then site_order='5';
656        if fx_site='(813, 73312) radius_ulna' then site_order='6';
657        if fx_site='(823, 73316) tib_fib' then site_order='7';
658        if fx_site='(824) ankle' then site_order='8';
659        if fx_site='(810) clavicle' then site_order='9';
660        run;

NOTE: There were 24352 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 20307 observations read from the data set WORK.SEQ_START.
13                                                                  The SAS System                                          17:45 Monday, May 21, 2018

NOTE: There were 24352 observations read from the data set WORK.SEQ_END.
NOTE: The data set WORK.SEQ_CQ_DATE has 24352 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.06 seconds
      

661        
662        data _tmp_combo;
663        set seq_cq_date;
664        where site_order^=" " and seq_cq^="0000" and seq_cq^=" ";
665        run;

NOTE: There were 6969 observations read from the data set WORK.SEQ_CQ_DATE.
      WHERE (site_order not = ' ') and seq_cq not in (' ', '0000');
NOTE: The data set WORK._TMP_COMBO has 6969 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.03 seconds
      

666        
667        * define combo or alone fx;
668        data seq_COMBO(
669        keep=patid seq seq_cq seq_start_date alone_combo fx_site site_order)
670        ;
671        if _n_=1 then do;
672            declare hash hpid(dataset:"_tmp_combo(where=(seq_cq^='0000' and seq_cq^=' ')
673                    rename=(seq_start_date=seq_start_date2  fx_site= fx_site_combo seq=seq_COMBO))", ordered: 'a', multidata:"Y");
674            rc=hpid.defineKey("patid");
675            rc=hpid.defineData("patid","seq_start_date2", "fx_site_combo", "seq_COMBO");
676            rc=hpid.defineDone();
677        end;
678        if 0 then set _tmp_combo(rename=(seq_start_date=seq_start_date2 fx_site= fx_site_combo seq=seq_COMBO));
679        set _tmp_combo(where=(seq_cq^="0000" and seq_cq^=" ") );
680        by patid seq;
681        length  index_fx_begin 4 alone_combo $5;
682        alone_combo="alone";
683            format index_fx_begin mmddyy10.;
684            index_fx_begin=seq_start_date;
685        
686         rc=hpid.find(key:patid);
687        
688         do while (rc = 0);
689         if rc=0 and abs(seq_start_date-seq_start_date2) <=30 and fx_site_combo^=fx_site then alone_combo= 'combo';
690         rc=hpid.find_next();
691         *hpid.has_next(result:r);
692        end;
693        if alone_combo="alone" then do;
694            seq_start_date2=.; fx_site_combo=" "; seq_COMBO=.;
695        end;
696        run;

NOTE: There were 6969 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: There were 6969 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.SEQ_COMBO has 6969 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.06 seconds
      

697        proc freq data=seq_COMBO; tables alone_combo; run;

                                                                  --- AS project ---                                    17:45 Monday, May 21, 2018   7

                                                                  The FREQ Procedure

                                             alone_                             Cumulative    Cumulative
                                             combo     Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             alone         6128       87.93          6128        87.93  
                                             combo          841       12.07          6969       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 6969 observations read from the data set WORK.SEQ_COMBO.
NOTE: The PROCEDURE FREQ printed page 7.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.06 seconds
      cpu time            0.00 seconds
      

14                                                                  The SAS System                                          17:45 Monday, May 21, 2018

698        
699        proc sort data = Work.seq_COMBO;
700          by patid seq_start_date;
701        run;

NOTE: There were 6969 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 6969 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

702        
703        data combo_seq;
704        set seq_COMBO;
705        by patid seq_start_date;
706        length combo_fx_site $30. combo_seq 4;
707        retain combo_seq 0 combo_fx_site;
708        if first.patid or seq_start_date-lag(seq_start_date) then combo_seq=1+combo_seq;
709        where seq_cq^='0000' and seq_cq^=' ';
710        if combo_fx_site=" " or ""<site_order<lag(site_order) then combo_fx_site=fx_site;
711        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      1 at 708:33   
NOTE: There were 6969 observations read from the data set WORK.SEQ_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.COMBO_SEQ has 6969 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

712        
713        proc sort data = Work.seq_COMBO;
714          by patid seq;
715        run;

NOTE: There were 6969 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 6969 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

716        
717        data FX_CLM_DB;
718        merge _dat2 seq_start seq_end seq_cq(drop=fx_site) seq_COMBO(keep=patid seq alone_combo);
719        by patid seq;
720        run;

NOTE: There were 168768 observations read from the data set WORK._DAT2.
NOTE: There were 20307 observations read from the data set WORK.SEQ_START.
NOTE: There were 24352 observations read from the data set WORK.SEQ_END.
NOTE: There were 24352 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 6969 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.FX_CLM_DB has 168768 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           0.31 seconds
      cpu time            0.28 seconds
      

721        
722        proc sql;
723        select count(distinct seq) from FX_CLM_DB;
                                                                  --- AS project ---                                    17:45 Monday, May 21, 2018   8

                                                                               
                                                                       --------
                                                                          24352
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
724        quit;
NOTE: The PROCEDURE SQL printed page 8.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.17 seconds
      cpu time            0.15 seconds
      
15                                                                  The SAS System                                          17:45 Monday, May 21, 2018


725        
726        
727        
728        
729        /*
730        Collapse to fracture episodes
731        
732        Q: Why are some seq_start_date values missing?
733         */
734        proc sort
735          data = Work.fx_clm_db
736          out = Work.fractureEpisodes (drop = seq
737                                       rename = (seq_start_date = fractureEpisodeStart
738                                                 seq_end_date = fractureEpisodeEnd
739                                                 fx_site = fractureSite))
740          nodupkey;
741          by patid seq seq_start_date seq_end_date fx_site;
742        run;

NOTE: There were 168768 observations read from the data set WORK.FX_CLM_DB.
NOTE: 144416 observations with duplicate key values were deleted.
NOTE: The data set WORK.FRACTUREEPISODES has 24352 observations and 24 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.26 seconds
      cpu time            0.39 seconds
      

743        
744        proc sql;
745          create table DT.fractureEpisodesPrev as
746            select A.database,
747                   A.exposure,
748                   A.indexGNN,
749                   A.indexDate,
750                   A.ASCohortDate,
751                   A.indexID,
752                   A.age,
753                   A.sex,
754                   B.*,
755                   case
756                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
757                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
758                     else ""
759                     end as fractureType
760            from DT.indexLookup A inner join
761                 Work.fractureEpisodes B on (A.patid = B.patid);
NOTE: Table DT.FRACTUREEPISODESPREV created, with 10161 rows and 33 columns.

762          create table Work.summaryFractureEpisodesPrev as
763            select "DT.fractureEpisodesPrev" as table,
764                   fractureType, fractureSite,
765                   count(distinct patid) as countDistinctPatid,
766                   count(*) as countFractureEpisodes
767            from DT.fractureEpisodesPrev
768            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESPREV created, with 23 rows and 5 columns.

769          select * from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                                    17:45 Monday, May 21, 2018   9

                                                                                                                    count         count
                                                                                                                 Distinct      Fracture
               table                    fractureType                         fractureSite                           Patid      Episodes
               ------------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesPrev                                       (7331) pathologic nos/nec                 90           209
               DT.fractureEpisodesPrev                                       (800-804) skull/face                     112           228
               DT.fractureEpisodesPrev                                       (807) rib/sternum/trachea                257           514
               DT.fractureEpisodesPrev                                       (809) trunk bones                          4             5
               DT.fractureEpisodesPrev                                       (810) clavicle                            88           184
               DT.fractureEpisodesPrev                                       (811) scapula                             21            35
               DT.fractureEpisodesPrev                                       (814) carpal                             128           271
               DT.fractureEpisodesPrev                                       (815-817) hand/fingers                   266           521
               DT.fractureEpisodesPrev                                       (818-819) arms mult                        4             8
               DT.fractureEpisodesPrev                                       (822) patella                            128           267
               DT.fractureEpisodesPrev                                       (823, 73316) tib_fib                     148           304
               DT.fractureEpisodesPrev                                       (824) ankle                              216           425
               DT.fractureEpisodesPrev                                       (825) tarsal_metatarsal                  298           677
               DT.fractureEpisodesPrev                                       (826) foot_phalanges                     210           415
               DT.fractureEpisodesPrev                                       (827) lower_limb                          11            21
               DT.fractureEpisodesPrev                                       (828) legs+arm/rib                         4             5
               DT.fractureEpisodesPrev                                       (829) fx_nos                             399           852
               DT.fractureEpisodesPrev  Clinical vertebral fracture          (805, 806, 73313) spine                  705          2027
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (808) pelvis                              96           183
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (812, 73311) humerus                     165           360
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                 292           627
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (820, 73314) hip                         703          1626
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (821, 73315) femur                       180           397
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
770          select "DT.fractureEpisodesPrev" as table,
771                 sum(countDistinctPatid) as sumDistinctPatid,
772                 sum(countFractureEpisodes) as sumFractureEpisodes
773            from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                                    17:45 Monday, May 21, 2018  10

                                                                           sumDistinct   sumFracture
                                                 table                           Patid      Episodes
                                                 ---------------------------------------------------
                                                 DT.fractureEpisodesPrev          4525         10161
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
774        
775          create table DT.fractureEpisodesInc as
776            select A.database,
777                   A.ENR_END_DATE,
778                   A.DEATH_DATE,
779                   A.exposure,
780                   A.exposureStart,
781                   A.exposureEnd,
782                   A.daysExposed,
16                                                                  The SAS System                                          17:45 Monday, May 21, 2018

783                   A.exposureID,
784                   B.*,
785                   case
786                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
787                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
788                     else ""
789                     end as fractureType
790            from DT.exposureTimeline A inner join
791                 Work.fractureEpisodes B on (A.patid = B.patid  & A.exposureStart <= B.fractureEpisodeStart <= A.exposureEnd);
NOTE: Table DT.FRACTUREEPISODESINC created, with 2818 rows and 33 columns.

792          create table Work.summaryFractureEpisodesInc as
793            select "DT.fractureEpisodesInc" as table,
794                   fractureType, fractureSite,
795                   count(distinct patid) as countDistinctPatid,
796                   count(*) as countFractureEpisodes
797            from DT.fractureEpisodesInc
798            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESINC created, with 23 rows and 5 columns.

799          select * from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                                    17:45 Monday, May 21, 2018  11

                                                                                                                   count         count
                                                                                                                Distinct      Fracture
               table                   fractureType                         fractureSite                           Patid      Episodes
               -----------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesInc                                       (7331) pathologic nos/nec                 33            42
               DT.fractureEpisodesInc                                       (800-804) skull/face                      60            65
               DT.fractureEpisodesInc                                       (807) rib/sternum/trachea                162           179
               DT.fractureEpisodesInc                                       (809) trunk bones                          2             2
               DT.fractureEpisodesInc                                       (810) clavicle                            50            52
               DT.fractureEpisodesInc                                       (811) scapula                             16            18
               DT.fractureEpisodesInc                                       (814) carpal                              53            58
               DT.fractureEpisodesInc                                       (815-817) hand/fingers                   153           164
               DT.fractureEpisodesInc                                       (818-819) arms mult                        3             3
               DT.fractureEpisodesInc                                       (822) patella                             26            34
               DT.fractureEpisodesInc                                       (823, 73316) tib_fib                      58            70
               DT.fractureEpisodesInc                                       (824) ankle                              108           119
               DT.fractureEpisodesInc                                       (825) tarsal_metatarsal                  167           207
               DT.fractureEpisodesInc                                       (826) foot_phalanges                     118           121
               DT.fractureEpisodesInc                                       (827) lower_limb                           4             4
               DT.fractureEpisodesInc                                       (828) legs+arm/rib                         2             2
               DT.fractureEpisodesInc                                       (829) fx_nos                              27            33
               DT.fractureEpisodesInc  Clinical vertebral fracture          (805, 806, 73313) spine                  445           649
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (808) pelvis                              57            59
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (812, 73311) humerus                      91           110
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                 150           173
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (820, 73314) hip                         401           505
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (821, 73315) femur                       126           149
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
800          select "DT.fractureEpisodesInc" as table,
801                 sum(countDistinctPatid) as sumDistinctPatid,
802                 sum(countFractureEpisodes) as sumFractureEpisodes
803            from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                                    17:45 Monday, May 21, 2018  12

                                                                           sumDistinct   sumFracture
                                                  table                          Patid      Episodes
                                                  --------------------------------------------------
                                                  DT.fractureEpisodesInc          2312          2818
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
804        quit;
NOTE: The PROCEDURE SQL printed pages 9-12.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.92 seconds
      cpu time            0.67 seconds
      

805        
806        
807        
808        
809        /*
810        CLEAN UP
811        
812        proc sql;
813          drop table UCB.tempFracDxMPCD;
814          drop table UCB.tempFracDxUCB;
815          drop table UCB.tempFracDxSABR;
816          drop table UCB.tempFracPxMPCD;
817          drop table UCB.tempFracPxUCB;
818          drop table UCB.tempFracPxSABR;
819        quit;
820         */
821        
822        
823        proc export
824          data = Work.summaryFractureEpisodesInc
825          outfile = "data\processed\&cmt..csv"
826          dbms = csv
827          replace;
828          delimiter = '09'x;
829        run;

830         /**********************************************************************
831         *   PRODUCT:   SAS
832         *   VERSION:   9.4
833         *   CREATOR:   External File Interface
834         *   DATE:      21MAY18
835         *   DESC:      Generated SAS Datastep Code
836         *   TEMPLATE SOURCE:  (None Specified.)
837         ***********************************************************************/
838            data _null_;
839            %let _EFIERR_ = 0; /* set the ERROR detection macro variable */
840            %let _EFIREC_ = 0;     /* clear export record count macro variable */
841            file 'data\processed\queryFractures.csv' delimiter='09'x DSD DROPOVER lrecl=32767;
842            if _n_ = 1 then        /* write column names or labels */
843             do;
17                                                                  The SAS System                                          17:45 Monday, May 21, 2018

844               put
845                  "table"
846               '09'x
847                  "fractureType"
848               '09'x
849                  "fractureSite"
850               '09'x
851                  "countDistinctPatid"
852               '09'x
853                  "countFractureEpisodes"
854               ;
855             end;
856           set  WORK.SUMMARYFRACTUREEPISODESINC   end=EFIEOD;
857               format table $22. ;
858               format fractureType $35. ;
859               format fractureSite $30. ;
860               format countDistinctPatid best12. ;
861               format countFractureEpisodes best12. ;
862             do;
863               EFIOUT + 1;
864               put table $ @;
865               put fractureType $ @;
866               put fractureSite $ @;
867               put countDistinctPatid @;
868               put countFractureEpisodes ;
869               ;
870             end;
871            if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable */
872            if EFIEOD then call symputx('_EFIREC_',EFIOUT);
873            run;

NOTE: The file 'data\processed\queryFractures.csv' is:
      Filename=U:\studies\AS\pgms\bchan\data\processed\queryFractures.csv,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=21May2018:17:46:49,
      Create Time=21May2018:17:46:49

NOTE: 24 records were written to the file 'data\processed\queryFractures.csv'.
      The minimum record length was 42.
      The maximum record length was 91.
NOTE: There were 23 observations read from the data set WORK.SUMMARYFRACTUREEPISODESINC.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.01 seconds
      

23 records created in data\processed\queryFractures.csv from WORK.SUMMARYFRACTUREEPISODESINC.
  
  
NOTE: "data\processed\queryFractures.csv" file was successfully created.
NOTE: PROCEDURE EXPORT used (Total process time):
      real time           0.21 seconds
      cpu time            0.15 seconds
      

874        
875        
876        ods html close;
NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           1:31.66
      cpu time            1:11.49
      
