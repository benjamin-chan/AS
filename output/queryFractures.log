1                                                          The SAS System                               09:40 Thursday, May 24, 2018

NOTE: Unable to open SASUSER.REGSTRY. WORK.REGSTRY will be opened instead.
NOTE: All registry changes will be lost at the end of the session.

WARNING: Unable to copy SASUSER registry to WORK registry. Because of this, you will not see registry customizations during this 
         session.
NOTE: Unable to open SASUSER.PROFILE. WORK.PROFILE will be opened instead.
NOTE: All profile changes will be lost at the end of the session.
NOTE: Copyright (c) 2016 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M5) 
      Licensed to UNIVERSITY OF ALABAMA AT BIRMINGHAM - SFA - T&R, Site 70086550.
NOTE: This session is executing on the X64_DS08R2  platform.



NOTE: Updated analytical products:
      
      SAS/STAT 14.3
      SAS/ETS 14.3
      SAS/IML 14.3
      SAS/QC 14.3

NOTE: Additional host information:

 X64_DS08R2 WIN 6.1.7601 Service Pack 1 Server

--- PEER News and Updates ---

: SECURITY REMINDER :
Please remember not to copy any data files that contain PHI (protected health identifiers) to any 
of the shared folders.

 


NOTE: SAS initialization used:
      real time           6.59 seconds
      cpu time            0.32 seconds
      
1          *  University of Alabama at Birmingham                               *
2          *  AS project                                            *
3          **********************************************************************;
4          options pagesize=74 linesize=150 pageno=1 missing=' ' date FORMCHAR="|----|+|---+=|-/\<>*";
5          * Programmer    : Benjamin Chan <chanb@ohsu.edu>
6          * Creation date :
7          * Modify date   :
8          ;
9          %let cmt=queryFractures; * type the name of your program here (without the filename extension);
10         %let pgm=&cmt..sas;
11         %include "lib\libname.sas" ;
NOTE: Libref STDC5P was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: H:\studies\osteo\data\STD_files\5pct\
NOTE: Libref STD_SABR was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\data\std_SABER\
NOTE: Libref MPSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\mpcd\data\stddata\
NOTE: Libref UCBSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\stddata\
NOTE: Libref UCB was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB\
NOTE: Libref UCB64 was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB64\
NOTE: Libref DT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: V:\studies\AS\data
NOTE: Libref NDC was successfully assigned as follows: 
      Engine:        V9 
2                                                                   The SAS System                                        09:40 Thursday, May 24, 2018

      Physical Name: W:\onenote\references\drug ndcs\sas data
143        footnote "&pgm.";
144        * footnote2 "%sysfunc(datetime(),datetime14.)";
145        title1 '--- AS project ---';
146        **********************************************************************;
147        options macrogen mlogic mprint symbolgen;
148        options nomacrogen nomlogic nomprint nosymbolgen;
149        
150        
151        ods html
152          body = "output\&cmt..html"
153          style = Statistical;
NOTE: Writing HTML Body file: output\queryFractures.html
154        
155        
156        /*
157        FRACTURES
158        
159        See "ALGORITHMS TO ENHANCE SPECIFICITY OF FRACTURE IDENTIFICATION_ 100316.docx"
160        
161        Adapted from Lang's code in "001_fx_data.sas"
162        
163        
164        From: Chen, Lang [mailto:langchen@uabmc.edu]
165        Sent: Monday, July 24, 2017 8:56 AM
166        To: Benjamin Chan <chanb@ohsu.edu>
167        Subject: RE: fracture identification algorithm
168        
169        Here it is.
170        For 001_fx_data, find all fx related claim and run the algorithm.
171        Please ignore any code after line 476
172        Modify code from line 1 -50
173        
174        For 002_fx_epi_data
175        Define fx episode.
176        
177        Final output data is fx_dgns_&firstyr._&lastyr._4. Please let me if you have any questions.
178         */
179        
180        
181        /*
182        START OF 001_fx_data.sas
183         */
184        
185        
186        /*Assign "Broad" fracture site (fx_site) for all ICD9 diagnoses, outputting separately, so some records are cloned, then combining into one
186      !  file */
187        /*No longer using matched trauma files here*/
188        
189        %macro comballfxdgns;
190            data fx_dgns;
191                set UCB64.tempFracDxAll (where = (diagCodeType = "Fracture code"));
192                    length fx_site $30 ;
193                    fx_site = '';
194                    if strip(DX) in: ('800' '801' '802' '803' '804') then           do; fx_site='(800-804) skull/face'; output; end;
195                    if strip(DX) in: ('805', '806') or strip(DX)='73313' then       do; fx_site='(805, 806, 73313) spine'; output; end;
196                    if strip(DX) in: ('807') then                                           do; fx_site='(807) rib/sternum/trachea'; output; end;
197                    if strip(DX) in: ('808') then                                           do; fx_site='(808) pelvis'; output; end;
198                    if strip(DX) in: ('809') then                                           do; fx_site='(809) trunk bones'; output; end;
199                    if strip(DX) in: ('810') then                                           do; fx_site='(810) clavicle'; output; end;
200                    if strip(DX) in: ('811') then                                           do; fx_site='(811) scapula'; output; end;
201                    if strip(DX) in: ('812') or strip(DX)='73311' then              do; fx_site='(812, 73311) humerus'; output; end;
202                    if strip(DX) in: ('813') or strip(DX)='73312' then              do; fx_site='(813, 73312) radius_ulna'; output; end;
203                    if strip(DX) in: ('814') then                                           do; fx_site='(814) carpal'; output; end;
204                    if strip(DX) in: ('815' '816' '817') then                           do; fx_site='(815-817) hand/fingers'; output; end;
205                    if strip(DX) in: ('818' '819') then                                     do; fx_site='(818-819) arms mult'; output; end;
206                    if strip(DX) in: ('820') or strip(DX) = '73314' then                do; fx_site='(820, 73314) hip'; output; end;
207                    if strip(DX) in: ('821') or strip(DX)='73315' then              do; fx_site='(821, 73315) femur'; output; end;
208                    if strip(DX) in: ('822') then                                           do; fx_site='(822) patella'; output; end;
209                    if strip(DX) in: ('823') or strip(DX)='73316' then              do; fx_site='(823, 73316) tib_fib'; output; end;
210                    if strip(DX) in: ('824') then                                           do; fx_site='(824) ankle'; output; end;
211                    if strip(DX) in: ('825') then                                           do; fx_site='(825) tarsal_metatarsal'; output; end;
3                                                                   The SAS System                                        09:40 Thursday, May 24, 2018

212                    if strip(DX) in: ('826') then                                           do; fx_site='(826) foot_phalanges'; output; end;
213                    if strip(DX) in: ('827') then                                           do; fx_site='(827) lower_limb'; output; end;
214                    if strip(DX) in: ('828') then                                           do; fx_site='(828) legs+arm/rib'; output; end;
215                    if strip(DX) in: ('829') then                                           do; fx_site='(829) fx_nos'; output; end;
216                    if strip(DX) in ('73310' '73319' '7331') then                 do; fx_site='(7331) pathologic nos/nec'; output; end;
217            data fx_excare;
218                set UCB64.tempFracDxAll (where = (diagCodeType = "Extended care code"));
219                    length fx_site $30 ;
220                    fx_site = '';
221                    /*Expanded Diagnosis Codes - Fracture Aftercare Codes*/
222                    if strip(DX) in ('V5410' 'V5420') then                          do; fx_site='(812, 73311) humerus'; output;
223                                                                                                     fx_site='(813, 73312) radius_ulna'; output;
223      ! end;
224                    if strip(DX) in ('V5411' 'V5421') then                          do; fx_site='(812, 73311) humerus'; output; end;
225                    if strip(DX) in ('V5412' 'V5422') then                          do; fx_site='(813, 73312) radius_ulna'; output;
226                                                                                                     fx_site='(814) carpal'; output; end;
227                    if strip(DX) in ('V5413' 'V5423') then                          do; fx_site='(820, 73314) hip'; output; end;
228                    if strip(DX) in ('V5414' 'V5424') then                          do; fx_site='(820, 73314) hip'; output;
229                                                                                                     fx_site='(821, 73315) femur'; output;
230                                                                                                     fx_site='(822) patella'; output;
231                                                                                                     fx_site='(824) ankle'; output;
232                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
233                    if strip(DX) in ('V5415' 'V5425') then                          do; fx_site='(820, 73314) hip'; output;
234                                                                                                     fx_site='(821, 73315) femur'; output;
235                                                                                                     fx_site='(822) patella'; output; end;
236                    if strip(DX) in ('V5416' 'V5426') then                          do; fx_site='(824) ankle'; output;
237                                                                                                     fx_site='(822) patella'; output;
238                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
239                    if strip(DX) in ('V5417' 'V5427') then                          do; fx_site='(805, 806, 73313) spine'; output; end;
240                    if strip(DX) in: ('V542') then                                       do; fx_site='(7331) pathologic nos/nec'; output; end;
241                    if strip(DX) in: ('V541') then                                       do; fx_site='(829) fx_nos'; output; end;
242            run;
243        
244            /* proc sort data=fx_dgns; by patid BEGIN_DATE fx_site; run;
245            proc sort data=fx_excare; by patid BEGIN_DATE fx_site; run; */
246        %mend;
247        %comballfxdgns;

NOTE: There were 31384 observations read from the data set UCB64.TEMPFRACDXALL.
      WHERE diagCodeType='Fracture code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_DGNS has 31384 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.42 seconds
      cpu time            0.17 seconds
      


NOTE: There were 1825 observations read from the data set UCB64.TEMPFRACDXALL.
      WHERE diagCodeType='Extended care code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_EXCARE has 4120 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.03 seconds
      

248        
249        /*Now, assign a more specific fracture site (e.g., closed, other) (site) that is used in the CQ algorithms*/
250        /*Since Expanded Diagnosis Codes (V Codes) apply to sub-categories of each broad fracture site, clone records for these so they appear in
250      ! both places*/
251        
252        data fx_dgns_2;
253            set fx_dgns;
254        
255            length site $30;
256        
257            site="";
258        
259            *Spine-closed and Spine-other;
260            if fx_site='(805, 806, 73313) spine' then
261                do;
4                                                                   The SAS System                                        09:40 Thursday, May 24, 2018

262                    site = 'spine_cls'; /*Includes V Codes and 73313 here*/
263                    if substr(strip(DX),1,3) in ('805' '806') and substr(strip(DX),1,4) ^in ('8050', '8052', '8054', '8058') then
264                        site = 'spine_oth';
265                end;
266        
267            *Pelvis-closed and Pelvis-other... No V Codes;
268            if fx_site='(808) pelvis' then
269                do;
270                    site = 'pelvis_cls';
271                    if substr(strip(DX),1,3)='808' and substr(strip(DX),1,4) ^in ('8080', '8082', '8084', '8088') then
272                        site = 'pelvis_oth';
273                end;
274        
275            *Clavicle-closed and Clavicle-other.... No V Codes;
276            if fx_site='(810) clavicle' then
277                do;
278                    site = 'clv_cls';
279                    if substr(strip(DX),1,3) = '810' and substr(strip(DX),1,4) ^in ('8100') then
280                        site = 'clv_oth';
281                end;
282        
283            *Humerus-closed and Humerus-other;
284            if fx_site='(812, 73311) humerus' then
285                do;
286                    site = 'hmrs_cls'; /*Includes V Codes and 73311 here*/
287                    if substr(strip(DX),1,3)= '812' and substr(strip(DX),1,4) ^in ('8120', '8122', '8124') then
288                        site = 'hmrs_oth';
289                end;
290        
291            *Distal radius/ulna and Radius/ulna-other;
292            if fx_site='(813, 73312) radius_ulna' then
293                do;
294                 site = 'dist4arm'; /*Includes V Codes and 73312 here*/
295                    if substr(strip(DX),1,3) = '813' and substr(strip(DX),1,4) ^in ('8134', '8135') then
296                        site = 'rad_ul_oth';
297                end;
298        
299            *Carpal... V Codes present but only one category;
300            if fx_site='(814) carpal' then
301                do;
302                    site = 'carpal';
303                 end;
304        
305            *Hip-closed and Hip-other;
306            if fx_site='(820, 73314) hip' then
307                    do;
308                    site = 'hip_cls'; /*Includes V Codes and 73314 here*/
309                    if substr(strip(DX),1,3)='820' and substr(strip(DX),1,4) ^in ('8200', '8202', '8208') then
310                        site = 'hip_oth';
311                end;
312        
313            *Other femur-closed and Other femur-other;
314            if fx_site='(821, 73315) femur' then
315                do;
316                    site = 'oth_fem_cls'; /*Includes V Codes and 73315 here*/
317                    if substr(strip(DX),1,3)='821' and substr(strip(DX),1,4) ^in ('8210', '8212') then
318                        site = 'oth_fem_oth';
319                end;
320        
321            *Tib/fib-closed and Tib/fib-other;
322            if fx_site='(823, 73316) tib_fib' then
323                do;
324                    site = 'tib_fib_cls'; /*Includes V Codes and 73316 here*/
325                    if substr(strip(DX),1,3)='823' and substr(strip(DX),1,4) ^in ('8230', '8232', '8238') then
326                        site = 'tib_fib_oth';
327                end;
328        
329            *Ankle... V Codes present but only one category;
330            if fx_site='(824) ankle' then
331                do;
332                    site = 'ankle';
333                end;
5                                                                   The SAS System                                        09:40 Thursday, May 24, 2018

334        
335            /*Assign site for other fx_sites that do not have CQ algorithm and thus no sub categories*/
336            if site = "" then do;
337                site = fx_site;
338            end;
339        
340            label site = 'CQ Algorithm Fracture Site (Specific)';
341        
342        run;

NOTE: There were 31384 observations read from the data set WORK.FX_DGNS.
NOTE: The data set WORK.FX_DGNS_2 has 31384 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.04 seconds
      

343        
344        /*###########################################################################################################*/
345        /***************************************************Intermediate Fracture Diagnosis File**********************/
346        /*Combine CQ diagnosis files*******************************************************/
347        data fx_dgns_3;
348            set fx_dgns_2
349        /*    fx_excare_*/
350                ;
351        run;

NOTE: There were 31384 observations read from the data set WORK.FX_DGNS_2.
NOTE: The data set WORK.FX_DGNS_3 has 31384 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.04 seconds
      

352        
353        proc freq data=fx_dgns_3;
354            tables fx_site site;
355        run;

                                                                  --- AS project ---                                  09:40 Thursday, May 24, 2018   1

                                                                  The FREQ Procedure

                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec         330        1.05           330         1.05  
                                    (800-804) skull/face              927        2.95          1257         4.01  
                                    (805, 806, 73313) spine          8622       27.47          9879        31.48  
                                    (807) rib/sternum/trachea        1551        4.94         11430        36.42  
                                    (808) pelvis                      747        2.38         12177        38.80  
                                    (809) trunk bones                   6        0.02         12183        38.82  
                                    (810) clavicle                    727        2.32         12910        41.14  
                                    (811) scapula                      86        0.27         12996        41.41  
                                    (812, 73311) humerus             1989        6.34         14985        47.75  
                                    (813, 73312) radius_ulna         2836        9.04         17821        56.78  
                                    (814) carpal                      629        2.00         18450        58.79  
                                    (815-817) hand/fingers           1973        6.29         20423        65.07  
                                    (818-819) arms mult                12        0.04         20435        65.11  
                                    (820, 73314) hip                 2676        8.53         23111        73.64  
                                    (821, 73315) femur                925        2.95         24036        76.59  
                                    (822) patella                     414        1.32         24450        77.91  
                                    (823, 73316) tib_fib             1086        3.46         25536        81.37  
                                    (824) ankle                      1578        5.03         27114        86.39  
                                    (825) tarsal_metatarsal          2865        9.13         29979        95.52  
                                    (826) foot_phalanges             1204        3.84         31183        99.36  
                                    (827) lower_limb                   28        0.09         31211        99.45  
                                    (828) legs+arm/rib                  6        0.02         31217        99.47  
                                    (829) fx_nos                      167        0.53         31384       100.00  


                                                        CQ Algorithm Fracture Site (Specific)
 
                                                                                          Cumulative    Cumulative
                                    site                         Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec         330        1.05           330         1.05  
                                    (800-804) skull/face              927        2.95          1257         4.01  
                                    (807) rib/sternum/trachea        1551        4.94          2808         8.95  
                                    (809) trunk bones                   6        0.02          2814         8.97  
                                    (811) scapula                      86        0.27          2900         9.24  
                                    (815-817) hand/fingers           1973        6.29          4873        15.53  
                                    (818-819) arms mult                12        0.04          4885        15.57  
                                    (822) patella                     414        1.32          5299        16.88  
                                    (825) tarsal_metatarsal          2865        9.13          8164        26.01  
                                    (826) foot_phalanges             1204        3.84          9368        29.85  
                                    (827) lower_limb                   28        0.09          9396        29.94  
                                    (828) legs+arm/rib                  6        0.02          9402        29.96  
                                    (829) fx_nos                      167        0.53          9569        30.49  
                                    ankle                            1578        5.03         11147        35.52  
                                    carpal                            629        2.00         11776        37.52  
                                    clv_cls                           727        2.32         12503        39.84  
                                    dist4arm                         1977        6.30         14480        46.14  
                                    hip_cls                          2607        8.31         17087        54.44  
                                    hip_oth                            69        0.22         17156        54.66  
                                    hmrs_cls                         1978        6.30         19134        60.97  
                                    hmrs_oth                           11        0.04         19145        61.00  
                                    oth_fem_cls                       890        2.84         20035        63.84  
                                    oth_fem_oth                        35        0.11         20070        63.95  
                                    pelvis_cls                        718        2.29         20788        66.24  
                                    pelvis_oth                         29        0.09         20817        66.33  
                                    rad_ul_oth                        859        2.74         21676        69.07  
                                    spine_cls                        7534       24.01         29210        93.07  
                                    spine_oth                        1088        3.47         30298        96.54  
                                    tib_fib_cls                      1042        3.32         31340        99.86  
                                    tib_fib_oth                        44        0.14         31384       100.00  
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 31384 observations read from the data set WORK.FX_DGNS_3.
NOTE: The PROCEDURE FREQ printed page 1.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.18 seconds
      cpu time            0.07 seconds
      

356        
357        proc sort data=fx_dgns_3;
358            by patid ENCOUNTERID fx_site site;
359        run;

NOTE: There were 31384 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_3 has 31384 observations and 28 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.15 seconds
      cpu time            0.07 seconds
      

360        
361        
362        /*###########################################################################################################*/
363        /*************************************************************************************************************/
364        /*Look for repair procedures and assign treatment site*******************/
365        /*This code has been updated to include hip/femur replacement with matching diagnosis code, also looked in claim strip(DX) not just primary
365      !  strip(DX)
366        /*Not accepting contiguous sites until later*/
367        /*Excluding procedures from DME files*/
368        /*******************************Select All Spine Imaging Codes from STD Procedure Files for CQ=4/5 algorithms*/
369        
370        %macro fx_prcd;
371            data fx_prcd spine_xray;
372                set UCB64.tempFracPxAll;
6                                                                   The SAS System                                        09:40 Thursday, May 24, 2018

373        
374                    length tx_site $30;
375                    length HLAT $1;
376        
377                    if strip(px) in ('21300' '21310' '21315' '21320' '21325' '21330' '21335' '21336' '21337' '21338' '21339' '21340' '21343'
377      ! '21344' '21345' '21346' '21347' '21348'
378                                         '21355' '21356' '21360' '21365' '21366' '21385' '21386' '21387' '21390' '21395' '21400' '21401' '21406'
378      ! '21407' '21408' '21421' '21422' '21423'
379                                         '21431' '21432' '21433' '21435' '21436' '21440' '21445' '21450' '21451' '21452' '21453' '21454' '21461'
379      ! '21462' '21465' '21470'
380                                         '62000' '62005' '62010')  and lengthn(strip(px)) = 5 then do;
381                        tx_site='(800-804) skull/face'; output fx_prcd; end;
382        
383                    if strip(px) in ('22305' '22310' '22315' '22318' '22319' '22325' '22326' '22327' '22328' '22520' '22521' '22522' '22523'
383      ! '22524' '22525' '76012' '76013'
384                                         'S2360' 'S2361' 'S2362' 'S2363' '72291' '72292')  and lengthn(strip(px)) = 5 then do;
385                        tx_site = '(805, 806, 73313) spine'; output fx_prcd; end;
386        
387                    if  strip(px) in ('21493' '21494' '21495' '21800' '21805' '21810' '21820' '21825' ) then do;
388                        tx_site='(807) rib/sternum/trachea'; output fx_prcd; end;
389        
390                    if strip(px) in ('27193' '27194' '27215' '27216' '27217' '27218' '27220' '27222' '27226' '27227' '27228')  and
390      ! lengthn(strip(px)) = 5 then do;
391                        tx_site = '(808) pelvis'; output fx_prcd; end;
392        
393                    if strip(px) in ('23500' '23505' '23515')  and lengthn(strip(px)) = 5 then do;
394                        tx_site = '(810) clavicle'; output fx_prcd; end;
395        
396                    if strip(px) in ('23570' '23575' '23585') then do;
397                        tx_site= '(811) scapula'; output fx_prcd; end;
398        
399                    if strip(px) in ('23600' '23605' '23615' '23616' '23620' '23625' '23630' '23665' '24500' '24505' '24515' '24516' '24530'
399      ! '24535' '24538' '24545' '24546' '24560'
400                                 '24565' '24566' '24575' '24576' '24577' '24579' '24582')  and lengthn(strip(px)) = 5 then do;
401                        tx_site = '(812, 73311) humerus'; output fx_prcd; end;
402        
403                    if strip(px) in ('25600' '25605' '25606' '25607' '25608' '25609' '25620' '25650' '25651' '25652')  and lengthn(strip(px)) = 5
403      ! then do;
404                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
405        
406                    if strip(px) in ('24650' '24655' '24665' '24666' '24670' '24675' '24685' '25500' '25505' '25515' '25520' '25525' '25526'
406      ! '25530' '25535' '25545' '25560' '25565'
407                                 '25574' '25575')  and lengthn(strip(px)) = 5 then do;
408                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
409        
410                    if strip(px) in ('25622' '25624' '25628' '25630' '25635' '25645' '25680' '25685')  and lengthn(strip(px)) = 5 then do;
411                        tx_site = '(814) carpal'; output fx_prcd; end;
412        
413                    if strip(px) in ('26600' '26605' '26607' '26608' '26615' '26645' '26650' '26665' '26720' '26725' '26727' '26735' '26740'
413      ! '26742' '26746' '26750' '26755' '26756' '26765' )
414                               and lengthn(strip(px)) = 5 then do;
415                        tx_site='(815-817) hand/fingers'; output fx_prcd; end;
416        
417                    if '27230' <= strip(px) <= '27248' and lengthn(strip(px)) = 5 then do;
418                        tx_site = '(820, 73314) hip'; output fx_prcd; end;
419        
420                    if '27500' <= strip(px) <= '27514'  and lengthn(strip(px)) = 5 then do;
421                        tx_site = '(821, 73315) femur'; output fx_prcd; end;
422        
423                    if strip(px) in ('27520' '27524')  and lengthn(strip(px)) = 5 then do;
424                        tx_site = '(822) patella'; output fx_prcd; end;
425        
426                    if ('27530' <= strip(px) <= '27536' or '27750' <= strip(px) <= '27759' or '27780' <= strip(px) <= '27784' or '27824' <=
426      ! strip(px) <= '27828') and lengthn(strip(px)) = 5  then do;
427                        tx_site = '(823, 73316) tib_fib'; output fx_prcd; end;
428        
429                    if strip(px) in ('27760' '27762' '27766' '27786' '27788' '27792' '27808' '27810' '27814' '27816' '27818' '27822' '27823'
429      ! '28430' '28435' '28436' '28445')  and lengthn(strip(px)) = 5 then do;
430                        tx_site = '(824) ankle'; output fx_prcd; end;
431        
432                    if strip(px) in ('28320' '28322' '28400' '28405' '28406' '28415' '28420' ) and lengthn(strip(px)) = 5 then do;
433                        tx_site='(825) tarsal_metatarsal'; output fx_prcd; end;
7                                                                   The SAS System                                        09:40 Thursday, May 24, 2018

434        
435                 /********************************Hip/Femur Additions - must be matched with DGNS to be included*/
436                 /*Hip replacement codes*/
437                    /*Hip*/
438                    if strip(px) in ('27130' '27125') and lengthn(strip(px)) = 5  then do;
439                        HLAT='1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
440        
441                    /*Codes below are the only ICD9 Procedure Codes that we are using for "repair"*/
442                    if strip(px) in ('8151' '8152') and lengthn(strip(px)) = 4 then do;
443                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
444        
445                    /*Femur repair codes, assigned to both Hip and Femur treatment sites... CHECK - MAYBE WE NEED TO DO THIS THE OTHER WAY AS
445      ! WELL*/
446                    /*Hip*/
447                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
448                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
449        
450                    /*Femur*/
451                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
452                        HLAT = '1'; tx_site = '(821, 73315) femur'; output fx_prcd; end;
453                     /*spine image*/
454                        if '72010' <= strip(px) <= '72159' or '72240' <= strip(px) <= '72285' or strip(px) = '72295' then do;   /*Spine Imaging
454      ! Codes*/
455                        tx_site='(805, 806, 73313) spine';
456                        output spine_xray; end;
457        
458            run;
459        
460            data fx_prcd;
461                set fx_prcd;
462                /*To add laterality info*/
463        /*        array hcpcs{*} hcpcs_1st_mdfr_cd hcpcs_2nd_mdfr_cd hcpcs_3rd_mdfr_cd hcpcs_4th_mdfr_cd ; */
464                if HLAT='1' then do;
465                    repair_right='0'; repair_left='0';
466                end;
467        /*        if HLAT='1' then */
468        /*            do i=1 to dim(hcpcs);*/
469        /*                if hcpcs{i} = 'RT' then repair_right='1';*/
470        /*                else if hcpcs{i} = 'LT' then repair_left='1';*/
471        /*            end;*/
472            run;
473            proc sort data=fx_prcd nodupkey; by patid ENCOUNTERID px_date tx_site; run;
474        
475            data spine_xray;
476                set spine_xray;
477                keep patid px_date tx_site  ENCOUNTERID begin_date;
478            run;
479            proc sort data=spine_xray nodupkey; by patid px_date; run;
480        %mend;
481        %fx_prcd;

NOTE: There were 11239197 observations read from the data set UCB64.TEMPFRACPXALL.
NOTE: The data set WORK.FX_PRCD has 7518 observations and 25 variables.
NOTE: The data set WORK.SPINE_XRAY has 126693 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           17.58 seconds
      cpu time            17.31 seconds
      


NOTE: There were 7518 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK.FX_PRCD has 7518 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.03 seconds
      


NOTE: There were 7518 observations read from the data set WORK.FX_PRCD.
NOTE: 3914 observations with duplicate key values were deleted.
NOTE: The data set WORK.FX_PRCD has 3604 observations and 27 variables.
NOTE: PROCEDURE SORT used (Total process time):
8                                                                   The SAS System                                        09:40 Thursday, May 24, 2018

      real time           0.04 seconds
      cpu time            0.03 seconds
      


NOTE: There were 126693 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.SPINE_XRAY has 126693 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.10 seconds
      cpu time            0.06 seconds
      


NOTE: There were 126693 observations read from the data set WORK.SPINE_XRAY.
NOTE: 89219 observations with duplicate key values were deleted.
NOTE: The data set WORK.SPINE_XRAY has 37474 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.15 seconds
      cpu time            0.12 seconds
      

482        
483        
484        
485        data trauma (rename=(begin_date=trauma_dt));
486                set UCB64.tempFracDxAll (where = (diagCodeType = "Trauma code"));
487        run;

NOTE: There were 7261 observations read from the data set UCB64.TEMPFRACDXALL.
      WHERE diagCodeType='Trauma code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.TRAUMA has 7261 observations and 26 variables.
NOTE: DATA statement used (Total process time):
      real time           0.09 seconds
      cpu time            0.06 seconds
      

488        proc sort data= trauma(keep=patid trauma_dt) nodupkey; by patid trauma_dt;run;

NOTE: There were 7261 observations read from the data set WORK.TRAUMA.
NOTE: 4102 observations with duplicate key values were deleted.
NOTE: The data set WORK.TRAUMA has 3159 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.07 seconds
      cpu time            0.01 seconds
      

489        
490        
491        /*subset the spine xray procedure claim for patients with fx diagnosis code only*/
492        /*so SAS will not run out of memory*/
493        data fx_spine_xray(keep=patid tx_site px_date ENCOUNTERID begin_date);
494        if _n_=1 then do;
495          declare hash hid(dataset:"fx_dgns_3(where=(fx_site='(805, 806, 73313) spine')))", multidata:"N", hashexp:20);
496          rc=hid.defineKey("patid");
497          rc=hid.defineDone();
498        end;
499        set spine_xray;
500        rc=hid.find();
501        if rc=0;
502        run;

NOTE: There were 8622 observations read from the data set WORK.FX_DGNS_3.
      WHERE fx_site='(805, 806, 73313) spine';
NOTE: There were 37474 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.FX_SPINE_XRAY has 5641 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.15 seconds
      cpu time            0.07 seconds
      

503        /*subset the Trauma code for patients with fx diagnosis code only*/
9                                                                   The SAS System                                        09:40 Thursday, May 24, 2018

504        /*so SAS will not run out of memory*/
505        data fx_trauma(drop=rc);
506        if _n_=1 then do;
507          declare hash hid(dataset:"fx_dgns_3", multidata:"N", hashexp:20);
508          rc=hid.defineKey("patid");
509          rc=hid.defineDone();
510        end;
511        set trauma;
512        rc=hid.find();
513        if rc=0;
514        run;

NOTE: There were 31384 observations read from the data set WORK.FX_DGNS_3.
NOTE: There were 3159 observations read from the data set WORK.TRAUMA.
NOTE: The data set WORK.FX_TRAUMA has 1472 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.09 seconds
      cpu time            0.06 seconds
      

515        /************************************Link Fracture Claims (ICD9 Diagnosis) with Repair Claims (CPT/HCPCS, some ICD9 procedure
515      ! code)***************/
516        
517        data fx_dgns_4(drop=rc: px_date tx_site xray_date trauma_dt);
518        if _n_=1 then do;
519          declare hash hid(dataset:"fx_prcd", multidata:"N", hashexp:20);
520          rc=hid.defineKey("patid", "px_date", "tx_site");
521        /*  rc=hid.defineData("px_date", "tx_site");*/
522          rc=hid.defineDone();
523          declare hash hxray(dataset:"fx_spine_xray(rename=px_date=xray_date)", multidata:"Y", hashexp:20);
524          rc=hxray.defineKey("patid", "tx_site");
525          rc=hxray.defineData("xray_date");
526          rc=hxray.defineDone();
527          declare hash htrauma(dataset:"fx_trauma", multidata:"Y", hashexp:20);
528          rc=htrauma.defineKey("patid");
529          rc=htrauma.defineData("trauma_dt");
530          rc=htrauma.defineDone();
531        end;
532        if 0 then set fx_prcd(keep=patid px_date tx_site)
533                      fx_spine_xray(keep=patid px_date tx_site rename=px_date=xray_date)
534                      fx_trauma;
535        set fx_dgns_3;
536        length cq $4 spine_image trauma_date 4 trauma $1;
537        format spine_image trauma_date mmddyy10.;
538        cq="0000";
539        rc=hid.find(key:patid, key:begin_date,key:fx_site);
540        if rc^=0 then do;
541            px_date=.;
542            tx_site=" ";
543        end;
544        if enc_type="IP" then do;
545        /*CQ = 1 Inpatient claim with primary diagnosis code */
546            if pdx="P" then substr(cq,1,1)="1";
547        /*CQ = 2 Inpatient claim with secondary diagnosis code*/
548            else substr(cq,2,1)="2";
549        end; else do;
550        /*CQ = 3 outpatient diagnosis code AND carrier line with repair/replace HCPCS*/
551            if rc=0 then substr(cq,3,1)="3";
552            rc1=hxray.find(key:patid, key:fx_site);
553            do while (rc1 = 0);
554                if begin_date-10 <=xray_date<= begin_date then do;
555                    if enc_type in ("AV" "IF" "NH" "HH" "ER" "ED") then do;
556        /*CQ = 4 outpatient [Physician E&M codes] diagnosis code with spine image/x-ray within 10 day early*/
557                        substr(cq,4,1)="4";
558                        spine_image=min(spine_image,xray_date);
559                    end;
560                end;
561                rc1=hxray.find_next(key:patid, key:fx_site);
562            end;
563        end;
564        /*is there trauma dx within 14 days*/
565        rc2=htrauma.find(key:patid);
10                                                                  The SAS System                                        09:40 Thursday, May 24, 2018

566        do while (rc2 = 0) ;
567            if 0<=abs(trauma_dt-begin_date)<=14 then do;
568                    trauma="1";
569                    trauma_date=min(trauma_date,trauma_dt);
570           end ;
571           rc2=htrauma.find_next(key:patid) ;
572        end;
573        
574        run;

NOTE: There were 3604 observations read from the data set WORK.FX_PRCD.
NOTE: There were 5641 observations read from the data set WORK.FX_SPINE_XRAY.
NOTE: There were 1472 observations read from the data set WORK.FX_TRAUMA.
NOTE: There were 31384 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_4 has 31384 observations and 32 variables.
NOTE: DATA statement used (Total process time):
      real time           0.18 seconds
      cpu time            0.15 seconds
      

575        proc freq data=fx_dgns_4; tables enc_type*cq fx_site*cq trauma/missing;run;

                                                                  --- AS project ---                                  09:40 Thursday, May 24, 2018   2

                                                                  The FREQ Procedure

                                                               Table of ENC_TYPE by cq

                                       ENC_TYPE(Encounter Type)     cq

                                       Frequency|
                                       Percent  |
                                       Row Pct  |
                                       Col Pct  |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       AV       |  15013 |   2352 |    692 |     84 |      0 |      0 |  18141
                                                |  47.84 |   7.49 |   2.20 |   0.27 |   0.00 |   0.00 |  57.80
                                                |  82.76 |  12.97 |   3.81 |   0.46 |   0.00 |   0.00 |
                                                |  68.19 |  64.44 |  34.43 |  62.22 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       ED       |   4518 |   1122 |   1308 |     51 |      0 |      0 |   6999
                                                |  14.40 |   3.58 |   4.17 |   0.16 |   0.00 |   0.00 |  22.30
                                                |  64.55 |  16.03 |  18.69 |   0.73 |   0.00 |   0.00 |
                                                |  20.52 |  30.74 |  65.07 |  37.78 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       HH       |    219 |     22 |      2 |      0 |      0 |      0 |    243
                                                |   0.70 |   0.07 |   0.01 |   0.00 |   0.00 |   0.00 |   0.77
                                                |  90.12 |   9.05 |   0.82 |   0.00 |   0.00 |   0.00 |
                                                |   0.99 |   0.60 |   0.10 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       IP       |      0 |      0 |      0 |      0 |   2416 |   1157 |   3573
                                                |   0.00 |   0.00 |   0.00 |   0.00 |   7.70 |   3.69 |  11.38
                                                |   0.00 |   0.00 |   0.00 |   0.00 |  67.62 |  32.38 |
                                                |   0.00 |   0.00 |   0.00 |   0.00 | 100.00 | 100.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       NH       |   2266 |    154 |      8 |      0 |      0 |      0 |   2428
                                                |   7.22 |   0.49 |   0.03 |   0.00 |   0.00 |   0.00 |   7.74
                                                |  93.33 |   6.34 |   0.33 |   0.00 |   0.00 |   0.00 |
                                                |  10.29 |   4.22 |   0.40 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       Total       22016     3650     2010      135     2416     1157    31384
                                                   70.15    11.63     6.40     0.43     7.70     3.69   100.00


 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                  09:40 Thursday, May 24, 2018   3

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (7331) pathologi |    320 |      0 |      0 |      0 |      7 |      3 |    330
                                   c nos/nec        |   1.02 |   0.00 |   0.00 |   0.00 |   0.02 |   0.01 |   1.05
                                                    |  96.97 |   0.00 |   0.00 |   0.00 |   2.12 |   0.91 |
                                                    |   1.45 |   0.00 |   0.00 |   0.00 |   0.29 |   0.26 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (800-804) skull/ |    728 |      0 |     77 |      0 |     88 |     34 |    927
                                   face             |   2.32 |   0.00 |   0.25 |   0.00 |   0.28 |   0.11 |   2.95
                                                    |  78.53 |   0.00 |   8.31 |   0.00 |   9.49 |   3.67 |
                                                    |   3.31 |   0.00 |   3.83 |   0.00 |   3.64 |   2.94 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (805, 806, 73313 |   3386 |   3650 |     13 |    135 |    966 |    472 |   8622
                                   ) spine          |  10.79 |  11.63 |   0.04 |   0.43 |   3.08 |   1.50 |  27.47
                                                    |  39.27 |  42.33 |   0.15 |   1.57 |  11.20 |   5.47 |
                                                    |  15.38 | 100.00 |   0.65 | 100.00 |  39.98 |  40.80 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (807) rib/sternu |   1148 |      0 |    189 |      0 |    181 |     33 |   1551
                                   m/trachea        |   3.66 |   0.00 |   0.60 |   0.00 |   0.58 |   0.11 |   4.94
                                                    |  74.02 |   0.00 |  12.19 |   0.00 |  11.67 |   2.13 |
                                                    |   5.21 |   0.00 |   9.40 |   0.00 |   7.49 |   2.85 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (808) pelvis     |    580 |      0 |     39 |      0 |     93 |     35 |    747
                                                    |   1.85 |   0.00 |   0.12 |   0.00 |   0.30 |   0.11 |   2.38
                                                    |  77.64 |   0.00 |   5.22 |   0.00 |  12.45 |   4.69 |
                                                    |   2.63 |   0.00 |   1.94 |   0.00 |   3.85 |   3.03 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (809) trunk bone |      5 |      0 |      0 |      0 |      1 |      0 |      6
                                   s                |   0.02 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.02
                                                    |  83.33 |   0.00 |   0.00 |   0.00 |  16.67 |   0.00 |
                                                    |   0.02 |   0.00 |   0.00 |   0.00 |   0.04 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (810) clavicle   |    571 |      0 |    129 |      0 |     23 |      4 |    727
                                                    |   1.82 |   0.00 |   0.41 |   0.00 |   0.07 |   0.01 |   2.32
                                                    |  78.54 |   0.00 |  17.74 |   0.00 |   3.16 |   0.55 |
                                                    |   2.59 |   0.00 |   6.42 |   0.00 |   0.95 |   0.35 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (811) scapula    |     74 |      0 |      5 |      0 |      5 |      2 |     86
                                                    |   0.24 |   0.00 |   0.02 |   0.00 |   0.02 |   0.01 |   0.27
                                                    |  86.05 |   0.00 |   5.81 |   0.00 |   5.81 |   2.33 |
                                                    |   0.34 |   0.00 |   0.25 |   0.00 |   0.21 |   0.17 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               22016     3650     2010      135     2416     1157    31384
                                                       70.15    11.63     6.40     0.43     7.70     3.69   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                  09:40 Thursday, May 24, 2018   4

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (812, 73311) hum |   1632 |      0 |    180 |      0 |    109 |     68 |   1989
                                   erus             |   5.20 |   0.00 |   0.57 |   0.00 |   0.35 |   0.22 |   6.34
                                                    |  82.05 |   0.00 |   9.05 |   0.00 |   5.48 |   3.42 |
                                                    |   7.41 |   0.00 |   8.96 |   0.00 |   4.51 |   5.88 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (813, 73312) rad |   2337 |      0 |    382 |      0 |     84 |     33 |   2836
                                   ius_ulna         |   7.45 |   0.00 |   1.22 |   0.00 |   0.27 |   0.11 |   9.04
                                                    |  82.40 |   0.00 |  13.47 |   0.00 |   2.96 |   1.16 |
                                                    |  10.62 |   0.00 |  19.00 |   0.00 |   3.48 |   2.85 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (814) carpal     |    516 |      0 |    100 |      0 |     13 |      0 |    629
                                                    |   1.64 |   0.00 |   0.32 |   0.00 |   0.04 |   0.00 |   2.00
                                                    |  82.03 |   0.00 |  15.90 |   0.00 |   2.07 |   0.00 |
                                                    |   2.34 |   0.00 |   4.98 |   0.00 |   0.54 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (815-817) hand/f |   1568 |      0 |    360 |      0 |     37 |      8 |   1973
                                   ingers           |   5.00 |   0.00 |   1.15 |   0.00 |   0.12 |   0.03 |   6.29
                                                    |  79.47 |   0.00 |  18.25 |   0.00 |   1.88 |   0.41 |
                                                    |   7.12 |   0.00 |  17.91 |   0.00 |   1.53 |   0.69 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (818-819) arms m |     12 |      0 |      0 |      0 |      0 |      0 |     12
                                   ult              |   0.04 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.04
                                                    | 100.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |
                                                    |   0.05 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (820, 73314) hip |   1878 |      0 |    144 |      0 |    384 |    270 |   2676
                                                    |   5.98 |   0.00 |   0.46 |   0.00 |   1.22 |   0.86 |   8.53
                                                    |  70.18 |   0.00 |   5.38 |   0.00 |  14.35 |  10.09 |
                                                    |   8.53 |   0.00 |   7.16 |   0.00 |  15.89 |  23.34 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (821, 73315) fem |    667 |      0 |     69 |      0 |    117 |     72 |    925
                                   ur               |   2.13 |   0.00 |   0.22 |   0.00 |   0.37 |   0.23 |   2.95
                                                    |  72.11 |   0.00 |   7.46 |   0.00 |  12.65 |   7.78 |
                                                    |   3.03 |   0.00 |   3.43 |   0.00 |   4.84 |   6.22 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (822) patella    |    321 |      0 |     43 |      0 |     36 |     14 |    414
                                                    |   1.02 |   0.00 |   0.14 |   0.00 |   0.11 |   0.04 |   1.32
                                                    |  77.54 |   0.00 |  10.39 |   0.00 |   8.70 |   3.38 |
                                                    |   1.46 |   0.00 |   2.14 |   0.00 |   1.49 |   1.21 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               22016     3650     2010      135     2416     1157    31384
                                                       70.15    11.63     6.40     0.43     7.70     3.69   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                  09:40 Thursday, May 24, 2018   5

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (823, 73316) tib |    920 |      0 |     65 |      0 |     67 |     34 |   1086
                                   _fib             |   2.93 |   0.00 |   0.21 |   0.00 |   0.21 |   0.11 |   3.46
                                                    |  84.71 |   0.00 |   5.99 |   0.00 |   6.17 |   3.13 |
                                                    |   4.18 |   0.00 |   3.23 |   0.00 |   2.77 |   2.94 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (824) ankle      |   1215 |      0 |    202 |      0 |    110 |     51 |   1578
                                                    |   3.87 |   0.00 |   0.64 |   0.00 |   0.35 |   0.16 |   5.03
                                                    |  77.00 |   0.00 |  12.80 |   0.00 |   6.97 |   3.23 |
                                                    |   5.52 |   0.00 |  10.05 |   0.00 |   4.55 |   4.41 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (825) tarsal_met |   2762 |      0 |     13 |      0 |     69 |     21 |   2865
                                   atarsal          |   8.80 |   0.00 |   0.04 |   0.00 |   0.22 |   0.07 |   9.13
                                                    |  96.40 |   0.00 |   0.45 |   0.00 |   2.41 |   0.73 |
                                                    |  12.55 |   0.00 |   0.65 |   0.00 |   2.86 |   1.82 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (826) foot_phala |   1181 |      0 |      0 |      0 |     20 |      3 |   1204
                                   nges             |   3.76 |   0.00 |   0.00 |   0.00 |   0.06 |   0.01 |   3.84
                                                    |  98.09 |   0.00 |   0.00 |   0.00 |   1.66 |   0.25 |
                                                    |   5.36 |   0.00 |   0.00 |   0.00 |   0.83 |   0.26 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (827) lower_limb |     27 |      0 |      0 |      0 |      1 |      0 |     28
                                                    |   0.09 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.09
                                                    |  96.43 |   0.00 |   0.00 |   0.00 |   3.57 |   0.00 |
                                                    |   0.12 |   0.00 |   0.00 |   0.00 |   0.04 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (828) legs+arm/r |      3 |      0 |      0 |      0 |      3 |      0 |      6
                                   ib               |   0.01 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   0.02
                                                    |  50.00 |   0.00 |   0.00 |   0.00 |  50.00 |   0.00 |
                                                    |   0.01 |   0.00 |   0.00 |   0.00 |   0.12 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (829) fx_nos     |    165 |      0 |      0 |      0 |      2 |      0 |    167
                                                    |   0.53 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   0.53
                                                    |  98.80 |   0.00 |   0.00 |   0.00 |   1.20 |   0.00 |
                                                    |   0.75 |   0.00 |   0.00 |   0.00 |   0.08 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               22016     3650     2010      135     2416     1157    31384
                                                       70.15    11.63     6.40     0.43     7.70     3.69   100.00


                                                                                Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                                          26835       85.51         26835        85.51  
                                             1             4549       14.49         31384       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 31384 observations read from the data set WORK.FX_DGNS_4.
NOTE: The PROCEDURE FREQ printed pages 2-5.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.39 seconds
      cpu time            0.21 seconds
      

576        
577        *goto 002_fx_epi.sas;
578        
579        
580        
581        
582        /*
583        START OF 002_fx_data.sas
584         */
585        
586        /*all the claims to define episode sequence */
587        data _dat0(keep=
588        PATID ENCOUNTERID ADMIT_DATE DISCHARGE_DATE BEGIN_DATE END_DATE DX DX_TYPE PDX  /* SOURCE */ ENC_TYPE fx_site px px_date
589        site cq spine_image trauma_date trauma );
590        set fx_dgns_4 fx_excare Fx_prcd(rename=tx_site=fx_site);
591        run;

NOTE: There were 31384 observations read from the data set WORK.FX_DGNS_4.
NOTE: There were 4120 observations read from the data set WORK.FX_EXCARE.
NOTE: There were 3604 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK._DAT0 has 39108 observations and 18 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.01 seconds
      

592        proc sort data=_dat0; by PATID fx_site BEGIN_DATE END_DATE; run;

NOTE: There were 39108 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT0 has 39108 observations and 18 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.10 seconds
      cpu time            0.06 seconds
      

593        /*for each claim define start and end date applicable to IP NH and NH*/
594        data _dat1;
595        set _dat0;
596        length start_date end_date 4;
597        format start_date end_date mmddyy10.;
598        by PATID fx_site BEGIN_DATE END_DATE;
599        start_date=min(ADMIT_DATE, BEGIN_DATE);
600        end_date=max(DISCHARGE_DATE, End_DATE);
11                                                                  The SAS System                                        09:40 Thursday, May 24, 2018

601        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      166 at 599:12   
NOTE: There were 39108 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT1 has 39108 observations and 19 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.04 seconds
      

602        proc sort data=_dat1; by PATID fx_site start_date end_date; run;

NOTE: There were 39108 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT1 has 39108 observations and 19 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.11 seconds
      cpu time            0.07 seconds
      

603        
604        /* generate unique episode sequence ID */
605        data _dat2(drop=end_date_max lag_end_date_max _gap);
606        set _dat1;
607        length lag_end_date_max end_date_max 4;
608        format lag_end_date_max end_date_max mmddyy10.;
609        
610        by PATID fx_site start_date end_date;
611        retain seq 0;
612        
613        /*if current claims end date > all previouse claim end date in sequence, then update*/
614        end_date_max=max(end_date,end_date_max);
615        lag_end_date_max=lag(end_date_max);
616        
617        if first.fx_site then lag_end_date_max=.;
618        _gap=start_date-lag_end_date_max;
619        
620        /*if current claims start date >90 days after all previouse claim end date in sequence,
621        then start new sequence*/
622        if first.fx_site or start_date-lag_end_date_max>90 then do;
623            end_date_max=end_date;
624        
625            seq+1;
626        end;
627        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      4647 at 618:16   4647 at 622:31   
NOTE: There were 39108 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT2 has 39108 observations and 20 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.06 seconds
      

628        proc sort data=_dat2; by seq;run;

NOTE: There were 39108 observations read from the data set WORK._DAT2.
NOTE: The data set WORK._DAT2 has 39108 observations and 20 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.09 seconds
      cpu time            0.06 seconds
      

629        proc sql;
630        /*episode sequence start date*/
631        create table seq_start as
632        select patid, seq, min(start_date) as seq_start_date length=4 format=mmddyy10.
633         from _dat2
634         where substr(dx,1,4) not in ('V541' 'V542')
12                                                                  The SAS System                                        09:40 Thursday, May 24, 2018

635         group by patid, seq
636         order by patid, seq;
NOTE: Table WORK.SEQ_START created, with 5041 rows and 3 columns.

637        /*episode sequence end date*/
638        create table seq_end as
639        select patid, seq,
640         max(start_date) as seq_end_date length=4 format=mmddyy10. from _dat2
641         group by patid, seq
642         order by patid, seq;
NOTE: Table WORK.SEQ_END created, with 5801 rows and 3 columns.

643        quit;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.45 seconds
      cpu time            0.32 seconds
      

644        /*episode sequence case qualifier indicator and trauma*/
645        data seq_cq(keep=patid seq seq_cq seq_trauma fx_site);
646        set _dat2;
647        by patid seq;
648        length seq_cq $4 seq_trauma $1;
649        retain seq_cq seq_trauma;
650        if first.seq then do;
651            seq_cq="0000";
652            seq_trauma="0";
653        end;
654        if trauma="1" then seq_trauma=trauma;
655        do i=1 to 4;
656        if substr(cq,i,1)>substr(seq_cq,i,1) then substr(seq_cq,i,1)=substr(cq,i,1);
657        end;
658        if last.seq then output;
659        run;

NOTE: There were 39108 observations read from the data set WORK._DAT2.
NOTE: The data set WORK.SEQ_CQ has 5801 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.06 seconds
      

660        proc freq data=seq_cq; tables seq_cq seq_trauma fx_site; run;

                                                                  --- AS project ---                                  09:40 Thursday, May 24, 2018   6

                                                                  The FREQ Procedure

                                                                                Cumulative    Cumulative
                                             seq_cq    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0000          4176       71.99          4176        71.99  
                                             0004           369        6.36          4545        78.35  
                                             0030           350        6.03          4895        84.38  
                                             0034             8        0.14          4903        84.52  
                                             0200           300        5.17          5203        89.69  
                                             0204            26        0.45          5229        90.14  
                                             0230            14        0.24          5243        90.38  
                                             1000            97        1.67          5340        92.05  
                                             1004            35        0.60          5375        92.66  
                                             1030            17        0.29          5392        92.95  
                                             1034             1        0.02          5393        92.97  
                                             1200           245        4.22          5638        97.19  
                                             1204           109        1.88          5747        99.07  
                                             1230            46        0.79          5793        99.86  
                                             1234             8        0.14          5801       100.00  


                                             seq_                               Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0             5190       89.47          5190        89.47  
                                             1              611       10.53          5801       100.00  


                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec         109        1.88           109         1.88  
                                    (800-804) skull/face              126        2.17           235         4.05  
                                    (805, 806, 73313) spine          1145       19.74          1380        23.79  
                                    (807) rib/sternum/trachea         290        5.00          1670        28.79  
                                    (808) pelvis                      111        1.91          1781        30.70  
                                    (809) trunk bones                   4        0.07          1785        30.77  
                                    (810) clavicle                    103        1.78          1888        32.55  
                                    (811) scapula                      23        0.40          1911        32.94  
                                    (812, 73311) humerus              217        3.74          2128        36.68  
                                    (813, 73312) radius_ulna          356        6.14          2484        42.82  
                                    (814) carpal                      140        2.41          2624        45.23  
                                    (815-817) hand/fingers            294        5.07          2918        50.30  
                                    (818-819) arms mult                 4        0.07          2922        50.37  
                                    (820, 73314) hip                  909       15.67          3831        66.04  
                                    (821, 73315) femur                230        3.96          4061        70.01  
                                    (822) patella                     162        2.79          4223        72.80  
                                    (823, 73316) tib_fib              194        3.34          4417        76.14  
                                    (824) ankle                       268        4.62          4685        80.76  
                                    (825) tarsal_metatarsal           390        6.72          5075        87.48  
                                    (826) foot_phalanges              229        3.95          5304        91.43  
                                    (827) lower_limb                   13        0.22          5317        91.66  
                                    (828) legs+arm/rib                  5        0.09          5322        91.74  
                                    (829) fx_nos                      479        8.26          5801       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 5801 observations read from the data set WORK.SEQ_CQ.
NOTE: The PROCEDURE FREQ printed page 6.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.09 seconds
      cpu time            0.04 seconds
      

661        
662        data seq_cq_date;
663        merge seq_cq seq_start seq_end;
664        by patid seq;
665        length site_order $1;
666        if fx_site='(820, 73314) hip' then site_order='1';
667        if fx_site='(821, 73315) femur' then site_order='2';
668        if fx_site='(808) pelvis' then site_order='3';
669        if fx_site='(805, 806, 73313) spine' then site_order='4';
670        if fx_site='(812, 73311) humerus' then site_order='5';
671        if fx_site='(813, 73312) radius_ulna' then site_order='6';
672        if fx_site='(823, 73316) tib_fib' then site_order='7';
673        if fx_site='(824) ankle' then site_order='8';
674        if fx_site='(810) clavicle' then site_order='9';
675        run;

NOTE: There were 5801 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 5041 observations read from the data set WORK.SEQ_START.
NOTE: There were 5801 observations read from the data set WORK.SEQ_END.
NOTE: The data set WORK.SEQ_CQ_DATE has 5801 observations and 8 variables.
NOTE: DATA statement used (Total process time):
13                                                                  The SAS System                                        09:40 Thursday, May 24, 2018

      real time           0.06 seconds
      cpu time            0.03 seconds
      

676        
677        data _tmp_combo;
678        set seq_cq_date;
679        where site_order^=" " and seq_cq^="0000" and seq_cq^=" ";
680        run;

NOTE: There were 1292 observations read from the data set WORK.SEQ_CQ_DATE.
      WHERE (site_order not = ' ') and seq_cq not in (' ', '0000');
NOTE: The data set WORK._TMP_COMBO has 1292 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.00 seconds
      

681        
682        * define combo or alone fx;
683        data seq_COMBO(
684        keep=patid seq seq_cq seq_start_date alone_combo fx_site site_order)
685        ;
686        if _n_=1 then do;
687            declare hash hpid(dataset:"_tmp_combo(where=(seq_cq^='0000' and seq_cq^=' ')
688                    rename=(seq_start_date=seq_start_date2  fx_site= fx_site_combo seq=seq_COMBO))", ordered: 'a', multidata:"Y");
689            rc=hpid.defineKey("patid");
690            rc=hpid.defineData("patid","seq_start_date2", "fx_site_combo", "seq_COMBO");
691            rc=hpid.defineDone();
692        end;
693        if 0 then set _tmp_combo(rename=(seq_start_date=seq_start_date2 fx_site= fx_site_combo seq=seq_COMBO));
694        set _tmp_combo(where=(seq_cq^="0000" and seq_cq^=" ") );
695        by patid seq;
696        length  index_fx_begin 4 alone_combo $5;
697        alone_combo="alone";
698            format index_fx_begin mmddyy10.;
699            index_fx_begin=seq_start_date;
700        
701         rc=hpid.find(key:patid);
702        
703         do while (rc = 0);
704         if rc=0 and abs(seq_start_date-seq_start_date2) <=30 and fx_site_combo^=fx_site then alone_combo= 'combo';
705         rc=hpid.find_next();
706         *hpid.has_next(result:r);
707        end;
708        if alone_combo="alone" then do;
709            seq_start_date2=.; fx_site_combo=" "; seq_COMBO=.;
710        end;
711        run;

NOTE: There were 1292 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: There were 1292 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.SEQ_COMBO has 1292 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.04 seconds
      

712        proc freq data=seq_COMBO; tables alone_combo; run;

                                                                  --- AS project ---                                  09:40 Thursday, May 24, 2018   7

                                                                  The FREQ Procedure

                                             alone_                             Cumulative    Cumulative
                                             combo     Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             alone         1146       88.70          1146        88.70  
                                             combo          146       11.30          1292       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 1292 observations read from the data set WORK.SEQ_COMBO.
NOTE: The PROCEDURE FREQ printed page 7.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.06 seconds
      cpu time            0.00 seconds
      

713        
714        proc sort data = Work.seq_COMBO;
715          by patid seq_start_date;
14                                                                  The SAS System                                        09:40 Thursday, May 24, 2018

716        run;

NOTE: There were 1292 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 1292 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

717        
718        data combo_seq;
719        set seq_COMBO;
720        by patid seq_start_date;
721        length combo_fx_site $30. combo_seq 4;
722        retain combo_seq 0 combo_fx_site;
723        if first.patid or seq_start_date-lag(seq_start_date) then combo_seq=1+combo_seq;
724        where seq_cq^='0000' and seq_cq^=' ';
725        if combo_fx_site=" " or ""<site_order<lag(site_order) then combo_fx_site=fx_site;
726        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      1 at 723:33   
NOTE: There were 1292 observations read from the data set WORK.SEQ_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.COMBO_SEQ has 1292 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

727        
728        proc sort data = Work.seq_COMBO;
729          by patid seq;
730        run;

NOTE: There were 1292 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 1292 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

731        
732        data FX_CLM_DB;
733        merge _dat2 seq_start seq_end seq_cq(drop=fx_site) seq_COMBO(keep=patid seq alone_combo);
734        by patid seq;
735        run;

NOTE: There were 39108 observations read from the data set WORK._DAT2.
NOTE: There were 5041 observations read from the data set WORK.SEQ_START.
NOTE: There were 5801 observations read from the data set WORK.SEQ_END.
NOTE: There were 5801 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 1292 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.FX_CLM_DB has 39108 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           0.12 seconds
      cpu time            0.11 seconds
      

736        
737        proc sql;
738        select count(distinct seq) from FX_CLM_DB;
                                                                  --- AS project ---                                  09:40 Thursday, May 24, 2018   8

                                                                               
                                                                       --------
                                                                           5801
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
739        quit;
NOTE: The PROCEDURE SQL printed page 8.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.07 seconds
      cpu time            0.03 seconds
      

740        
741        
15                                                                  The SAS System                                        09:40 Thursday, May 24, 2018

742        
743        
744        /*
745        Collapse to fracture episodes
746        
747        Q: Why are some seq_start_date values missing?
748         */
749        proc sort
750          data = Work.fx_clm_db
751          out = Work.fractureEpisodes (drop = seq
752                                       rename = (seq_start_date = fractureEpisodeStart
753                                                 seq_end_date = fractureEpisodeEnd
754                                                 fx_site = fractureSite))
755          nodupkey;
756          by patid seq seq_start_date seq_end_date fx_site;
757        run;

NOTE: There were 39108 observations read from the data set WORK.FX_CLM_DB.
NOTE: 33307 observations with duplicate key values were deleted.
NOTE: The data set WORK.FRACTUREEPISODES has 5801 observations and 24 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.10 seconds
      cpu time            0.06 seconds
      

758        
759        proc sql;
760          create table DT.fractureEpisodesPrev as
761            select A.database,
762                   A.exposure,
763                   A.indexGNN,
764                   A.indexDate,
765                   A.ASCohortDate,
766                   A.indexID,
767                   A.age,
768                   A.sex,
769                   B.*,
770                   case
771                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
772                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
773                     else ""
774                     end as fractureType
775            from DT.indexLookup A inner join
776                 Work.fractureEpisodes B on (A.patid = B.patid);
NOTE: Table DT.FRACTUREEPISODESPREV created, with 10306 rows and 33 columns.

777          create table Work.summaryFractureEpisodesPrev as
778            select "DT.fractureEpisodesPrev" as table,
779                   fractureType, fractureSite,
780                   count(distinct patid) as countDistinctPatid,
781                   count(*) as countFractureEpisodes
782            from DT.fractureEpisodesPrev
783            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESPREV created, with 23 rows and 5 columns.

784          select * from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                                  09:40 Thursday, May 24, 2018   9

                                                                                                                    count         count
                                                                                                                 Distinct      Fracture
               table                    fractureType                         fractureSite                           Patid      Episodes
               ------------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesPrev                                       (7331) pathologic nos/nec                 91           211
               DT.fractureEpisodesPrev                                       (800-804) skull/face                     116           235
               DT.fractureEpisodesPrev                                       (807) rib/sternum/trachea                259           516
               DT.fractureEpisodesPrev                                       (809) trunk bones                          4             5
               DT.fractureEpisodesPrev                                       (810) clavicle                            92           188
               DT.fractureEpisodesPrev                                       (811) scapula                             21            35
               DT.fractureEpisodesPrev                                       (814) carpal                             129           273
               DT.fractureEpisodesPrev                                       (815-817) hand/fingers                   274           530
               DT.fractureEpisodesPrev                                       (818-819) arms mult                        4             8
               DT.fractureEpisodesPrev                                       (822) patella                            131           270
               DT.fractureEpisodesPrev                                       (823, 73316) tib_fib                     151           308
               DT.fractureEpisodesPrev                                       (824) ankle                              222           437
               DT.fractureEpisodesPrev                                       (825) tarsal_metatarsal                  307           691
               DT.fractureEpisodesPrev                                       (826) foot_phalanges                     215           421
               DT.fractureEpisodesPrev                                       (827) lower_limb                          11            21
               DT.fractureEpisodesPrev                                       (828) legs+arm/rib                         5             6
               DT.fractureEpisodesPrev                                       (829) fx_nos                             410           867
               DT.fractureEpisodesPrev  Clinical vertebral fracture          (805, 806, 73313) spine                  726          2061
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (808) pelvis                             100           188
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (812, 73311) humerus                     168           364
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                 298           635
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (820, 73314) hip                         715          1638
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (821, 73315) femur                       181           398
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
785          select "DT.fractureEpisodesPrev" as table,
786                 sum(countDistinctPatid) as sumDistinctPatid,
787                 sum(countFractureEpisodes) as sumFractureEpisodes
788            from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                                  09:40 Thursday, May 24, 2018  10

                                                                           sumDistinct   sumFracture
                                                 table                           Patid      Episodes
                                                 ---------------------------------------------------
                                                 DT.fractureEpisodesPrev          4630         10306
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
789        
790          create table DT.fractureEpisodesInc as
791            select A.database,
792                   A.ENR_END_DATE,
793                   A.DEATH_DATE,
794                   A.exposure,
795                   A.exposureStart,
796                   A.exposureEnd,
797                   A.daysExposed,
798                   A.exposureID,
799                   B.*,
800                   case
16                                                                  The SAS System                                        09:40 Thursday, May 24, 2018

801                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
802                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
803                     else ""
804                     end as fractureType
805            from DT.exposureTimeline A inner join
806                 Work.fractureEpisodes B on (A.patid = B.patid  & A.exposureStart <= B.fractureEpisodeStart <= A.exposureEnd);
NOTE: Table DT.FRACTUREEPISODESINC created, with 2872 rows and 33 columns.

807          create table Work.summaryFractureEpisodesInc as
808            select "DT.fractureEpisodesInc" as table,
809                   fractureType, fractureSite,
810                   count(distinct patid) as countDistinctPatid,
811                   count(*) as countFractureEpisodes
812            from DT.fractureEpisodesInc
813            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESINC created, with 23 rows and 5 columns.

814          select * from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                                  09:40 Thursday, May 24, 2018  11

                                                                                                                   count         count
                                                                                                                Distinct      Fracture
               table                   fractureType                         fractureSite                           Patid      Episodes
               -----------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesInc                                       (7331) pathologic nos/nec                 34            43
               DT.fractureEpisodesInc                                       (800-804) skull/face                      62            67
               DT.fractureEpisodesInc                                       (807) rib/sternum/trachea                163           180
               DT.fractureEpisodesInc                                       (809) trunk bones                          2             2
               DT.fractureEpisodesInc                                       (810) clavicle                            51            53
               DT.fractureEpisodesInc                                       (811) scapula                             16            18
               DT.fractureEpisodesInc                                       (814) carpal                              54            59
               DT.fractureEpisodesInc                                       (815-817) hand/fingers                   157           168
               DT.fractureEpisodesInc                                       (818-819) arms mult                        3             3
               DT.fractureEpisodesInc                                       (822) patella                             27            35
               DT.fractureEpisodesInc                                       (823, 73316) tib_fib                      59            71
               DT.fractureEpisodesInc                                       (824) ankle                              110           123
               DT.fractureEpisodesInc                                       (825) tarsal_metatarsal                  169           209
               DT.fractureEpisodesInc                                       (826) foot_phalanges                     120           124
               DT.fractureEpisodesInc                                       (827) lower_limb                           4             4
               DT.fractureEpisodesInc                                       (828) legs+arm/rib                         3             3
               DT.fractureEpisodesInc                                       (829) fx_nos                              27            33
               DT.fractureEpisodesInc  Clinical vertebral fracture          (805, 806, 73313) spine                  459           665
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (808) pelvis                              59            61
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (812, 73311) humerus                      93           112
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                 155           178
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (820, 73314) hip                         407           511
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (821, 73315) femur                       127           150
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
815          select "DT.fractureEpisodesInc" as table,
816                 sum(countDistinctPatid) as sumDistinctPatid,
817                 sum(countFractureEpisodes) as sumFractureEpisodes
818            from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                                  09:40 Thursday, May 24, 2018  12

                                                                           sumDistinct   sumFracture
                                                  table                          Patid      Episodes
                                                  --------------------------------------------------
                                                  DT.fractureEpisodesInc          2361          2872
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
819        quit;
NOTE: The PROCEDURE SQL printed pages 9-12.
NOTE: PROCEDURE SQL used (Total process time):
      real time           1.01 seconds
      cpu time            0.32 seconds
      

820        
821        
822        
823        
824        /*
825        CLEAN UP
826        
827        proc sql;
828          drop table UCB64.tempFracDxMPCD;
829          drop table UCB64.tempFracDxUCB;
830          drop table UCB64.tempFracDxSABR;
831          drop table UCB64.tempFracPxMPCD;
832          drop table UCB64.tempFracPxUCB;
833          drop table UCB64.tempFracPxSABR;
834        quit;
835         */
836        
837        
838        proc export
839          data = Work.summaryFractureEpisodesInc
840          outfile = "data\processed\&cmt..csv"
841          dbms = csv
842          replace;
843          delimiter = '09'x;
844        run;

845         /**********************************************************************
846         *   PRODUCT:   SAS
847         *   VERSION:   9.4
848         *   CREATOR:   External File Interface
849         *   DATE:      24MAY18
850         *   DESC:      Generated SAS Datastep Code
851         *   TEMPLATE SOURCE:  (None Specified.)
852         ***********************************************************************/
853            data _null_;
854            %let _EFIERR_ = 0; /* set the ERROR detection macro variable */
855            %let _EFIREC_ = 0;     /* clear export record count macro variable */
856            file 'data\processed\queryFractures.csv' delimiter='09'x DSD DROPOVER lrecl=32767;
857            if _n_ = 1 then        /* write column names or labels */
858             do;
859               put
860                  "table"
861               '09'x
17                                                                  The SAS System                                        09:40 Thursday, May 24, 2018

862                  "fractureType"
863               '09'x
864                  "fractureSite"
865               '09'x
866                  "countDistinctPatid"
867               '09'x
868                  "countFractureEpisodes"
869               ;
870             end;
871           set  WORK.SUMMARYFRACTUREEPISODESINC   end=EFIEOD;
872               format table $22. ;
873               format fractureType $35. ;
874               format fractureSite $30. ;
875               format countDistinctPatid best12. ;
876               format countFractureEpisodes best12. ;
877             do;
878               EFIOUT + 1;
879               put table $ @;
880               put fractureType $ @;
881               put fractureSite $ @;
882               put countDistinctPatid @;
883               put countFractureEpisodes ;
884               ;
885             end;
886            if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable */
887            if EFIEOD then call symputx('_EFIREC_',EFIOUT);
888            run;

NOTE: The file 'data\processed\queryFractures.csv' is:
      Filename=U:\studies\AS\pgms\bchan\data\processed\queryFractures.csv,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=24May2018:09:41:35,
      Create Time=24May2018:09:41:35

NOTE: 24 records were written to the file 'data\processed\queryFractures.csv'.
      The minimum record length was 42.
      The maximum record length was 91.
NOTE: There were 23 observations read from the data set WORK.SUMMARYFRACTUREEPISODESINC.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.01 seconds
      

23 records created in data\processed\queryFractures.csv from WORK.SUMMARYFRACTUREEPISODESINC.
  
  
NOTE: "data\processed\queryFractures.csv" file was successfully created.
NOTE: PROCEDURE EXPORT used (Total process time):
      real time           1.49 seconds
      cpu time            0.18 seconds
      

889        
890        
891        ods html close;
NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           44.52 seconds
      cpu time            21.16 seconds
      
