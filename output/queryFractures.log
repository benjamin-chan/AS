1                                          The SAS System             04:06 Wednesday, June 13, 2018

NOTE: Copyright (c) 2016 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M5) 
      Licensed to UNIVERSITY OF ALABAMA AT BIRMINGHAM - SFA - T&R, Site 70086550.
NOTE: This session is executing on the X64_DS08R2  platform.



NOTE: Updated analytical products:
      
      SAS/STAT 14.3
      SAS/ETS 14.3
      SAS/IML 14.3
      SAS/QC 14.3

NOTE: Additional host information:

 X64_DS08R2 WIN 6.1.7601 Service Pack 1 Server

--- PEER News and Updates ---

: SECURITY REMINDER :
Please remember not to copy any data files that contain PHI (protected health identifiers) to any 
of the shared folders.

 


NOTE: SAS initialization used:
      real time           2.05 seconds
      cpu time            0.46 seconds
      
1          *  University of Alabama at Birmingham                               *
2          *  AS project                                            *
3          **********************************************************************;
4          options pagesize=74 linesize=150 pageno=1 missing=' ' date FORMCHAR="|----|+|---+=|-/\<>*";
5          * Programmer    : Benjamin Chan <chanb@ohsu.edu>
6          * Creation date :
7          * Modify date   :
8          ;
9          %let cmt=queryFractures; * type the name of your program here (without the filename extension);
10         %let pgm=&cmt..sas;
11         %include "lib\libname.sas" ;
NOTE: Libref STDC5P was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: H:\studies\osteo\data\STD_files\5pct\
NOTE: Libref STD_SABR was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\data\std_SABER\
NOTE: Libref MPSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\mpcd\data\stddata\
NOTE: Libref UCBSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\stddata\
NOTE: Libref UCB was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB\
NOTE: Libref UCB64 was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB64\
NOTE: Libref DT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: V:\studies\AS\data
NOTE: Libref NDC was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: W:\onenote\references\drug ndcs\sas data
143        footnote "&pgm.";
144        * footnote2 "%sysfunc(datetime(),datetime14.)";
145        title1 '--- AS project ---';
146        **********************************************************************;
147        options macrogen mlogic mprint symbolgen;
148        options nomacrogen nomlogic nomprint nosymbolgen;
2                                                                   The SAS System                                      04:06 Wednesday, June 13, 2018

149        
150        
151        ods html
152          body = "output\&cmt..html"
153          style = Statistical;
NOTE: Writing HTML Body file: output\queryFractures.html
154        
155        
156        /*
157        FRACTURES
158        
159        See "ALGORITHMS TO ENHANCE SPECIFICITY OF FRACTURE IDENTIFICATION_ 100316.docx"
160        
161        Adapted from Lang's code in "001_fx_data.sas"
162        
163        
164        From: Chen, Lang [mailto:langchen@uabmc.edu]
165        Sent: Monday, July 24, 2017 8:56 AM
166        To: Benjamin Chan <chanb@ohsu.edu>
167        Subject: RE: fracture identification algorithm
168        
169        Here it is.
170        For 001_fx_data, find all fx related claim and run the algorithm.
171        Please ignore any code after line 476
172        Modify code from line 1 -50
173        
174        For 002_fx_epi_data
175        Define fx episode.
176        
177        Final output data is fx_dgns_&firstyr._&lastyr._4. Please let me if you have any questions.
178         */
179        
180        
181        /*
182        START OF 001_fx_data.sas
183         */
184        
185        
186        /*Assign "Broad" fracture site (fx_site) for all ICD9 diagnoses, outputting separately, so some records are cloned, then combining into one
186      !  file */
187        /*No longer using matched trauma files here*/
188        
189        %macro comballfxdgns;
190            data fx_dgns;
191                set UCB64.tempFracDxAll (where = (diagCodeType = "Fracture code"));
192                    length fx_site $30 ;
193                    fx_site = '';
194                    if strip(DX) in: ('800' '801' '802' '803' '804') then           do; fx_site='(800-804) skull/face'; output; end;
195                    if strip(DX) in: ('805', '806') or strip(DX)='73313' then       do; fx_site='(805, 806, 73313) spine'; output; end;
196                    if strip(DX) in: ('807') then                                           do; fx_site='(807) rib/sternum/trachea'; output; end;
197                    if strip(DX) in: ('808') then                                           do; fx_site='(808) pelvis'; output; end;
198                    if strip(DX) in: ('809') then                                           do; fx_site='(809) trunk bones'; output; end;
199                    if strip(DX) in: ('810') then                                           do; fx_site='(810) clavicle'; output; end;
200                    if strip(DX) in: ('811') then                                           do; fx_site='(811) scapula'; output; end;
201                    if strip(DX) in: ('812') or strip(DX)='73311' then              do; fx_site='(812, 73311) humerus'; output; end;
202                    if strip(DX) in: ('813') or strip(DX)='73312' then              do; fx_site='(813, 73312) radius_ulna'; output; end;
203                    if strip(DX) in: ('814') then                                           do; fx_site='(814) carpal'; output; end;
204                    if strip(DX) in: ('815' '816' '817') then                           do; fx_site='(815-817) hand/fingers'; output; end;
205                    if strip(DX) in: ('818' '819') then                                     do; fx_site='(818-819) arms mult'; output; end;
206                    if strip(DX) in: ('820') or strip(DX) = '73314' then                do; fx_site='(820, 73314) hip'; output; end;
207                    if strip(DX) in: ('821') or strip(DX)='73315' then              do; fx_site='(821, 73315) femur'; output; end;
208                    if strip(DX) in: ('822') then                                           do; fx_site='(822) patella'; output; end;
209                    if strip(DX) in: ('823') or strip(DX)='73316' then              do; fx_site='(823, 73316) tib_fib'; output; end;
210                    if strip(DX) in: ('824') then                                           do; fx_site='(824) ankle'; output; end;
211                    if strip(DX) in: ('825') then                                           do; fx_site='(825) tarsal_metatarsal'; output; end;
212                    if strip(DX) in: ('826') then                                           do; fx_site='(826) foot_phalanges'; output; end;
213                    if strip(DX) in: ('827') then                                           do; fx_site='(827) lower_limb'; output; end;
214                    if strip(DX) in: ('828') then                                           do; fx_site='(828) legs+arm/rib'; output; end;
215                    if strip(DX) in: ('829') then                                           do; fx_site='(829) fx_nos'; output; end;
216                    if strip(DX) in ('73310' '73319' '7331') then                 do; fx_site='(7331) pathologic nos/nec'; output; end;
217            data fx_excare;
218                set UCB64.tempFracDxAll (where = (diagCodeType = "Extended care code"));
3                                                                   The SAS System                                      04:06 Wednesday, June 13, 2018

219                    length fx_site $30 ;
220                    fx_site = '';
221                    /*Expanded Diagnosis Codes - Fracture Aftercare Codes*/
222                    if strip(DX) in ('V5410' 'V5420') then                          do; fx_site='(812, 73311) humerus'; output;
223                                                                                                     fx_site='(813, 73312) radius_ulna'; output;
223      ! end;
224                    if strip(DX) in ('V5411' 'V5421') then                          do; fx_site='(812, 73311) humerus'; output; end;
225                    if strip(DX) in ('V5412' 'V5422') then                          do; fx_site='(813, 73312) radius_ulna'; output;
226                                                                                                     fx_site='(814) carpal'; output; end;
227                    if strip(DX) in ('V5413' 'V5423') then                          do; fx_site='(820, 73314) hip'; output; end;
228                    if strip(DX) in ('V5414' 'V5424') then                          do; fx_site='(820, 73314) hip'; output;
229                                                                                                     fx_site='(821, 73315) femur'; output;
230                                                                                                     fx_site='(822) patella'; output;
231                                                                                                     fx_site='(824) ankle'; output;
232                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
233                    if strip(DX) in ('V5415' 'V5425') then                          do; fx_site='(820, 73314) hip'; output;
234                                                                                                     fx_site='(821, 73315) femur'; output;
235                                                                                                     fx_site='(822) patella'; output; end;
236                    if strip(DX) in ('V5416' 'V5426') then                          do; fx_site='(824) ankle'; output;
237                                                                                                     fx_site='(822) patella'; output;
238                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
239                    if strip(DX) in ('V5417' 'V5427') then                          do; fx_site='(805, 806, 73313) spine'; output; end;
240                    if strip(DX) in: ('V542') then                                       do; fx_site='(7331) pathologic nos/nec'; output; end;
241                    if strip(DX) in: ('V541') then                                       do; fx_site='(829) fx_nos'; output; end;
242            run;
243        
244            /* proc sort data=fx_dgns; by patid BEGIN_DATE fx_site; run;
245            proc sort data=fx_excare; by patid BEGIN_DATE fx_site; run; */
246        %mend;
247        %comballfxdgns;

NOTE: There were 16078 observations read from the data set UCB64.TEMPFRACDXALL.
      WHERE diagCodeType='Fracture code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_DGNS has 16078 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.34 seconds
      cpu time            0.14 seconds
      


NOTE: There were 997 observations read from the data set UCB64.TEMPFRACDXALL.
      WHERE diagCodeType='Extended care code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_EXCARE has 2124 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.03 seconds
      

248        
249        /*Now, assign a more specific fracture site (e.g., closed, other) (site) that is used in the CQ algorithms*/
250        /*Since Expanded Diagnosis Codes (V Codes) apply to sub-categories of each broad fracture site, clone records for these so they appear in
250      ! both places*/
251        
252        data fx_dgns_2;
253            set fx_dgns;
254        
255            length site $30;
256        
257            site="";
258        
259            *Spine-closed and Spine-other;
260            if fx_site='(805, 806, 73313) spine' then
261                do;
262                    site = 'spine_cls'; /*Includes V Codes and 73313 here*/
263                    if substr(strip(DX),1,3) in ('805' '806') and substr(strip(DX),1,4) ^in ('8050', '8052', '8054', '8058') then
264                        site = 'spine_oth';
265                end;
266        
267            *Pelvis-closed and Pelvis-other... No V Codes;
268            if fx_site='(808) pelvis' then
4                                                                   The SAS System                                      04:06 Wednesday, June 13, 2018

269                do;
270                    site = 'pelvis_cls';
271                    if substr(strip(DX),1,3)='808' and substr(strip(DX),1,4) ^in ('8080', '8082', '8084', '8088') then
272                        site = 'pelvis_oth';
273                end;
274        
275            *Clavicle-closed and Clavicle-other.... No V Codes;
276            if fx_site='(810) clavicle' then
277                do;
278                    site = 'clv_cls';
279                    if substr(strip(DX),1,3) = '810' and substr(strip(DX),1,4) ^in ('8100') then
280                        site = 'clv_oth';
281                end;
282        
283            *Humerus-closed and Humerus-other;
284            if fx_site='(812, 73311) humerus' then
285                do;
286                    site = 'hmrs_cls'; /*Includes V Codes and 73311 here*/
287                    if substr(strip(DX),1,3)= '812' and substr(strip(DX),1,4) ^in ('8120', '8122', '8124') then
288                        site = 'hmrs_oth';
289                end;
290        
291            *Distal radius/ulna and Radius/ulna-other;
292            if fx_site='(813, 73312) radius_ulna' then
293                do;
294                 site = 'dist4arm'; /*Includes V Codes and 73312 here*/
295                    if substr(strip(DX),1,3) = '813' and substr(strip(DX),1,4) ^in ('8134', '8135') then
296                        site = 'rad_ul_oth';
297                end;
298        
299            *Carpal... V Codes present but only one category;
300            if fx_site='(814) carpal' then
301                do;
302                    site = 'carpal';
303                 end;
304        
305            *Hip-closed and Hip-other;
306            if fx_site='(820, 73314) hip' then
307                    do;
308                    site = 'hip_cls'; /*Includes V Codes and 73314 here*/
309                    if substr(strip(DX),1,3)='820' and substr(strip(DX),1,4) ^in ('8200', '8202', '8208') then
310                        site = 'hip_oth';
311                end;
312        
313            *Other femur-closed and Other femur-other;
314            if fx_site='(821, 73315) femur' then
315                do;
316                    site = 'oth_fem_cls'; /*Includes V Codes and 73315 here*/
317                    if substr(strip(DX),1,3)='821' and substr(strip(DX),1,4) ^in ('8210', '8212') then
318                        site = 'oth_fem_oth';
319                end;
320        
321            *Tib/fib-closed and Tib/fib-other;
322            if fx_site='(823, 73316) tib_fib' then
323                do;
324                    site = 'tib_fib_cls'; /*Includes V Codes and 73316 here*/
325                    if substr(strip(DX),1,3)='823' and substr(strip(DX),1,4) ^in ('8230', '8232', '8238') then
326                        site = 'tib_fib_oth';
327                end;
328        
329            *Ankle... V Codes present but only one category;
330            if fx_site='(824) ankle' then
331                do;
332                    site = 'ankle';
333                end;
334        
335            /*Assign site for other fx_sites that do not have CQ algorithm and thus no sub categories*/
336            if site = "" then do;
337                site = fx_site;
338            end;
339        
340            label site = 'CQ Algorithm Fracture Site (Specific)';
5                                                                   The SAS System                                      04:06 Wednesday, June 13, 2018

341        
342        run;

NOTE: There were 16078 observations read from the data set WORK.FX_DGNS.
NOTE: The data set WORK.FX_DGNS_2 has 16078 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.04 seconds
      

343        
344        /*###########################################################################################################*/
345        /***************************************************Intermediate Fracture Diagnosis File**********************/
346        /*Combine CQ diagnosis files*******************************************************/
347        data fx_dgns_3;
348            set fx_dgns_2
349        /*    fx_excare_*/
350                ;
351        run;

NOTE: There were 16078 observations read from the data set WORK.FX_DGNS_2.
NOTE: The data set WORK.FX_DGNS_3 has 16078 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.03 seconds
      

352        
353        proc freq data=fx_dgns_3;
354            tables fx_site site;
355        run;

                                                                  --- AS project ---                                04:06 Wednesday, June 13, 2018   1

                                                                  The FREQ Procedure

                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec         198        1.23           198         1.23  
                                    (800-804) skull/face              449        2.79           647         4.02  
                                    (805, 806, 73313) spine          4556       28.34          5203        32.36  
                                    (807) rib/sternum/trachea         978        6.08          6181        38.44  
                                    (808) pelvis                      490        3.05          6671        41.49  
                                    (809) trunk bones                   3        0.02          6674        41.51  
                                    (810) clavicle                    323        2.01          6997        43.52  
                                    (811) scapula                      78        0.49          7075        44.00  
                                    (812, 73311) humerus             1152        7.17          8227        51.17  
                                    (813, 73312) radius_ulna         1459        9.07          9686        60.24  
                                    (814) carpal                      231        1.44          9917        61.68  
                                    (815-817) hand/fingers            857        5.33         10774        67.01  
                                    (818-819) arms mult                11        0.07         10785        67.08  
                                    (820, 73314) hip                 1913       11.90         12698        78.98  
                                    (821, 73315) femur                414        2.57         13112        81.55  
                                    (822) patella                     177        1.10         13289        82.65  
                                    (823, 73316) tib_fib              387        2.41         13676        85.06  
                                    (824) ankle                       824        5.13         14500        90.19  
                                    (825) tarsal_metatarsal          1019        6.34         15519        96.52  
                                    (826) foot_phalanges              434        2.70         15953        99.22  
                                    (827) lower_limb                   11        0.07         15964        99.29  
                                    (828) legs+arm/rib                  3        0.02         15967        99.31  
                                    (829) fx_nos                      111        0.69         16078       100.00  


                                                        CQ Algorithm Fracture Site (Specific)
 
                                                                                          Cumulative    Cumulative
                                    site                         Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec         198        1.23           198         1.23  
                                    (800-804) skull/face              449        2.79           647         4.02  
                                    (807) rib/sternum/trachea         978        6.08          1625        10.11  
                                    (809) trunk bones                   3        0.02          1628        10.13  
                                    (811) scapula                      78        0.49          1706        10.61  
                                    (815-817) hand/fingers            857        5.33          2563        15.94  
                                    (818-819) arms mult                11        0.07          2574        16.01  
                                    (822) patella                     177        1.10          2751        17.11  
                                    (825) tarsal_metatarsal          1019        6.34          3770        23.45  
                                    (826) foot_phalanges              434        2.70          4204        26.15  
                                    (827) lower_limb                   11        0.07          4215        26.22  
                                    (828) legs+arm/rib                  3        0.02          4218        26.23  
                                    (829) fx_nos                      111        0.69          4329        26.92  
                                    ankle                             824        5.13          5153        32.05  
                                    carpal                            231        1.44          5384        33.49  
                                    clv_cls                           323        2.01          5707        35.50  
                                    dist4arm                         1106        6.88          6813        42.37  
                                    hip_cls                          1855       11.54          8668        53.91  
                                    hip_oth                            58        0.36          8726        54.27  
                                    hmrs_cls                         1148        7.14          9874        61.41  
                                    hmrs_oth                            4        0.02          9878        61.44  
                                    oth_fem_cls                       407        2.53         10285        63.97  
                                    oth_fem_oth                         7        0.04         10292        64.01  
                                    pelvis_cls                        470        2.92         10762        66.94  
                                    pelvis_oth                         20        0.12         10782        67.06  
                                    rad_ul_oth                        353        2.20         11135        69.26  
                                    spine_cls                        3932       24.46         15067        93.71  
                                    spine_oth                         624        3.88         15691        97.59  
                                    tib_fib_cls                       357        2.22         16048        99.81  
                                    tib_fib_oth                        30        0.19         16078       100.00  
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 16078 observations read from the data set WORK.FX_DGNS_3.
NOTE: The PROCEDURE FREQ printed page 1.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.17 seconds
      cpu time            0.06 seconds
      

356        
357        proc sort data=fx_dgns_3;
358            by patid ENCOUNTERID fx_site site;
359        run;

NOTE: There were 16078 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_3 has 16078 observations and 28 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.12 seconds
      cpu time            0.07 seconds
      

360        
361        
362        /*###########################################################################################################*/
363        /*************************************************************************************************************/
364        /*Look for repair procedures and assign treatment site*******************/
365        /*This code has been updated to include hip/femur replacement with matching diagnosis code, also looked in claim strip(DX) not just primary
365      !  strip(DX)
366        /*Not accepting contiguous sites until later*/
367        /*Excluding procedures from DME files*/
368        /*******************************Select All Spine Imaging Codes from STD Procedure Files for CQ=4/5 algorithms*/
369        
370        %macro fx_prcd;
371            data fx_prcd spine_xray;
372                set UCB64.tempFracPxAll;
373        
374                    length tx_site $30;
375                    length HLAT $1;
376        
377                    if strip(px) in ('21300' '21310' '21315' '21320' '21325' '21330' '21335' '21336' '21337' '21338' '21339' '21340' '21343'
377      ! '21344' '21345' '21346' '21347' '21348'
378                                         '21355' '21356' '21360' '21365' '21366' '21385' '21386' '21387' '21390' '21395' '21400' '21401' '21406'
6                                                                   The SAS System                                      04:06 Wednesday, June 13, 2018

378      ! '21407' '21408' '21421' '21422' '21423'
379                                         '21431' '21432' '21433' '21435' '21436' '21440' '21445' '21450' '21451' '21452' '21453' '21454' '21461'
379      ! '21462' '21465' '21470'
380                                         '62000' '62005' '62010')  and lengthn(strip(px)) = 5 then do;
381                        tx_site='(800-804) skull/face'; output fx_prcd; end;
382        
383                    if strip(px) in ('22305' '22310' '22315' '22318' '22319' '22325' '22326' '22327' '22328' '22520' '22521' '22522' '22523'
383      ! '22524' '22525' '76012' '76013'
384                                         'S2360' 'S2361' 'S2362' 'S2363' '72291' '72292')  and lengthn(strip(px)) = 5 then do;
385                        tx_site = '(805, 806, 73313) spine'; output fx_prcd; end;
386        
387                    if  strip(px) in ('21493' '21494' '21495' '21800' '21805' '21810' '21820' '21825' ) then do;
388                        tx_site='(807) rib/sternum/trachea'; output fx_prcd; end;
389        
390                    if strip(px) in ('27193' '27194' '27215' '27216' '27217' '27218' '27220' '27222' '27226' '27227' '27228')  and
390      ! lengthn(strip(px)) = 5 then do;
391                        tx_site = '(808) pelvis'; output fx_prcd; end;
392        
393                    if strip(px) in ('23500' '23505' '23515')  and lengthn(strip(px)) = 5 then do;
394                        tx_site = '(810) clavicle'; output fx_prcd; end;
395        
396                    if strip(px) in ('23570' '23575' '23585') then do;
397                        tx_site= '(811) scapula'; output fx_prcd; end;
398        
399                    if strip(px) in ('23600' '23605' '23615' '23616' '23620' '23625' '23630' '23665' '24500' '24505' '24515' '24516' '24530'
399      ! '24535' '24538' '24545' '24546' '24560'
400                                 '24565' '24566' '24575' '24576' '24577' '24579' '24582')  and lengthn(strip(px)) = 5 then do;
401                        tx_site = '(812, 73311) humerus'; output fx_prcd; end;
402        
403                    if strip(px) in ('25600' '25605' '25606' '25607' '25608' '25609' '25620' '25650' '25651' '25652')  and lengthn(strip(px)) = 5
403      ! then do;
404                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
405        
406                    if strip(px) in ('24650' '24655' '24665' '24666' '24670' '24675' '24685' '25500' '25505' '25515' '25520' '25525' '25526'
406      ! '25530' '25535' '25545' '25560' '25565'
407                                 '25574' '25575')  and lengthn(strip(px)) = 5 then do;
408                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
409        
410                    if strip(px) in ('25622' '25624' '25628' '25630' '25635' '25645' '25680' '25685')  and lengthn(strip(px)) = 5 then do;
411                        tx_site = '(814) carpal'; output fx_prcd; end;
412        
413                    if strip(px) in ('26600' '26605' '26607' '26608' '26615' '26645' '26650' '26665' '26720' '26725' '26727' '26735' '26740'
413      ! '26742' '26746' '26750' '26755' '26756' '26765' )
414                               and lengthn(strip(px)) = 5 then do;
415                        tx_site='(815-817) hand/fingers'; output fx_prcd; end;
416        
417                    if '27230' <= strip(px) <= '27248' and lengthn(strip(px)) = 5 then do;
418                        tx_site = '(820, 73314) hip'; output fx_prcd; end;
419        
420                    if '27500' <= strip(px) <= '27514'  and lengthn(strip(px)) = 5 then do;
421                        tx_site = '(821, 73315) femur'; output fx_prcd; end;
422        
423                    if strip(px) in ('27520' '27524')  and lengthn(strip(px)) = 5 then do;
424                        tx_site = '(822) patella'; output fx_prcd; end;
425        
426                    if ('27530' <= strip(px) <= '27536' or '27750' <= strip(px) <= '27759' or '27780' <= strip(px) <= '27784' or '27824' <=
426      ! strip(px) <= '27828') and lengthn(strip(px)) = 5  then do;
427                        tx_site = '(823, 73316) tib_fib'; output fx_prcd; end;
428        
429                    if strip(px) in ('27760' '27762' '27766' '27786' '27788' '27792' '27808' '27810' '27814' '27816' '27818' '27822' '27823'
429      ! '28430' '28435' '28436' '28445')  and lengthn(strip(px)) = 5 then do;
430                        tx_site = '(824) ankle'; output fx_prcd; end;
431        
432                    if strip(px) in ('28320' '28322' '28400' '28405' '28406' '28415' '28420' ) and lengthn(strip(px)) = 5 then do;
433                        tx_site='(825) tarsal_metatarsal'; output fx_prcd; end;
434        
435                 /********************************Hip/Femur Additions - must be matched with DGNS to be included*/
436                 /*Hip replacement codes*/
437                    /*Hip*/
438                    if strip(px) in ('27130' '27125') and lengthn(strip(px)) = 5  then do;
439                        HLAT='1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
440        
7                                                                   The SAS System                                      04:06 Wednesday, June 13, 2018

441                    /*Codes below are the only ICD9 Procedure Codes that we are using for "repair"*/
442                    if strip(px) in ('8151' '8152') and lengthn(strip(px)) = 4 then do;
443                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
444        
445                    /*Femur repair codes, assigned to both Hip and Femur treatment sites... CHECK - MAYBE WE NEED TO DO THIS THE OTHER WAY AS
445      ! WELL*/
446                    /*Hip*/
447                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
448                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
449        
450                    /*Femur*/
451                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
452                        HLAT = '1'; tx_site = '(821, 73315) femur'; output fx_prcd; end;
453                     /*spine image*/
454                        if '72010' <= strip(px) <= '72159' or '72240' <= strip(px) <= '72285' or strip(px) = '72295' then do;   /*Spine Imaging
454      ! Codes*/
455                        tx_site='(805, 806, 73313) spine';
456                        output spine_xray; end;
457        
458            run;
459        
460            data fx_prcd;
461                set fx_prcd;
462                /*To add laterality info*/
463        /*        array hcpcs{*} hcpcs_1st_mdfr_cd hcpcs_2nd_mdfr_cd hcpcs_3rd_mdfr_cd hcpcs_4th_mdfr_cd ; */
464                if HLAT='1' then do;
465                    repair_right='0'; repair_left='0';
466                end;
467        /*        if HLAT='1' then */
468        /*            do i=1 to dim(hcpcs);*/
469        /*                if hcpcs{i} = 'RT' then repair_right='1';*/
470        /*                else if hcpcs{i} = 'LT' then repair_left='1';*/
471        /*            end;*/
472            run;
473            proc sort data=fx_prcd nodupkey; by patid ENCOUNTERID px_date tx_site; run;
474        
475            data spine_xray;
476                set spine_xray;
477                keep patid px_date tx_site  ENCOUNTERID begin_date;
478            run;
479            proc sort data=spine_xray nodupkey; by patid px_date; run;
480        %mend;
481        %fx_prcd;

NOTE: There were 5895224 observations read from the data set UCB64.TEMPFRACPXALL.
NOTE: The data set WORK.FX_PRCD has 4263 observations and 25 variables.
NOTE: The data set WORK.SPINE_XRAY has 58178 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           9.56 seconds
      cpu time            9.09 seconds
      


NOTE: There were 4263 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK.FX_PRCD has 4263 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.03 seconds
      


NOTE: There were 4263 observations read from the data set WORK.FX_PRCD.
NOTE: 2260 observations with duplicate key values were deleted.
NOTE: The data set WORK.FX_PRCD has 2003 observations and 27 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      


NOTE: There were 58178 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.SPINE_XRAY has 58178 observations and 5 variables.
8                                                                   The SAS System                                      04:06 Wednesday, June 13, 2018

NOTE: DATA statement used (Total process time):
      real time           0.09 seconds
      cpu time            0.07 seconds
      


NOTE: There were 58178 observations read from the data set WORK.SPINE_XRAY.
NOTE: 36885 observations with duplicate key values were deleted.
NOTE: The data set WORK.SPINE_XRAY has 21293 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.09 seconds
      cpu time            0.06 seconds
      

482        
483        
484        
485        data trauma (rename=(begin_date=trauma_dt));
486                set UCB64.tempFracDxAll (where = (diagCodeType = "Trauma code"));
487        run;

NOTE: There were 2301 observations read from the data set UCB64.TEMPFRACDXALL.
      WHERE diagCodeType='Trauma code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.TRAUMA has 2301 observations and 26 variables.
NOTE: DATA statement used (Total process time):
      real time           0.12 seconds
      cpu time            0.01 seconds
      

488        proc sort data= trauma(keep=patid trauma_dt) nodupkey; by patid trauma_dt;run;

NOTE: There were 2301 observations read from the data set WORK.TRAUMA.
NOTE: 1127 observations with duplicate key values were deleted.
NOTE: The data set WORK.TRAUMA has 1174 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.07 seconds
      cpu time            0.01 seconds
      

489        
490        
491        /*subset the spine xray procedure claim for patients with fx diagnosis code only*/
492        /*so SAS will not run out of memory*/
493        data fx_spine_xray(keep=patid tx_site px_date ENCOUNTERID begin_date);
494        if _n_=1 then do;
495          declare hash hid(dataset:"fx_dgns_3(where=(fx_site='(805, 806, 73313) spine')))", multidata:"N", hashexp:20);
496          rc=hid.defineKey("patid");
497          rc=hid.defineDone();
498        end;
499        set spine_xray;
500        rc=hid.find();
501        if rc=0;
502        run;

NOTE: There were 4556 observations read from the data set WORK.FX_DGNS_3.
      WHERE fx_site='(805, 806, 73313) spine';
NOTE: There were 21293 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.FX_SPINE_XRAY has 2853 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.23 seconds
      cpu time            0.04 seconds
      

503        /*subset the Trauma code for patients with fx diagnosis code only*/
504        /*so SAS will not run out of memory*/
505        data fx_trauma(drop=rc);
506        if _n_=1 then do;
507          declare hash hid(dataset:"fx_dgns_3", multidata:"N", hashexp:20);
508          rc=hid.defineKey("patid");
509          rc=hid.defineDone();
510        end;
9                                                                   The SAS System                                      04:06 Wednesday, June 13, 2018

511        set trauma;
512        rc=hid.find();
513        if rc=0;
514        run;

NOTE: There were 16078 observations read from the data set WORK.FX_DGNS_3.
NOTE: There were 1174 observations read from the data set WORK.TRAUMA.
NOTE: The data set WORK.FX_TRAUMA has 546 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.09 seconds
      cpu time            0.07 seconds
      

515        /************************************Link Fracture Claims (ICD9 Diagnosis) with Repair Claims (CPT/HCPCS, some ICD9 procedure
515      ! code)***************/
516        
517        data fx_dgns_4(drop=rc: px_date tx_site xray_date trauma_dt);
518        if _n_=1 then do;
519          declare hash hid(dataset:"fx_prcd", multidata:"N", hashexp:20);
520          rc=hid.defineKey("patid", "px_date", "tx_site");
521        /*  rc=hid.defineData("px_date", "tx_site");*/
522          rc=hid.defineDone();
523          declare hash hxray(dataset:"fx_spine_xray(rename=px_date=xray_date)", multidata:"Y", hashexp:20);
524          rc=hxray.defineKey("patid", "tx_site");
525          rc=hxray.defineData("xray_date");
526          rc=hxray.defineDone();
527          declare hash htrauma(dataset:"fx_trauma", multidata:"Y", hashexp:20);
528          rc=htrauma.defineKey("patid");
529          rc=htrauma.defineData("trauma_dt");
530          rc=htrauma.defineDone();
531        end;
532        if 0 then set fx_prcd(keep=patid px_date tx_site)
533                      fx_spine_xray(keep=patid px_date tx_site rename=px_date=xray_date)
534                      fx_trauma;
535        set fx_dgns_3;
536        length cq $4 spine_image trauma_date 4 trauma $1;
537        format spine_image trauma_date mmddyy10.;
538        cq="0000";
539        rc=hid.find(key:patid, key:begin_date,key:fx_site);
540        if rc^=0 then do;
541            px_date=.;
542            tx_site=" ";
543        end;
544        if enc_type="IP" then do;
545        /*CQ = 1 Inpatient claim with primary diagnosis code */
546            if pdx="P" then substr(cq,1,1)="1";
547        /*CQ = 2 Inpatient claim with secondary diagnosis code*/
548            else substr(cq,2,1)="2";
549        end; else do;
550        /*CQ = 3 outpatient diagnosis code AND carrier line with repair/replace HCPCS*/
551            if rc=0 then substr(cq,3,1)="3";
552            rc1=hxray.find(key:patid, key:fx_site);
553            do while (rc1 = 0);
554                if begin_date-10 <=xray_date<= begin_date then do;
555                    if enc_type in ("AV" "IF" "NH" "HH" "ER" "ED") then do;
556        /*CQ = 4 outpatient [Physician E&M codes] diagnosis code with spine image/x-ray within 10 day early*/
557                        substr(cq,4,1)="4";
558                        spine_image=min(spine_image,xray_date);
559                    end;
560                end;
561                rc1=hxray.find_next(key:patid, key:fx_site);
562            end;
563        end;
564        /*is there trauma dx within 14 days*/
565        rc2=htrauma.find(key:patid);
566        do while (rc2 = 0) ;
567            if 0<=abs(trauma_dt-begin_date)<=14 then do;
568                    trauma="1";
569                    trauma_date=min(trauma_date,trauma_dt);
570           end ;
571           rc2=htrauma.find_next(key:patid) ;
572        end;
10                                                                  The SAS System                                      04:06 Wednesday, June 13, 2018

573        
574        run;

NOTE: There were 2003 observations read from the data set WORK.FX_PRCD.
NOTE: There were 2853 observations read from the data set WORK.FX_SPINE_XRAY.
NOTE: There were 546 observations read from the data set WORK.FX_TRAUMA.
NOTE: There were 16078 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_4 has 16078 observations and 32 variables.
NOTE: DATA statement used (Total process time):
      real time           0.20 seconds
      cpu time            0.17 seconds
      

575        proc freq data=fx_dgns_4; tables enc_type*cq fx_site*cq trauma/missing;run;

                                                                  --- AS project ---                                04:06 Wednesday, June 13, 2018   2

                                                                  The FREQ Procedure

                                                               Table of ENC_TYPE by cq

                                       ENC_TYPE(Encounter Type)     cq

                                       Frequency|
                                       Percent  |
                                       Row Pct  |
                                       Col Pct  |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       AV       |   7406 |   1290 |    301 |     72 |      0 |      0 |   9069
                                                |  46.06 |   8.02 |   1.87 |   0.45 |   0.00 |   0.00 |  56.41
                                                |  81.66 |  14.22 |   3.32 |   0.79 |   0.00 |   0.00 |
                                                |  68.32 |  66.36 |  29.17 |  67.29 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       ED       |   1972 |    530 |    721 |     35 |      0 |      0 |   3258
                                                |  12.27 |   3.30 |   4.48 |   0.22 |   0.00 |   0.00 |  20.26
                                                |  60.53 |  16.27 |  22.13 |   1.07 |   0.00 |   0.00 |
                                                |  18.19 |  27.26 |  69.86 |  32.71 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       HH       |     80 |      8 |      2 |      0 |      0 |      0 |     90
                                                |   0.50 |   0.05 |   0.01 |   0.00 |   0.00 |   0.00 |   0.56
                                                |  88.89 |   8.89 |   2.22 |   0.00 |   0.00 |   0.00 |
                                                |   0.74 |   0.41 |   0.19 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       IP       |      0 |      0 |      0 |      0 |   1486 |    669 |   2155
                                                |   0.00 |   0.00 |   0.00 |   0.00 |   9.24 |   4.16 |  13.40
                                                |   0.00 |   0.00 |   0.00 |   0.00 |  68.96 |  31.04 |
                                                |   0.00 |   0.00 |   0.00 |   0.00 | 100.00 | 100.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       NH       |   1382 |    116 |      8 |      0 |      0 |      0 |   1506
                                                |   8.60 |   0.72 |   0.05 |   0.00 |   0.00 |   0.00 |   9.37
                                                |  91.77 |   7.70 |   0.53 |   0.00 |   0.00 |   0.00 |
                                                |  12.75 |   5.97 |   0.78 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       Total       10840     1944     1032      107     1486      669    16078
                                                   67.42    12.09     6.42     0.67     9.24     4.16   100.00


 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                04:06 Wednesday, June 13, 2018   3

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (7331) pathologi |    195 |      0 |      0 |      0 |      2 |      1 |    198
                                   c nos/nec        |   1.21 |   0.00 |   0.00 |   0.00 |   0.01 |   0.01 |   1.23
                                                    |  98.48 |   0.00 |   0.00 |   0.00 |   1.01 |   0.51 |
                                                    |   1.80 |   0.00 |   0.00 |   0.00 |   0.13 |   0.15 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (800-804) skull/ |    309 |      0 |     55 |      0 |     59 |     26 |    449
                                   face             |   1.92 |   0.00 |   0.34 |   0.00 |   0.37 |   0.16 |   2.79
                                                    |  68.82 |   0.00 |  12.25 |   0.00 |  13.14 |   5.79 |
                                                    |   2.85 |   0.00 |   5.33 |   0.00 |   3.97 |   3.89 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (805, 806, 73313 |   1663 |   1944 |      2 |    107 |    595 |    245 |   4556
                                   ) spine          |  10.34 |  12.09 |   0.01 |   0.67 |   3.70 |   1.52 |  28.34
                                                    |  36.50 |  42.67 |   0.04 |   2.35 |  13.06 |   5.38 |
                                                    |  15.34 | 100.00 |   0.19 | 100.00 |  40.04 |  36.62 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (807) rib/sternu |    704 |      0 |    119 |      0 |    129 |     26 |    978
                                   m/trachea        |   4.38 |   0.00 |   0.74 |   0.00 |   0.80 |   0.16 |   6.08
                                                    |  71.98 |   0.00 |  12.17 |   0.00 |  13.19 |   2.66 |
                                                    |   6.49 |   0.00 |  11.53 |   0.00 |   8.68 |   3.89 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (808) pelvis     |    372 |      0 |     25 |      0 |     65 |     28 |    490
                                                    |   2.31 |   0.00 |   0.16 |   0.00 |   0.40 |   0.17 |   3.05
                                                    |  75.92 |   0.00 |   5.10 |   0.00 |  13.27 |   5.71 |
                                                    |   3.43 |   0.00 |   2.42 |   0.00 |   4.37 |   4.19 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (809) trunk bone |      3 |      0 |      0 |      0 |      0 |      0 |      3
                                   s                |   0.02 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.02
                                                    | 100.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |
                                                    |   0.03 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (810) clavicle   |    253 |      0 |     61 |      0 |      7 |      2 |    323
                                                    |   1.57 |   0.00 |   0.38 |   0.00 |   0.04 |   0.01 |   2.01
                                                    |  78.33 |   0.00 |  18.89 |   0.00 |   2.17 |   0.62 |
                                                    |   2.33 |   0.00 |   5.91 |   0.00 |   0.47 |   0.30 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (811) scapula    |     66 |      0 |      5 |      0 |      5 |      2 |     78
                                                    |   0.41 |   0.00 |   0.03 |   0.00 |   0.03 |   0.01 |   0.49
                                                    |  84.62 |   0.00 |   6.41 |   0.00 |   6.41 |   2.56 |
                                                    |   0.61 |   0.00 |   0.48 |   0.00 |   0.34 |   0.30 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               10840     1944     1032      107     1486      669    16078
                                                       67.42    12.09     6.42     0.67     9.24     4.16   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                04:06 Wednesday, June 13, 2018   4

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (812, 73311) hum |    951 |      0 |     95 |      0 |     67 |     39 |   1152
                                   erus             |   5.91 |   0.00 |   0.59 |   0.00 |   0.42 |   0.24 |   7.17
                                                    |  82.55 |   0.00 |   8.25 |   0.00 |   5.82 |   3.39 |
                                                    |   8.77 |   0.00 |   9.21 |   0.00 |   4.51 |   5.83 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (813, 73312) rad |   1182 |      0 |    214 |      0 |     49 |     14 |   1459
                                   ius_ulna         |   7.35 |   0.00 |   1.33 |   0.00 |   0.30 |   0.09 |   9.07
                                                    |  81.01 |   0.00 |  14.67 |   0.00 |   3.36 |   0.96 |
                                                    |  10.90 |   0.00 |  20.74 |   0.00 |   3.30 |   2.09 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (814) carpal     |    173 |      0 |     47 |      0 |     11 |      0 |    231
                                                    |   1.08 |   0.00 |   0.29 |   0.00 |   0.07 |   0.00 |   1.44
                                                    |  74.89 |   0.00 |  20.35 |   0.00 |   4.76 |   0.00 |
                                                    |   1.60 |   0.00 |   4.55 |   0.00 |   0.74 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (815-817) hand/f |    694 |      0 |    141 |      0 |     20 |      2 |    857
                                   ingers           |   4.32 |   0.00 |   0.88 |   0.00 |   0.12 |   0.01 |   5.33
                                                    |  80.98 |   0.00 |  16.45 |   0.00 |   2.33 |   0.23 |
                                                    |   6.40 |   0.00 |  13.66 |   0.00 |   1.35 |   0.30 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (818-819) arms m |     11 |      0 |      0 |      0 |      0 |      0 |     11
                                   ult              |   0.07 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.07
                                                    | 100.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |
                                                    |   0.10 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (820, 73314) hip |   1367 |      0 |     86 |      0 |    270 |    190 |   1913
                                                    |   8.50 |   0.00 |   0.53 |   0.00 |   1.68 |   1.18 |  11.90
                                                    |  71.46 |   0.00 |   4.50 |   0.00 |  14.11 |   9.93 |
                                                    |  12.61 |   0.00 |   8.33 |   0.00 |  18.17 |  28.40 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (821, 73315) fem |    286 |      0 |     30 |      0 |     64 |     34 |    414
                                   ur               |   1.78 |   0.00 |   0.19 |   0.00 |   0.40 |   0.21 |   2.57
                                                    |  69.08 |   0.00 |   7.25 |   0.00 |  15.46 |   8.21 |
                                                    |   2.64 |   0.00 |   2.91 |   0.00 |   4.31 |   5.08 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (822) patella    |    122 |      0 |     20 |      0 |     24 |     11 |    177
                                                    |   0.76 |   0.00 |   0.12 |   0.00 |   0.15 |   0.07 |   1.10
                                                    |  68.93 |   0.00 |  11.30 |   0.00 |  13.56 |   6.21 |
                                                    |   1.13 |   0.00 |   1.94 |   0.00 |   1.62 |   1.64 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               10840     1944     1032      107     1486      669    16078
                                                       67.42    12.09     6.42     0.67     9.24     4.16   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                04:06 Wednesday, June 13, 2018   5

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (823, 73316) tib |    316 |      0 |     33 |      0 |     26 |     12 |    387
                                   _fib             |   1.97 |   0.00 |   0.21 |   0.00 |   0.16 |   0.07 |   2.41
                                                    |  81.65 |   0.00 |   8.53 |   0.00 |   6.72 |   3.10 |
                                                    |   2.92 |   0.00 |   3.20 |   0.00 |   1.75 |   1.79 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (824) ankle      |    645 |      0 |     99 |      0 |     53 |     27 |    824
                                                    |   4.01 |   0.00 |   0.62 |   0.00 |   0.33 |   0.17 |   5.13
                                                    |  78.28 |   0.00 |  12.01 |   0.00 |   6.43 |   3.28 |
                                                    |   5.95 |   0.00 |   9.59 |   0.00 |   3.57 |   4.04 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (825) tarsal_met |    988 |      0 |      0 |      0 |     24 |      7 |   1019
                                   atarsal          |   6.15 |   0.00 |   0.00 |   0.00 |   0.15 |   0.04 |   6.34
                                                    |  96.96 |   0.00 |   0.00 |   0.00 |   2.36 |   0.69 |
                                                    |   9.11 |   0.00 |   0.00 |   0.00 |   1.62 |   1.05 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (826) foot_phala |    420 |      0 |      0 |      0 |     11 |      3 |    434
                                   nges             |   2.61 |   0.00 |   0.00 |   0.00 |   0.07 |   0.02 |   2.70
                                                    |  96.77 |   0.00 |   0.00 |   0.00 |   2.53 |   0.69 |
                                                    |   3.87 |   0.00 |   0.00 |   0.00 |   0.74 |   0.45 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (827) lower_limb |     10 |      0 |      0 |      0 |      1 |      0 |     11
                                                    |   0.06 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   0.07
                                                    |  90.91 |   0.00 |   0.00 |   0.00 |   9.09 |   0.00 |
                                                    |   0.09 |   0.00 |   0.00 |   0.00 |   0.07 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (828) legs+arm/r |      1 |      0 |      0 |      0 |      2 |      0 |      3
                                   ib               |   0.01 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   0.02
                                                    |  33.33 |   0.00 |   0.00 |   0.00 |  66.67 |   0.00 |
                                                    |   0.01 |   0.00 |   0.00 |   0.00 |   0.13 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (829) fx_nos     |    109 |      0 |      0 |      0 |      2 |      0 |    111
                                                    |   0.68 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   0.69
                                                    |  98.20 |   0.00 |   0.00 |   0.00 |   1.80 |   0.00 |
                                                    |   1.01 |   0.00 |   0.00 |   0.00 |   0.13 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               10840     1944     1032      107     1486      669    16078
                                                       67.42    12.09     6.42     0.67     9.24     4.16   100.00


                                                                                Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                                          13908       86.50         13908        86.50  
                                             1             2170       13.50         16078       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 16078 observations read from the data set WORK.FX_DGNS_4.
NOTE: The PROCEDURE FREQ printed pages 2-5.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.34 seconds
      cpu time            0.20 seconds
      

576        
577        *goto 002_fx_epi.sas;
578        
579        
580        
581        
582        /*
583        START OF 002_fx_data.sas
584         */
585        
586        /*all the claims to define episode sequence */
587        data _dat0(keep=
588        PATID ENCOUNTERID ADMIT_DATE DISCHARGE_DATE BEGIN_DATE END_DATE DX DX_TYPE PDX  /* SOURCE */ ENC_TYPE fx_site px px_date
589        site cq spine_image trauma_date trauma );
590        set fx_dgns_4 fx_excare Fx_prcd(rename=tx_site=fx_site);
591        run;

NOTE: There were 16078 observations read from the data set WORK.FX_DGNS_4.
NOTE: There were 2124 observations read from the data set WORK.FX_EXCARE.
NOTE: There were 2003 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK._DAT0 has 20205 observations and 18 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.03 seconds
      

592        proc sort data=_dat0; by PATID fx_site BEGIN_DATE END_DATE; run;

NOTE: There were 20205 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT0 has 20205 observations and 18 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.07 seconds
      cpu time            0.03 seconds
      

593        /*for each claim define start and end date applicable to IP NH and NH*/
594        data _dat1;
595        set _dat0;
596        length start_date end_date 4;
597        format start_date end_date mmddyy10.;
598        by PATID fx_site BEGIN_DATE END_DATE;
599        start_date=min(ADMIT_DATE, BEGIN_DATE);
600        end_date=max(DISCHARGE_DATE, End_DATE);
601        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      68 at 599:12   
NOTE: There were 20205 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT1 has 20205 observations and 19 variables.
11                                                                  The SAS System                                      04:06 Wednesday, June 13, 2018

NOTE: DATA statement used (Total process time):
      real time           0.21 seconds
      cpu time            0.04 seconds
      

602        proc sort data=_dat1; by PATID fx_site start_date end_date; run;

NOTE: There were 20205 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT1 has 20205 observations and 19 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.09 seconds
      cpu time            0.06 seconds
      

603        
604        /* generate unique episode sequence ID */
605        data _dat2(drop=end_date_max lag_end_date_max _gap);
606        set _dat1;
607        length lag_end_date_max end_date_max 4;
608        format lag_end_date_max end_date_max mmddyy10.;
609        
610        by PATID fx_site start_date end_date;
611        retain seq 0;
612        
613        /*if current claims end date > all previouse claim end date in sequence, then update*/
614        end_date_max=max(end_date,end_date_max);
615        lag_end_date_max=lag(end_date_max);
616        
617        if first.fx_site then lag_end_date_max=.;
618        _gap=start_date-lag_end_date_max;
619        
620        /*if current claims start date >90 days after all previouse claim end date in sequence,
621        then start new sequence*/
622        if first.fx_site or start_date-lag_end_date_max>90 then do;
623            end_date_max=end_date;
624        
625            seq+1;
626        end;
627        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      2629 at 618:16   2629 at 622:31   
NOTE: There were 20205 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT2 has 20205 observations and 20 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.04 seconds
      

628        proc sort data=_dat2; by seq;run;

NOTE: There were 20205 observations read from the data set WORK._DAT2.
NOTE: The data set WORK._DAT2 has 20205 observations and 20 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.06 seconds
      cpu time            0.03 seconds
      

629        proc sql;
630        /*episode sequence start date*/
631        create table seq_start as
632        select patid, seq, min(start_date) as seq_start_date length=4 format=mmddyy10.
633         from _dat2
634         where substr(dx,1,4) not in ('V541' 'V542')
635         group by patid, seq
636         order by patid, seq;
NOTE: Table WORK.SEQ_START created, with 2799 rows and 3 columns.

637        /*episode sequence end date*/
638        create table seq_end as
639        select patid, seq,
12                                                                  The SAS System                                      04:06 Wednesday, June 13, 2018

640         max(start_date) as seq_end_date length=4 format=mmddyy10. from _dat2
641         group by patid, seq
642         order by patid, seq;
NOTE: Table WORK.SEQ_END created, with 3189 rows and 3 columns.

643        quit;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.49 seconds
      cpu time            0.20 seconds
      

644        /*episode sequence case qualifier indicator and trauma*/
645        data seq_cq(keep=patid seq seq_cq seq_trauma fx_site);
646        set _dat2;
647        by patid seq;
648        length seq_cq $4 seq_trauma $1;
649        retain seq_cq seq_trauma;
650        if first.seq then do;
651            seq_cq="0000";
652            seq_trauma="0";
653        end;
654        if trauma="1" then seq_trauma=trauma;
655        do i=1 to 4;
656        if substr(cq,i,1)>substr(seq_cq,i,1) then substr(seq_cq,i,1)=substr(cq,i,1);
657        end;
658        if last.seq then output;
659        run;

NOTE: There were 20205 observations read from the data set WORK._DAT2.
NOTE: The data set WORK.SEQ_CQ has 3189 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.04 seconds
      

660        proc freq data=seq_cq; tables seq_cq seq_trauma fx_site; run;

                                                                  --- AS project ---                                04:06 Wednesday, June 13, 2018   6

                                                                  The FREQ Procedure

                                                                                Cumulative    Cumulative
                                             seq_cq    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0000          2249       70.52          2249        70.52  
                                             0004           201        6.30          2450        76.83  
                                             0030           196        6.15          2646        82.97  
                                             0034             5        0.16          2651        83.13  
                                             0200           175        5.49          2826        88.62  
                                             0204            21        0.66          2847        89.28  
                                             0230            10        0.31          2857        89.59  
                                             1000            58        1.82          2915        91.41  
                                             1004            15        0.47          2930        91.88  
                                             1030             9        0.28          2939        92.16  
                                             1200           147        4.61          3086        96.77  
                                             1204            68        2.13          3154        98.90  
                                             1230            30        0.94          3184        99.84  
                                             1234             5        0.16          3189       100.00  


                                             seq_                               Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0             2898       90.87          2898        90.87  
                                             1              291        9.13          3189       100.00  


                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec          56        1.76            56         1.76  
                                    (800-804) skull/face               65        2.04           121         3.79  
                                    (805, 806, 73313) spine           622       19.50           743        23.30  
                                    (807) rib/sternum/trachea         174        5.46           917        28.76  
                                    (808) pelvis                       72        2.26           989        31.01  
                                    (809) trunk bones                   2        0.06           991        31.08  
                                    (810) clavicle                     57        1.79          1048        32.86  
                                    (811) scapula                      19        0.60          1067        33.46  
                                    (812, 73311) humerus              128        4.01          1195        37.47  
                                    (813, 73312) radius_ulna          217        6.80          1412        44.28  
                                    (814) carpal                       64        2.01          1476        46.28  
                                    (815-817) hand/fingers            172        5.39          1648        51.68  
                                    (818-819) arms mult                 3        0.09          1651        51.77  
                                    (820, 73314) hip                  512       16.06          2163        67.83  
                                    (821, 73315) femur                135        4.23          2298        72.06  
                                    (822) patella                      81        2.54          2379        74.60  
                                    (823, 73316) tib_fib               90        2.82          2469        77.42  
                                    (824) ankle                       138        4.33          2607        81.75  
                                    (825) tarsal_metatarsal           186        5.83          2793        87.58  
                                    (826) foot_phalanges              111        3.48          2904        91.06  
                                    (827) lower_limb                    5        0.16          2909        91.22  
                                    (828) legs+arm/rib                  3        0.09          2912        91.31  
                                    (829) fx_nos                      277        8.69          3189       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 3189 observations read from the data set WORK.SEQ_CQ.
NOTE: The PROCEDURE FREQ printed page 6.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.09 seconds
      cpu time            0.03 seconds
      

661        
662        data seq_cq_date;
663        merge seq_cq seq_start seq_end;
664        by patid seq;
665        length site_order $1;
666        if fx_site='(820, 73314) hip' then site_order='1';
667        if fx_site='(821, 73315) femur' then site_order='2';
668        if fx_site='(808) pelvis' then site_order='3';
669        if fx_site='(805, 806, 73313) spine' then site_order='4';
670        if fx_site='(812, 73311) humerus' then site_order='5';
671        if fx_site='(813, 73312) radius_ulna' then site_order='6';
672        if fx_site='(823, 73316) tib_fib' then site_order='7';
673        if fx_site='(824) ankle' then site_order='8';
674        if fx_site='(810) clavicle' then site_order='9';
675        run;

NOTE: There were 3189 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 2799 observations read from the data set WORK.SEQ_START.
NOTE: There were 3189 observations read from the data set WORK.SEQ_END.
NOTE: The data set WORK.SEQ_CQ_DATE has 3189 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.03 seconds
      

676        
677        data _tmp_combo;
678        set seq_cq_date;
13                                                                  The SAS System                                      04:06 Wednesday, June 13, 2018

679        where site_order^=" " and seq_cq^="0000" and seq_cq^=" ";
680        run;

NOTE: There were 744 observations read from the data set WORK.SEQ_CQ_DATE.
      WHERE (site_order not = ' ') and seq_cq not in (' ', '0000');
NOTE: The data set WORK._TMP_COMBO has 744 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.01 seconds
      

681        
682        * define combo or alone fx;
683        data seq_COMBO(
684        keep=patid seq seq_cq seq_start_date alone_combo fx_site site_order)
685        ;
686        if _n_=1 then do;
687            declare hash hpid(dataset:"_tmp_combo(where=(seq_cq^='0000' and seq_cq^=' ')
688                    rename=(seq_start_date=seq_start_date2  fx_site= fx_site_combo seq=seq_COMBO))", ordered: 'a', multidata:"Y");
689            rc=hpid.defineKey("patid");
690            rc=hpid.defineData("patid","seq_start_date2", "fx_site_combo", "seq_COMBO");
691            rc=hpid.defineDone();
692        end;
693        if 0 then set _tmp_combo(rename=(seq_start_date=seq_start_date2 fx_site= fx_site_combo seq=seq_COMBO));
694        set _tmp_combo(where=(seq_cq^="0000" and seq_cq^=" ") );
695        by patid seq;
696        length  index_fx_begin 4 alone_combo $5;
697        alone_combo="alone";
698            format index_fx_begin mmddyy10.;
699            index_fx_begin=seq_start_date;
700        
701         rc=hpid.find(key:patid);
702        
703         do while (rc = 0);
704         if rc=0 and abs(seq_start_date-seq_start_date2) <=30 and fx_site_combo^=fx_site then alone_combo= 'combo';
705         rc=hpid.find_next();
706         *hpid.has_next(result:r);
707        end;
708        if alone_combo="alone" then do;
709            seq_start_date2=.; fx_site_combo=" "; seq_COMBO=.;
710        end;
711        run;

NOTE: There were 744 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: There were 744 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.SEQ_COMBO has 744 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.03 seconds
      

712        proc freq data=seq_COMBO; tables alone_combo; run;

                                                                  --- AS project ---                                04:06 Wednesday, June 13, 2018   7

                                                                  The FREQ Procedure

                                             alone_                             Cumulative    Cumulative
                                             combo     Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             alone          651       87.50           651        87.50  
                                             combo           93       12.50           744       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 744 observations read from the data set WORK.SEQ_COMBO.
NOTE: The PROCEDURE FREQ printed page 7.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.10 seconds
      cpu time            0.01 seconds
      

713        
714        proc sort data = Work.seq_COMBO;
715          by patid seq_start_date;
716        run;

NOTE: There were 744 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 744 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
14                                                                  The SAS System                                      04:06 Wednesday, June 13, 2018

      

717        
718        data combo_seq;
719        set seq_COMBO;
720        by patid seq_start_date;
721        length combo_fx_site $30. combo_seq 4;
722        retain combo_seq 0 combo_fx_site;
723        if first.patid or seq_start_date-lag(seq_start_date) then combo_seq=1+combo_seq;
724        where seq_cq^='0000' and seq_cq^=' ';
725        if combo_fx_site=" " or ""<site_order<lag(site_order) then combo_fx_site=fx_site;
726        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      1 at 723:33   
NOTE: There were 744 observations read from the data set WORK.SEQ_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.COMBO_SEQ has 744 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
      

727        
728        proc sort data = Work.seq_COMBO;
729          by patid seq;
730        run;

NOTE: There were 744 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 744 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.03 seconds
      cpu time            0.00 seconds
      

731        
732        data FX_CLM_DB;
733        merge _dat2 seq_start seq_end seq_cq(drop=fx_site) seq_COMBO(keep=patid seq alone_combo);
734        by patid seq;
735        run;

NOTE: There were 20205 observations read from the data set WORK._DAT2.
NOTE: There were 2799 observations read from the data set WORK.SEQ_START.
NOTE: There were 3189 observations read from the data set WORK.SEQ_END.
NOTE: There were 3189 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 744 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.FX_CLM_DB has 20205 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           0.10 seconds
      cpu time            0.07 seconds
      

736        
737        proc sql;
738        select count(distinct seq) from FX_CLM_DB;
                                                                  --- AS project ---                                04:06 Wednesday, June 13, 2018   8

                                                                               
                                                                       --------
                                                                           3189
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
739        quit;
NOTE: The PROCEDURE SQL printed page 8.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.07 seconds
      cpu time            0.04 seconds
      

740        
741        
742        
743        
744        /*
745        Collapse to fracture episodes
746        
747        Q: Why are some seq_start_date values missing?
748         */
15                                                                  The SAS System                                      04:06 Wednesday, June 13, 2018

749        proc sort
750          data = Work.fx_clm_db
751          out = Work.fractureEpisodes (drop = seq
752                                       rename = (seq_start_date = fractureEpisodeStart
753                                                 seq_end_date = fractureEpisodeEnd
754                                                 fx_site = fractureSite))
755          nodupkey;
756          by patid seq seq_start_date seq_end_date fx_site;
757        run;

NOTE: There were 20205 observations read from the data set WORK.FX_CLM_DB.
NOTE: 17016 observations with duplicate key values were deleted.
NOTE: The data set WORK.FRACTUREEPISODES has 3189 observations and 24 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.07 seconds
      cpu time            0.03 seconds
      

758        
759        proc sql;
760          create table DT.fractureEpisodesPrev as
761            select A.database,
762                   A.exposure,
763                   A.indexGNN,
764                   A.indexDate,
765                   A.ASCohortDate,
766                   A.indexID,
767                   A.age,
768                   A.sex,
769                   B.*,
770                   case
771                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
772                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
773                     else ""
774                     end as fractureType
775            from DT.indexLookup A inner join
776                 Work.fractureEpisodes B on (A.patid = B.patid);
NOTE: Table DT.FRACTUREEPISODESPREV created, with 5298 rows and 33 columns.

777          create table Work.summaryFractureEpisodesPrev as
778            select "DT.fractureEpisodesPrev" as table,
779                   fractureType, fractureSite,
780                   count(distinct patid) as countDistinctPatid,
781                   count(*) as countFractureEpisodes
782            from DT.fractureEpisodesPrev
783            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESPREV created, with 23 rows and 5 columns.

784          select * from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                                04:06 Wednesday, June 13, 2018   9

                                                                                                                    count         count
                                                                                                                 Distinct      Fracture
               table                    fractureType                         fractureSite                           Patid      Episodes
               ------------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesPrev                                       (7331) pathologic nos/nec                 51           106
               DT.fractureEpisodesPrev                                       (800-804) skull/face                      60           111
               DT.fractureEpisodesPrev                                       (807) rib/sternum/trachea                161           312
               DT.fractureEpisodesPrev                                       (809) trunk bones                          2             2
               DT.fractureEpisodesPrev                                       (810) clavicle                            49            91
               DT.fractureEpisodesPrev                                       (811) scapula                             17            30
               DT.fractureEpisodesPrev                                       (814) carpal                              59           122
               DT.fractureEpisodesPrev                                       (815-817) hand/fingers                   156           285
               DT.fractureEpisodesPrev                                       (818-819) arms mult                        3             7
               DT.fractureEpisodesPrev                                       (822) patella                             68           112
               DT.fractureEpisodesPrev                                       (823, 73316) tib_fib                      74           131
               DT.fractureEpisodesPrev                                       (824) ankle                              116           217
               DT.fractureEpisodesPrev                                       (825) tarsal_metatarsal                  167           302
               DT.fractureEpisodesPrev                                       (826) foot_phalanges                     106           178
               DT.fractureEpisodesPrev                                       (827) lower_limb                           5             5
               DT.fractureEpisodesPrev                                       (828) legs+arm/rib                         3             3
               DT.fractureEpisodesPrev                                       (829) fx_nos                             243           476
               DT.fractureEpisodesPrev  Clinical vertebral fracture          (805, 806, 73313) spine                  417          1048
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (808) pelvis                              66           114
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (812, 73311) humerus                      99           207
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                 183           361
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (820, 73314) hip                         409           863
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (821, 73315) femur                       108           215
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
785          select "DT.fractureEpisodesPrev" as table,
786                 sum(countDistinctPatid) as sumDistinctPatid,
787                 sum(countFractureEpisodes) as sumFractureEpisodes
788            from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                                04:06 Wednesday, June 13, 2018  10

                                                                           sumDistinct   sumFracture
                                                 table                           Patid      Episodes
                                                 ---------------------------------------------------
                                                 DT.fractureEpisodesPrev          2622          5298
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
789        
790          create table DT.fractureEpisodesInc as
791            select A.database,
792                   A.ENR_END_DATE,
793                   A.DEATH_DATE,
794                   A.exposure,
795                   A.exposureStart,
796                   A.exposureEnd,
797                   A.daysExposed,
798                   A.exposureID,
799                   B.*,
800                   case
801                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
802                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
803                     else ""
804                     end as fractureType
805            from DT.exposureTimeline A inner join
806                 Work.fractureEpisodes B on (A.patid = B.patid  & A.exposureStart <= B.fractureEpisodeStart <= A.exposureEnd);
NOTE: Table DT.FRACTUREEPISODESINC created, with 1624 rows and 33 columns.
16                                                                  The SAS System                                      04:06 Wednesday, June 13, 2018


807          create table Work.summaryFractureEpisodesInc as
808            select "DT.fractureEpisodesInc" as table,
809                   fractureType, fractureSite,
810                   count(distinct patid) as countDistinctPatid,
811                   count(*) as countFractureEpisodes
812            from DT.fractureEpisodesInc
813            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESINC created, with 23 rows and 5 columns.

814          select * from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                                04:06 Wednesday, June 13, 2018  11

                                                                                                                   count         count
                                                                                                                Distinct      Fracture
               table                   fractureType                         fractureSite                           Patid      Episodes
               -----------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesInc                                       (7331) pathologic nos/nec                 22            25
               DT.fractureEpisodesInc                                       (800-804) skull/face                      29            32
               DT.fractureEpisodesInc                                       (807) rib/sternum/trachea                105           115
               DT.fractureEpisodesInc                                       (809) trunk bones                          1             1
               DT.fractureEpisodesInc                                       (810) clavicle                            29            31
               DT.fractureEpisodesInc                                       (811) scapula                             14            16
               DT.fractureEpisodesInc                                       (814) carpal                              22            23
               DT.fractureEpisodesInc                                       (815-817) hand/fingers                    87            94
               DT.fractureEpisodesInc                                       (818-819) arms mult                        3             3
               DT.fractureEpisodesInc                                       (822) patella                             15            20
               DT.fractureEpisodesInc                                       (823, 73316) tib_fib                      30            36
               DT.fractureEpisodesInc                                       (824) ankle                               64            73
               DT.fractureEpisodesInc                                       (825) tarsal_metatarsal                   89            95
               DT.fractureEpisodesInc                                       (826) foot_phalanges                      53            54
               DT.fractureEpisodesInc                                       (827) lower_limb                           2             2
               DT.fractureEpisodesInc                                       (828) legs+arm/rib                         2             2
               DT.fractureEpisodesInc                                       (829) fx_nos                              17            22
               DT.fractureEpisodesInc  Clinical vertebral fracture          (805, 806, 73313) spine                  270           375
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (808) pelvis                              42            42
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (812, 73311) humerus                      56            67
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                  94           104
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (820, 73314) hip                         234           297
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (821, 73315) femur                        80            95
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
815          select "DT.fractureEpisodesInc" as table,
816                 sum(countDistinctPatid) as sumDistinctPatid,
817                 sum(countFractureEpisodes) as sumFractureEpisodes
818            from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                                04:06 Wednesday, June 13, 2018  12

                                                                           sumDistinct   sumFracture
                                                  table                          Patid      Episodes
                                                  --------------------------------------------------
                                                  DT.fractureEpisodesInc          1360          1624
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
819        quit;
NOTE: The PROCEDURE SQL printed pages 9-12.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.62 seconds
      cpu time            0.31 seconds
      

820        
821        
822        
823        
824        /*
825        CLEAN UP
826        
827        proc sql;
828          drop table UCB64.tempFracDxMPCD;
829          drop table UCB64.tempFracDxUCB;
830          drop table UCB64.tempFracDxSABR;
831          drop table UCB64.tempFracPxMPCD;
832          drop table UCB64.tempFracPxUCB;
833          drop table UCB64.tempFracPxSABR;
834        quit;
835         */
836        
837        
838        proc export
839          data = Work.summaryFractureEpisodesInc
840          outfile = "data\processed\&cmt..csv"
841          dbms = csv
842          replace;
843          delimiter = '09'x;
844        run;

845         /**********************************************************************
846         *   PRODUCT:   SAS
847         *   VERSION:   9.4
848         *   CREATOR:   External File Interface
849         *   DATE:      13JUN18
850         *   DESC:      Generated SAS Datastep Code
851         *   TEMPLATE SOURCE:  (None Specified.)
852         ***********************************************************************/
853            data _null_;
854            %let _EFIERR_ = 0; /* set the ERROR detection macro variable */
855            %let _EFIREC_ = 0;     /* clear export record count macro variable */
856            file 'data\processed\queryFractures.csv' delimiter='09'x DSD DROPOVER lrecl=32767;
857            if _n_ = 1 then        /* write column names or labels */
858             do;
859               put
860                  "table"
861               '09'x
862                  "fractureType"
863               '09'x
864                  "fractureSite"
865               '09'x
866                  "countDistinctPatid"
867               '09'x
868                  "countFractureEpisodes"
17                                                                  The SAS System                                      04:06 Wednesday, June 13, 2018

869               ;
870             end;
871           set  WORK.SUMMARYFRACTUREEPISODESINC   end=EFIEOD;
872               format table $22. ;
873               format fractureType $35. ;
874               format fractureSite $30. ;
875               format countDistinctPatid best12. ;
876               format countFractureEpisodes best12. ;
877             do;
878               EFIOUT + 1;
879               put table $ @;
880               put fractureType $ @;
881               put fractureSite $ @;
882               put countDistinctPatid @;
883               put countFractureEpisodes ;
884               ;
885             end;
886            if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable */
887            if EFIEOD then call symputx('_EFIREC_',EFIOUT);
888            run;

NOTE: The file 'data\processed\queryFractures.csv' is:
      Filename=U:\studies\AS\pgms\bchan\data\processed\queryFractures.csv,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=13Jun2018:04:06:46,
      Create Time=13Jun2018:04:06:46

NOTE: 24 records were written to the file 'data\processed\queryFractures.csv'.
      The minimum record length was 41.
      The maximum record length was 90.
NOTE: There were 23 observations read from the data set WORK.SUMMARYFRACTUREEPISODESINC.
NOTE: DATA statement used (Total process time):
      real time           0.09 seconds
      cpu time            0.01 seconds
      

23 records created in data\processed\queryFractures.csv from WORK.SUMMARYFRACTUREEPISODESINC.
  
  
NOTE: "data\processed\queryFractures.csv" file was successfully created.
NOTE: PROCEDURE EXPORT used (Total process time):
      real time           1.57 seconds
      cpu time            0.14 seconds
      

889        
890        
891        ods html close;
NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           20.42 seconds
      cpu time            12.57 seconds
      
