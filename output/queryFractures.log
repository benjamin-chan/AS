1                                                                                           The SAS System                                                               10:38 Monday, November 5, 2018

NOTE: Copyright (c) 2016 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M5) 
      Licensed to UNIVERSITY OF ALABAMA AT BIRMINGHAM - SFA - T&R, Site 70086550.
NOTE: This session is executing on the X64_DS08R2  platform.



NOTE: Updated analytical products:
      
      SAS/STAT 14.3
      SAS/ETS 14.3
      SAS/IML 14.3
      SAS/QC 14.3

NOTE: Additional host information:

 X64_DS08R2 WIN 6.1.7601 Service Pack 1 Server

--- PEER News and Updates ---

: SECURITY REMINDER :
Please remember not to copy any data files that contain PHI (protected health identifiers) to any of the shared folders.

 


NOTE: SAS initialization used:
      real time           4.21 seconds
      cpu time            0.29 seconds
      
1          *  University of Alabama at Birmingham                               *
2          *  AS project                                            *
3          **********************************************************************;
4          options pagesize=74 linesize=150 pageno=1 missing=' ' date FORMCHAR="|----|+|---+=|-/\<>*";
5          * Programmer    : Benjamin Chan <chanb@ohsu.edu>
6          * Creation date :
7          * Modify date   :
8          ;
9          %let cmt=queryFractures; * type the name of your program here (without the filename extension);
10         %let pgm=&cmt..sas;
11         %include "lib\libname.sas" ;
NOTE: Libref STDC5P was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: H:\studies\osteo\data\STD_files\5pct\
NOTE: Libref STD_SABR was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\data\std_SABER\
NOTE: Libref MPSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\mpcd\data\stddata\
NOTE: Libref UCBSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\stddata\
NOTE: Libref UCB was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB\
NOTE: Libref UCB64 was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB64\
NOTE: Libref DT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: V:\studies\AS\data
NOTE: Libref NDC was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: W:\onenote\references\drug ndcs\sas data
143        footnote "&pgm.";
144        * footnote2 "%sysfunc(datetime(),datetime14.)";
145        title1 '--- AS project ---';
146        **********************************************************************;
147        options macrogen mlogic mprint symbolgen;
148        options nomacrogen nomlogic nomprint nosymbolgen;
149        
2                                                                   The SAS System                                      10:38 Monday, November 5, 2018

150        
151        ods html
152          body = "output\&cmt..html"
153          style = Statistical;
NOTE: Writing HTML Body file: output\queryFractures.html
154        
155        
156        /*
157        FRACTURES
158        
159        See "ALGORITHMS TO ENHANCE SPECIFICITY OF FRACTURE IDENTIFICATION_ 100316.docx"
160        
161        Adapted from Lang's code in "001_fx_data.sas"
162        
163        
164        From: Chen, Lang [mailto:langchen@uabmc.edu]
165        Sent: Monday, July 24, 2017 8:56 AM
166        To: Benjamin Chan <chanb@ohsu.edu>
167        Subject: RE: fracture identification algorithm
168        
169        Here it is.
170        For 001_fx_data, find all fx related claim and run the algorithm.
171        Please ignore any code after line 476
172        Modify code from line 1 -50
173        
174        For 002_fx_epi_data
175        Define fx episode.
176        
177        Final output data is fx_dgns_&firstyr._&lastyr._4. Please let me if you have any questions.
178         */
179        
180        
181        /*
182        START OF 001_fx_data.sas
183         */
184        
185        
186        /*Assign "Broad" fracture site (fx_site) for all ICD9 diagnoses, outputting separately, so some records are cloned, then combining into one
186      !  file */
187        /*No longer using matched trauma files here*/
188        
189        %macro comballfxdgns;
190            data fx_dgns;
191                set UCB64.tempFracDxAll (where = (diagCodeType = "Fracture code"));
192                    length fx_site $30 ;
193                    fx_site = '';
194                    if strip(DX) in: ('800' '801' '802' '803' '804') then           do; fx_site='(800-804) skull/face'; output; end;
195                    if strip(DX) in: ('805', '806') or strip(DX)='73313' then       do; fx_site='(805, 806, 73313) spine'; output; end;
196                    if strip(DX) in: ('807') then                                           do; fx_site='(807) rib/sternum/trachea'; output; end;
197                    if strip(DX) in: ('808') then                                           do; fx_site='(808) pelvis'; output; end;
198                    if strip(DX) in: ('809') then                                           do; fx_site='(809) trunk bones'; output; end;
199                    if strip(DX) in: ('810') then                                           do; fx_site='(810) clavicle'; output; end;
200                    if strip(DX) in: ('811') then                                           do; fx_site='(811) scapula'; output; end;
201                    if strip(DX) in: ('812') or strip(DX)='73311' then              do; fx_site='(812, 73311) humerus'; output; end;
202                    if strip(DX) in: ('813') or strip(DX)='73312' then              do; fx_site='(813, 73312) radius_ulna'; output; end;
203                    if strip(DX) in: ('814') then                                           do; fx_site='(814) carpal'; output; end;
204                    if strip(DX) in: ('815' '816' '817') then                           do; fx_site='(815-817) hand/fingers'; output; end;
205                    if strip(DX) in: ('818' '819') then                                     do; fx_site='(818-819) arms mult'; output; end;
206                    if strip(DX) in: ('820') or strip(DX) = '73314' then                do; fx_site='(820, 73314) hip'; output; end;
207                    if strip(DX) in: ('821') or strip(DX)='73315' then              do; fx_site='(821, 73315) femur'; output; end;
208                    if strip(DX) in: ('822') then                                           do; fx_site='(822) patella'; output; end;
209                    if strip(DX) in: ('823') or strip(DX)='73316' then              do; fx_site='(823, 73316) tib_fib'; output; end;
210                    if strip(DX) in: ('824') then                                           do; fx_site='(824) ankle'; output; end;
211                    if strip(DX) in: ('825') then                                           do; fx_site='(825) tarsal_metatarsal'; output; end;
212                    if strip(DX) in: ('826') then                                           do; fx_site='(826) foot_phalanges'; output; end;
213                    if strip(DX) in: ('827') then                                           do; fx_site='(827) lower_limb'; output; end;
214                    if strip(DX) in: ('828') then                                           do; fx_site='(828) legs+arm/rib'; output; end;
215                    if strip(DX) in: ('829') then                                           do; fx_site='(829) fx_nos'; output; end;
216                    if strip(DX) in ('73310' '73319' '7331') then                 do; fx_site='(7331) pathologic nos/nec'; output; end;
217            data fx_excare;
218                set UCB64.tempFracDxAll (where = (diagCodeType = "Extended care code"));
219                    length fx_site $30 ;
3                                                                   The SAS System                                      10:38 Monday, November 5, 2018

220                    fx_site = '';
221                    /*Expanded Diagnosis Codes - Fracture Aftercare Codes*/
222                    if strip(DX) in ('V5410' 'V5420') then                          do; fx_site='(812, 73311) humerus'; output;
223                                                                                                     fx_site='(813, 73312) radius_ulna'; output;
223      ! end;
224                    if strip(DX) in ('V5411' 'V5421') then                          do; fx_site='(812, 73311) humerus'; output; end;
225                    if strip(DX) in ('V5412' 'V5422') then                          do; fx_site='(813, 73312) radius_ulna'; output;
226                                                                                                     fx_site='(814) carpal'; output; end;
227                    if strip(DX) in ('V5413' 'V5423') then                          do; fx_site='(820, 73314) hip'; output; end;
228                    if strip(DX) in ('V5414' 'V5424') then                          do; fx_site='(820, 73314) hip'; output;
229                                                                                                     fx_site='(821, 73315) femur'; output;
230                                                                                                     fx_site='(822) patella'; output;
231                                                                                                     fx_site='(824) ankle'; output;
232                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
233                    if strip(DX) in ('V5415' 'V5425') then                          do; fx_site='(820, 73314) hip'; output;
234                                                                                                     fx_site='(821, 73315) femur'; output;
235                                                                                                     fx_site='(822) patella'; output; end;
236                    if strip(DX) in ('V5416' 'V5426') then                          do; fx_site='(824) ankle'; output;
237                                                                                                     fx_site='(822) patella'; output;
238                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
239                    if strip(DX) in ('V5417' 'V5427') then                          do; fx_site='(805, 806, 73313) spine'; output; end;
240                    if strip(DX) in: ('V542') then                                       do; fx_site='(7331) pathologic nos/nec'; output; end;
241                    if strip(DX) in: ('V541') then                                       do; fx_site='(829) fx_nos'; output; end;
242            run;
243        
244            /* proc sort data=fx_dgns; by patid BEGIN_DATE fx_site; run;
245            proc sort data=fx_excare; by patid BEGIN_DATE fx_site; run; */
246        %mend;
247        %comballfxdgns;

NOTE: There were 76759 observations read from the data set UCB64.TEMPFRACDXALL.
      WHERE diagCodeType='Fracture code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_DGNS has 76759 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.37 seconds
      cpu time            0.37 seconds
      


NOTE: There were 4793 observations read from the data set UCB64.TEMPFRACDXALL.
      WHERE diagCodeType='Extended care code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_EXCARE has 10812 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.09 seconds
      cpu time            0.06 seconds
      

248        
249        /*Now, assign a more specific fracture site (e.g., closed, other) (site) that is used in the CQ algorithms*/
250        /*Since Expanded Diagnosis Codes (V Codes) apply to sub-categories of each broad fracture site, clone records for these so they appear in
250      ! both places*/
251        
252        data fx_dgns_2;
253            set fx_dgns;
254        
255            length site $30;
256        
257            site="";
258        
259            *Spine-closed and Spine-other;
260            if fx_site='(805, 806, 73313) spine' then
261                do;
262                    site = 'spine_cls'; /*Includes V Codes and 73313 here*/
263                    if substr(strip(DX),1,3) in ('805' '806') and substr(strip(DX),1,4) ^in ('8050', '8052', '8054', '8058') then
264                        site = 'spine_oth';
265                end;
266        
267            *Pelvis-closed and Pelvis-other... No V Codes;
268            if fx_site='(808) pelvis' then
269                do;
4                                                                   The SAS System                                      10:38 Monday, November 5, 2018

270                    site = 'pelvis_cls';
271                    if substr(strip(DX),1,3)='808' and substr(strip(DX),1,4) ^in ('8080', '8082', '8084', '8088') then
272                        site = 'pelvis_oth';
273                end;
274        
275            *Clavicle-closed and Clavicle-other.... No V Codes;
276            if fx_site='(810) clavicle' then
277                do;
278                    site = 'clv_cls';
279                    if substr(strip(DX),1,3) = '810' and substr(strip(DX),1,4) ^in ('8100') then
280                        site = 'clv_oth';
281                end;
282        
283            *Humerus-closed and Humerus-other;
284            if fx_site='(812, 73311) humerus' then
285                do;
286                    site = 'hmrs_cls'; /*Includes V Codes and 73311 here*/
287                    if substr(strip(DX),1,3)= '812' and substr(strip(DX),1,4) ^in ('8120', '8122', '8124') then
288                        site = 'hmrs_oth';
289                end;
290        
291            *Distal radius/ulna and Radius/ulna-other;
292            if fx_site='(813, 73312) radius_ulna' then
293                do;
294                 site = 'dist4arm'; /*Includes V Codes and 73312 here*/
295                    if substr(strip(DX),1,3) = '813' and substr(strip(DX),1,4) ^in ('8134', '8135') then
296                        site = 'rad_ul_oth';
297                end;
298        
299            *Carpal... V Codes present but only one category;
300            if fx_site='(814) carpal' then
301                do;
302                    site = 'carpal';
303                 end;
304        
305            *Hip-closed and Hip-other;
306            if fx_site='(820, 73314) hip' then
307                    do;
308                    site = 'hip_cls'; /*Includes V Codes and 73314 here*/
309                    if substr(strip(DX),1,3)='820' and substr(strip(DX),1,4) ^in ('8200', '8202', '8208') then
310                        site = 'hip_oth';
311                end;
312        
313            *Other femur-closed and Other femur-other;
314            if fx_site='(821, 73315) femur' then
315                do;
316                    site = 'oth_fem_cls'; /*Includes V Codes and 73315 here*/
317                    if substr(strip(DX),1,3)='821' and substr(strip(DX),1,4) ^in ('8210', '8212') then
318                        site = 'oth_fem_oth';
319                end;
320        
321            *Tib/fib-closed and Tib/fib-other;
322            if fx_site='(823, 73316) tib_fib' then
323                do;
324                    site = 'tib_fib_cls'; /*Includes V Codes and 73316 here*/
325                    if substr(strip(DX),1,3)='823' and substr(strip(DX),1,4) ^in ('8230', '8232', '8238') then
326                        site = 'tib_fib_oth';
327                end;
328        
329            *Ankle... V Codes present but only one category;
330            if fx_site='(824) ankle' then
331                do;
332                    site = 'ankle';
333                end;
334        
335            /*Assign site for other fx_sites that do not have CQ algorithm and thus no sub categories*/
336            if site = "" then do;
337                site = fx_site;
338            end;
339        
340            label site = 'CQ Algorithm Fracture Site (Specific)';
341        
5                                                                   The SAS System                                      10:38 Monday, November 5, 2018

342        run;

NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD exposure=DMARD patid=104066289 indexGNN=HYDROXYCHLOROQUINE indexDate=09/15/2010 age=25 SEX=F asDate=09/14/2010 ENR_START_DATE=02/01/2007
ENR_END_DATE=12/31/2010 obs_end=12/31/2010 asCohortDate=09/14/2010 DEATH_DATE= indexID=235 ENCOUNTERID=10735519963 ENC_TYPE=AV ADMIT_DATE=
BEGIN_DATE=01/21/2010 DISCHARGE_DATE= END_DATE=01/21/2010 DX_TYPE=09 DX=810 PDX=O codeType=ICD9-DX code=810 PROV_TYPE=8 diagCodeType=Fracture code
fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=237
NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD exposure=DMARD patid=104066289 indexGNN=HYDROXYCHLOROQUINE indexDate=09/15/2010 age=25 SEX=F asDate=09/14/2010 ENR_START_DATE=02/01/2007
ENR_END_DATE=12/31/2010 obs_end=12/31/2010 asCohortDate=09/14/2010 DEATH_DATE= indexID=235 ENCOUNTERID=10735519963 ENC_TYPE=AV ADMIT_DATE=
BEGIN_DATE=01/21/2010 DISCHARGE_DATE= END_DATE=01/21/2010 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX code=810 PROV_TYPE=8 diagCodeType=Fracture code
fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=238
NOTE: There were 76759 observations read from the data set WORK.FX_DGNS.
NOTE: The data set WORK.FX_DGNS_2 has 76759 observations and 29 variables.
NOTE: DATA statement used (Total process time):
      real time           0.18 seconds
      cpu time            0.15 seconds
      

343        
344        /*###########################################################################################################*/
345        /***************************************************Intermediate Fracture Diagnosis File**********************/
346        /*Combine CQ diagnosis files*******************************************************/
347        data fx_dgns_3;
348            set fx_dgns_2
349        /*    fx_excare_*/
350                ;
351        run;

NOTE: There were 76759 observations read from the data set WORK.FX_DGNS_2.
NOTE: The data set WORK.FX_DGNS_3 has 76759 observations and 29 variables.
NOTE: DATA statement used (Total process time):
      real time           0.14 seconds
      cpu time            0.09 seconds
      

352        
353        proc freq data=fx_dgns_3;
354            tables fx_site site;
355        run;

                                                                  --- AS project ---                                10:38 Monday, November 5, 2018   1

                                                                  The FREQ Procedure

                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec        1449        1.89          1449         1.89  
                                    (800-804) skull/face             2057        2.68          3506         4.57  
                                    (805, 806, 73313) spine         18589       24.22         22095        28.78  
                                    (807) rib/sternum/trachea        4244        5.53         26339        34.31  
                                    (808) pelvis                     4445        5.79         30784        40.10  
                                    (809) trunk bones                  62        0.08         30846        40.19  
                                    (810) clavicle                    958        1.25         31804        41.43  
                                    (811) scapula                     282        0.37         32086        41.80  
                                    (812, 73311) humerus             5671        7.39         37757        49.19  
                                    (813, 73312) radius_ulna         6842        8.91         44599        58.10  
                                    (814) carpal                     1350        1.76         45949        59.86  
                                    (815-817) hand/fingers           2738        3.57         48687        63.43  
                                    (818-819) arms mult                56        0.07         48743        63.50  
                                    (820, 73314) hip                10091       13.15         58834        76.65  
                                    (821, 73315) femur               2211        2.88         61045        79.53  
                                    (822) patella                    1159        1.51         62204        81.04  
                                    (823, 73316) tib_fib             1901        2.48         64105        83.51  
                                    (824) ankle                      4369        5.69         68474        89.21  
                                    (825) tarsal_metatarsal          5635        7.34         74109        96.55  
                                    (826) foot_phalanges             2125        2.77         76234        99.32  
                                    (827) lower_limb                   49        0.06         76283        99.38  
                                    (828) legs+arm/rib                  6        0.01         76289        99.39  
                                    (829) fx_nos                      470        0.61         76759       100.00  


                                                        CQ Algorithm Fracture Site (Specific)
 
                                                                                          Cumulative    Cumulative
                                    site                         Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec        1449        1.89          1449         1.89  
                                    (800-804) skull/face             2057        2.68          3506         4.57  
                                    (807) rib/sternum/trachea        4244        5.53          7750        10.10  
                                    (809) trunk bones                  62        0.08          7812        10.18  
                                    (811) scapula                     282        0.37          8094        10.54  
                                    (815-817) hand/fingers           2738        3.57         10832        14.11  
                                    (818-819) arms mult                56        0.07         10888        14.18  
                                    (822) patella                    1159        1.51         12047        15.69  
                                    (825) tarsal_metatarsal          5635        7.34         17682        23.04  
                                    (826) foot_phalanges             2125        2.77         19807        25.80  
                                    (827) lower_limb                   49        0.06         19856        25.87  
                                    (828) legs+arm/rib                  6        0.01         19862        25.88  
                                    (829) fx_nos                      470        0.61         20332        26.49  
                                    ankle                            4369        5.69         24701        32.18  
                                    carpal                           1350        1.76         26051        33.94  
                                    clv_cls                           944        1.23         26995        35.17  
                                    clv_oth                            14        0.02         27009        35.19  
                                    dist4arm                         5091        6.63         32100        41.82  
                                    hip_cls                          9688       12.62         41788        54.44  
                                    hip_oth                           403        0.53         42191        54.97  
                                    hmrs_cls                         5553        7.23         47744        62.20  
                                    hmrs_oth                          118        0.15         47862        62.35  
                                    oth_fem_cls                      2185        2.85         50047        65.20  
                                    oth_fem_oth                        26        0.03         50073        65.23  
                                    pelvis_cls                       4409        5.74         54482        70.98  
                                    pelvis_oth                         36        0.05         54518        71.02  
                                    rad_ul_oth                       1751        2.28         56269        73.31  
                                    spine_cls                       16963       22.10         73232        95.41  
                                    spine_oth                        1626        2.12         74858        97.52  
                                    tib_fib_cls                      1717        2.24         76575        99.76  
                                    tib_fib_oth                       184        0.24         76759       100.00  
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 76759 observations read from the data set WORK.FX_DGNS_3.
NOTE: The PROCEDURE FREQ printed page 1.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.22 seconds
      cpu time            0.15 seconds
      

356        
357        proc sort data=fx_dgns_3;
358            by patid ENCOUNTERID fx_site site;
359        run;

NOTE: There were 76759 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_3 has 76759 observations and 29 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.23 seconds
      cpu time            0.21 seconds
      

360        
361        
362        /*###########################################################################################################*/
363        /*************************************************************************************************************/
364        /*Look for repair procedures and assign treatment site*******************/
365        /*This code has been updated to include hip/femur replacement with matching diagnosis code, also looked in claim strip(DX) not just primary
365      !  strip(DX)
366        /*Not accepting contiguous sites until later*/
367        /*Excluding procedures from DME files*/
368        /*******************************Select All Spine Imaging Codes from STD Procedure Files for CQ=4/5 algorithms*/
369        
370        %macro fx_prcd;
6                                                                   The SAS System                                      10:38 Monday, November 5, 2018

371            data fx_prcd spine_xray;
372                set UCB64.tempFracPxAll;
373        
374                    length tx_site $30;
375                    length HLAT $1;
376        
377                    if strip(px) in ('21300' '21310' '21315' '21320' '21325' '21330' '21335' '21336' '21337' '21338' '21339' '21340' '21343'
377      ! '21344' '21345' '21346' '21347' '21348'
378                                         '21355' '21356' '21360' '21365' '21366' '21385' '21386' '21387' '21390' '21395' '21400' '21401' '21406'
378      ! '21407' '21408' '21421' '21422' '21423'
379                                         '21431' '21432' '21433' '21435' '21436' '21440' '21445' '21450' '21451' '21452' '21453' '21454' '21461'
379      ! '21462' '21465' '21470'
380                                         '62000' '62005' '62010')  and lengthn(strip(px)) = 5 then do;
381                        tx_site='(800-804) skull/face'; output fx_prcd; end;
382        
383                    if strip(px) in ('22305' '22310' '22315' '22318' '22319' '22325' '22326' '22327' '22328' '22520' '22521' '22522' '22523'
383      ! '22524' '22525' '76012' '76013'
384                                         'S2360' 'S2361' 'S2362' 'S2363' '72291' '72292')  and lengthn(strip(px)) = 5 then do;
385                        tx_site = '(805, 806, 73313) spine'; output fx_prcd; end;
386        
387                    if  strip(px) in ('21493' '21494' '21495' '21800' '21805' '21810' '21820' '21825' ) then do;
388                        tx_site='(807) rib/sternum/trachea'; output fx_prcd; end;
389        
390                    if strip(px) in ('27193' '27194' '27215' '27216' '27217' '27218' '27220' '27222' '27226' '27227' '27228')  and
390      ! lengthn(strip(px)) = 5 then do;
391                        tx_site = '(808) pelvis'; output fx_prcd; end;
392        
393                    if strip(px) in ('23500' '23505' '23515')  and lengthn(strip(px)) = 5 then do;
394                        tx_site = '(810) clavicle'; output fx_prcd; end;
395        
396                    if strip(px) in ('23570' '23575' '23585') then do;
397                        tx_site= '(811) scapula'; output fx_prcd; end;
398        
399                    if strip(px) in ('23600' '23605' '23615' '23616' '23620' '23625' '23630' '23665' '24500' '24505' '24515' '24516' '24530'
399      ! '24535' '24538' '24545' '24546' '24560'
400                                 '24565' '24566' '24575' '24576' '24577' '24579' '24582')  and lengthn(strip(px)) = 5 then do;
401                        tx_site = '(812, 73311) humerus'; output fx_prcd; end;
402        
403                    if strip(px) in ('25600' '25605' '25606' '25607' '25608' '25609' '25620' '25650' '25651' '25652')  and lengthn(strip(px)) = 5
403      ! then do;
404                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
405        
406                    if strip(px) in ('24650' '24655' '24665' '24666' '24670' '24675' '24685' '25500' '25505' '25515' '25520' '25525' '25526'
406      ! '25530' '25535' '25545' '25560' '25565'
407                                 '25574' '25575')  and lengthn(strip(px)) = 5 then do;
408                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
409        
410                    if strip(px) in ('25622' '25624' '25628' '25630' '25635' '25645' '25680' '25685')  and lengthn(strip(px)) = 5 then do;
411                        tx_site = '(814) carpal'; output fx_prcd; end;
412        
413                    if strip(px) in ('26600' '26605' '26607' '26608' '26615' '26645' '26650' '26665' '26720' '26725' '26727' '26735' '26740'
413      ! '26742' '26746' '26750' '26755' '26756' '26765' )
414                               and lengthn(strip(px)) = 5 then do;
415                        tx_site='(815-817) hand/fingers'; output fx_prcd; end;
416        
417                    if '27230' <= strip(px) <= '27248' and lengthn(strip(px)) = 5 then do;
418                        tx_site = '(820, 73314) hip'; output fx_prcd; end;
419        
420                    if '27500' <= strip(px) <= '27514'  and lengthn(strip(px)) = 5 then do;
421                        tx_site = '(821, 73315) femur'; output fx_prcd; end;
422        
423                    if strip(px) in ('27520' '27524')  and lengthn(strip(px)) = 5 then do;
424                        tx_site = '(822) patella'; output fx_prcd; end;
425        
426                    if ('27530' <= strip(px) <= '27536' or '27750' <= strip(px) <= '27759' or '27780' <= strip(px) <= '27784' or '27824' <=
426      ! strip(px) <= '27828') and lengthn(strip(px)) = 5  then do;
427                        tx_site = '(823, 73316) tib_fib'; output fx_prcd; end;
428        
429                    if strip(px) in ('27760' '27762' '27766' '27786' '27788' '27792' '27808' '27810' '27814' '27816' '27818' '27822' '27823'
429      ! '28430' '28435' '28436' '28445')  and lengthn(strip(px)) = 5 then do;
430                        tx_site = '(824) ankle'; output fx_prcd; end;
431        
7                                                                   The SAS System                                      10:38 Monday, November 5, 2018

432                    if strip(px) in ('28320' '28322' '28400' '28405' '28406' '28415' '28420' ) and lengthn(strip(px)) = 5 then do;
433                        tx_site='(825) tarsal_metatarsal'; output fx_prcd; end;
434        
435                 /********************************Hip/Femur Additions - must be matched with DGNS to be included*/
436                 /*Hip replacement codes*/
437                    /*Hip*/
438                    if strip(px) in ('27130' '27125') and lengthn(strip(px)) = 5  then do;
439                        HLAT='1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
440        
441                    /*Codes below are the only ICD9 Procedure Codes that we are using for "repair"*/
442                    if strip(px) in ('8151' '8152') and lengthn(strip(px)) = 4 then do;
443                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
444        
445                    /*Femur repair codes, assigned to both Hip and Femur treatment sites... CHECK - MAYBE WE NEED TO DO THIS THE OTHER WAY AS
445      ! WELL*/
446                    /*Hip*/
447                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
448                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
449        
450                    /*Femur*/
451                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
452                        HLAT = '1'; tx_site = '(821, 73315) femur'; output fx_prcd; end;
453                     /*spine image*/
454                        if '72010' <= strip(px) <= '72159' or '72240' <= strip(px) <= '72285' or strip(px) = '72295' then do;   /*Spine Imaging
454      ! Codes*/
455                        tx_site='(805, 806, 73313) spine';
456                        output spine_xray; end;
457        
458            run;
459        
460            data fx_prcd;
461                set fx_prcd;
462                /*To add laterality info*/
463        /*        array hcpcs{*} hcpcs_1st_mdfr_cd hcpcs_2nd_mdfr_cd hcpcs_3rd_mdfr_cd hcpcs_4th_mdfr_cd ; */
464                if HLAT='1' then do;
465                    repair_right='0'; repair_left='0';
466                end;
467        /*        if HLAT='1' then */
468        /*            do i=1 to dim(hcpcs);*/
469        /*                if hcpcs{i} = 'RT' then repair_right='1';*/
470        /*                else if hcpcs{i} = 'LT' then repair_left='1';*/
471        /*            end;*/
472            run;
473            proc sort data=fx_prcd nodupkey; by patid ENCOUNTERID px_date tx_site; run;
474        
475            data spine_xray;
476                set spine_xray;
477                keep patid px_date tx_site  ENCOUNTERID begin_date;
478            run;
479            proc sort data=spine_xray nodupkey; by patid px_date; run;
480        %mend;
481        %fx_prcd;

NOTE: There were 20905356 observations read from the data set UCB64.TEMPFRACPXALL.
NOTE: The data set WORK.FX_PRCD has 14319 observations and 26 variables.
NOTE: The data set WORK.SPINE_XRAY has 188524 observations and 26 variables.
NOTE: DATA statement used (Total process time):
      real time           33.59 seconds
      cpu time            33.55 seconds
      


NOTE: There were 14319 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK.FX_PRCD has 14319 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.04 seconds
      


NOTE: There were 14319 observations read from the data set WORK.FX_PRCD.
NOTE: 7520 observations with duplicate key values were deleted.
8                                                                   The SAS System                                      10:38 Monday, November 5, 2018

NOTE: The data set WORK.FX_PRCD has 6799 observations and 28 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.06 seconds
      cpu time            0.03 seconds
      


NOTE: There were 188524 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.SPINE_XRAY has 188524 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.18 seconds
      cpu time            0.15 seconds
      


NOTE: There were 188524 observations read from the data set WORK.SPINE_XRAY.
NOTE: 121426 observations with duplicate key values were deleted.
NOTE: The data set WORK.SPINE_XRAY has 67098 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.21 seconds
      cpu time            0.32 seconds
      

482        
483        
484        
485        data trauma (rename=(begin_date=trauma_dt));
486                set UCB64.tempFracDxAll (where = (diagCodeType = "Trauma code"));
487        run;

NOTE: There were 8298 observations read from the data set UCB64.TEMPFRACDXALL.
      WHERE diagCodeType='Trauma code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.TRAUMA has 8298 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.10 seconds
      cpu time            0.09 seconds
      

488        proc sort data= trauma(keep=patid trauma_dt) nodupkey; by patid trauma_dt;run;

NOTE: There were 8298 observations read from the data set WORK.TRAUMA.
NOTE: 4227 observations with duplicate key values were deleted.
NOTE: The data set WORK.TRAUMA has 4071 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.07 seconds
      cpu time            0.01 seconds
      

489        
490        
491        /*subset the spine xray procedure claim for patients with fx diagnosis code only*/
492        /*so SAS will not run out of memory*/
493        data fx_spine_xray(keep=patid tx_site px_date ENCOUNTERID begin_date);
494        if _n_=1 then do;
495          declare hash hid(dataset:"fx_dgns_3(where=(fx_site='(805, 806, 73313) spine')))", multidata:"N", hashexp:20);
496          rc=hid.defineKey("patid");
497          rc=hid.defineDone();
498        end;
499        set spine_xray;
500        rc=hid.find();
501        if rc=0;
502        run;

NOTE: There were 18589 observations read from the data set WORK.FX_DGNS_3.
      WHERE fx_site='(805, 806, 73313) spine';
NOTE: There were 67098 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.FX_SPINE_XRAY has 13246 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.17 seconds
      cpu time            0.12 seconds
      
9                                                                   The SAS System                                      10:38 Monday, November 5, 2018


503        /*subset the Trauma code for patients with fx diagnosis code only*/
504        /*so SAS will not run out of memory*/
505        data fx_trauma(drop=rc);
506        if _n_=1 then do;
507          declare hash hid(dataset:"fx_dgns_3", multidata:"N", hashexp:20);
508          rc=hid.defineKey("patid");
509          rc=hid.defineDone();
510        end;
511        set trauma;
512        rc=hid.find();
513        if rc=0;
514        run;

NOTE: There were 76759 observations read from the data set WORK.FX_DGNS_3.
NOTE: There were 4071 observations read from the data set WORK.TRAUMA.
NOTE: The data set WORK.FX_TRAUMA has 2386 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.14 seconds
      cpu time            0.11 seconds
      

515        /************************************Link Fracture Claims (ICD9 Diagnosis) with Repair Claims (CPT/HCPCS, some ICD9 procedure
515      ! code)***************/
516        
517        data fx_dgns_4(drop=rc: px_date tx_site xray_date trauma_dt);
518        if _n_=1 then do;
519          declare hash hid(dataset:"fx_prcd", multidata:"N", hashexp:20);
520          rc=hid.defineKey("patid", "px_date", "tx_site");
521        /*  rc=hid.defineData("px_date", "tx_site");*/
522          rc=hid.defineDone();
523          declare hash hxray(dataset:"fx_spine_xray(rename=px_date=xray_date)", multidata:"Y", hashexp:20);
524          rc=hxray.defineKey("patid", "tx_site");
525          rc=hxray.defineData("xray_date");
526          rc=hxray.defineDone();
527          declare hash htrauma(dataset:"fx_trauma", multidata:"Y", hashexp:20);
528          rc=htrauma.defineKey("patid");
529          rc=htrauma.defineData("trauma_dt");
530          rc=htrauma.defineDone();
531        end;
532        if 0 then set fx_prcd(keep=patid px_date tx_site)
533                      fx_spine_xray(keep=patid px_date tx_site rename=px_date=xray_date)
534                      fx_trauma;
535        set fx_dgns_3;
536        length cq $4 spine_image trauma_date 4 trauma $1;
537        format spine_image trauma_date mmddyy10.;
538        cq="0000";
539        rc=hid.find(key:patid, key:begin_date,key:fx_site);
540        if rc^=0 then do;
541            px_date=.;
542            tx_site=" ";
543        end;
544        if enc_type="IP" then do;
545        /*CQ = 1 Inpatient claim with primary diagnosis code */
546            if pdx="P" then substr(cq,1,1)="1";
547        /*CQ = 2 Inpatient claim with secondary diagnosis code*/
548            else substr(cq,2,1)="2";
549        end; else do;
550        /*CQ = 3 outpatient diagnosis code AND carrier line with repair/replace HCPCS*/
551            if rc=0 then substr(cq,3,1)="3";
552            rc1=hxray.find(key:patid, key:fx_site);
553            do while (rc1 = 0);
554                if begin_date-10 <=xray_date<= begin_date then do;
555                    if enc_type in ("AV" "IF" "NH" "HH" "ER" "ED") then do;
556        /*CQ = 4 outpatient [Physician E&M codes] diagnosis code with spine image/x-ray within 10 day early*/
557                        substr(cq,4,1)="4";
558                        spine_image=min(spine_image,xray_date);
559                    end;
560                end;
561                rc1=hxray.find_next(key:patid, key:fx_site);
562            end;
563        end;
10                                                                  The SAS System                                      10:38 Monday, November 5, 2018

564        /*is there trauma dx within 14 days*/
565        rc2=htrauma.find(key:patid);
566        do while (rc2 = 0) ;
567            if 0<=abs(trauma_dt-begin_date)<=14 then do;
568                    trauma="1";
569                    trauma_date=min(trauma_date,trauma_dt);
570           end ;
571           rc2=htrauma.find_next(key:patid) ;
572        end;
573        
574        run;

NOTE: There were 6799 observations read from the data set WORK.FX_PRCD.
NOTE: There were 13246 observations read from the data set WORK.FX_SPINE_XRAY.
NOTE: There were 2386 observations read from the data set WORK.FX_TRAUMA.
NOTE: There were 76759 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_4 has 76759 observations and 33 variables.
NOTE: DATA statement used (Total process time):
      real time           0.39 seconds
      cpu time            0.37 seconds
      

575        proc freq data=fx_dgns_4; tables enc_type*cq fx_site*cq trauma/missing;run;

                                                                  --- AS project ---                                10:38 Monday, November 5, 2018   2

                                                                  The FREQ Procedure

                                                               Table of ENC_TYPE by cq

                                       ENC_TYPE(Encounter Type)     cq

                                       Frequency|
                                       Percent  |
                                       Row Pct  |
                                       Col Pct  |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       AV       |  36475 |   5235 |   2291 |    416 |      0 |      0 |  44417
                                                |  47.52 |   6.82 |   2.98 |   0.54 |   0.00 |   0.00 |  57.87
                                                |  82.12 |  11.79 |   5.16 |   0.94 |   0.00 |   0.00 |
                                                |  65.22 |  68.63 |  48.74 |  87.21 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       ED       |   9419 |   1857 |   2378 |     61 |      0 |      0 |  13715
                                                |  12.27 |   2.42 |   3.10 |   0.08 |   0.00 |   0.00 |  17.87
                                                |  68.68 |  13.54 |  17.34 |   0.44 |   0.00 |   0.00 |
                                                |  16.84 |  24.34 |  50.60 |  12.79 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       HH       |   1080 |    116 |      2 |      0 |      0 |      0 |   1198
                                                |   1.41 |   0.15 |   0.00 |   0.00 |   0.00 |   0.00 |   1.56
                                                |  90.15 |   9.68 |   0.17 |   0.00 |   0.00 |   0.00 |
                                                |   1.93 |   1.52 |   0.04 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       IP       |      0 |      0 |      0 |      0 |   5386 |   2645 |   8031
                                                |   0.00 |   0.00 |   0.00 |   0.00 |   7.02 |   3.45 |  10.46
                                                |   0.00 |   0.00 |   0.00 |   0.00 |  67.07 |  32.93 |
                                                |   0.00 |   0.00 |   0.00 |   0.00 | 100.00 | 100.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       NH       |   8949 |    420 |     29 |      0 |      0 |      0 |   9398
                                                |  11.66 |   0.55 |   0.04 |   0.00 |   0.00 |   0.00 |  12.24
                                                |  95.22 |   4.47 |   0.31 |   0.00 |   0.00 |   0.00 |
                                                |  16.00 |   5.51 |   0.62 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       Total       55923     7628     4700      477     5386     2645    76759
                                                   72.86     9.94     6.12     0.62     7.02     3.45   100.00


 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                10:38 Monday, November 5, 2018   3

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (7331) pathologi |   1381 |      0 |      0 |      0 |     51 |     17 |   1449
                                   c nos/nec        |   1.80 |   0.00 |   0.00 |   0.00 |   0.07 |   0.02 |   1.89
                                                    |  95.31 |   0.00 |   0.00 |   0.00 |   3.52 |   1.17 |
                                                    |   2.47 |   0.00 |   0.00 |   0.00 |   0.95 |   0.64 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (800-804) skull/ |   1661 |      0 |    168 |      0 |    170 |     58 |   2057
                                   face             |   2.16 |   0.00 |   0.22 |   0.00 |   0.22 |   0.08 |   2.68
                                                    |  80.75 |   0.00 |   8.17 |   0.00 |   8.26 |   2.82 |
                                                    |   2.97 |   0.00 |   3.57 |   0.00 |   3.16 |   2.19 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (805, 806, 73313 |   8089 |   7628 |     39 |    477 |   1615 |    741 |  18589
                                   ) spine          |  10.54 |   9.94 |   0.05 |   0.62 |   2.10 |   0.97 |  24.22
                                                    |  43.51 |  41.04 |   0.21 |   2.57 |   8.69 |   3.99 |
                                                    |  14.46 | 100.00 |   0.83 | 100.00 |  29.99 |  28.02 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (807) rib/sternu |   3233 |      0 |    495 |      0 |    398 |    118 |   4244
                                   m/trachea        |   4.21 |   0.00 |   0.64 |   0.00 |   0.52 |   0.15 |   5.53
                                                    |  76.18 |   0.00 |  11.66 |   0.00 |   9.38 |   2.78 |
                                                    |   5.78 |   0.00 |  10.53 |   0.00 |   7.39 |   4.46 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (808) pelvis     |   3681 |      0 |    136 |      0 |    422 |    206 |   4445
                                                    |   4.80 |   0.00 |   0.18 |   0.00 |   0.55 |   0.27 |   5.79
                                                    |  82.81 |   0.00 |   3.06 |   0.00 |   9.49 |   4.63 |
                                                    |   6.58 |   0.00 |   2.89 |   0.00 |   7.84 |   7.79 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (809) trunk bone |     60 |      0 |      0 |      0 |      1 |      1 |     62
                                   s                |   0.08 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.08
                                                    |  96.77 |   0.00 |   0.00 |   0.00 |   1.61 |   1.61 |
                                                    |   0.11 |   0.00 |   0.00 |   0.00 |   0.02 |   0.04 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (810) clavicle   |    734 |      0 |    168 |      0 |     49 |      7 |    958
                                                    |   0.96 |   0.00 |   0.22 |   0.00 |   0.06 |   0.01 |   1.25
                                                    |  76.62 |   0.00 |  17.54 |   0.00 |   5.11 |   0.73 |
                                                    |   1.31 |   0.00 |   3.57 |   0.00 |   0.91 |   0.26 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (811) scapula    |    219 |      0 |     15 |      0 |     39 |      9 |    282
                                                    |   0.29 |   0.00 |   0.02 |   0.00 |   0.05 |   0.01 |   0.37
                                                    |  77.66 |   0.00 |   5.32 |   0.00 |  13.83 |   3.19 |
                                                    |   0.39 |   0.00 |   0.32 |   0.00 |   0.72 |   0.34 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               55923     7628     4700      477     5386     2645    76759
                                                       72.86     9.94     6.12     0.62     7.02     3.45   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                10:38 Monday, November 5, 2018   4

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (812, 73311) hum |   4697 |      0 |    528 |      0 |    301 |    145 |   5671
                                   erus             |   6.12 |   0.00 |   0.69 |   0.00 |   0.39 |   0.19 |   7.39
                                                    |  82.82 |   0.00 |   9.31 |   0.00 |   5.31 |   2.56 |
                                                    |   8.40 |   0.00 |  11.23 |   0.00 |   5.59 |   5.48 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (813, 73312) rad |   5204 |      0 |   1311 |      0 |    240 |     87 |   6842
                                   ius_ulna         |   6.78 |   0.00 |   1.71 |   0.00 |   0.31 |   0.11 |   8.91
                                                    |  76.06 |   0.00 |  19.16 |   0.00 |   3.51 |   1.27 |
                                                    |   9.31 |   0.00 |  27.89 |   0.00 |   4.46 |   3.29 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (814) carpal     |   1266 |      0 |     64 |      0 |     20 |      0 |   1350
                                                    |   1.65 |   0.00 |   0.08 |   0.00 |   0.03 |   0.00 |   1.76
                                                    |  93.78 |   0.00 |   4.74 |   0.00 |   1.48 |   0.00 |
                                                    |   2.26 |   0.00 |   1.36 |   0.00 |   0.37 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (815-817) hand/f |   2137 |      0 |    553 |      0 |     44 |      4 |   2738
                                   ingers           |   2.78 |   0.00 |   0.72 |   0.00 |   0.06 |   0.01 |   3.57
                                                    |  78.05 |   0.00 |  20.20 |   0.00 |   1.61 |   0.15 |
                                                    |   3.82 |   0.00 |  11.77 |   0.00 |   0.82 |   0.15 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (818-819) arms m |     55 |      0 |      0 |      0 |      1 |      0 |     56
                                   ult              |   0.07 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.07
                                                    |  98.21 |   0.00 |   0.00 |   0.00 |   1.79 |   0.00 |
                                                    |   0.10 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (820, 73314) hip |   7422 |      0 |    549 |      0 |   1265 |    855 |  10091
                                                    |   9.67 |   0.00 |   0.72 |   0.00 |   1.65 |   1.11 |  13.15
                                                    |  73.55 |   0.00 |   5.44 |   0.00 |  12.54 |   8.47 |
                                                    |  13.27 |   0.00 |  11.68 |   0.00 |  23.49 |  32.33 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (821, 73315) fem |   1825 |      0 |     93 |      0 |    172 |    121 |   2211
                                   ur               |   2.38 |   0.00 |   0.12 |   0.00 |   0.22 |   0.16 |   2.88
                                                    |  82.54 |   0.00 |   4.21 |   0.00 |   7.78 |   5.47 |
                                                    |   3.26 |   0.00 |   1.98 |   0.00 |   3.19 |   4.57 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (822) patella    |    975 |      0 |     74 |      0 |     74 |     36 |   1159
                                                    |   1.27 |   0.00 |   0.10 |   0.00 |   0.10 |   0.05 |   1.51
                                                    |  84.12 |   0.00 |   6.38 |   0.00 |   6.38 |   3.11 |
                                                    |   1.74 |   0.00 |   1.57 |   0.00 |   1.37 |   1.36 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               55923     7628     4700      477     5386     2645    76759
                                                       72.86     9.94     6.12     0.62     7.02     3.45   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                10:38 Monday, November 5, 2018   5

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (823, 73316) tib |   1553 |      0 |    152 |      0 |    131 |     65 |   1901
                                   _fib             |   2.02 |   0.00 |   0.20 |   0.00 |   0.17 |   0.08 |   2.48
                                                    |  81.69 |   0.00 |   8.00 |   0.00 |   6.89 |   3.42 |
                                                    |   2.78 |   0.00 |   3.23 |   0.00 |   2.43 |   2.46 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (824) ankle      |   3622 |      0 |    313 |      0 |    282 |    152 |   4369
                                                    |   4.72 |   0.00 |   0.41 |   0.00 |   0.37 |   0.20 |   5.69
                                                    |  82.90 |   0.00 |   7.16 |   0.00 |   6.45 |   3.48 |
                                                    |   6.48 |   0.00 |   6.66 |   0.00 |   5.24 |   5.75 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (825) tarsal_met |   5499 |      0 |     42 |      0 |     74 |     20 |   5635
                                   atarsal          |   7.16 |   0.00 |   0.05 |   0.00 |   0.10 |   0.03 |   7.34
                                                    |  97.59 |   0.00 |   0.75 |   0.00 |   1.31 |   0.35 |
                                                    |   9.83 |   0.00 |   0.89 |   0.00 |   1.37 |   0.76 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (826) foot_phala |   2102 |      0 |      0 |      0 |     20 |      3 |   2125
                                   nges             |   2.74 |   0.00 |   0.00 |   0.00 |   0.03 |   0.00 |   2.77
                                                    |  98.92 |   0.00 |   0.00 |   0.00 |   0.94 |   0.14 |
                                                    |   3.76 |   0.00 |   0.00 |   0.00 |   0.37 |   0.11 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (827) lower_limb |     48 |      0 |      0 |      0 |      1 |      0 |     49
                                                    |   0.06 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.06
                                                    |  97.96 |   0.00 |   0.00 |   0.00 |   2.04 |   0.00 |
                                                    |   0.09 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (828) legs+arm/r |      1 |      0 |      0 |      0 |      5 |      0 |      6
                                   ib               |   0.00 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   0.01
                                                    |  16.67 |   0.00 |   0.00 |   0.00 |  83.33 |   0.00 |
                                                    |   0.00 |   0.00 |   0.00 |   0.00 |   0.09 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (829) fx_nos     |    459 |      0 |      0 |      0 |     11 |      0 |    470
                                                    |   0.60 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   0.61
                                                    |  97.66 |   0.00 |   0.00 |   0.00 |   2.34 |   0.00 |
                                                    |   0.82 |   0.00 |   0.00 |   0.00 |   0.20 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               55923     7628     4700      477     5386     2645    76759
                                                       72.86     9.94     6.12     0.62     7.02     3.45   100.00


                                                                                Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                                          66680       86.87         66680        86.87  
                                             1            10079       13.13         76759       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 76759 observations read from the data set WORK.FX_DGNS_4.
NOTE: The PROCEDURE FREQ printed pages 2-5.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.35 seconds
      cpu time            0.23 seconds
      

576        
577        *goto 002_fx_epi.sas;
578        
579        
580        
581        
582        /*
583        START OF 002_fx_data.sas
584         */
585        
586        /*all the claims to define episode sequence */
587        data _dat0(keep=
588        PATID ENCOUNTERID ADMIT_DATE DISCHARGE_DATE BEGIN_DATE END_DATE DX DX_TYPE PDX  /* SOURCE */ ENC_TYPE fx_site px px_date
589        site cq spine_image trauma_date trauma );
590        set fx_dgns_4 fx_excare Fx_prcd(rename=tx_site=fx_site);
591        run;

NOTE: There were 76759 observations read from the data set WORK.FX_DGNS_4.
NOTE: There were 10812 observations read from the data set WORK.FX_EXCARE.
NOTE: There were 6799 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK._DAT0 has 94370 observations and 18 variables.
NOTE: DATA statement used (Total process time):
      real time           0.15 seconds
      cpu time            0.12 seconds
      

592        proc sort data=_dat0; by PATID fx_site BEGIN_DATE END_DATE; run;

NOTE: There were 94370 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT0 has 94370 observations and 18 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.20 seconds
      cpu time            0.17 seconds
      

593        /*for each claim define start and end date applicable to IP NH and NH*/
594        data _dat1;
595        set _dat0;
596        length start_date end_date 4;
597        format start_date end_date mmddyy10.;
598        by PATID fx_site BEGIN_DATE END_DATE;
11                                                                  The SAS System                                      10:38 Monday, November 5, 2018

599        start_date=min(ADMIT_DATE, BEGIN_DATE);
600        end_date=max(DISCHARGE_DATE, End_DATE);
601        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      323 at 599:12   
NOTE: There were 94370 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT1 has 94370 observations and 19 variables.
NOTE: DATA statement used (Total process time):
      real time           0.15 seconds
      cpu time            0.12 seconds
      

602        proc sort data=_dat1; by PATID fx_site start_date end_date; run;

NOTE: There were 94370 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT1 has 94370 observations and 19 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.20 seconds
      cpu time            0.14 seconds
      

603        
604        /* generate unique episode sequence ID */
605        data _dat2(drop=end_date_max lag_end_date_max _gap);
606        set _dat1;
607        length lag_end_date_max end_date_max 4;
608        format lag_end_date_max end_date_max mmddyy10.;
609        
610        by PATID fx_site start_date end_date;
611        retain seq 0;
612        
613        /*if current claims end date > all previouse claim end date in sequence, then update*/
614        end_date_max=max(end_date,end_date_max);
615        lag_end_date_max=lag(end_date_max);
616        
617        if first.fx_site then lag_end_date_max=.;
618        _gap=start_date-lag_end_date_max;
619        
620        /*if current claims start date >90 days after all previouse claim end date in sequence,
621        then start new sequence*/
622        if first.fx_site or start_date-lag_end_date_max>90 then do;
623            end_date_max=end_date;
624        
625            seq+1;
626        end;
627        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      10539 at 618:16   10539 at 622:31   
NOTE: There were 94370 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT2 has 94370 observations and 20 variables.
NOTE: DATA statement used (Total process time):
      real time           0.17 seconds
      cpu time            0.14 seconds
      

628        proc sort data=_dat2; by seq;run;

NOTE: There were 94370 observations read from the data set WORK._DAT2.
NOTE: The data set WORK._DAT2 has 94370 observations and 20 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.18 seconds
      cpu time            0.14 seconds
      

629        proc sql;
630        /*episode sequence start date*/
631        create table seq_start as
632        select patid, seq, min(start_date) as seq_start_date length=4 format=mmddyy10.
12                                                                  The SAS System                                      10:38 Monday, November 5, 2018

633         from _dat2
634         where substr(dx,1,4) not in ('V541' 'V542')
635         group by patid, seq
636         order by patid, seq;
NOTE: Table WORK.SEQ_START created, with 11339 rows and 3 columns.

637        /*episode sequence end date*/
638        create table seq_end as
639        select patid, seq,
640         max(start_date) as seq_end_date length=4 format=mmddyy10. from _dat2
641         group by patid, seq
642         order by patid, seq;
NOTE: Table WORK.SEQ_END created, with 13207 rows and 3 columns.

643        quit;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.37 seconds
      cpu time            0.43 seconds
      

644        /*episode sequence case qualifier indicator and trauma*/
645        data seq_cq(keep=patid seq seq_cq seq_trauma fx_site);
646        set _dat2;
647        by patid seq;
648        length seq_cq $4 seq_trauma $1;
649        retain seq_cq seq_trauma;
650        if first.seq then do;
651            seq_cq="0000";
652            seq_trauma="0";
653        end;
654        if trauma="1" then seq_trauma=trauma;
655        do i=1 to 4;
656        if substr(cq,i,1)>substr(seq_cq,i,1) then substr(seq_cq,i,1)=substr(cq,i,1);
657        end;
658        if last.seq then output;
659        run;

NOTE: There were 94370 observations read from the data set WORK._DAT2.
NOTE: The data set WORK.SEQ_CQ has 13207 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.13 seconds
      cpu time            0.10 seconds
      

660        proc freq data=seq_cq; tables seq_cq seq_trauma fx_site; run;

                                                                  --- AS project ---                                10:38 Monday, November 5, 2018   6

                                                                  The FREQ Procedure

                                                                                Cumulative    Cumulative
                                             seq_cq    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0000          9450       71.55          9450        71.55  
                                             0004           840        6.36         10290        77.91  
                                             0030           772        5.85         11062        83.76  
                                             0034            58        0.44         11120        84.20  
                                             0200           670        5.07         11790        89.27  
                                             0204            66        0.50         11856        89.77  
                                             0230            50        0.38         11906        90.15  
                                             0234             3        0.02         11909        90.17  
                                             1000           240        1.82         12149        91.99  
                                             1004            51        0.39         12200        92.38  
                                             1030            37        0.28         12237        92.66  
                                             1034             2        0.02         12239        92.67  
                                             1200           629        4.76         12868        97.43  
                                             1204           178        1.35         13046        98.78  
                                             1230           149        1.13         13195        99.91  
                                             1234            12        0.09         13207       100.00  


                                             seq_                               Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0            11854       89.76         11854        89.76  
                                             1             1353       10.24         13207       100.00  


                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec         460        3.48           460         3.48  
                                    (800-804) skull/face              332        2.51           792         6.00  
                                    (805, 806, 73313) spine          2632       19.93          3424        25.93  
                                    (807) rib/sternum/trachea         727        5.50          4151        31.43  
                                    (808) pelvis                      426        3.23          4577        34.66  
                                    (809) trunk bones                  21        0.16          4598        34.81  
                                    (810) clavicle                    162        1.23          4760        36.04  
                                    (811) scapula                      63        0.48          4823        36.52  
                                    (812, 73311) humerus              583        4.41          5406        40.93  
                                    (813, 73312) radius_ulna          858        6.50          6264        47.43  
                                    (814) carpal                      340        2.57          6604        50.00  
                                    (815-817) hand/fingers            485        3.67          7089        53.68  
                                    (818-819) arms mult                20        0.15          7109        53.83  
                                    (820, 73314) hip                 1711       12.96          8820        66.78  
                                    (821, 73315) femur                581        4.40          9401        71.18  
                                    (822) patella                     331        2.51          9732        73.69  
                                    (823, 73316) tib_fib              343        2.60         10075        76.29  
                                    (824) ankle                       566        4.29         10641        80.57  
                                    (825) tarsal_metatarsal           831        6.29         11472        86.86  
                                    (826) foot_phalanges              479        3.63         11951        90.49  
                                    (827) lower_limb                   11        0.08         11962        90.57  
                                    (828) legs+arm/rib                  4        0.03         11966        90.60  
                                    (829) fx_nos                     1241        9.40         13207       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 13207 observations read from the data set WORK.SEQ_CQ.
NOTE: The PROCEDURE FREQ printed page 6.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.10 seconds
      cpu time            0.06 seconds
      

661        
662        data seq_cq_date;
663        merge seq_cq seq_start seq_end;
664        by patid seq;
665        length site_order $1;
666        if fx_site='(820, 73314) hip' then site_order='1';
667        if fx_site='(821, 73315) femur' then site_order='2';
668        if fx_site='(808) pelvis' then site_order='3';
669        if fx_site='(805, 806, 73313) spine' then site_order='4';
670        if fx_site='(812, 73311) humerus' then site_order='5';
671        if fx_site='(813, 73312) radius_ulna' then site_order='6';
672        if fx_site='(823, 73316) tib_fib' then site_order='7';
673        if fx_site='(824) ankle' then site_order='8';
674        if fx_site='(810) clavicle' then site_order='9';
675        run;

NOTE: There were 13207 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 11339 observations read from the data set WORK.SEQ_START.
NOTE: There were 13207 observations read from the data set WORK.SEQ_END.
13                                                                  The SAS System                                      10:38 Monday, November 5, 2018

NOTE: The data set WORK.SEQ_CQ_DATE has 13207 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.03 seconds
      

676        
677        data _tmp_combo;
678        set seq_cq_date;
679        where site_order^=" " and seq_cq^="0000" and seq_cq^=" ";
680        run;

NOTE: There were 3065 observations read from the data set WORK.SEQ_CQ_DATE.
      WHERE (site_order not = ' ') and seq_cq not in (' ', '0000');
NOTE: The data set WORK._TMP_COMBO has 3065 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
      

681        
682        * define combo or alone fx;
683        data seq_COMBO(
684        keep=patid seq seq_cq seq_start_date alone_combo fx_site site_order)
685        ;
686        if _n_=1 then do;
687            declare hash hpid(dataset:"_tmp_combo(where=(seq_cq^='0000' and seq_cq^=' ')
688                    rename=(seq_start_date=seq_start_date2  fx_site= fx_site_combo seq=seq_COMBO))", ordered: 'a', multidata:"Y");
689            rc=hpid.defineKey("patid");
690            rc=hpid.defineData("patid","seq_start_date2", "fx_site_combo", "seq_COMBO");
691            rc=hpid.defineDone();
692        end;
693        if 0 then set _tmp_combo(rename=(seq_start_date=seq_start_date2 fx_site= fx_site_combo seq=seq_COMBO));
694        set _tmp_combo(where=(seq_cq^="0000" and seq_cq^=" ") );
695        by patid seq;
696        length  index_fx_begin 4 alone_combo $5;
697        alone_combo="alone";
698            format index_fx_begin mmddyy10.;
699            index_fx_begin=seq_start_date;
700        
701         rc=hpid.find(key:patid);
702        
703         do while (rc = 0);
704         if rc=0 and abs(seq_start_date-seq_start_date2) <=30 and fx_site_combo^=fx_site then alone_combo= 'combo';
705         rc=hpid.find_next();
706         *hpid.has_next(result:r);
707        end;
708        if alone_combo="alone" then do;
709            seq_start_date2=.; fx_site_combo=" "; seq_COMBO=.;
710        end;
711        run;

NOTE: There were 3065 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: There were 3065 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.SEQ_COMBO has 3065 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.04 seconds
      

712        proc freq data=seq_COMBO; tables alone_combo; run;

                                                                  --- AS project ---                                10:38 Monday, November 5, 2018   7

                                                                  The FREQ Procedure

                                             alone_                             Cumulative    Cumulative
                                             combo     Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             alone         2656       86.66          2656        86.66  
                                             combo          409       13.34          3065       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 3065 observations read from the data set WORK.SEQ_COMBO.
NOTE: The PROCEDURE FREQ printed page 7.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.07 seconds
      cpu time            0.00 seconds
      

713        
14                                                                  The SAS System                                      10:38 Monday, November 5, 2018

714        proc sort data = Work.seq_COMBO;
715          by patid seq_start_date;
716        run;

NOTE: There were 3065 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 3065 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.06 seconds
      cpu time            0.01 seconds
      

717        
718        data combo_seq;
719        set seq_COMBO;
720        by patid seq_start_date;
721        length combo_fx_site $30. combo_seq 4;
722        retain combo_seq 0 combo_fx_site;
723        if first.patid or seq_start_date-lag(seq_start_date) then combo_seq=1+combo_seq;
724        where seq_cq^='0000' and seq_cq^=' ';
725        if combo_fx_site=" " or ""<site_order<lag(site_order) then combo_fx_site=fx_site;
726        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      1 at 723:33   
NOTE: There were 3065 observations read from the data set WORK.SEQ_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.COMBO_SEQ has 3065 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

727        
728        proc sort data = Work.seq_COMBO;
729          by patid seq;
730        run;

NOTE: There were 3065 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 3065 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.06 seconds
      cpu time            0.01 seconds
      

731        
732        data FX_CLM_DB;
733        merge _dat2 seq_start seq_end seq_cq(drop=fx_site) seq_COMBO(keep=patid seq alone_combo);
734        by patid seq;
735        run;

NOTE: There were 94370 observations read from the data set WORK._DAT2.
NOTE: There were 11339 observations read from the data set WORK.SEQ_START.
NOTE: There were 13207 observations read from the data set WORK.SEQ_END.
NOTE: There were 13207 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 3065 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.FX_CLM_DB has 94370 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           0.25 seconds
      cpu time            0.23 seconds
      

736        
737        proc sql;
738        select count(distinct seq) from FX_CLM_DB;
                                                                  --- AS project ---                                10:38 Monday, November 5, 2018   8

                                                                               
                                                                       --------
                                                                          13207
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
739        quit;
NOTE: The PROCEDURE SQL printed page 8.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.15 seconds
      cpu time            0.12 seconds
      

15                                                                  The SAS System                                      10:38 Monday, November 5, 2018

740        
741        
742        
743        
744        /*
745        Collapse to fracture episodes
746        
747        Q: Why are some seq_start_date values missing?
748         */
749        proc sort
750          data = Work.fx_clm_db
751          out = Work.fractureEpisodes (drop = seq
752                                       rename = (seq_start_date = fractureEpisodeStart
753                                                 seq_end_date = fractureEpisodeEnd
754                                                 fx_site = fractureSite))
755          nodupkey;
756          by patid seq seq_start_date seq_end_date fx_site;
757        run;

NOTE: There were 94370 observations read from the data set WORK.FX_CLM_DB.
NOTE: 81163 observations with duplicate key values were deleted.
NOTE: The data set WORK.FRACTUREEPISODES has 13207 observations and 24 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.18 seconds
      cpu time            0.15 seconds
      

758        
759        proc sql;
760          create table DT.fractureEpisodesPrev as
761            select A.database,
762                   A.exposure,
763                   A.indexGNN,
764                   A.indexDate,
765                   A.ASCohortDate,
766                   A.indexID,
767                   A.age,
768                   A.sex,
769                   B.*,
770                   case
771                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
772                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
773                     else ""
774                     end as fractureType
775            from DT.indexLookup A inner join
776                 Work.fractureEpisodes B on (A.patid = B.patid);
NOTE: Table DT.FRACTUREEPISODESPREV created, with 23199 rows and 33 columns.

777          create table Work.summaryFractureEpisodesPrev as
778            select "DT.fractureEpisodesPrev" as table,
779                   fractureType, fractureSite,
780                   count(distinct patid) as countDistinctPatid,
781                   count(*) as countFractureEpisodes
782            from DT.fractureEpisodesPrev
783            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESPREV created, with 23 rows and 5 columns.

784          select * from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                                10:38 Monday, November 5, 2018   9

                                                                                                                    count         count
                                                                                                                 Distinct      Fracture
               table                    fractureType                         fractureSite                           Patid      Episodes
               ------------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesPrev                                       (7331) pathologic nos/nec                371           877
               DT.fractureEpisodesPrev                                       (800-804) skull/face                     308           542
               DT.fractureEpisodesPrev                                       (807) rib/sternum/trachea                653          1252
               DT.fractureEpisodesPrev                                       (809) trunk bones                         18            38
               DT.fractureEpisodesPrev                                       (810) clavicle                           151           267
               DT.fractureEpisodesPrev                                       (811) scapula                             61            98
               DT.fractureEpisodesPrev                                       (814) carpal                             318           603
               DT.fractureEpisodesPrev                                       (815-817) hand/fingers                   447           790
               DT.fractureEpisodesPrev                                       (818-819) arms mult                       20            33
               DT.fractureEpisodesPrev                                       (822) patella                            284           571
               DT.fractureEpisodesPrev                                       (823, 73316) tib_fib                     305           596
               DT.fractureEpisodesPrev                                       (824) ankle                              470          1002
               DT.fractureEpisodesPrev                                       (825) tarsal_metatarsal                  690          1498
               DT.fractureEpisodesPrev                                       (826) foot_phalanges                     447           836
               DT.fractureEpisodesPrev                                       (827) lower_limb                          11            17
               DT.fractureEpisodesPrev                                       (828) legs+arm/rib                         4             6
               DT.fractureEpisodesPrev                                       (829) fx_nos                            1033          2199
               DT.fractureEpisodesPrev  Clinical vertebral fracture          (805, 806, 73313) spine                 1596          4717
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (808) pelvis                             350           755
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (812, 73311) humerus                     465          1008
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                 698          1503
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (820, 73314) hip                        1338          2951
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (821, 73315) femur                       466          1040
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
785          select "DT.fractureEpisodesPrev" as table,
786                 sum(countDistinctPatid) as sumDistinctPatid,
787                 sum(countFractureEpisodes) as sumFractureEpisodes
788            from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                                10:38 Monday, November 5, 2018  10

                                                                           sumDistinct   sumFracture
                                                 table                           Patid      Episodes
                                                 ---------------------------------------------------
                                                 DT.fractureEpisodesPrev         10504         23199
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
789        
790          create table DT.fractureEpisodesInc as
791            select A.database,
792                   A.ENR_END_DATE,
793                   A.DEATH_DATE,
794                   A.exposure,
795                   A.exposureStart,
796                   A.exposureEnd,
797                   A.daysExposed,
798                   A.exposureID,
16                                                                  The SAS System                                      10:38 Monday, November 5, 2018

799                   B.*,
800                   case
801                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
802                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
803                     else ""
804                     end as fractureType
805            from DT.exposureTimeline A inner join
806                 Work.fractureEpisodes B on (A.patid = B.patid  & A.exposureStart <= B.fractureEpisodeStart <= A.exposureEnd);
NOTE: Table DT.FRACTUREEPISODESINC created, with 3687 rows and 33 columns.

807          create table Work.summaryFractureEpisodesInc as
808            select "DT.fractureEpisodesInc" as table,
809                   fractureType, fractureSite,
810                   count(distinct patid) as countDistinctPatid,
811                   count(*) as countFractureEpisodes
812            from DT.fractureEpisodesInc
813            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESINC created, with 23 rows and 5 columns.

814          select * from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                                10:38 Monday, November 5, 2018  11

                                                                                                                   count         count
                                                                                                                Distinct      Fracture
               table                   fractureType                         fractureSite                           Patid      Episodes
               -----------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesInc                                       (7331) pathologic nos/nec                 77            87
               DT.fractureEpisodesInc                                       (800-804) skull/face                      91            95
               DT.fractureEpisodesInc                                       (807) rib/sternum/trachea                257           286
               DT.fractureEpisodesInc                                       (809) trunk bones                          6             6
               DT.fractureEpisodesInc                                       (810) clavicle                            46            49
               DT.fractureEpisodesInc                                       (811) scapula                             20            22
               DT.fractureEpisodesInc                                       (814) carpal                              68            70
               DT.fractureEpisodesInc                                       (815-817) hand/fingers                   134           141
               DT.fractureEpisodesInc                                       (818-819) arms mult                        5             5
               DT.fractureEpisodesInc                                       (822) patella                             44            50
               DT.fractureEpisodesInc                                       (823, 73316) tib_fib                      62            69
               DT.fractureEpisodesInc                                       (824) ankle                              117           141
               DT.fractureEpisodesInc                                       (825) tarsal_metatarsal                  210           236
               DT.fractureEpisodesInc                                       (826) foot_phalanges                     132           136
               DT.fractureEpisodesInc                                       (827) lower_limb                           2             2
               DT.fractureEpisodesInc                                       (828) legs+arm/rib                         2             2
               DT.fractureEpisodesInc                                       (829) fx_nos                              51            54
               DT.fractureEpisodesInc  Clinical vertebral fracture          (805, 806, 73313) spine                  652           882
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (808) pelvis                             123           132
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (812, 73311) humerus                     153           175
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                 236           275
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (820, 73314) hip                         489           560
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (821, 73315) femur                       190           212
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
815          select "DT.fractureEpisodesInc" as table,
816                 sum(countDistinctPatid) as sumDistinctPatid,
817                 sum(countFractureEpisodes) as sumFractureEpisodes
818            from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                                10:38 Monday, November 5, 2018  12

                                                                           sumDistinct   sumFracture
                                                  table                          Patid      Episodes
                                                  --------------------------------------------------
                                                  DT.fractureEpisodesInc          3167          3687
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
819        quit;
NOTE: The PROCEDURE SQL printed pages 9-12.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.70 seconds
      cpu time            0.54 seconds
      

820        
821        
822        
823        
824        /*
825        CLEAN UP
826        
827        proc sql;
828          drop table UCB64.tempFracDxMPCD;
829          drop table UCB64.tempFracDxUCB;
830          drop table UCB64.tempFracDxSABR;
831          drop table UCB64.tempFracPxMPCD;
832          drop table UCB64.tempFracPxUCB;
833          drop table UCB64.tempFracPxSABR;
834        quit;
835         */
836        
837        
838        proc export
839          data = Work.summaryFractureEpisodesInc
840          outfile = "data\processed\&cmt..csv"
841          dbms = csv
842          replace;
843          delimiter = '09'x;
844        run;

845         /**********************************************************************
846         *   PRODUCT:   SAS
847         *   VERSION:   9.4
848         *   CREATOR:   External File Interface
849         *   DATE:      05NOV18
850         *   DESC:      Generated SAS Datastep Code
851         *   TEMPLATE SOURCE:  (None Specified.)
852         ***********************************************************************/
853            data _null_;
854            %let _EFIERR_ = 0; /* set the ERROR detection macro variable */
855            %let _EFIREC_ = 0;     /* clear export record count macro variable */
856            file 'data\processed\queryFractures.csv' delimiter='09'x DSD DROPOVER lrecl=32767;
857            if _n_ = 1 then        /* write column names or labels */
858             do;
859               put
17                                                                  The SAS System                                      10:38 Monday, November 5, 2018

860                  "table"
861               '09'x
862                  "fractureType"
863               '09'x
864                  "fractureSite"
865               '09'x
866                  "countDistinctPatid"
867               '09'x
868                  "countFractureEpisodes"
869               ;
870             end;
871           set  WORK.SUMMARYFRACTUREEPISODESINC   end=EFIEOD;
872               format table $22. ;
873               format fractureType $35. ;
874               format fractureSite $30. ;
875               format countDistinctPatid best12. ;
876               format countFractureEpisodes best12. ;
877             do;
878               EFIOUT + 1;
879               put table $ @;
880               put fractureType $ @;
881               put fractureSite $ @;
882               put countDistinctPatid @;
883               put countFractureEpisodes ;
884               ;
885             end;
886            if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable */
887            if EFIEOD then call symputx('_EFIREC_',EFIOUT);
888            run;

NOTE: The file 'data\processed\queryFractures.csv' is:
      Filename=U:\studies\AS\pgms\bchan\data\processed\queryFractures.csv,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=05Nov2018:10:39:17,
      Create Time=05Nov2018:10:39:17

NOTE: 24 records were written to the file 'data\processed\queryFractures.csv'.
      The minimum record length was 42.
      The maximum record length was 91.
NOTE: There were 23 observations read from the data set WORK.SUMMARYFRACTUREEPISODESINC.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.01 seconds
      

23 records created in data\processed\queryFractures.csv from WORK.SUMMARYFRACTUREEPISODESINC.
  
  
NOTE: "data\processed\queryFractures.csv" file was successfully created.
NOTE: PROCEDURE EXPORT used (Total process time):
      real time           0.24 seconds
      cpu time            0.15 seconds
      

889        
890        
891        ods html close;
NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           55.79 seconds
      cpu time            39.81 seconds
      
