1                                                          The SAS System                          09:21 Thursday, September 7, 2017

NOTE: Copyright (c) 2002-2012 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M1) 
      Licensed to UNIVERSITY OF ALABAMA AT BIRMINGHAM - SFA - T&R, Site 70058223.
NOTE: This session is executing on the W32_ES08R2  platform.



NOTE: Updated analytical products:
      
      SAS/STAT 13.1
      SAS/ETS 13.1
      SAS/OR 13.1
      SAS/IML 13.1
      SAS/QC 13.1

NOTE: Additional host information:

 W32_ES08R2 WIN 6.1.7601 Service Pack 1 Server

--- PEER News and Updates ---

: SECURITY REMINDER :
Please remember not to copy any data files that contain PHI (protected health identifiers) to any of the shared folders.

 


NOTE: SAS initialization used:
      real time           0.17 seconds
      cpu time            0.10 seconds
      
1          *  University of Alabama at Birmingham                               *
2          *  AS project                                            *
3          **********************************************************************;
4          options pagesize=74 linesize=150 pageno=1 missing=' ' date FORMCHAR="|----|+|---+=|-/\<>*";
5          * Programmer    : Benjamin Chan <chanb@ohsu.edu>
6          * Creation date :
7          * Modify date   :
8          ;
9          %let cmt=queryFractures; * type the name of your program here (without the filename extension);
10         %let pgm=&cmt..sas;
11         %include "lib\libname.sas" ;
NOTE: Libref CCW5STD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: h:\studies\osteo\data\CDM\5pct\
NOTE: Libref STD_SABR was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\data\std_SABER\
NOTE: Libref MPSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: h:\studies\mpcd\data\stddata\
NOTE: Libref UCBSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\stddata\
NOTE: Libref UCB was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB\
NOTE: Libref DT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: V:\studies\AS\data
89         footnote "&pgm.";
90         * footnote2 "%sysfunc(datetime(),datetime14.)";
91         title1 '--- AS project ---';
92         **********************************************************************;
93         options macrogen mlogic mprint symbolgen;
94         options nomacrogen nomlogic nomprint nosymbolgen;
95         
96         
97         ods html
98           body = "output\&cmt..html"
99           style = Statistical;
NOTE: Writing HTML Body file: output\queryFractures.html
2                                                                   The SAS System                                   09:21 Thursday, September 7, 2017

100        
101        
102        /*
103        FRACTURES
104        
105        See "ALGORITHMS TO ENHANCE SPECIFICITY OF FRACTURE IDENTIFICATION_ 100316.docx"
106        
107        Adapted from Lang's code in "001_fx_data.sas"
108        
109        
110        From: Chen, Lang [mailto:langchen@uabmc.edu]
111        Sent: Monday, July 24, 2017 8:56 AM
112        To: Benjamin Chan <chanb@ohsu.edu>
113        Subject: RE: fracture identification algorithm
114        
115        Here it is.
116        For 001_fx_data, find all fx related claim and run the algorithm.
117        Please ignore any code after line 476
118        Modify code from line 1 -50
119        
120        For 002_fx_epi_data
121        Define fx episode.
122        
123        Final output data is fx_dgns_&firstyr._&lastyr._4. Please let me if you have any questions.
124         */
125        
126        
127        /*
128        START OF 001_fx_data.sas
129         */
130        
131        
132        /*Assign "Broad" fracture site (fx_site) for all ICD9 diagnoses, outputting separately, so some records are cloned, then combining into one
132      !  file */
133        /*No longer using matched trauma files here*/
134        
135        %macro comballfxdgns;
136            data fx_dgns;
137                set UCB.tempFracDxMPCD (where = (diagCodeType = "Fracture code"))
138                    UCB.tempFracDxUCB (where = (diagCodeType = "Fracture code"))
139                    UCB.tempFracDxSABR (where = (diagCodeType = "Fracture code"));
140                    length fx_site $30 ;
141                    fx_site = '';
142                    if strip(DX) in: ('800' '801' '802' '803' '804') then           do; fx_site='(800-804) skull/face'; output; end;
143                    if strip(DX) in: ('805', '806') or strip(DX)='73313' then       do; fx_site='(805, 806, 73313) spine'; output; end;
144                    if strip(DX) in: ('807') then                                           do; fx_site='(807) rib/sternum/trachea'; output; end;
145                    if strip(DX) in: ('808') then                                           do; fx_site='(808) pelvis'; output; end;
146                    if strip(DX) in: ('809') then                                           do; fx_site='(809) trunk bones'; output; end;
147                    if strip(DX) in: ('810') then                                           do; fx_site='(810) clavicle'; output; end;
148                    if strip(DX) in: ('811') then                                           do; fx_site='(811) scapula'; output; end;
149                    if strip(DX) in: ('812') or strip(DX)='73311' then              do; fx_site='(812, 73311) humerus'; output; end;
150                    if strip(DX) in: ('813') or strip(DX)='73312' then              do; fx_site='(813, 73312) radius_ulna'; output; end;
151                    if strip(DX) in: ('814') then                                           do; fx_site='(814) carpal'; output; end;
152                    if strip(DX) in: ('815' '816' '817') then                           do; fx_site='(815-817) hand/fingers'; output; end;
153                    if strip(DX) in: ('818' '819') then                                     do; fx_site='(818-819) arms mult'; output; end;
154                    if strip(DX) in: ('820') or strip(DX) = '73314' then                do; fx_site='(820, 73314) hip'; output; end;
155                    if strip(DX) in: ('821') or strip(DX)='73315' then              do; fx_site='(821, 73315) femur'; output; end;
156                    if strip(DX) in: ('822') then                                           do; fx_site='(822) patella'; output; end;
157                    if strip(DX) in: ('823') or strip(DX)='73316' then              do; fx_site='(823, 73316) tib_fib'; output; end;
158                    if strip(DX) in: ('824') then                                           do; fx_site='(824) ankle'; output; end;
159                    if strip(DX) in: ('825') then                                           do; fx_site='(825) tarsal_metatarsal'; output; end;
160                    if strip(DX) in: ('826') then                                           do; fx_site='(826) foot_phalanges'; output; end;
161                    if strip(DX) in: ('827') then                                           do; fx_site='(827) lower_limb'; output; end;
162                    if strip(DX) in: ('828') then                                           do; fx_site='(828) legs+arm/rib'; output; end;
163                    if strip(DX) in: ('829') then                                           do; fx_site='(829) fx_nos'; output; end;
164                    if strip(DX) in ('73310' '73319' '7331') then                 do; fx_site='(7331) pathologic nos/nec'; output; end;
165            data fx_excare;
166                set UCB.tempFracDxMPCD (where = (diagCodeType = "Extended care code"))
167                    UCB.tempFracDxUCB (where = (diagCodeType = "Extended care code"))
168                    UCB.tempFracDxSABR (where = (diagCodeType = "Extended care code"));
169                    length fx_site $30 ;
170                    fx_site = '';
3                                                                   The SAS System                                   09:21 Thursday, September 7, 2017

171                    /*Expanded Diagnosis Codes - Fracture Aftercare Codes*/
172                    if strip(DX) in ('V5410' 'V5420') then                          do; fx_site='(812, 73311) humerus'; output;
173                                                                                                     fx_site='(813, 73312) radius_ulna'; output;
173      ! end;
174                    if strip(DX) in ('V5411' 'V5421') then                          do; fx_site='(812, 73311) humerus'; output; end;
175                    if strip(DX) in ('V5412' 'V5422') then                          do; fx_site='(813, 73312) radius_ulna'; output;
176                                                                                                     fx_site='(814) carpal'; output; end;
177                    if strip(DX) in ('V5413' 'V5423') then                          do; fx_site='(820, 73314) hip'; output; end;
178                    if strip(DX) in ('V5414' 'V5424') then                          do; fx_site='(820, 73314) hip'; output;
179                                                                                                     fx_site='(821, 73315) femur'; output;
180                                                                                                     fx_site='(822) patella'; output;
181                                                                                                     fx_site='(824) ankle'; output;
182                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
183                    if strip(DX) in ('V5415' 'V5425') then                          do; fx_site='(820, 73314) hip'; output;
184                                                                                                     fx_site='(821, 73315) femur'; output;
185                                                                                                     fx_site='(822) patella'; output; end;
186                    if strip(DX) in ('V5416' 'V5426') then                          do; fx_site='(824) ankle'; output;
187                                                                                                     fx_site='(822) patella'; output;
188                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
189                    if strip(DX) in ('V5417' 'V5427') then                          do; fx_site='(805, 806, 73313) spine'; output; end;
190                    if strip(DX) in: ('V542') then                                       do; fx_site='(7331) pathologic nos/nec'; output; end;
191                    if strip(DX) in: ('V541') then                                       do; fx_site='(829) fx_nos'; output; end;
192            run;
193        
194            /* proc sort data=fx_dgns; by patid BEGIN_DATE fx_site; run;
195            proc sort data=fx_excare; by patid BEGIN_DATE fx_site; run; */
196        %mend;
197        %comballfxdgns;

WARNING: Multiple lengths were specified for the variable ADMIT_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable BEGIN_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DISCHARGE_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable END_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DX by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable PDX by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable code by input data set(s). This can cause truncation of data.
NOTE: There were 2227 observations read from the data set UCB.TEMPFRACDXMPCD.
      WHERE diagCodeType='Fracture code';
NOTE: There were 6049 observations read from the data set UCB.TEMPFRACDXUCB.
      WHERE diagCodeType='Fracture code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: There were 267267 observations read from the data set UCB.TEMPFRACDXSABR.
      WHERE diagCodeType='Fracture code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_DGNS has 275543 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           1.71 seconds
      cpu time            0.85 seconds
      


WARNING: Multiple lengths were specified for the variable ADMIT_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable BEGIN_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DISCHARGE_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable END_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DX by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable PDX by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable code by input data set(s). This can cause truncation of data.
NOTE: There were 20 observations read from the data set UCB.TEMPFRACDXMPCD.
      WHERE diagCodeType='Extended care code';
NOTE: There were 312 observations read from the data set UCB.TEMPFRACDXUCB.
      WHERE diagCodeType='Extended care code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: There were 18934 observations read from the data set UCB.TEMPFRACDXSABR.
      WHERE diagCodeType='Extended care code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_EXCARE has 43288 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.17 seconds
      cpu time            0.12 seconds
      

4                                                                   The SAS System                                   09:21 Thursday, September 7, 2017

198        
199        /*Now, assign a more specific fracture site (e.g., closed, other) (site) that is used in the CQ algorithms*/
200        /*Since Expanded Diagnosis Codes (V Codes) apply to sub-categories of each broad fracture site, clone records for these so they appear in
200      ! both places*/
201        
202        data fx_dgns_2;
203            set fx_dgns;
204        
205            length site $30;
206        
207            site="";
208        
209            *Spine-closed and Spine-other;
210            if fx_site='(805, 806, 73313) spine' then
211                do;
212                    site = 'spine_cls'; /*Includes V Codes and 73313 here*/
213                    if substr(strip(DX),1,3) in ('805' '806') and substr(strip(DX),1,4) ^in ('8050', '8052', '8054', '8058') then
214                        site = 'spine_oth';
215                end;
216        
217            *Pelvis-closed and Pelvis-other... No V Codes;
218            if fx_site='(808) pelvis' then
219                do;
220                    site = 'pelvis_cls';
221                    if substr(strip(DX),1,3)='808' and substr(strip(DX),1,4) ^in ('8080', '8082', '8084', '8088') then
222                        site = 'pelvis_oth';
223                end;
224        
225            *Clavicle-closed and Clavicle-other.... No V Codes;
226            if fx_site='(810) clavicle' then
227                do;
228                    site = 'clv_cls';
229                    if substr(strip(DX),1,3) = '810' and substr(strip(DX),1,4) ^in ('8100') then
230                        site = 'clv_oth';
231                end;
232        
233            *Humerus-closed and Humerus-other;
234            if fx_site='(812, 73311) humerus' then
235                do;
236                    site = 'hmrs_cls'; /*Includes V Codes and 73311 here*/
237                    if substr(strip(DX),1,3)= '812' and substr(strip(DX),1,4) ^in ('8120', '8122', '8124') then
238                        site = 'hmrs_oth';
239                end;
240        
241            *Distal radius/ulna and Radius/ulna-other;
242            if fx_site='(813, 73312) radius_ulna' then
243                do;
244                 site = 'dist4arm'; /*Includes V Codes and 73312 here*/
245                    if substr(strip(DX),1,3) = '813' and substr(strip(DX),1,4) ^in ('8134', '8135') then
246                        site = 'rad_ul_oth';
247                end;
248        
249            *Carpal... V Codes present but only one category;
250            if fx_site='(814) carpal' then
251                do;
252                    site = 'carpal';
253                 end;
254        
255            *Hip-closed and Hip-other;
256            if fx_site='(820, 73314) hip' then
257                    do;
258                    site = 'hip_cls'; /*Includes V Codes and 73314 here*/
259                    if substr(strip(DX),1,3)='820' and substr(strip(DX),1,4) ^in ('8200', '8202', '8208') then
260                        site = 'hip_oth';
261                end;
262        
263            *Other femur-closed and Other femur-other;
264            if fx_site='(821, 73315) femur' then
265                do;
266                    site = 'oth_fem_cls'; /*Includes V Codes and 73315 here*/
267                    if substr(strip(DX),1,3)='821' and substr(strip(DX),1,4) ^in ('8210', '8212') then
268                        site = 'oth_fem_oth';
5                                                                   The SAS System                                   09:21 Thursday, September 7, 2017

269                end;
270        
271            *Tib/fib-closed and Tib/fib-other;
272            if fx_site='(823, 73316) tib_fib' then
273                do;
274                    site = 'tib_fib_cls'; /*Includes V Codes and 73316 here*/
275                    if substr(strip(DX),1,3)='823' and substr(strip(DX),1,4) ^in ('8230', '8232', '8238') then
276                        site = 'tib_fib_oth';
277                end;
278        
279            *Ankle... V Codes present but only one category;
280            if fx_site='(824) ankle' then
281                do;
282                    site = 'ankle';
283                end;
284        
285            /*Assign site for other fx_sites that do not have CQ algorithm and thus no sub categories*/
286            if site = "" then do;
287                site = fx_site;
288            end;
289        
290            label site = 'CQ Algorithm Fracture Site (Specific)';
291        
292        run;

NOTE: Invalid third argument to function SUBSTR at line 245 column 50.
database=MPCD exposure=NSAID or no exposure PATID=104237646 indexGNN=NoExp indexDate=07/20/2007 age=61 SEX=M ASdate=07/20/2007
ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2009 AScohortDate=07/20/2007 DEATH_DATE= indexID=3161 ENCOUNTERID=10986231261 ENC_TYPE=AV ADMIT_DATE=
BEGIN_DATE=03/26/2007 DISCHARGE_DATE= END_DATE=03/26/2007 DX_TYPE=09 DX=813 PDX=O codeType=ICD9-DX code=813 diagCodeType=Fracture code
provTypeCategory=8 fx_site=(813, 73312) radius_ulna site=rad_ul_oth _ERROR_=1 _N_=1338
NOTE: There were 275543 observations read from the data set WORK.FX_DGNS.
NOTE: The data set WORK.FX_DGNS_2 has 275543 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.39 seconds
      cpu time            0.34 seconds
      

293        
294        /*###########################################################################################################*/
295        /***************************************************Intermediate Fracture Diagnosis File**********************/
296        /*Combine CQ diagnosis files*******************************************************/
297        data fx_dgns_3;
298            set fx_dgns_2
299        /*    fx_excare_*/
300                ;
301        run;

NOTE: There were 275543 observations read from the data set WORK.FX_DGNS_2.
NOTE: The data set WORK.FX_DGNS_3 has 275543 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.26 seconds
      cpu time            0.21 seconds
      

302        
303        proc freq data=fx_dgns_3;
304            tables fx_site site;
305        run;

                                                                  --- AS project ---                             09:21 Thursday, September 7, 2017   1

                                                                  The FREQ Procedure

                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec        1682        0.61          1682         0.61  
                                    (800-804) skull/face             4760        1.73          6442         2.34  
                                    (805, 806, 73313) spine        101843       36.96        108285        39.30  
                                    (807) rib/sternum/trachea        9270        3.36        117555        42.66  
                                    (808) pelvis                     7218        2.62        124773        45.28  
                                    (809) trunk bones                  86        0.03        124859        45.31  
                                    (810) clavicle                   3168        1.15        128027        46.46  
                                    (811) scapula                     792        0.29        128819        46.75  
                                    (812, 73311) humerus            19404        7.04        148223        53.79  
                                    (813, 73312) radius_ulna        21628        7.85        169851        61.64  
                                    (814) carpal                     3080        1.12        172931        62.76  
                                    (815-817) hand/fingers           8978        3.26        181909        66.02  
                                    (818-819) arms mult               259        0.09        182168        66.11  
                                    (820, 73314) hip                37146       13.48        219314        79.59  
                                    (821, 73315) femur              12178        4.42        231492        84.01  
                                    (822) patella                    2947        1.07        234439        85.08  
                                    (823, 73316) tib_fib            10209        3.71        244648        88.79  
                                    (824) ankle                     15185        5.51        259833        94.30  
                                    (825) tarsal_metatarsal          9623        3.49        269456        97.79  
                                    (826) foot_phalanges             3438        1.25        272894        99.04  
                                    (827) lower_limb                  223        0.08        273117        99.12  
                                    (828) legs+arm/rib                 83        0.03        273200        99.15  
                                    (829) fx_nos                     2343        0.85        275543       100.00  


                                                        CQ Algorithm Fracture Site (Specific)
 
                                                                                          Cumulative    Cumulative
                                    site                         Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec        1682        0.61          1682         0.61  
                                    (800-804) skull/face             4760        1.73          6442         2.34  
                                    (807) rib/sternum/trachea        9270        3.36         15712         5.70  
                                    (809) trunk bones                  86        0.03         15798         5.73  
                                    (811) scapula                     792        0.29         16590         6.02  
                                    (815-817) hand/fingers           8978        3.26         25568         9.28  
                                    (818-819) arms mult               259        0.09         25827         9.37  
                                    (822) patella                    2947        1.07         28774        10.44  
                                    (825) tarsal_metatarsal          9623        3.49         38397        13.94  
                                    (826) foot_phalanges             3438        1.25         41835        15.18  
                                    (827) lower_limb                  223        0.08         42058        15.26  
                                    (828) legs+arm/rib                 83        0.03         42141        15.29  
                                    (829) fx_nos                     2343        0.85         44484        16.14  
                                    ankle                           15185        5.51         59669        21.66  
                                    carpal                           3080        1.12         62749        22.77  
                                    clv_cls                          3160        1.15         65909        23.92  
                                    clv_oth                             8        0.00         65917        23.92  
                                    dist4arm                        15739        5.71         81656        29.63  
                                    hip_cls                         36118       13.11        117774        42.74  
                                    hip_oth                          1028        0.37        118802        43.12  
                                    hmrs_cls                        18974        6.89        137776        50.00  
                                    hmrs_oth                          430        0.16        138206        50.16  
                                    oth_fem_cls                     11749        4.26        149955        54.42  
                                    oth_fem_oth                       429        0.16        150384        54.58  
                                    pelvis_cls                       7172        2.60        157556        57.18  
                                    pelvis_oth                         46        0.02        157602        57.20  
                                    rad_ul_oth                       5889        2.14        163491        59.33  
                                    spine_cls                       89417       32.45        252908        91.79  
                                    spine_oth                       12426        4.51        265334        96.29  
                                    tib_fib_cls                      9501        3.45        274835        99.74  
                                    tib_fib_oth                       708        0.26        275543       100.00  
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 275543 observations read from the data set WORK.FX_DGNS_3.
NOTE: The PROCEDURE FREQ printed page 1.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.29 seconds
      cpu time            0.23 seconds
      

306        
307        proc sort data=fx_dgns_3;
308            by patid ENCOUNTERID fx_site site;
309        run;

NOTE: There were 275543 observations read from the data set WORK.FX_DGNS_3.
6                                                                   The SAS System                                   09:21 Thursday, September 7, 2017

NOTE: The data set WORK.FX_DGNS_3 has 275543 observations and 28 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.34 seconds
      cpu time            0.54 seconds
      

310        
311        
312        /*###########################################################################################################*/
313        /*************************************************************************************************************/
314        /*Look for repair procedures and assign treatment site*******************/
315        /*This code has been updated to include hip/femur replacement with matching diagnosis code, also looked in claim strip(DX) not just primary
315      !  strip(DX)
316        /*Not accepting contiguous sites until later*/
317        /*Excluding procedures from DME files*/
318        /*******************************Select All Spine Imaging Codes from STD Procedure Files for CQ=4/5 algorithms*/
319        
320        %macro fx_prcd;
321            data fx_prcd spine_xray;
322                set UCB.tempFracPxMPCD
323                    UCB.tempFracPxUCB
324                    UCB.tempFracPxSABR;
325        
326                    length tx_site $30;
327                    length HLAT $1;
328        
329                    if strip(px) in ('21300' '21310' '21315' '21320' '21325' '21330' '21335' '21336' '21337' '21338' '21339' '21340' '21343'
329      ! '21344' '21345' '21346' '21347' '21348'
330                                         '21355' '21356' '21360' '21365' '21366' '21385' '21386' '21387' '21390' '21395' '21400' '21401' '21406'
330      ! '21407' '21408' '21421' '21422' '21423'
331                                         '21431' '21432' '21433' '21435' '21436' '21440' '21445' '21450' '21451' '21452' '21453' '21454' '21461'
331      ! '21462' '21465' '21470'
332                                         '62000' '62005' '62010')  and lengthn(strip(px)) = 5 then do;
333                        tx_site='(800-804) skull/face'; output fx_prcd; end;
334        
335                    if strip(px) in ('22305' '22310' '22315' '22318' '22319' '22325' '22326' '22327' '22328' '22520' '22521' '22522' '22523'
335      ! '22524' '22525' '76012' '76013'
336                                         'S2360' 'S2361' 'S2362' 'S2363' '72291' '72292')  and lengthn(strip(px)) = 5 then do;
337                        tx_site = '(805, 806, 73313) spine'; output fx_prcd; end;
338        
339                    if  strip(px) in ('21493' '21494' '21495' '21800' '21805' '21810' '21820' '21825' ) then do;
340                        tx_site='(807) rib/sternum/trachea'; output fx_prcd; end;
341        
342                    if strip(px) in ('27193' '27194' '27215' '27216' '27217' '27218' '27220' '27222' '27226' '27227' '27228')  and
342      ! lengthn(strip(px)) = 5 then do;
343                        tx_site = '(808) pelvis'; output fx_prcd; end;
344        
345                    if strip(px) in ('23500' '23505' '23515')  and lengthn(strip(px)) = 5 then do;
346                        tx_site = '(810) clavicle'; output fx_prcd; end;
347        
348                    if strip(px) in ('23570' '23575' '23585') then do;
349                        tx_site= '(811) scapula'; output fx_prcd; end;
350        
351                    if strip(px) in ('23600' '23605' '23615' '23616' '23620' '23625' '23630' '23665' '24500' '24505' '24515' '24516' '24530'
351      ! '24535' '24538' '24545' '24546' '24560'
352                                 '24565' '24566' '24575' '24576' '24577' '24579' '24582')  and lengthn(strip(px)) = 5 then do;
353                        tx_site = '(812, 73311) humerus'; output fx_prcd; end;
354        
355                    if strip(px) in ('25600' '25605' '25606' '25607' '25608' '25609' '25620' '25650' '25651' '25652')  and lengthn(strip(px)) = 5
355      ! then do;
356                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
357        
358                    if strip(px) in ('24650' '24655' '24665' '24666' '24670' '24675' '24685' '25500' '25505' '25515' '25520' '25525' '25526'
358      ! '25530' '25535' '25545' '25560' '25565'
359                                 '25574' '25575')  and lengthn(strip(px)) = 5 then do;
360                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
361        
362                    if strip(px) in ('25622' '25624' '25628' '25630' '25635' '25645' '25680' '25685')  and lengthn(strip(px)) = 5 then do;
363                        tx_site = '(814) carpal'; output fx_prcd; end;
364        
365                    if strip(px) in ('26600' '26605' '26607' '26608' '26615' '26645' '26650' '26665' '26720' '26725' '26727' '26735' '26740'
365      ! '26742' '26746' '26750' '26755' '26756' '26765' )
7                                                                   The SAS System                                   09:21 Thursday, September 7, 2017

366                               and lengthn(strip(px)) = 5 then do;
367                        tx_site='(815-817) hand/fingers'; output fx_prcd; end;
368        
369                    if '27230' <= strip(px) <= '27248' and lengthn(strip(px)) = 5 then do;
370                        tx_site = '(820, 73314) hip'; output fx_prcd; end;
371        
372                    if '27500' <= strip(px) <= '27514'  and lengthn(strip(px)) = 5 then do;
373                        tx_site = '(821, 73315) femur'; output fx_prcd; end;
374        
375                    if strip(px) in ('27520' '27524')  and lengthn(strip(px)) = 5 then do;
376                        tx_site = '(822) patella'; output fx_prcd; end;
377        
378                    if ('27530' <= strip(px) <= '27536' or '27750' <= strip(px) <= '27759' or '27780' <= strip(px) <= '27784' or '27824' <=
378      ! strip(px) <= '27828') and lengthn(strip(px)) = 5  then do;
379                        tx_site = '(823, 73316) tib_fib'; output fx_prcd; end;
380        
381                    if strip(px) in ('27760' '27762' '27766' '27786' '27788' '27792' '27808' '27810' '27814' '27816' '27818' '27822' '27823'
381      ! '28430' '28435' '28436' '28445')  and lengthn(strip(px)) = 5 then do;
382                        tx_site = '(824) ankle'; output fx_prcd; end;
383        
384                    if strip(px) in ('28320' '28322' '28400' '28405' '28406' '28415' '28420' ) and lengthn(strip(px)) = 5 then do;
385                        tx_site='(825) tarsal_metatarsal'; output fx_prcd; end;
386        
387                 /********************************Hip/Femur Additions - must be matched with DGNS to be included*/
388                 /*Hip replacement codes*/
389                    /*Hip*/
390                    if strip(px) in ('27130' '27125') and lengthn(strip(px)) = 5  then do;
391                        HLAT='1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
392        
393                    /*Codes below are the only ICD9 Procedure Codes that we are using for "repair"*/
394                    if strip(px) in ('8151' '8152') and lengthn(strip(px)) = 4 then do;
395                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
396        
397                    /*Femur repair codes, assigned to both Hip and Femur treatment sites... CHECK - MAYBE WE NEED TO DO THIS THE OTHER WAY AS
397      ! WELL*/
398                    /*Hip*/
399                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
400                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
401        
402                    /*Femur*/
403                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
404                        HLAT = '1'; tx_site = '(821, 73315) femur'; output fx_prcd; end;
405                     /*spine image*/
406                        if '72010' <= strip(px) <= '72159' or '72240' <= strip(px) <= '72285' or strip(px) = '72295' then do;   /*Spine Imaging
406      ! Codes*/
407                        tx_site='(805, 806, 73313) spine';
408                        output spine_xray; end;
409        
410            run;
411        
412            data fx_prcd;
413                set fx_prcd;
414                /*To add laterality info*/
415        /*        array hcpcs{*} hcpcs_1st_mdfr_cd hcpcs_2nd_mdfr_cd hcpcs_3rd_mdfr_cd hcpcs_4th_mdfr_cd ; */
416                if HLAT='1' then do;
417                    repair_right='0'; repair_left='0';
418                end;
419        /*        if HLAT='1' then */
420        /*            do i=1 to dim(hcpcs);*/
421        /*                if hcpcs{i} = 'RT' then repair_right='1';*/
422        /*                else if hcpcs{i} = 'LT' then repair_left='1';*/
423        /*            end;*/
424            run;
425            proc sort data=fx_prcd nodupkey; by patid ENCOUNTERID px_date tx_site; run;
426        
427            data spine_xray;
428                set spine_xray;
429                keep patid px_date tx_site  ENCOUNTERID begin_date;
430            run;
431            proc sort data=spine_xray nodupkey; by patid px_date; run;
432        %mend;
433        %fx_prcd;
8                                                                   The SAS System                                   09:21 Thursday, September 7, 2017


WARNING: Multiple lengths were specified for the variable ADMIT_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable BEGIN_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DISCHARGE_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable END_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable PX_DATE by input data set(s). This can cause truncation of data.
NOTE: There were 880584 observations read from the data set UCB.TEMPFRACPXMPCD.
NOTE: There were 4303767 observations read from the data set UCB.TEMPFRACPXUCB.
NOTE: There were 30790932 observations read from the data set UCB.TEMPFRACPXSABR.
NOTE: The data set WORK.FX_PRCD has 26787 observations and 25 variables.
NOTE: The data set WORK.SPINE_XRAY has 393415 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           2:06.92
      cpu time            1:57.03
      


NOTE: There were 26787 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK.FX_PRCD has 26787 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.20 seconds
      cpu time            0.03 seconds
      


NOTE: There were 26787 observations read from the data set WORK.FX_PRCD.
NOTE: 13338 observations with duplicate key values were deleted.
NOTE: The data set WORK.FX_PRCD has 13449 observations and 27 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.12 seconds
      cpu time            0.03 seconds
      


NOTE: There were 393415 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.SPINE_XRAY has 393415 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.28 seconds
      cpu time            0.20 seconds
      


NOTE: There were 393415 observations read from the data set WORK.SPINE_XRAY.
NOTE: 272427 observations with duplicate key values were deleted.
NOTE: The data set WORK.SPINE_XRAY has 120988 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.23 seconds
      cpu time            0.35 seconds
      

434        
435        
436        
437        data trauma (rename=(begin_date=trauma_dt));
438                set UCB.tempFracDxMPCD (where = (diagCodeType = "Trauma code"))
439                    UCB.tempFracDxUCB (where = (diagCodeType = "Trauma code"))
440                    UCB.tempFracDxSABR (where = (diagCodeType = "Trauma code"));
441        run;

WARNING: Multiple lengths were specified for the variable ADMIT_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable BEGIN_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DISCHARGE_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable END_DATE by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable DX by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable PDX by input data set(s). This can cause truncation of data.
WARNING: Multiple lengths were specified for the variable code by input data set(s). This can cause truncation of data.
NOTE: There were 298 observations read from the data set UCB.TEMPFRACDXMPCD.
      WHERE diagCodeType='Trauma code';
NOTE: There were 592 observations read from the data set UCB.TEMPFRACDXUCB.
      WHERE diagCodeType='Trauma code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: There were 21463 observations read from the data set UCB.TEMPFRACDXSABR.
9                                                                   The SAS System                                   09:21 Thursday, September 7, 2017

      WHERE diagCodeType='Trauma code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.TRAUMA has 22353 observations and 26 variables.
NOTE: DATA statement used (Total process time):
      real time           0.18 seconds
      cpu time            0.10 seconds
      

442        proc sort data= trauma(keep=patid trauma_dt) nodupkey; by patid trauma_dt;run;

NOTE: There were 22353 observations read from the data set WORK.TRAUMA.
NOTE: 12269 observations with duplicate key values were deleted.
NOTE: The data set WORK.TRAUMA has 10084 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

443        
444        
445        /*subset the spine xray procedure claim for patients with fx diagnosis code only*/
446        /*so SAS will not run out of memory*/
447        data fx_spine_xray(keep=patid tx_site px_date ENCOUNTERID begin_date);
448        if _n_=1 then do;
449          declare hash hid(dataset:"fx_dgns_3(where=(fx_site='(805, 806, 73313) spine')))", multidata:"N", hashexp:20);
450          rc=hid.defineKey("patid");
451          rc=hid.defineDone();
452        end;
453        set spine_xray;
454        rc=hid.find();
455        if rc=0;
456        run;

NOTE: There were 101843 observations read from the data set WORK.FX_DGNS_3.
      WHERE fx_site='(805, 806, 73313) spine';
NOTE: There were 120988 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.FX_SPINE_XRAY has 34204 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.26 seconds
      cpu time            0.20 seconds
      

457        /*subset the Trauma code for patients with fx diagnosis code only*/
458        /*so SAS will not run out of memory*/
459        data fx_trauma(drop=rc);
460        if _n_=1 then do;
461          declare hash hid(dataset:"fx_dgns_3", multidata:"N", hashexp:20);
462          rc=hid.defineKey("patid");
463          rc=hid.defineDone();
464        end;
465        set trauma;
466        rc=hid.find();
467        if rc=0;
468        run;

NOTE: There were 275543 observations read from the data set WORK.FX_DGNS_3.
NOTE: There were 10084 observations read from the data set WORK.TRAUMA.
NOTE: The data set WORK.FX_TRAUMA has 6137 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.20 seconds
      cpu time            0.15 seconds
      

469        /************************************Link Fracture Claims (ICD9 Diagnosis) with Repair Claims (CPT/HCPCS, some ICD9 procedure
469      ! code)***************/
470        
471        data fx_dgns_4(drop=rc: px_date tx_site xray_date trauma_dt);
472        if _n_=1 then do;
473          declare hash hid(dataset:"fx_prcd", multidata:"N", hashexp:20);
474          rc=hid.defineKey("patid", "px_date", "tx_site");
475        /*  rc=hid.defineData("px_date", "tx_site");*/
476          rc=hid.defineDone();
10                                                                  The SAS System                                   09:21 Thursday, September 7, 2017

477          declare hash hxray(dataset:"fx_spine_xray(rename=px_date=xray_date)", multidata:"Y", hashexp:20);
478          rc=hxray.defineKey("patid", "tx_site");
479          rc=hxray.defineData("xray_date");
480          rc=hxray.defineDone();
481          declare hash htrauma(dataset:"fx_trauma", multidata:"Y", hashexp:20);
482          rc=htrauma.defineKey("patid");
483          rc=htrauma.defineData("trauma_dt");
484          rc=htrauma.defineDone();
485        end;
486        if 0 then set fx_prcd(keep=patid px_date tx_site)
487                      fx_spine_xray(keep=patid px_date tx_site rename=px_date=xray_date)
488                      fx_trauma;
489        set fx_dgns_3;
490        length cq $4 spine_image trauma_date 4 trauma $1;
491        format spine_image trauma_date mmddyy10.;
492        cq="0000";
493        rc=hid.find(key:patid, key:begin_date,key:fx_site);
494        if rc^=0 then do;
495            px_date=.;
496            tx_site=" ";
497        end;
498        if enc_type="IP" then do;
499        /*CQ = 1 Inpatient claim with primary diagnosis code */
500            if pdx="P" then substr(cq,1,1)="1";
501        /*CQ = 2 Inpatient claim with secondary diagnosis code*/
502            else substr(cq,2,1)="2";
503        end; else do;
504        /*CQ = 3 outpatient diagnosis code AND carrier line with repair/replace HCPCS*/
505            if rc=0 then substr(cq,3,1)="3";
506            rc1=hxray.find(key:patid, key:fx_site);
507            do while (rc1 = 0);
508                if begin_date-10 <=xray_date<= begin_date then do;
509                    if enc_type in ("AV" "IF" "NH" "HH" "ER" "ED") then do;
510        /*CQ = 4 outpatient [Physician E&M codes] diagnosis code with spine image/x-ray within 10 day early*/
511                        substr(cq,4,1)="4";
512                        spine_image=min(spine_image,xray_date);
513                    end;
514                end;
515                rc1=hxray.find_next(key:patid, key:fx_site);
516            end;
517        end;
518        /*is there trauma dx within 14 days*/
519        rc2=htrauma.find(key:patid);
520        do while (rc2 = 0) ;
521            if 0<=abs(trauma_dt-begin_date)<=14 then do;
522                    trauma="1";
523                    trauma_date=min(trauma_date,trauma_dt);
524           end ;
525           rc2=htrauma.find_next(key:patid) ;
526        end;
527        
528        run;

NOTE: There were 13449 observations read from the data set WORK.FX_PRCD.
NOTE: There were 34204 observations read from the data set WORK.FX_SPINE_XRAY.
NOTE: There were 6137 observations read from the data set WORK.FX_TRAUMA.
NOTE: There were 275543 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_4 has 275543 observations and 32 variables.
NOTE: DATA statement used (Total process time):
      real time           0.95 seconds
      cpu time            0.90 seconds
      

529        proc freq data=fx_dgns_4; tables enc_type*cq fx_site*cq trauma/missing;run;

                                                                  --- AS project ---                             09:21 Thursday, September 7, 2017   2

                                                                  The FREQ Procedure

                                                               Table of ENC_TYPE by cq

                                       ENC_TYPE(Encounter Type)     cq

                                       Frequency|
                                       Percent  |
                                       Row Pct  |
                                       Col Pct  |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                       ---------+--------+--------+--------+--------+--------+--------+
                                                |  76081 |      0 |  16457 |      0 |      0 |      0 |  92538
                                                |  27.61 |   0.00 |   5.97 |   0.00 |   0.00 |   0.00 |  33.58
                                                |  82.22 |   0.00 |  17.78 |   0.00 |   0.00 |   0.00 |
                                                |  38.30 |   0.00 |  48.11 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       AV       |  30099 |   7007 |   1684 |    226 |      0 |      0 |  39016
                                                |  10.92 |   2.54 |   0.61 |   0.08 |   0.00 |   0.00 |  14.16
                                                |  77.15 |  17.96 |   4.32 |   0.58 |   0.00 |   0.00 |
                                                |  15.15 |  25.62 |   4.92 |  20.56 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       ED       |  12707 |   4488 |   3163 |    123 |      0 |      0 |  20481
                                                |   4.61 |   1.63 |   1.15 |   0.04 |   0.00 |   0.00 |   7.43
                                                |  62.04 |  21.91 |  15.44 |   0.60 |   0.00 |   0.00 |
                                                |   6.40 |  16.41 |   9.25 |  11.19 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       HH       |    766 |     96 |      0 |      0 |      0 |      0 |    862
                                                |   0.28 |   0.03 |   0.00 |   0.00 |   0.00 |   0.00 |   0.31
                                                |  88.86 |  11.14 |   0.00 |   0.00 |   0.00 |   0.00 |
                                                |   0.39 |   0.35 |   0.00 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       IF       |  23879 |  15028 |   2837 |    750 |      0 |      0 |  42494
                                                |   8.67 |   5.45 |   1.03 |   0.27 |   0.00 |   0.00 |  15.42
                                                |  56.19 |  35.36 |   6.68 |   1.76 |   0.00 |   0.00 |
                                                |  12.02 |  54.95 |   8.29 |  68.24 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       IP       |      0 |      0 |      0 |      0 |   9688 |   4578 |  14266
                                                |   0.00 |   0.00 |   0.00 |   0.00 |   3.52 |   1.66 |   5.18
                                                |   0.00 |   0.00 |   0.00 |   0.00 |  67.91 |  32.09 |
                                                |   0.00 |   0.00 |   0.00 |   0.00 | 100.00 | 100.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       NH       |   5869 |    730 |     13 |      0 |      0 |      0 |   6612
                                                |   2.13 |   0.26 |   0.00 |   0.00 |   0.00 |   0.00 |   2.40
                                                |  88.76 |  11.04 |   0.20 |   0.00 |   0.00 |   0.00 |
                                                |   2.95 |   2.67 |   0.04 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       OT       |  49220 |      0 |  10054 |      0 |      0 |      0 |  59274
                                                |  17.86 |   0.00 |   3.65 |   0.00 |   0.00 |   0.00 |  21.51
                                                |  83.04 |   0.00 |  16.96 |   0.00 |   0.00 |   0.00 |
                                                |  24.78 |   0.00 |  29.39 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       Total      198621    27349    34208     1099     9688     4578   275543
                                                   72.08     9.93    12.41     0.40     3.52     1.66   100.00


 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                             09:21 Thursday, September 7, 2017   3

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (7331) pathologi |   1605 |      0 |      0 |      0 |     61 |     16 |   1682
                                   c nos/nec        |   0.58 |   0.00 |   0.00 |   0.00 |   0.02 |   0.01 |   0.61
                                                    |  95.42 |   0.00 |   0.00 |   0.00 |   3.63 |   0.95 |
                                                    |   0.81 |   0.00 |   0.00 |   0.00 |   0.63 |   0.35 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (800-804) skull/ |   3942 |      0 |    520 |      0 |    235 |     63 |   4760
                                   face             |   1.43 |   0.00 |   0.19 |   0.00 |   0.09 |   0.02 |   1.73
                                                    |  82.82 |   0.00 |  10.92 |   0.00 |   4.94 |   1.32 |
                                                    |   1.98 |   0.00 |   1.52 |   0.00 |   2.43 |   1.38 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (805, 806, 73313 |  57860 |  27349 |   8302 |   1099 |   4940 |   2293 | 101843
                                   ) spine          |  21.00 |   9.93 |   3.01 |   0.40 |   1.79 |   0.83 |  36.96
                                                    |  56.81 |  26.85 |   8.15 |   1.08 |   4.85 |   2.25 |
                                                    |  29.13 | 100.00 |  24.27 | 100.00 |  50.99 |  50.09 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (807) rib/sternu |   7775 |      0 |    937 |      0 |    460 |     98 |   9270
                                   m/trachea        |   2.82 |   0.00 |   0.34 |   0.00 |   0.17 |   0.04 |   3.36
                                                    |  83.87 |   0.00 |  10.11 |   0.00 |   4.96 |   1.06 |
                                                    |   3.91 |   0.00 |   2.74 |   0.00 |   4.75 |   2.14 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (808) pelvis     |   6399 |      0 |    415 |      0 |    294 |    110 |   7218
                                                    |   2.32 |   0.00 |   0.15 |   0.00 |   0.11 |   0.04 |   2.62
                                                    |  88.65 |   0.00 |   5.75 |   0.00 |   4.07 |   1.52 |
                                                    |   3.22 |   0.00 |   1.21 |   0.00 |   3.03 |   2.40 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (809) trunk bone |     85 |      0 |      0 |      0 |      1 |      0 |     86
                                   s                |   0.03 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.03
                                                    |  98.84 |   0.00 |   0.00 |   0.00 |   1.16 |   0.00 |
                                                    |   0.04 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (810) clavicle   |   2489 |      0 |    592 |      0 |     71 |     16 |   3168
                                                    |   0.90 |   0.00 |   0.21 |   0.00 |   0.03 |   0.01 |   1.15
                                                    |  78.57 |   0.00 |  18.69 |   0.00 |   2.24 |   0.51 |
                                                    |   1.25 |   0.00 |   1.73 |   0.00 |   0.73 |   0.35 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (811) scapula    |    677 |      0 |     97 |      0 |     17 |      1 |    792
                                                    |   0.25 |   0.00 |   0.04 |   0.00 |   0.01 |   0.00 |   0.29
                                                    |  85.48 |   0.00 |  12.25 |   0.00 |   2.15 |   0.13 |
                                                    |   0.34 |   0.00 |   0.28 |   0.00 |   0.18 |   0.02 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total              198621    27349    34208     1099     9688     4578   275543
                                                       72.08     9.93    12.41     0.40     3.52     1.66   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                             09:21 Thursday, September 7, 2017   4

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (812, 73311) hum |  16231 |      0 |   2478 |      0 |    462 |    233 |  19404
                                   erus             |   5.89 |   0.00 |   0.90 |   0.00 |   0.17 |   0.08 |   7.04
                                                    |  83.65 |   0.00 |  12.77 |   0.00 |   2.38 |   1.20 |
                                                    |   8.17 |   0.00 |   7.24 |   0.00 |   4.77 |   5.09 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (813, 73312) rad |  16942 |      0 |   4317 |      0 |    265 |    104 |  21628
                                   ius_ulna         |   6.15 |   0.00 |   1.57 |   0.00 |   0.10 |   0.04 |   7.85
                                                    |  78.33 |   0.00 |  19.96 |   0.00 |   1.23 |   0.48 |
                                                    |   8.53 |   0.00 |  12.62 |   0.00 |   2.74 |   2.27 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (814) carpal     |   2809 |      0 |    240 |      0 |     30 |      1 |   3080
                                                    |   1.02 |   0.00 |   0.09 |   0.00 |   0.01 |   0.00 |   1.12
                                                    |  91.20 |   0.00 |   7.79 |   0.00 |   0.97 |   0.03 |
                                                    |   1.41 |   0.00 |   0.70 |   0.00 |   0.31 |   0.02 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (815-817) hand/f |   7204 |      0 |   1696 |      0 |     68 |     10 |   8978
                                   ingers           |   2.61 |   0.00 |   0.62 |   0.00 |   0.02 |   0.00 |   3.26
                                                    |  80.24 |   0.00 |  18.89 |   0.00 |   0.76 |   0.11 |
                                                    |   3.63 |   0.00 |   4.96 |   0.00 |   0.70 |   0.22 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (818-819) arms m |    257 |      0 |      0 |      0 |      2 |      0 |    259
                                   ult              |   0.09 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.09
                                                    |  99.23 |   0.00 |   0.00 |   0.00 |   0.77 |   0.00 |
                                                    |   0.13 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (820, 73314) hip |  26353 |      0 |   8244 |      0 |   1552 |    997 |  37146
                                                    |   9.56 |   0.00 |   2.99 |   0.00 |   0.56 |   0.36 |  13.48
                                                    |  70.94 |   0.00 |  22.19 |   0.00 |   4.18 |   2.68 |
                                                    |  13.27 |   0.00 |  24.10 |   0.00 |  16.02 |  21.78 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (821, 73315) fem |   9744 |      0 |   1828 |      0 |    379 |    227 |  12178
                                   ur               |   3.54 |   0.00 |   0.66 |   0.00 |   0.14 |   0.08 |   4.42
                                                    |  80.01 |   0.00 |  15.01 |   0.00 |   3.11 |   1.86 |
                                                    |   4.91 |   0.00 |   5.34 |   0.00 |   3.91 |   4.96 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (822) patella    |   2366 |      0 |    448 |      0 |     96 |     37 |   2947
                                                    |   0.86 |   0.00 |   0.16 |   0.00 |   0.03 |   0.01 |   1.07
                                                    |  80.29 |   0.00 |  15.20 |   0.00 |   3.26 |   1.26 |
                                                    |   1.19 |   0.00 |   1.31 |   0.00 |   0.99 |   0.81 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total              198621    27349    34208     1099     9688     4578   275543
                                                       72.08     9.93    12.41     0.40     3.52     1.66   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                             09:21 Thursday, September 7, 2017   5

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (823, 73316) tib |   8679 |      0 |   1180 |      0 |    230 |    120 |  10209
                                   _fib             |   3.15 |   0.00 |   0.43 |   0.00 |   0.08 |   0.04 |   3.71
                                                    |  85.01 |   0.00 |  11.56 |   0.00 |   2.25 |   1.18 |
                                                    |   4.37 |   0.00 |   3.45 |   0.00 |   2.37 |   2.62 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (824) ankle      |  11983 |      0 |   2651 |      0 |    344 |    207 |  15185
                                                    |   4.35 |   0.00 |   0.96 |   0.00 |   0.12 |   0.08 |   5.51
                                                    |  78.91 |   0.00 |  17.46 |   0.00 |   2.27 |   1.36 |
                                                    |   6.03 |   0.00 |   7.75 |   0.00 |   3.55 |   4.52 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (825) tarsal_met |   9181 |      0 |    263 |      0 |    137 |     42 |   9623
                                   atarsal          |   3.33 |   0.00 |   0.10 |   0.00 |   0.05 |   0.02 |   3.49
                                                    |  95.41 |   0.00 |   2.73 |   0.00 |   1.42 |   0.44 |
                                                    |   4.62 |   0.00 |   0.77 |   0.00 |   1.41 |   0.92 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (826) foot_phala |   3406 |      0 |      0 |      0 |     29 |      3 |   3438
                                   nges             |   1.24 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   1.25
                                                    |  99.07 |   0.00 |   0.00 |   0.00 |   0.84 |   0.09 |
                                                    |   1.71 |   0.00 |   0.00 |   0.00 |   0.30 |   0.07 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (827) lower_limb |    223 |      0 |      0 |      0 |      0 |      0 |    223
                                                    |   0.08 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.08
                                                    | 100.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |
                                                    |   0.11 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (828) legs+arm/r |     80 |      0 |      0 |      0 |      3 |      0 |     83
                                   ib               |   0.03 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.03
                                                    |  96.39 |   0.00 |   0.00 |   0.00 |   3.61 |   0.00 |
                                                    |   0.04 |   0.00 |   0.00 |   0.00 |   0.03 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (829) fx_nos     |   2331 |      0 |      0 |      0 |     12 |      0 |   2343
                                                    |   0.85 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.85
                                                    |  99.49 |   0.00 |   0.00 |   0.00 |   0.51 |   0.00 |
                                                    |   1.17 |   0.00 |   0.00 |   0.00 |   0.12 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total              198621    27349    34208     1099     9688     4578   275543
                                                       72.08     9.93    12.41     0.40     3.52     1.66   100.00


                                                                                Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                                         239212       86.81        239212        86.81  
                                             1            36331       13.19        275543       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 275543 observations read from the data set WORK.FX_DGNS_4.
NOTE: The PROCEDURE FREQ printed pages 2-5.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.57 seconds
      cpu time            0.39 seconds
      

11                                                                  The SAS System                                   09:21 Thursday, September 7, 2017

530        
531        *goto 002_fx_epi.sas;
532        
533        
534        
535        
536        /*
537        START OF 002_fx_data.sas
538         */
539        
540        /*all the claims to define episode sequence */
541        data _dat0(keep=
542        PATID ENCOUNTERID ADMIT_DATE DISCHARGE_DATE BEGIN_DATE END_DATE DX DX_TYPE PDX  /* SOURCE */ ENC_TYPE fx_site px px_date
543        site cq spine_image trauma_date trauma );
544        set fx_dgns_4 fx_excare Fx_prcd(rename=tx_site=fx_site);
545        run;

WARNING: Multiple lengths were specified for the variable code by input data set(s). This can cause truncation of data.
NOTE: There were 275543 observations read from the data set WORK.FX_DGNS_4.
NOTE: There were 43288 observations read from the data set WORK.FX_EXCARE.
NOTE: There were 13449 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK._DAT0 has 332280 observations and 18 variables.
NOTE: DATA statement used (Total process time):
      real time           0.32 seconds
      cpu time            0.21 seconds
      

546        proc sort data=_dat0; by PATID fx_site BEGIN_DATE END_DATE; run;

NOTE: There were 332280 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT0 has 332280 observations and 18 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.31 seconds
      cpu time            0.56 seconds
      

547        /*for each claim define start and end date applicable to IP NH and NH*/
548        data _dat1;
549        set _dat0;
550        length start_date end_date 4;
551        format start_date end_date mmddyy10.;
552        by PATID fx_site BEGIN_DATE END_DATE;
553        start_date=min(ADMIT_DATE, BEGIN_DATE);
554        end_date=max(DISCHARGE_DATE, End_DATE);
555        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      616 at 553:12   
NOTE: There were 332280 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT1 has 332280 observations and 19 variables.
NOTE: DATA statement used (Total process time):
      real time           0.32 seconds
      cpu time            0.23 seconds
      

556        proc sort data=_dat1; by PATID fx_site start_date end_date; run;

NOTE: There were 332280 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT1 has 332280 observations and 19 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.31 seconds
      cpu time            0.49 seconds
      

557        
558        /* generate unique episode sequence ID */
559        data _dat2(drop=end_date_max lag_end_date_max _gap);
560        set _dat1;
561        length lag_end_date_max end_date_max 4;
562        format lag_end_date_max end_date_max mmddyy10.;
563        
12                                                                  The SAS System                                   09:21 Thursday, September 7, 2017

564        by PATID fx_site start_date end_date;
565        retain seq 0;
566        
567        /*if current claims end date > all previouse claim end date in sequence, then update*/
568        end_date_max=max(end_date,end_date_max);
569        lag_end_date_max=lag(end_date_max);
570        
571        if first.fx_site then lag_end_date_max=.;
572        _gap=start_date-lag_end_date_max;
573        
574        /*if current claims start date >90 days after all previouse claim end date in sequence,
575        then start new sequence*/
576        if first.fx_site or start_date-lag_end_date_max>90 then do;
577            end_date_max=end_date;
578        
579            seq+1;
580        end;
581        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      21053 at 572:16   21053 at 576:31   
NOTE: There were 332280 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT2 has 332280 observations and 20 variables.
NOTE: DATA statement used (Total process time):
      real time           0.35 seconds
      cpu time            0.28 seconds
      

582        proc sort data=_dat2; by seq;run;

NOTE: There were 332280 observations read from the data set WORK._DAT2.
NOTE: The data set WORK._DAT2 has 332280 observations and 20 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.32 seconds
      cpu time            0.42 seconds
      

583        proc sql;
584        /*episode sequence start date*/
585        create table seq_start as
586        select patid, seq, min(start_date) as seq_start_date length=4 format=mmddyy10.
587         from _dat2
588         where substr(dx,1,4) not in ('V541' 'V542')
589         group by patid, seq
590         order by patid, seq;
NOTE: Table WORK.SEQ_START created, with 22014 rows and 3 columns.

591        /*episode sequence end date*/
592        create table seq_end as
593        select patid, seq,
594         max(start_date) as seq_end_date length=4 format=mmddyy10. from _dat2
595         group by patid, seq
596         order by patid, seq;
NOTE: Table WORK.SEQ_END created, with 26818 rows and 3 columns.

597        quit;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.62 seconds
      cpu time            0.82 seconds
      

598        /*episode sequence case qualifier indicator and trauma*/
599        data seq_cq(keep=patid seq seq_cq seq_trauma fx_site);
600        set _dat2;
601        by patid seq;
602        length seq_cq $4 seq_trauma $1;
603        retain seq_cq seq_trauma;
604        if first.seq then do;
605            seq_cq="0000";
606            seq_trauma="0";
607        end;
13                                                                  The SAS System                                   09:21 Thursday, September 7, 2017

608        if trauma="1" then seq_trauma=trauma;
609        do i=1 to 4;
610        if substr(cq,i,1)>substr(seq_cq,i,1) then substr(seq_cq,i,1)=substr(cq,i,1);
611        end;
612        if last.seq then output;
613        run;

NOTE: There were 332280 observations read from the data set WORK._DAT2.
NOTE: The data set WORK.SEQ_CQ has 26818 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.42 seconds
      cpu time            0.26 seconds
      

614        proc freq data=seq_cq; tables seq_cq seq_trauma fx_site; run;

                                                                  --- AS project ---                             09:21 Thursday, September 7, 2017   6

                                                                  The FREQ Procedure

                                                                                Cumulative    Cumulative
                                             seq_cq    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0000         19000       70.85         19000        70.85  
                                             0004          1378        5.14         20378        75.99  
                                             0030          2030        7.57         22408        83.56  
                                             0034           286        1.07         22694        84.62  
                                             0200           915        3.41         23609        88.03  
                                             0204           242        0.90         23851        88.94  
                                             0230           219        0.82         24070        89.75  
                                             0234            85        0.32         24155        90.07  
                                             1000            80        0.30         24235        90.37  
                                             1004            87        0.32         24322        90.69  
                                             1030           281        1.05         24603        91.74  
                                             1034            94        0.35         24697        92.09  
                                             1200           471        1.76         25168        93.85  
                                             1204           570        2.13         25738        95.97  
                                             1230           715        2.67         26453        98.64  
                                             1234           365        1.36         26818       100.00  


                                             seq_                               Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0            24187       90.19         24187        90.19  
                                             1             2631        9.81         26818       100.00  


                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec         714        2.66           714         2.66  
                                    (800-804) skull/face              556        2.07          1270         4.74  
                                    (805, 806, 73313) spine          6839       25.50          8109        30.24  
                                    (807) rib/sternum/trachea        1455        5.43          9564        35.66  
                                    (808) pelvis                      633        2.36         10197        38.02  
                                    (809) trunk bones                  19        0.07         10216        38.09  
                                    (810) clavicle                    310        1.16         10526        39.25  
                                    (811) scapula                     122        0.45         10648        39.70  
                                    (812, 73311) humerus             1070        3.99         11718        43.69  
                                    (813, 73312) radius_ulna         1230        4.59         12948        48.28  
                                    (814) carpal                      615        2.29         13563        50.57  
                                    (815-817) hand/fingers            869        3.24         14432        53.81  
                                    (818-819) arms mult                35        0.13         14467        53.95  
                                    (820, 73314) hip                 3526       13.15         17993        67.09  
                                    (821, 73315) femur               1274        4.75         19267        71.84  
                                    (822) patella                     791        2.95         20058        74.79  
                                    (823, 73316) tib_fib              880        3.28         20938        78.07  
                                    (824) ankle                      1026        3.83         21964        81.90  
                                    (825) tarsal_metatarsal           953        3.55         22917        85.45  
                                    (826) foot_phalanges              528        1.97         23445        87.42  
                                    (827) lower_limb                   50        0.19         23495        87.61  
                                    (828) legs+arm/rib                 13        0.05         23508        87.66  
                                    (829) fx_nos                     3310       12.34         26818       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 26818 observations read from the data set WORK.SEQ_CQ.
NOTE: The PROCEDURE FREQ printed page 6.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.13 seconds
      cpu time            0.06 seconds
      

615        
616        data seq_cq_date;
617        merge seq_cq seq_start seq_end;
618        by patid seq;
619        length site_order $1;
620        if fx_site='(820, 73314) hip' then site_order='1';
621        if fx_site='(821, 73315) femur' then site_order='2';
622        if fx_site='(808) pelvis' then site_order='3';
623        if fx_site='(805, 806, 73313) spine' then site_order='4';
624        if fx_site='(812, 73311) humerus' then site_order='5';
625        if fx_site='(813, 73312) radius_ulna' then site_order='6';
626        if fx_site='(823, 73316) tib_fib' then site_order='7';
627        if fx_site='(824) ankle' then site_order='8';
628        if fx_site='(810) clavicle' then site_order='9';
629        run;

NOTE: There were 26818 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 22014 observations read from the data set WORK.SEQ_START.
NOTE: There were 26818 observations read from the data set WORK.SEQ_END.
NOTE: The data set WORK.SEQ_CQ_DATE has 26818 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.17 seconds
      cpu time            0.04 seconds
      

630        
631        data _tmp_combo;
632        set seq_cq_date;
633        where site_order^=" " and seq_cq^="0000" and seq_cq^=" ";
634        run;

NOTE: There were 6683 observations read from the data set WORK.SEQ_CQ_DATE.
      WHERE (site_order not = ' ') and seq_cq not in (' ', '0000');
NOTE: The data set WORK._TMP_COMBO has 6683 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

635        
636        * define combo or alone fx;
637        data seq_COMBO(
638        keep=patid seq seq_cq seq_start_date alone_combo fx_site site_order)
639        ;
640        if _n_=1 then do;
641            declare hash hpid(dataset:"_tmp_combo(where=(seq_cq^='0000' and seq_cq^=' ')
642                    rename=(seq_start_date=seq_start_date2  fx_site= fx_site_combo seq=seq_COMBO))", ordered: 'a', multidata:"Y");
643            rc=hpid.defineKey("patid");
644            rc=hpid.defineData("patid","seq_start_date2", "fx_site_combo", "seq_COMBO");
14                                                                  The SAS System                                   09:21 Thursday, September 7, 2017

645            rc=hpid.defineDone();
646        end;
647        if 0 then set _tmp_combo(rename=(seq_start_date=seq_start_date2 fx_site= fx_site_combo seq=seq_COMBO));
648        set _tmp_combo(where=(seq_cq^="0000" and seq_cq^=" ") );
649        by patid seq;
650        length  index_fx_begin 4 alone_combo $5;
651        alone_combo="alone";
652            format index_fx_begin mmddyy10.;
653            index_fx_begin=seq_start_date;
654        
655         rc=hpid.find(key:patid);
656        
657         do while (rc = 0);
658         if rc=0 and abs(seq_start_date-seq_start_date2) <=30 and fx_site_combo^=fx_site then alone_combo= 'combo';
659         rc=hpid.find_next();
660         *hpid.has_next(result:r);
661        end;
662        if alone_combo="alone" then do;
663            seq_start_date2=.; fx_site_combo=" "; seq_COMBO=.;
664        end;
665        run;

NOTE: There were 6683 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: There were 6683 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.SEQ_COMBO has 6683 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.01 seconds
      

666        proc freq data=seq_COMBO; tables alone_combo; run;

                                                                  --- AS project ---                             09:21 Thursday, September 7, 2017   7

                                                                  The FREQ Procedure

                                             alone_                             Cumulative    Cumulative
                                             combo     Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             alone         5812       86.97          5812        86.97  
                                             combo          871       13.03          6683       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 6683 observations read from the data set WORK.SEQ_COMBO.
NOTE: The PROCEDURE FREQ printed page 7.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

667        
668        proc sort data = Work.seq_COMBO;
669          by patid seq_start_date;
670        run;

NOTE: There were 6683 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 6683 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
      

671        
672        data combo_seq;
673        set seq_COMBO;
674        by patid seq_start_date;
675        length combo_fx_site $30. combo_seq 4;
676        retain combo_seq 0 combo_fx_site;
677        if first.patid or seq_start_date-lag(seq_start_date) then combo_seq=1+combo_seq;
678        where seq_cq^='0000' and seq_cq^=' ';
679        if combo_fx_site=" " or ""<site_order<lag(site_order) then combo_fx_site=fx_site;
680        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      1 at 677:33   
NOTE: There were 6683 observations read from the data set WORK.SEQ_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.COMBO_SEQ has 6683 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
15                                                                  The SAS System                                   09:21 Thursday, September 7, 2017

      cpu time            0.01 seconds
      

681        
682        proc sort data = Work.seq_COMBO;
683          by patid seq;
684        run;

NOTE: There were 6683 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 6683 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.03 seconds
      cpu time            0.00 seconds
      

685        
686        data FX_CLM_DB;
687        merge _dat2 seq_start seq_end seq_cq(drop=fx_site) seq_COMBO(keep=patid seq alone_combo);
688        by patid seq;
689        run;

NOTE: There were 332280 observations read from the data set WORK._DAT2.
NOTE: There were 22014 observations read from the data set WORK.SEQ_START.
NOTE: There were 26818 observations read from the data set WORK.SEQ_END.
NOTE: There were 26818 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 6683 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.FX_CLM_DB has 332280 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           0.48 seconds
      cpu time            0.43 seconds
      

690        
691        proc sql;
692        select count(distinct seq) from FX_CLM_DB;
                                                                  --- AS project ---                             09:21 Thursday, September 7, 2017   8

                                                                               
                                                                       --------
                                                                          26818
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
693        quit;
NOTE: The PROCEDURE SQL printed page 8.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.28 seconds
      cpu time            0.28 seconds
      

694        
695        
696        
697        
698        /*
699        Collapse to fracture episodes
700        
701        Q: Why are some seq_start_date values missing?
702         */
703        proc sort
704          data = Work.fx_clm_db
705          out = Work.fractureEpisodes (drop = seq
706                                       rename = (seq_start_date = fractureEpisodeStart
707                                                 seq_end_date = fractureEpisodeEnd
708                                                 fx_site = fractureSite))
709          nodupkey;
710          by patid seq seq_start_date seq_end_date fx_site;
711        run;

NOTE: There were 332280 observations read from the data set WORK.FX_CLM_DB.
NOTE: 305462 observations with duplicate key values were deleted.
NOTE: The data set WORK.FRACTUREEPISODES has 26818 observations and 24 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.28 seconds
      cpu time            0.40 seconds
      

712        
713        proc sql;
714          create table DT.fractureEpisodesPrev as
16                                                                  The SAS System                                   09:21 Thursday, September 7, 2017

715            select A.database,
716                   A.exposure,
717                   A.indexGNN,
718                   A.indexDate,
719                   A.ASCohortDate,
720                   A.indexID,
721                   A.age,
722                   A.sex,
723                   B.*,
724                   case
725                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
726                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
727                     else ""
728                     end as fractureType
729            from DT.indexLookup A inner join
730                 Work.fractureEpisodes B on (A.patid = B.patid);
NOTE: Table DT.FRACTUREEPISODESPREV created, with 45396 rows and 33 columns.

731          create table Work.summaryFractureEpisodesPrev as
732            select "DT.fractureEpisodesPrev" as table,
733                   fractureType, fractureSite,
734                   count(distinct patid) as countDistinctPatid,
735                   count(*) as countFractureEpisodes
736            from DT.fractureEpisodesPrev
737            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESPREV created, with 23 rows and 5 columns.

738          select * from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                             09:21 Thursday, September 7, 2017   9

                                                                                                                    count         count
                                                                                                                 Distinct      Fracture
               table                    fractureType                         fractureSite                           Patid      Episodes
               ------------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesPrev                                       (7331) pathologic nos/nec                628          1175
               DT.fractureEpisodesPrev                                       (800-804) skull/face                     504           954
               DT.fractureEpisodesPrev                                       (807) rib/sternum/trachea               1257          2462
               DT.fractureEpisodesPrev                                       (809) trunk bones                         19            33
               DT.fractureEpisodesPrev                                       (810) clavicle                           286           541
               DT.fractureEpisodesPrev                                       (811) scapula                            117           209
               DT.fractureEpisodesPrev                                       (814) carpal                             571          1126
               DT.fractureEpisodesPrev                                       (815-817) hand/fingers                   798          1618
               DT.fractureEpisodesPrev                                       (818-819) arms mult                       34            61
               DT.fractureEpisodesPrev                                       (822) patella                            678          1436
               DT.fractureEpisodesPrev                                       (823, 73316) tib_fib                     725          1517
               DT.fractureEpisodesPrev                                       (824) ankle                              857          1816
               DT.fractureEpisodesPrev                                       (825) tarsal_metatarsal                  798          1779
               DT.fractureEpisodesPrev                                       (826) foot_phalanges                     494           986
               DT.fractureEpisodesPrev                                       (827) lower_limb                          47            91
               DT.fractureEpisodesPrev                                       (828) legs+arm/rib                        12            15
               DT.fractureEpisodesPrev                                       (829) fx_nos                            2665          5368
               DT.fractureEpisodesPrev  Clinical vertebral fracture          (805, 806, 73313) spine                 4325         11132
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (808) pelvis                             525          1060
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (812, 73311) humerus                     844          1791
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                1049          2163
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (820, 73314) hip                        2747          6004
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (821, 73315) femur                       998          2059
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
739          select "DT.fractureEpisodesPrev" as table,
740                 sum(countDistinctPatid) as sumDistinctPatid,
741                 sum(countFractureEpisodes) as sumFractureEpisodes
742            from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                             09:21 Thursday, September 7, 2017  10

                                                                           sumDistinct   sumFracture
                                                 table                           Patid      Episodes
                                                 ---------------------------------------------------
                                                 DT.fractureEpisodesPrev         20978         45396
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
743        
744          create table DT.fractureEpisodesInc as
745            select A.database,
746                   A.ENR_END_DATE,
747                   A.DEATH_DATE,
748                   A.exposure,
749                   A.exposureStart,
750                   A.exposureEnd,
751                   A.daysExposed,
752                   A.exposureID,
753                   B.*,
754                   case
755                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
756                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
757                     else ""
758                     end as fractureType
759            from DT.exposureTimeline A inner join
760                 Work.fractureEpisodes B on (A.patid = B.patid  & A.exposureStart <= B.fractureEpisodeStart <= A.exposureEnd);
NOTE: Table DT.FRACTUREEPISODESINC created, with 11133 rows and 33 columns.

761          create table Work.summaryFractureEpisodesInc as
762            select "DT.fractureEpisodesInc" as table,
763                   fractureType, fractureSite,
764                   count(distinct patid) as countDistinctPatid,
765                   count(*) as countFractureEpisodes
766            from DT.fractureEpisodesInc
767            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESINC created, with 23 rows and 5 columns.

768          select * from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                             09:21 Thursday, September 7, 2017  11

                                                                                                                   count         count
                                                                                                                Distinct      Fracture
               table                   fractureType                         fractureSite                           Patid      Episodes
               -----------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesInc                                       (7331) pathologic nos/nec                163           180
               DT.fractureEpisodesInc                                       (800-804) skull/face                     260           280
               DT.fractureEpisodesInc                                       (807) rib/sternum/trachea                693           780
               DT.fractureEpisodesInc                                       (809) trunk bones                         10            10
               DT.fractureEpisodesInc                                       (810) clavicle                           147           152
               DT.fractureEpisodesInc                                       (811) scapula                             66            67
               DT.fractureEpisodesInc                                       (814) carpal                             176           188
               DT.fractureEpisodesInc                                       (815-817) hand/fingers                   410           440
               DT.fractureEpisodesInc                                       (818-819) arms mult                       17            18
               DT.fractureEpisodesInc                                       (822) patella                            104           122
               DT.fractureEpisodesInc                                       (823, 73316) tib_fib                     303           348
               DT.fractureEpisodesInc                                       (824) ankle                              367           410
               DT.fractureEpisodesInc                                       (825) tarsal_metatarsal                  386           450
               DT.fractureEpisodesInc                                       (826) foot_phalanges                     270           281
               DT.fractureEpisodesInc                                       (827) lower_limb                          17            17
               DT.fractureEpisodesInc                                       (828) legs+arm/rib                         4             4
               DT.fractureEpisodesInc                                       (829) fx_nos                             219           238
               DT.fractureEpisodesInc  Clinical vertebral fracture          (805, 806, 73313) spine                 2431          3388
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (808) pelvis                             278           320
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (812, 73311) humerus                     445           525
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                 487           552
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (820, 73314) hip                        1444          1705
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (821, 73315) femur                       555           658
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
769          select "DT.fractureEpisodesInc" as table,
770                 sum(countDistinctPatid) as sumDistinctPatid,
771                 sum(countFractureEpisodes) as sumFractureEpisodes
772            from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                             09:21 Thursday, September 7, 2017  12

                                                                           sumDistinct   sumFracture
                                                  table                          Patid      Episodes
                                                  --------------------------------------------------
                                                  DT.fractureEpisodesInc          9252         11133
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
773        quit;
NOTE: The PROCEDURE SQL printed pages 9-12.
NOTE: PROCEDURE SQL used (Total process time):
      real time           1.04 seconds
      cpu time            0.65 seconds
      
17                                                                  The SAS System                                   09:21 Thursday, September 7, 2017


774        
775        
776        
777        
778        /*
779        CLEAN UP
780        
781        proc sql;
782          drop table UCB.tempFracDxMPCD;
783          drop table UCB.tempFracDxUCB;
784          drop table UCB.tempFracDxSABR;
785          drop table UCB.tempFracPxMPCD;
786          drop table UCB.tempFracPxUCB;
787          drop table UCB.tempFracPxSABR;
788        quit;
789         */
790        
791        
792        proc export
793          data = Work.summaryFractureEpisodes
794          outfile = "data\processed\&cmt..csv"
795          dbms = csv
796          replace;
797          delimiter = '09'x;
798        run;

ERROR: File WORK.SUMMARYFRACTUREEPISODES.DATA does not exist. 
ERROR: Export unsuccessful.  See SAS Log for details.
NOTE: PROCEDURE EXPORT used (Total process time):
      real time           0.52 seconds
      cpu time            0.00 seconds
      

799        
800        
801        ods html close;
ERROR: Errors printed on page 17.

NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           2:20.07
      cpu time            2:07.37
      
