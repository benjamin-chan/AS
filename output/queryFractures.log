1                                          The SAS System                11:47 Friday, June 22, 2018

NOTE: Copyright (c) 2016 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M5) 
      Licensed to UNIVERSITY OF ALABAMA AT BIRMINGHAM - SFA - T&R, Site 70086550.
NOTE: This session is executing on the X64_DS08R2  platform.



NOTE: Updated analytical products:
      
      SAS/STAT 14.3
      SAS/ETS 14.3
      SAS/IML 14.3
      SAS/QC 14.3

NOTE: Additional host information:

 X64_DS08R2 WIN 6.1.7601 Service Pack 1 Server

--- PEER News and Updates ---

: SECURITY REMINDER :
Please remember not to copy any data files that contain PHI (protected health identifiers) to any 
of the shared folders.

 


NOTE: SAS initialization used:
      real time           1.61 seconds
      cpu time            0.45 seconds
      
1          *  University of Alabama at Birmingham                               *
2          *  AS project                                            *
3          **********************************************************************;
4          options pagesize=74 linesize=150 pageno=1 missing=' ' date FORMCHAR="|----|+|---+=|-/\<>*";
5          * Programmer    : Benjamin Chan <chanb@ohsu.edu>
6          * Creation date :
7          * Modify date   :
8          ;
9          %let cmt=queryFractures; * type the name of your program here (without the filename extension);
10         %let pgm=&cmt..sas;
11         %include "lib\libname.sas" ;
NOTE: Libref STDC5P was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: H:\studies\osteo\data\STD_files\5pct\
NOTE: Libref STD_SABR was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\data\std_SABER\
NOTE: Libref MPSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\mpcd\data\stddata\
NOTE: Libref UCBSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\stddata\
NOTE: Libref UCB was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB\
NOTE: Libref UCB64 was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB64\
NOTE: Libref DT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: V:\studies\AS\data
NOTE: Libref NDC was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: W:\onenote\references\drug ndcs\sas data
143        footnote "&pgm.";
144        * footnote2 "%sysfunc(datetime(),datetime14.)";
145        title1 '--- AS project ---';
146        **********************************************************************;
147        options macrogen mlogic mprint symbolgen;
148        options nomacrogen nomlogic nomprint nosymbolgen;
2                                                                   The SAS System                                         11:47 Friday, June 22, 2018

149        
150        
151        ods html
152          body = "output\&cmt..html"
153          style = Statistical;
NOTE: Writing HTML Body file: output\queryFractures.html
154        
155        
156        /*
157        FRACTURES
158        
159        See "ALGORITHMS TO ENHANCE SPECIFICITY OF FRACTURE IDENTIFICATION_ 100316.docx"
160        
161        Adapted from Lang's code in "001_fx_data.sas"
162        
163        
164        From: Chen, Lang [mailto:langchen@uabmc.edu]
165        Sent: Monday, July 24, 2017 8:56 AM
166        To: Benjamin Chan <chanb@ohsu.edu>
167        Subject: RE: fracture identification algorithm
168        
169        Here it is.
170        For 001_fx_data, find all fx related claim and run the algorithm.
171        Please ignore any code after line 476
172        Modify code from line 1 -50
173        
174        For 002_fx_epi_data
175        Define fx episode.
176        
177        Final output data is fx_dgns_&firstyr._&lastyr._4. Please let me if you have any questions.
178         */
179        
180        
181        /*
182        START OF 001_fx_data.sas
183         */
184        
185        
186        /*Assign "Broad" fracture site (fx_site) for all ICD9 diagnoses, outputting separately, so some records are cloned, then combining into one
186      !  file */
187        /*No longer using matched trauma files here*/
188        
189        %macro comballfxdgns;
190            data fx_dgns;
191                set UCB64.tempFracDxAll (where = (diagCodeType = "Fracture code"));
192                    length fx_site $30 ;
193                    fx_site = '';
194                    if strip(DX) in: ('800' '801' '802' '803' '804') then           do; fx_site='(800-804) skull/face'; output; end;
195                    if strip(DX) in: ('805', '806') or strip(DX)='73313' then       do; fx_site='(805, 806, 73313) spine'; output; end;
196                    if strip(DX) in: ('807') then                                           do; fx_site='(807) rib/sternum/trachea'; output; end;
197                    if strip(DX) in: ('808') then                                           do; fx_site='(808) pelvis'; output; end;
198                    if strip(DX) in: ('809') then                                           do; fx_site='(809) trunk bones'; output; end;
199                    if strip(DX) in: ('810') then                                           do; fx_site='(810) clavicle'; output; end;
200                    if strip(DX) in: ('811') then                                           do; fx_site='(811) scapula'; output; end;
201                    if strip(DX) in: ('812') or strip(DX)='73311' then              do; fx_site='(812, 73311) humerus'; output; end;
202                    if strip(DX) in: ('813') or strip(DX)='73312' then              do; fx_site='(813, 73312) radius_ulna'; output; end;
203                    if strip(DX) in: ('814') then                                           do; fx_site='(814) carpal'; output; end;
204                    if strip(DX) in: ('815' '816' '817') then                           do; fx_site='(815-817) hand/fingers'; output; end;
205                    if strip(DX) in: ('818' '819') then                                     do; fx_site='(818-819) arms mult'; output; end;
206                    if strip(DX) in: ('820') or strip(DX) = '73314' then                do; fx_site='(820, 73314) hip'; output; end;
207                    if strip(DX) in: ('821') or strip(DX)='73315' then              do; fx_site='(821, 73315) femur'; output; end;
208                    if strip(DX) in: ('822') then                                           do; fx_site='(822) patella'; output; end;
209                    if strip(DX) in: ('823') or strip(DX)='73316' then              do; fx_site='(823, 73316) tib_fib'; output; end;
210                    if strip(DX) in: ('824') then                                           do; fx_site='(824) ankle'; output; end;
211                    if strip(DX) in: ('825') then                                           do; fx_site='(825) tarsal_metatarsal'; output; end;
212                    if strip(DX) in: ('826') then                                           do; fx_site='(826) foot_phalanges'; output; end;
213                    if strip(DX) in: ('827') then                                           do; fx_site='(827) lower_limb'; output; end;
214                    if strip(DX) in: ('828') then                                           do; fx_site='(828) legs+arm/rib'; output; end;
215                    if strip(DX) in: ('829') then                                           do; fx_site='(829) fx_nos'; output; end;
216                    if strip(DX) in ('73310' '73319' '7331') then                 do; fx_site='(7331) pathologic nos/nec'; output; end;
217            data fx_excare;
218                set UCB64.tempFracDxAll (where = (diagCodeType = "Extended care code"));
3                                                                   The SAS System                                         11:47 Friday, June 22, 2018

219                    length fx_site $30 ;
220                    fx_site = '';
221                    /*Expanded Diagnosis Codes - Fracture Aftercare Codes*/
222                    if strip(DX) in ('V5410' 'V5420') then                          do; fx_site='(812, 73311) humerus'; output;
223                                                                                                     fx_site='(813, 73312) radius_ulna'; output;
223      ! end;
224                    if strip(DX) in ('V5411' 'V5421') then                          do; fx_site='(812, 73311) humerus'; output; end;
225                    if strip(DX) in ('V5412' 'V5422') then                          do; fx_site='(813, 73312) radius_ulna'; output;
226                                                                                                     fx_site='(814) carpal'; output; end;
227                    if strip(DX) in ('V5413' 'V5423') then                          do; fx_site='(820, 73314) hip'; output; end;
228                    if strip(DX) in ('V5414' 'V5424') then                          do; fx_site='(820, 73314) hip'; output;
229                                                                                                     fx_site='(821, 73315) femur'; output;
230                                                                                                     fx_site='(822) patella'; output;
231                                                                                                     fx_site='(824) ankle'; output;
232                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
233                    if strip(DX) in ('V5415' 'V5425') then                          do; fx_site='(820, 73314) hip'; output;
234                                                                                                     fx_site='(821, 73315) femur'; output;
235                                                                                                     fx_site='(822) patella'; output; end;
236                    if strip(DX) in ('V5416' 'V5426') then                          do; fx_site='(824) ankle'; output;
237                                                                                                     fx_site='(822) patella'; output;
238                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
239                    if strip(DX) in ('V5417' 'V5427') then                          do; fx_site='(805, 806, 73313) spine'; output; end;
240                    if strip(DX) in: ('V542') then                                       do; fx_site='(7331) pathologic nos/nec'; output; end;
241                    if strip(DX) in: ('V541') then                                       do; fx_site='(829) fx_nos'; output; end;
242            run;
243        
244            /* proc sort data=fx_dgns; by patid BEGIN_DATE fx_site; run;
245            proc sort data=fx_excare; by patid BEGIN_DATE fx_site; run; */
246        %mend;
247        %comballfxdgns;

NOTE: There were 74073 observations read from the data set UCB64.TEMPFRACDXALL.
      WHERE diagCodeType='Fracture code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_DGNS has 74073 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.61 seconds
      cpu time            0.32 seconds
      


NOTE: There were 4562 observations read from the data set UCB64.TEMPFRACDXALL.
      WHERE diagCodeType='Extended care code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_EXCARE has 10257 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.10 seconds
      cpu time            0.07 seconds
      

248        
249        /*Now, assign a more specific fracture site (e.g., closed, other) (site) that is used in the CQ algorithms*/
250        /*Since Expanded Diagnosis Codes (V Codes) apply to sub-categories of each broad fracture site, clone records for these so they appear in
250      ! both places*/
251        
252        data fx_dgns_2;
253            set fx_dgns;
254        
255            length site $30;
256        
257            site="";
258        
259            *Spine-closed and Spine-other;
260            if fx_site='(805, 806, 73313) spine' then
261                do;
262                    site = 'spine_cls'; /*Includes V Codes and 73313 here*/
263                    if substr(strip(DX),1,3) in ('805' '806') and substr(strip(DX),1,4) ^in ('8050', '8052', '8054', '8058') then
264                        site = 'spine_oth';
265                end;
266        
267            *Pelvis-closed and Pelvis-other... No V Codes;
268            if fx_site='(808) pelvis' then
4                                                                   The SAS System                                         11:47 Friday, June 22, 2018

269                do;
270                    site = 'pelvis_cls';
271                    if substr(strip(DX),1,3)='808' and substr(strip(DX),1,4) ^in ('8080', '8082', '8084', '8088') then
272                        site = 'pelvis_oth';
273                end;
274        
275            *Clavicle-closed and Clavicle-other.... No V Codes;
276            if fx_site='(810) clavicle' then
277                do;
278                    site = 'clv_cls';
279                    if substr(strip(DX),1,3) = '810' and substr(strip(DX),1,4) ^in ('8100') then
280                        site = 'clv_oth';
281                end;
282        
283            *Humerus-closed and Humerus-other;
284            if fx_site='(812, 73311) humerus' then
285                do;
286                    site = 'hmrs_cls'; /*Includes V Codes and 73311 here*/
287                    if substr(strip(DX),1,3)= '812' and substr(strip(DX),1,4) ^in ('8120', '8122', '8124') then
288                        site = 'hmrs_oth';
289                end;
290        
291            *Distal radius/ulna and Radius/ulna-other;
292            if fx_site='(813, 73312) radius_ulna' then
293                do;
294                 site = 'dist4arm'; /*Includes V Codes and 73312 here*/
295                    if substr(strip(DX),1,3) = '813' and substr(strip(DX),1,4) ^in ('8134', '8135') then
296                        site = 'rad_ul_oth';
297                end;
298        
299            *Carpal... V Codes present but only one category;
300            if fx_site='(814) carpal' then
301                do;
302                    site = 'carpal';
303                 end;
304        
305            *Hip-closed and Hip-other;
306            if fx_site='(820, 73314) hip' then
307                    do;
308                    site = 'hip_cls'; /*Includes V Codes and 73314 here*/
309                    if substr(strip(DX),1,3)='820' and substr(strip(DX),1,4) ^in ('8200', '8202', '8208') then
310                        site = 'hip_oth';
311                end;
312        
313            *Other femur-closed and Other femur-other;
314            if fx_site='(821, 73315) femur' then
315                do;
316                    site = 'oth_fem_cls'; /*Includes V Codes and 73315 here*/
317                    if substr(strip(DX),1,3)='821' and substr(strip(DX),1,4) ^in ('8210', '8212') then
318                        site = 'oth_fem_oth';
319                end;
320        
321            *Tib/fib-closed and Tib/fib-other;
322            if fx_site='(823, 73316) tib_fib' then
323                do;
324                    site = 'tib_fib_cls'; /*Includes V Codes and 73316 here*/
325                    if substr(strip(DX),1,3)='823' and substr(strip(DX),1,4) ^in ('8230', '8232', '8238') then
326                        site = 'tib_fib_oth';
327                end;
328        
329            *Ankle... V Codes present but only one category;
330            if fx_site='(824) ankle' then
331                do;
332                    site = 'ankle';
333                end;
334        
335            /*Assign site for other fx_sites that do not have CQ algorithm and thus no sub categories*/
336            if site = "" then do;
337                site = fx_site;
338            end;
339        
340            label site = 'CQ Algorithm Fracture Site (Specific)';
5                                                                   The SAS System                                         11:47 Friday, June 22, 2018

341        
342        run;

NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD exposure=DMARD patid=104066289 indexGNN=HYDROXYCHLOROQUINE indexDate=09/15/2010 age=25 SEX=F asDate=09/14/2010 ENR_START_DATE=02/01/2007
ENR_END_DATE=12/31/2010 asCohortDate=09/14/2010 DEATH_DATE= indexID=209 ENCOUNTERID=10735519963 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=01/21/2010
DISCHARGE_DATE= END_DATE=01/21/2010 DX_TYPE=09 DX=810 PDX=O codeType=ICD9-DX code=810 PROV_TYPE=8 diagCodeType=Fracture code fx_site=(810) clavicle
site=clv_oth _ERROR_=1 _N_=95
NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD exposure=DMARD patid=104066289 indexGNN=HYDROXYCHLOROQUINE indexDate=09/15/2010 age=25 SEX=F asDate=09/14/2010 ENR_START_DATE=02/01/2007
ENR_END_DATE=12/31/2010 asCohortDate=09/14/2010 DEATH_DATE= indexID=209 ENCOUNTERID=10735519963 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=01/21/2010
DISCHARGE_DATE= END_DATE=01/21/2010 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX code=810 PROV_TYPE=8 diagCodeType=Fracture code fx_site=(810) clavicle
site=clv_oth _ERROR_=1 _N_=96
NOTE: There were 74073 observations read from the data set WORK.FX_DGNS.
NOTE: The data set WORK.FX_DGNS_2 has 74073 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.15 seconds
      cpu time            0.14 seconds
      

343        
344        /*###########################################################################################################*/
345        /***************************************************Intermediate Fracture Diagnosis File**********************/
346        /*Combine CQ diagnosis files*******************************************************/
347        data fx_dgns_3;
348            set fx_dgns_2
349        /*    fx_excare_*/
350                ;
351        run;

NOTE: There were 74073 observations read from the data set WORK.FX_DGNS_2.
NOTE: The data set WORK.FX_DGNS_3 has 74073 observations and 28 variables.
NOTE: DATA statement used (Total process time):
      real time           0.14 seconds
      cpu time            0.09 seconds
      

352        
353        proc freq data=fx_dgns_3;
354            tables fx_site site;
355        run;

                                                                  --- AS project ---                                   11:47 Friday, June 22, 2018   1

                                                                  The FREQ Procedure

                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec        1473        1.99          1473         1.99  
                                    (800-804) skull/face             1970        2.66          3443         4.65  
                                    (805, 806, 73313) spine         18188       24.55         21631        29.20  
                                    (807) rib/sternum/trachea        3944        5.32         25575        34.53  
                                    (808) pelvis                     4343        5.86         29918        40.39  
                                    (809) trunk bones                  71        0.10         29989        40.49  
                                    (810) clavicle                    775        1.05         30764        41.53  
                                    (811) scapula                     264        0.36         31028        41.89  
                                    (812, 73311) humerus             5370        7.25         36398        49.14  
                                    (813, 73312) radius_ulna         6452        8.71         42850        57.85  
                                    (814) carpal                     1313        1.77         44163        59.62  
                                    (815-817) hand/fingers           2534        3.42         46697        63.04  
                                    (818-819) arms mult                58        0.08         46755        63.12  
                                    (820, 73314) hip                 9570       12.92         56325        76.04  
                                    (821, 73315) femur               2232        3.01         58557        79.05  
                                    (822) patella                    1263        1.71         59820        80.76  
                                    (823, 73316) tib_fib             1747        2.36         61567        83.12  
                                    (824) ankle                      4186        5.65         65753        88.77  
                                    (825) tarsal_metatarsal          5758        7.77         71511        96.54  
                                    (826) foot_phalanges             2115        2.86         73626        99.40  
                                    (827) lower_limb                   53        0.07         73679        99.47  
                                    (828) legs+arm/rib                  8        0.01         73687        99.48  
                                    (829) fx_nos                      386        0.52         74073       100.00  


                                                        CQ Algorithm Fracture Site (Specific)
 
                                                                                          Cumulative    Cumulative
                                    site                         Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec        1473        1.99          1473         1.99  
                                    (800-804) skull/face             1970        2.66          3443         4.65  
                                    (807) rib/sternum/trachea        3944        5.32          7387         9.97  
                                    (809) trunk bones                  71        0.10          7458        10.07  
                                    (811) scapula                     264        0.36          7722        10.42  
                                    (815-817) hand/fingers           2534        3.42         10256        13.85  
                                    (818-819) arms mult                58        0.08         10314        13.92  
                                    (822) patella                    1263        1.71         11577        15.63  
                                    (825) tarsal_metatarsal          5758        7.77         17335        23.40  
                                    (826) foot_phalanges             2115        2.86         19450        26.26  
                                    (827) lower_limb                   53        0.07         19503        26.33  
                                    (828) legs+arm/rib                  8        0.01         19511        26.34  
                                    (829) fx_nos                      386        0.52         19897        26.86  
                                    ankle                            4186        5.65         24083        32.51  
                                    carpal                           1313        1.77         25396        34.29  
                                    clv_cls                           761        1.03         26157        35.31  
                                    clv_oth                            14        0.02         26171        35.33  
                                    dist4arm                         4746        6.41         30917        41.74  
                                    hip_cls                          9138       12.34         40055        54.08  
                                    hip_oth                           432        0.58         40487        54.66  
                                    hmrs_cls                         5251        7.09         45738        61.75  
                                    hmrs_oth                          119        0.16         45857        61.91  
                                    oth_fem_cls                      2201        2.97         48058        64.88  
                                    oth_fem_oth                        31        0.04         48089        64.92  
                                    pelvis_cls                       4307        5.81         52396        70.74  
                                    pelvis_oth                         36        0.05         52432        70.78  
                                    rad_ul_oth                       1706        2.30         54138        73.09  
                                    spine_cls                       16528       22.31         70666        95.40  
                                    spine_oth                        1660        2.24         72326        97.64  
                                    tib_fib_cls                      1536        2.07         73862        99.72  
                                    tib_fib_oth                       211        0.28         74073       100.00  
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 74073 observations read from the data set WORK.FX_DGNS_3.
NOTE: The PROCEDURE FREQ printed page 1.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.21 seconds
      cpu time            0.12 seconds
      

356        
357        proc sort data=fx_dgns_3;
358            by patid ENCOUNTERID fx_site site;
359        run;

NOTE: There were 74073 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_3 has 74073 observations and 28 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.25 seconds
      cpu time            0.20 seconds
      

360        
361        
362        /*###########################################################################################################*/
363        /*************************************************************************************************************/
364        /*Look for repair procedures and assign treatment site*******************/
365        /*This code has been updated to include hip/femur replacement with matching diagnosis code, also looked in claim strip(DX) not just primary
365      !  strip(DX)
366        /*Not accepting contiguous sites until later*/
367        /*Excluding procedures from DME files*/
368        /*******************************Select All Spine Imaging Codes from STD Procedure Files for CQ=4/5 algorithms*/
369        
6                                                                   The SAS System                                         11:47 Friday, June 22, 2018

370        %macro fx_prcd;
371            data fx_prcd spine_xray;
372                set UCB64.tempFracPxAll;
373        
374                    length tx_site $30;
375                    length HLAT $1;
376        
377                    if strip(px) in ('21300' '21310' '21315' '21320' '21325' '21330' '21335' '21336' '21337' '21338' '21339' '21340' '21343'
377      ! '21344' '21345' '21346' '21347' '21348'
378                                         '21355' '21356' '21360' '21365' '21366' '21385' '21386' '21387' '21390' '21395' '21400' '21401' '21406'
378      ! '21407' '21408' '21421' '21422' '21423'
379                                         '21431' '21432' '21433' '21435' '21436' '21440' '21445' '21450' '21451' '21452' '21453' '21454' '21461'
379      ! '21462' '21465' '21470'
380                                         '62000' '62005' '62010')  and lengthn(strip(px)) = 5 then do;
381                        tx_site='(800-804) skull/face'; output fx_prcd; end;
382        
383                    if strip(px) in ('22305' '22310' '22315' '22318' '22319' '22325' '22326' '22327' '22328' '22520' '22521' '22522' '22523'
383      ! '22524' '22525' '76012' '76013'
384                                         'S2360' 'S2361' 'S2362' 'S2363' '72291' '72292')  and lengthn(strip(px)) = 5 then do;
385                        tx_site = '(805, 806, 73313) spine'; output fx_prcd; end;
386        
387                    if  strip(px) in ('21493' '21494' '21495' '21800' '21805' '21810' '21820' '21825' ) then do;
388                        tx_site='(807) rib/sternum/trachea'; output fx_prcd; end;
389        
390                    if strip(px) in ('27193' '27194' '27215' '27216' '27217' '27218' '27220' '27222' '27226' '27227' '27228')  and
390      ! lengthn(strip(px)) = 5 then do;
391                        tx_site = '(808) pelvis'; output fx_prcd; end;
392        
393                    if strip(px) in ('23500' '23505' '23515')  and lengthn(strip(px)) = 5 then do;
394                        tx_site = '(810) clavicle'; output fx_prcd; end;
395        
396                    if strip(px) in ('23570' '23575' '23585') then do;
397                        tx_site= '(811) scapula'; output fx_prcd; end;
398        
399                    if strip(px) in ('23600' '23605' '23615' '23616' '23620' '23625' '23630' '23665' '24500' '24505' '24515' '24516' '24530'
399      ! '24535' '24538' '24545' '24546' '24560'
400                                 '24565' '24566' '24575' '24576' '24577' '24579' '24582')  and lengthn(strip(px)) = 5 then do;
401                        tx_site = '(812, 73311) humerus'; output fx_prcd; end;
402        
403                    if strip(px) in ('25600' '25605' '25606' '25607' '25608' '25609' '25620' '25650' '25651' '25652')  and lengthn(strip(px)) = 5
403      ! then do;
404                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
405        
406                    if strip(px) in ('24650' '24655' '24665' '24666' '24670' '24675' '24685' '25500' '25505' '25515' '25520' '25525' '25526'
406      ! '25530' '25535' '25545' '25560' '25565'
407                                 '25574' '25575')  and lengthn(strip(px)) = 5 then do;
408                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
409        
410                    if strip(px) in ('25622' '25624' '25628' '25630' '25635' '25645' '25680' '25685')  and lengthn(strip(px)) = 5 then do;
411                        tx_site = '(814) carpal'; output fx_prcd; end;
412        
413                    if strip(px) in ('26600' '26605' '26607' '26608' '26615' '26645' '26650' '26665' '26720' '26725' '26727' '26735' '26740'
413      ! '26742' '26746' '26750' '26755' '26756' '26765' )
414                               and lengthn(strip(px)) = 5 then do;
415                        tx_site='(815-817) hand/fingers'; output fx_prcd; end;
416        
417                    if '27230' <= strip(px) <= '27248' and lengthn(strip(px)) = 5 then do;
418                        tx_site = '(820, 73314) hip'; output fx_prcd; end;
419        
420                    if '27500' <= strip(px) <= '27514'  and lengthn(strip(px)) = 5 then do;
421                        tx_site = '(821, 73315) femur'; output fx_prcd; end;
422        
423                    if strip(px) in ('27520' '27524')  and lengthn(strip(px)) = 5 then do;
424                        tx_site = '(822) patella'; output fx_prcd; end;
425        
426                    if ('27530' <= strip(px) <= '27536' or '27750' <= strip(px) <= '27759' or '27780' <= strip(px) <= '27784' or '27824' <=
426      ! strip(px) <= '27828') and lengthn(strip(px)) = 5  then do;
427                        tx_site = '(823, 73316) tib_fib'; output fx_prcd; end;
428        
429                    if strip(px) in ('27760' '27762' '27766' '27786' '27788' '27792' '27808' '27810' '27814' '27816' '27818' '27822' '27823'
429      ! '28430' '28435' '28436' '28445')  and lengthn(strip(px)) = 5 then do;
430                        tx_site = '(824) ankle'; output fx_prcd; end;
7                                                                   The SAS System                                         11:47 Friday, June 22, 2018

431        
432                    if strip(px) in ('28320' '28322' '28400' '28405' '28406' '28415' '28420' ) and lengthn(strip(px)) = 5 then do;
433                        tx_site='(825) tarsal_metatarsal'; output fx_prcd; end;
434        
435                 /********************************Hip/Femur Additions - must be matched with DGNS to be included*/
436                 /*Hip replacement codes*/
437                    /*Hip*/
438                    if strip(px) in ('27130' '27125') and lengthn(strip(px)) = 5  then do;
439                        HLAT='1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
440        
441                    /*Codes below are the only ICD9 Procedure Codes that we are using for "repair"*/
442                    if strip(px) in ('8151' '8152') and lengthn(strip(px)) = 4 then do;
443                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
444        
445                    /*Femur repair codes, assigned to both Hip and Femur treatment sites... CHECK - MAYBE WE NEED TO DO THIS THE OTHER WAY AS
445      ! WELL*/
446                    /*Hip*/
447                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
448                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
449        
450                    /*Femur*/
451                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
452                        HLAT = '1'; tx_site = '(821, 73315) femur'; output fx_prcd; end;
453                     /*spine image*/
454                        if '72010' <= strip(px) <= '72159' or '72240' <= strip(px) <= '72285' or strip(px) = '72295' then do;   /*Spine Imaging
454      ! Codes*/
455                        tx_site='(805, 806, 73313) spine';
456                        output spine_xray; end;
457        
458            run;
459        
460            data fx_prcd;
461                set fx_prcd;
462                /*To add laterality info*/
463        /*        array hcpcs{*} hcpcs_1st_mdfr_cd hcpcs_2nd_mdfr_cd hcpcs_3rd_mdfr_cd hcpcs_4th_mdfr_cd ; */
464                if HLAT='1' then do;
465                    repair_right='0'; repair_left='0';
466                end;
467        /*        if HLAT='1' then */
468        /*            do i=1 to dim(hcpcs);*/
469        /*                if hcpcs{i} = 'RT' then repair_right='1';*/
470        /*                else if hcpcs{i} = 'LT' then repair_left='1';*/
471        /*            end;*/
472            run;
473            proc sort data=fx_prcd nodupkey; by patid ENCOUNTERID px_date tx_site; run;
474        
475            data spine_xray;
476                set spine_xray;
477                keep patid px_date tx_site  ENCOUNTERID begin_date;
478            run;
479            proc sort data=spine_xray nodupkey; by patid px_date; run;
480        %mend;
481        %fx_prcd;

NOTE: There were 20871236 observations read from the data set UCB64.TEMPFRACPXALL.
NOTE: The data set WORK.FX_PRCD has 14158 observations and 25 variables.
NOTE: The data set WORK.SPINE_XRAY has 190551 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           33.50 seconds
      cpu time            32.62 seconds
      


NOTE: There were 14158 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK.FX_PRCD has 14158 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.03 seconds
      


NOTE: There were 14158 observations read from the data set WORK.FX_PRCD.
8                                                                   The SAS System                                         11:47 Friday, June 22, 2018

NOTE: 7681 observations with duplicate key values were deleted.
NOTE: The data set WORK.FX_PRCD has 6477 observations and 27 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.06 seconds
      cpu time            0.01 seconds
      


NOTE: There were 190551 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.SPINE_XRAY has 190551 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.18 seconds
      cpu time            0.15 seconds
      


NOTE: There were 190551 observations read from the data set WORK.SPINE_XRAY.
NOTE: 124894 observations with duplicate key values were deleted.
NOTE: The data set WORK.SPINE_XRAY has 65657 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.21 seconds
      cpu time            0.37 seconds
      

482        
483        
484        
485        data trauma (rename=(begin_date=trauma_dt));
486                set UCB64.tempFracDxAll (where = (diagCodeType = "Trauma code"));
487        run;

NOTE: There were 8040 observations read from the data set UCB64.TEMPFRACDXALL.
      WHERE diagCodeType='Trauma code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.TRAUMA has 8040 observations and 26 variables.
NOTE: DATA statement used (Total process time):
      real time           0.10 seconds
      cpu time            0.06 seconds
      

488        proc sort data= trauma(keep=patid trauma_dt) nodupkey; by patid trauma_dt;run;

NOTE: There were 8040 observations read from the data set WORK.TRAUMA.
NOTE: 4208 observations with duplicate key values were deleted.
NOTE: The data set WORK.TRAUMA has 3832 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.07 seconds
      cpu time            0.01 seconds
      

489        
490        
491        /*subset the spine xray procedure claim for patients with fx diagnosis code only*/
492        /*so SAS will not run out of memory*/
493        data fx_spine_xray(keep=patid tx_site px_date ENCOUNTERID begin_date);
494        if _n_=1 then do;
495          declare hash hid(dataset:"fx_dgns_3(where=(fx_site='(805, 806, 73313) spine')))", multidata:"N", hashexp:20);
496          rc=hid.defineKey("patid");
497          rc=hid.defineDone();
498        end;
499        set spine_xray;
500        rc=hid.find();
501        if rc=0;
502        run;

NOTE: There were 18188 observations read from the data set WORK.FX_DGNS_3.
      WHERE fx_site='(805, 806, 73313) spine';
NOTE: There were 65657 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.FX_SPINE_XRAY has 12824 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.29 seconds
      cpu time            0.12 seconds
9                                                                   The SAS System                                         11:47 Friday, June 22, 2018

      

503        /*subset the Trauma code for patients with fx diagnosis code only*/
504        /*so SAS will not run out of memory*/
505        data fx_trauma(drop=rc);
506        if _n_=1 then do;
507          declare hash hid(dataset:"fx_dgns_3", multidata:"N", hashexp:20);
508          rc=hid.defineKey("patid");
509          rc=hid.defineDone();
510        end;
511        set trauma;
512        rc=hid.find();
513        if rc=0;
514        run;

NOTE: There were 74073 observations read from the data set WORK.FX_DGNS_3.
NOTE: There were 3832 observations read from the data set WORK.TRAUMA.
NOTE: The data set WORK.FX_TRAUMA has 2214 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.14 seconds
      cpu time            0.10 seconds
      

515        /************************************Link Fracture Claims (ICD9 Diagnosis) with Repair Claims (CPT/HCPCS, some ICD9 procedure
515      ! code)***************/
516        
517        data fx_dgns_4(drop=rc: px_date tx_site xray_date trauma_dt);
518        if _n_=1 then do;
519          declare hash hid(dataset:"fx_prcd", multidata:"N", hashexp:20);
520          rc=hid.defineKey("patid", "px_date", "tx_site");
521        /*  rc=hid.defineData("px_date", "tx_site");*/
522          rc=hid.defineDone();
523          declare hash hxray(dataset:"fx_spine_xray(rename=px_date=xray_date)", multidata:"Y", hashexp:20);
524          rc=hxray.defineKey("patid", "tx_site");
525          rc=hxray.defineData("xray_date");
526          rc=hxray.defineDone();
527          declare hash htrauma(dataset:"fx_trauma", multidata:"Y", hashexp:20);
528          rc=htrauma.defineKey("patid");
529          rc=htrauma.defineData("trauma_dt");
530          rc=htrauma.defineDone();
531        end;
532        if 0 then set fx_prcd(keep=patid px_date tx_site)
533                      fx_spine_xray(keep=patid px_date tx_site rename=px_date=xray_date)
534                      fx_trauma;
535        set fx_dgns_3;
536        length cq $4 spine_image trauma_date 4 trauma $1;
537        format spine_image trauma_date mmddyy10.;
538        cq="0000";
539        rc=hid.find(key:patid, key:begin_date,key:fx_site);
540        if rc^=0 then do;
541            px_date=.;
542            tx_site=" ";
543        end;
544        if enc_type="IP" then do;
545        /*CQ = 1 Inpatient claim with primary diagnosis code */
546            if pdx="P" then substr(cq,1,1)="1";
547        /*CQ = 2 Inpatient claim with secondary diagnosis code*/
548            else substr(cq,2,1)="2";
549        end; else do;
550        /*CQ = 3 outpatient diagnosis code AND carrier line with repair/replace HCPCS*/
551            if rc=0 then substr(cq,3,1)="3";
552            rc1=hxray.find(key:patid, key:fx_site);
553            do while (rc1 = 0);
554                if begin_date-10 <=xray_date<= begin_date then do;
555                    if enc_type in ("AV" "IF" "NH" "HH" "ER" "ED") then do;
556        /*CQ = 4 outpatient [Physician E&M codes] diagnosis code with spine image/x-ray within 10 day early*/
557                        substr(cq,4,1)="4";
558                        spine_image=min(spine_image,xray_date);
559                    end;
560                end;
561                rc1=hxray.find_next(key:patid, key:fx_site);
562            end;
10                                                                  The SAS System                                         11:47 Friday, June 22, 2018

563        end;
564        /*is there trauma dx within 14 days*/
565        rc2=htrauma.find(key:patid);
566        do while (rc2 = 0) ;
567            if 0<=abs(trauma_dt-begin_date)<=14 then do;
568                    trauma="1";
569                    trauma_date=min(trauma_date,trauma_dt);
570           end ;
571           rc2=htrauma.find_next(key:patid) ;
572        end;
573        
574        run;

NOTE: There were 6477 observations read from the data set WORK.FX_PRCD.
NOTE: There were 12824 observations read from the data set WORK.FX_SPINE_XRAY.
NOTE: There were 2214 observations read from the data set WORK.FX_TRAUMA.
NOTE: There were 74073 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_4 has 74073 observations and 32 variables.
NOTE: DATA statement used (Total process time):
      real time           0.39 seconds
      cpu time            0.34 seconds
      

575        proc freq data=fx_dgns_4; tables enc_type*cq fx_site*cq trauma/missing;run;

                                                                  --- AS project ---                                   11:47 Friday, June 22, 2018   2

                                                                  The FREQ Procedure

                                                               Table of ENC_TYPE by cq

                                       ENC_TYPE(Encounter Type)     cq

                                       Frequency|
                                       Percent  |
                                       Row Pct  |
                                       Col Pct  |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       AV       |  34469 |   5016 |   1813 |    251 |      0 |      0 |  41549
                                                |  46.53 |   6.77 |   2.45 |   0.34 |   0.00 |   0.00 |  56.09
                                                |  82.96 |  12.07 |   4.36 |   0.60 |   0.00 |   0.00 |
                                                |  63.61 |  67.60 |  43.24 |  82.30 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       ED       |   9456 |   1855 |   2344 |     54 |      0 |      0 |  13709
                                                |  12.77 |   2.50 |   3.16 |   0.07 |   0.00 |   0.00 |  18.51
                                                |  68.98 |  13.53 |  17.10 |   0.39 |   0.00 |   0.00 |
                                                |  17.45 |  25.00 |  55.90 |  17.70 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       HH       |   1099 |    118 |      2 |      0 |      0 |      0 |   1219
                                                |   1.48 |   0.16 |   0.00 |   0.00 |   0.00 |   0.00 |   1.65
                                                |  90.16 |   9.68 |   0.16 |   0.00 |   0.00 |   0.00 |
                                                |   2.03 |   1.59 |   0.05 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       IP       |      0 |      0 |      0 |      0 |   5347 |   2623 |   7970
                                                |   0.00 |   0.00 |   0.00 |   0.00 |   7.22 |   3.54 |  10.76
                                                |   0.00 |   0.00 |   0.00 |   0.00 |  67.09 |  32.91 |
                                                |   0.00 |   0.00 |   0.00 |   0.00 | 100.00 | 100.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       NH       |   9161 |    431 |     34 |      0 |      0 |      0 |   9626
                                                |  12.37 |   0.58 |   0.05 |   0.00 |   0.00 |   0.00 |  13.00
                                                |  95.17 |   4.48 |   0.35 |   0.00 |   0.00 |   0.00 |
                                                |  16.91 |   5.81 |   0.81 |   0.00 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       Total       54185     7420     4193      305     5347     2623    74073
                                                   73.15    10.02     5.66     0.41     7.22     3.54   100.00


 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                   11:47 Friday, June 22, 2018   3

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (7331) pathologi |   1405 |      0 |      0 |      0 |     51 |     17 |   1473
                                   c nos/nec        |   1.90 |   0.00 |   0.00 |   0.00 |   0.07 |   0.02 |   1.99
                                                    |  95.38 |   0.00 |   0.00 |   0.00 |   3.46 |   1.15 |
                                                    |   2.59 |   0.00 |   0.00 |   0.00 |   0.95 |   0.65 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (800-804) skull/ |   1573 |      0 |    173 |      0 |    164 |     60 |   1970
                                   face             |   2.12 |   0.00 |   0.23 |   0.00 |   0.22 |   0.08 |   2.66
                                                    |  79.85 |   0.00 |   8.78 |   0.00 |   8.32 |   3.05 |
                                                    |   2.90 |   0.00 |   4.13 |   0.00 |   3.07 |   2.29 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (805, 806, 73313 |   8140 |   7420 |     42 |    305 |   1565 |    716 |  18188
                                   ) spine          |  10.99 |  10.02 |   0.06 |   0.41 |   2.11 |   0.97 |  24.55
                                                    |  44.75 |  40.80 |   0.23 |   1.68 |   8.60 |   3.94 |
                                                    |  15.02 | 100.00 |   1.00 | 100.00 |  29.27 |  27.30 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (807) rib/sternu |   2911 |      0 |    500 |      0 |    409 |    124 |   3944
                                   m/trachea        |   3.93 |   0.00 |   0.68 |   0.00 |   0.55 |   0.17 |   5.32
                                                    |  73.81 |   0.00 |  12.68 |   0.00 |  10.37 |   3.14 |
                                                    |   5.37 |   0.00 |  11.92 |   0.00 |   7.65 |   4.73 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (808) pelvis     |   3588 |      0 |    136 |      0 |    419 |    200 |   4343
                                                    |   4.84 |   0.00 |   0.18 |   0.00 |   0.57 |   0.27 |   5.86
                                                    |  82.62 |   0.00 |   3.13 |   0.00 |   9.65 |   4.61 |
                                                    |   6.62 |   0.00 |   3.24 |   0.00 |   7.84 |   7.62 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (809) trunk bone |     69 |      0 |      0 |      0 |      1 |      1 |     71
                                   s                |   0.09 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.10
                                                    |  97.18 |   0.00 |   0.00 |   0.00 |   1.41 |   1.41 |
                                                    |   0.13 |   0.00 |   0.00 |   0.00 |   0.02 |   0.04 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (810) clavicle   |    545 |      0 |    174 |      0 |     47 |      9 |    775
                                                    |   0.74 |   0.00 |   0.23 |   0.00 |   0.06 |   0.01 |   1.05
                                                    |  70.32 |   0.00 |  22.45 |   0.00 |   6.06 |   1.16 |
                                                    |   1.01 |   0.00 |   4.15 |   0.00 |   0.88 |   0.34 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (811) scapula    |    193 |      0 |     16 |      0 |     44 |     11 |    264
                                                    |   0.26 |   0.00 |   0.02 |   0.00 |   0.06 |   0.01 |   0.36
                                                    |  73.11 |   0.00 |   6.06 |   0.00 |  16.67 |   4.17 |
                                                    |   0.36 |   0.00 |   0.38 |   0.00 |   0.82 |   0.42 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               54185     7420     4193      305     5347     2623    74073
                                                       73.15    10.02     5.66     0.41     7.22     3.54   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                   11:47 Friday, June 22, 2018   4

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (812, 73311) hum |   4405 |      0 |    520 |      0 |    301 |    144 |   5370
                                   erus             |   5.95 |   0.00 |   0.70 |   0.00 |   0.41 |   0.19 |   7.25
                                                    |  82.03 |   0.00 |   9.68 |   0.00 |   5.61 |   2.68 |
                                                    |   8.13 |   0.00 |  12.40 |   0.00 |   5.63 |   5.49 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (813, 73312) rad |   5020 |      0 |   1117 |      0 |    232 |     83 |   6452
                                   ius_ulna         |   6.78 |   0.00 |   1.51 |   0.00 |   0.31 |   0.11 |   8.71
                                                    |  77.81 |   0.00 |  17.31 |   0.00 |   3.60 |   1.29 |
                                                    |   9.26 |   0.00 |  26.64 |   0.00 |   4.34 |   3.16 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (814) carpal     |   1219 |      0 |     71 |      0 |     23 |      0 |   1313
                                                    |   1.65 |   0.00 |   0.10 |   0.00 |   0.03 |   0.00 |   1.77
                                                    |  92.84 |   0.00 |   5.41 |   0.00 |   1.75 |   0.00 |
                                                    |   2.25 |   0.00 |   1.69 |   0.00 |   0.43 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (815-817) hand/f |   2021 |      0 |    458 |      0 |     51 |      4 |   2534
                                   ingers           |   2.73 |   0.00 |   0.62 |   0.00 |   0.07 |   0.01 |   3.42
                                                    |  79.76 |   0.00 |  18.07 |   0.00 |   2.01 |   0.16 |
                                                    |   3.73 |   0.00 |  10.92 |   0.00 |   0.95 |   0.15 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (818-819) arms m |     57 |      0 |      0 |      0 |      1 |      0 |     58
                                   ult              |   0.08 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.08
                                                    |  98.28 |   0.00 |   0.00 |   0.00 |   1.72 |   0.00 |
                                                    |   0.11 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (820, 73314) hip |   7156 |      0 |    336 |      0 |   1239 |    839 |   9570
                                                    |   9.66 |   0.00 |   0.45 |   0.00 |   1.67 |   1.13 |  12.92
                                                    |  74.78 |   0.00 |   3.51 |   0.00 |  12.95 |   8.77 |
                                                    |  13.21 |   0.00 |   8.01 |   0.00 |  23.17 |  31.99 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (821, 73315) fem |   1804 |      0 |    100 |      0 |    194 |    134 |   2232
                                   ur               |   2.44 |   0.00 |   0.14 |   0.00 |   0.26 |   0.18 |   3.01
                                                    |  80.82 |   0.00 |   4.48 |   0.00 |   8.69 |   6.00 |
                                                    |   3.33 |   0.00 |   2.38 |   0.00 |   3.63 |   5.11 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (822) patella    |   1064 |      0 |     84 |      0 |     79 |     36 |   1263
                                                    |   1.44 |   0.00 |   0.11 |   0.00 |   0.11 |   0.05 |   1.71
                                                    |  84.24 |   0.00 |   6.65 |   0.00 |   6.25 |   2.85 |
                                                    |   1.96 |   0.00 |   2.00 |   0.00 |   1.48 |   1.37 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               54185     7420     4193      305     5347     2623    74073
                                                       73.15    10.02     5.66     0.41     7.22     3.54   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
                                                                  --- AS project ---                                   11:47 Friday, June 22, 2018   5

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (823, 73316) tib |   1430 |      0 |    122 |      0 |    123 |     72 |   1747
                                   _fib             |   1.93 |   0.00 |   0.16 |   0.00 |   0.17 |   0.10 |   2.36
                                                    |  81.85 |   0.00 |   6.98 |   0.00 |   7.04 |   4.12 |
                                                    |   2.64 |   0.00 |   2.91 |   0.00 |   2.30 |   2.74 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (824) ankle      |   3427 |      0 |    319 |      0 |    288 |    152 |   4186
                                                    |   4.63 |   0.00 |   0.43 |   0.00 |   0.39 |   0.21 |   5.65
                                                    |  81.87 |   0.00 |   7.62 |   0.00 |   6.88 |   3.63 |
                                                    |   6.32 |   0.00 |   7.61 |   0.00 |   5.39 |   5.79 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (825) tarsal_met |   5637 |      0 |     25 |      0 |     78 |     18 |   5758
                                   atarsal          |   7.61 |   0.00 |   0.03 |   0.00 |   0.11 |   0.02 |   7.77
                                                    |  97.90 |   0.00 |   0.43 |   0.00 |   1.35 |   0.31 |
                                                    |  10.40 |   0.00 |   0.60 |   0.00 |   1.46 |   0.69 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (826) foot_phala |   2094 |      0 |      0 |      0 |     18 |      3 |   2115
                                   nges             |   2.83 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |   2.86
                                                    |  99.01 |   0.00 |   0.00 |   0.00 |   0.85 |   0.14 |
                                                    |   3.86 |   0.00 |   0.00 |   0.00 |   0.34 |   0.11 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (827) lower_limb |     52 |      0 |      0 |      0 |      1 |      0 |     53
                                                    |   0.07 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.07
                                                    |  98.11 |   0.00 |   0.00 |   0.00 |   1.89 |   0.00 |
                                                    |   0.10 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (828) legs+arm/r |      1 |      0 |      0 |      0 |      7 |      0 |      8
                                   ib               |   0.00 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   0.01
                                                    |  12.50 |   0.00 |   0.00 |   0.00 |  87.50 |   0.00 |
                                                    |   0.00 |   0.00 |   0.00 |   0.00 |   0.13 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (829) fx_nos     |    374 |      0 |      0 |      0 |     12 |      0 |    386
                                                    |   0.50 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |   0.52
                                                    |  96.89 |   0.00 |   0.00 |   0.00 |   3.11 |   0.00 |
                                                    |   0.69 |   0.00 |   0.00 |   0.00 |   0.22 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total               54185     7420     4193      305     5347     2623    74073
                                                       73.15    10.02     5.66     0.41     7.22     3.54   100.00


                                                                                Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                                          67367       90.95         67367        90.95  
                                             1             6706        9.05         74073       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 74073 observations read from the data set WORK.FX_DGNS_4.
NOTE: The PROCEDURE FREQ printed pages 2-5.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.39 seconds
      cpu time            0.28 seconds
      

576        
577        *goto 002_fx_epi.sas;
578        
579        
580        
581        
582        /*
583        START OF 002_fx_data.sas
584         */
585        
586        /*all the claims to define episode sequence */
587        data _dat0(keep=
588        PATID ENCOUNTERID ADMIT_DATE DISCHARGE_DATE BEGIN_DATE END_DATE DX DX_TYPE PDX  /* SOURCE */ ENC_TYPE fx_site px px_date
589        site cq spine_image trauma_date trauma );
590        set fx_dgns_4 fx_excare Fx_prcd(rename=tx_site=fx_site);
591        run;

NOTE: There were 74073 observations read from the data set WORK.FX_DGNS_4.
NOTE: There were 10257 observations read from the data set WORK.FX_EXCARE.
NOTE: There were 6477 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK._DAT0 has 90807 observations and 18 variables.
NOTE: DATA statement used (Total process time):
      real time           0.14 seconds
      cpu time            0.10 seconds
      

592        proc sort data=_dat0; by PATID fx_site BEGIN_DATE END_DATE; run;

NOTE: There were 90807 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT0 has 90807 observations and 18 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.18 seconds
      cpu time            0.15 seconds
      

593        /*for each claim define start and end date applicable to IP NH and NH*/
594        data _dat1;
595        set _dat0;
596        length start_date end_date 4;
597        format start_date end_date mmddyy10.;
11                                                                  The SAS System                                         11:47 Friday, June 22, 2018

598        by PATID fx_site BEGIN_DATE END_DATE;
599        start_date=min(ADMIT_DATE, BEGIN_DATE);
600        end_date=max(DISCHARGE_DATE, End_DATE);
601        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      320 at 599:12   
NOTE: There were 90807 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT1 has 90807 observations and 19 variables.
NOTE: DATA statement used (Total process time):
      real time           0.14 seconds
      cpu time            0.12 seconds
      

602        proc sort data=_dat1; by PATID fx_site start_date end_date; run;

NOTE: There were 90807 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT1 has 90807 observations and 19 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.18 seconds
      cpu time            0.17 seconds
      

603        
604        /* generate unique episode sequence ID */
605        data _dat2(drop=end_date_max lag_end_date_max _gap);
606        set _dat1;
607        length lag_end_date_max end_date_max 4;
608        format lag_end_date_max end_date_max mmddyy10.;
609        
610        by PATID fx_site start_date end_date;
611        retain seq 0;
612        
613        /*if current claims end date > all previouse claim end date in sequence, then update*/
614        end_date_max=max(end_date,end_date_max);
615        lag_end_date_max=lag(end_date_max);
616        
617        if first.fx_site then lag_end_date_max=.;
618        _gap=start_date-lag_end_date_max;
619        
620        /*if current claims start date >90 days after all previouse claim end date in sequence,
621        then start new sequence*/
622        if first.fx_site or start_date-lag_end_date_max>90 then do;
623            end_date_max=end_date;
624        
625            seq+1;
626        end;
627        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      9811 at 618:16   9811 at 622:31   
NOTE: There were 90807 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT2 has 90807 observations and 20 variables.
NOTE: DATA statement used (Total process time):
      real time           0.14 seconds
      cpu time            0.12 seconds
      

628        proc sort data=_dat2; by seq;run;

NOTE: There were 90807 observations read from the data set WORK._DAT2.
NOTE: The data set WORK._DAT2 has 90807 observations and 20 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.15 seconds
      cpu time            0.14 seconds
      

629        proc sql;
630        /*episode sequence start date*/
631        create table seq_start as
12                                                                  The SAS System                                         11:47 Friday, June 22, 2018

632        select patid, seq, min(start_date) as seq_start_date length=4 format=mmddyy10.
633         from _dat2
634         where substr(dx,1,4) not in ('V541' 'V542')
635         group by patid, seq
636         order by patid, seq;
NOTE: Table WORK.SEQ_START created, with 10620 rows and 3 columns.

637        /*episode sequence end date*/
638        create table seq_end as
639        select patid, seq,
640         max(start_date) as seq_end_date length=4 format=mmddyy10. from _dat2
641         group by patid, seq
642         order by patid, seq;
NOTE: Table WORK.SEQ_END created, with 12423 rows and 3 columns.

643        quit;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.51 seconds
      cpu time            0.45 seconds
      

644        /*episode sequence case qualifier indicator and trauma*/
645        data seq_cq(keep=patid seq seq_cq seq_trauma fx_site);
646        set _dat2;
647        by patid seq;
648        length seq_cq $4 seq_trauma $1;
649        retain seq_cq seq_trauma;
650        if first.seq then do;
651            seq_cq="0000";
652            seq_trauma="0";
653        end;
654        if trauma="1" then seq_trauma=trauma;
655        do i=1 to 4;
656        if substr(cq,i,1)>substr(seq_cq,i,1) then substr(seq_cq,i,1)=substr(cq,i,1);
657        end;
658        if last.seq then output;
659        run;

NOTE: There were 90807 observations read from the data set WORK._DAT2.
NOTE: The data set WORK.SEQ_CQ has 12423 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.12 seconds
      cpu time            0.10 seconds
      

660        proc freq data=seq_cq; tables seq_cq seq_trauma fx_site; run;

                                                                  --- AS project ---                                   11:47 Friday, June 22, 2018   6

                                                                  The FREQ Procedure

                                                                                Cumulative    Cumulative
                                             seq_cq    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0000          8844       71.19          8844        71.19  
                                             0004           805        6.48          9649        77.67  
                                             0030           701        5.64         10350        83.31  
                                             0034            48        0.39         10398        83.70  
                                             0200           645        5.19         11043        88.89  
                                             0204            66        0.53         11109        89.42  
                                             0230            47        0.38         11156        89.80  
                                             0234             3        0.02         11159        89.83  
                                             1000           233        1.88         11392        91.70  
                                             1004            47        0.38         11439        92.08  
                                             1030            36        0.29         11475        92.37  
                                             1034             1        0.01         11476        92.38  
                                             1200           623        5.01         12099        97.39  
                                             1204           169        1.36         12268        98.75  
                                             1230           145        1.17         12413        99.92  
                                             1234            10        0.08         12423       100.00  


                                             seq_                               Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0            11521       92.74         11521        92.74  
                                             1              902        7.26         12423       100.00  


                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec         428        3.45           428         3.45  
                                    (800-804) skull/face              293        2.36           721         5.80  
                                    (805, 806, 73313) spine          2530       20.37          3251        26.17  
                                    (807) rib/sternum/trachea         676        5.44          3927        31.61  
                                    (808) pelvis                      408        3.28          4335        34.89  
                                    (809) trunk bones                  21        0.17          4356        35.06  
                                    (810) clavicle                    127        1.02          4483        36.09  
                                    (811) scapula                      46        0.37          4529        36.46  
                                    (812, 73311) humerus              529        4.26          5058        40.71  
                                    (813, 73312) radius_ulna          810        6.52          5868        47.23  
                                    (814) carpal                      311        2.50          6179        49.74  
                                    (815-817) hand/fingers            436        3.51          6615        53.25  
                                    (818-819) arms mult                20        0.16          6635        53.41  
                                    (820, 73314) hip                 1619       13.03          8254        66.44  
                                    (821, 73315) femur                557        4.48          8811        70.92  
                                    (822) patella                     318        2.56          9129        73.48  
                                    (823, 73316) tib_fib              308        2.48          9437        75.96  
                                    (824) ankle                       525        4.23          9962        80.19  
                                    (825) tarsal_metatarsal           805        6.48         10767        86.67  
                                    (826) foot_phalanges              450        3.62         11217        90.29  
                                    (827) lower_limb                   12        0.10         11229        90.39  
                                    (828) legs+arm/rib                  5        0.04         11234        90.43  
                                    (829) fx_nos                     1189        9.57         12423       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 12423 observations read from the data set WORK.SEQ_CQ.
NOTE: The PROCEDURE FREQ printed page 6.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.07 seconds
      cpu time            0.03 seconds
      

661        
662        data seq_cq_date;
663        merge seq_cq seq_start seq_end;
664        by patid seq;
665        length site_order $1;
666        if fx_site='(820, 73314) hip' then site_order='1';
667        if fx_site='(821, 73315) femur' then site_order='2';
668        if fx_site='(808) pelvis' then site_order='3';
669        if fx_site='(805, 806, 73313) spine' then site_order='4';
670        if fx_site='(812, 73311) humerus' then site_order='5';
671        if fx_site='(813, 73312) radius_ulna' then site_order='6';
672        if fx_site='(823, 73316) tib_fib' then site_order='7';
673        if fx_site='(824) ankle' then site_order='8';
674        if fx_site='(810) clavicle' then site_order='9';
675        run;

NOTE: There were 12423 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 10620 observations read from the data set WORK.SEQ_START.
13                                                                  The SAS System                                         11:47 Friday, June 22, 2018

NOTE: There were 12423 observations read from the data set WORK.SEQ_END.
NOTE: The data set WORK.SEQ_CQ_DATE has 12423 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.10 seconds
      cpu time            0.07 seconds
      

676        
677        data _tmp_combo;
678        set seq_cq_date;
679        where site_order^=" " and seq_cq^="0000" and seq_cq^=" ";
680        run;

NOTE: There were 2927 observations read from the data set WORK.SEQ_CQ_DATE.
      WHERE (site_order not = ' ') and seq_cq not in (' ', '0000');
NOTE: The data set WORK._TMP_COMBO has 2927 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
      

681        
682        * define combo or alone fx;
683        data seq_COMBO(
684        keep=patid seq seq_cq seq_start_date alone_combo fx_site site_order)
685        ;
686        if _n_=1 then do;
687            declare hash hpid(dataset:"_tmp_combo(where=(seq_cq^='0000' and seq_cq^=' ')
688                    rename=(seq_start_date=seq_start_date2  fx_site= fx_site_combo seq=seq_COMBO))", ordered: 'a', multidata:"Y");
689            rc=hpid.defineKey("patid");
690            rc=hpid.defineData("patid","seq_start_date2", "fx_site_combo", "seq_COMBO");
691            rc=hpid.defineDone();
692        end;
693        if 0 then set _tmp_combo(rename=(seq_start_date=seq_start_date2 fx_site= fx_site_combo seq=seq_COMBO));
694        set _tmp_combo(where=(seq_cq^="0000" and seq_cq^=" ") );
695        by patid seq;
696        length  index_fx_begin 4 alone_combo $5;
697        alone_combo="alone";
698            format index_fx_begin mmddyy10.;
699            index_fx_begin=seq_start_date;
700        
701         rc=hpid.find(key:patid);
702        
703         do while (rc = 0);
704         if rc=0 and abs(seq_start_date-seq_start_date2) <=30 and fx_site_combo^=fx_site then alone_combo= 'combo';
705         rc=hpid.find_next();
706         *hpid.has_next(result:r);
707        end;
708        if alone_combo="alone" then do;
709            seq_start_date2=.; fx_site_combo=" "; seq_COMBO=.;
710        end;
711        run;

NOTE: There were 2927 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: There were 2927 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.SEQ_COMBO has 2927 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.03 seconds
      

712        proc freq data=seq_COMBO; tables alone_combo; run;

                                                                  --- AS project ---                                   11:47 Friday, June 22, 2018   7

                                                                  The FREQ Procedure

                                             alone_                             Cumulative    Cumulative
                                             combo     Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             alone         2576       88.01          2576        88.01  
                                             combo          351       11.99          2927       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
NOTE: There were 2927 observations read from the data set WORK.SEQ_COMBO.
NOTE: The PROCEDURE FREQ printed page 7.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.07 seconds
      cpu time            0.01 seconds
      

14                                                                  The SAS System                                         11:47 Friday, June 22, 2018

713        
714        proc sort data = Work.seq_COMBO;
715          by patid seq_start_date;
716        run;

NOTE: There were 2927 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 2927 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
      

717        
718        data combo_seq;
719        set seq_COMBO;
720        by patid seq_start_date;
721        length combo_fx_site $30. combo_seq 4;
722        retain combo_seq 0 combo_fx_site;
723        if first.patid or seq_start_date-lag(seq_start_date) then combo_seq=1+combo_seq;
724        where seq_cq^='0000' and seq_cq^=' ';
725        if combo_fx_site=" " or ""<site_order<lag(site_order) then combo_fx_site=fx_site;
726        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      1 at 723:33   
NOTE: There were 2927 observations read from the data set WORK.SEQ_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.COMBO_SEQ has 2927 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
      

727        
728        proc sort data = Work.seq_COMBO;
729          by patid seq;
730        run;

NOTE: There were 2927 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 2927 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

731        
732        data FX_CLM_DB;
733        merge _dat2 seq_start seq_end seq_cq(drop=fx_site) seq_COMBO(keep=patid seq alone_combo);
734        by patid seq;
735        run;

NOTE: There were 90807 observations read from the data set WORK._DAT2.
NOTE: There were 10620 observations read from the data set WORK.SEQ_START.
NOTE: There were 12423 observations read from the data set WORK.SEQ_END.
NOTE: There were 12423 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 2927 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.FX_CLM_DB has 90807 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           0.23 seconds
      cpu time            0.15 seconds
      

736        
737        proc sql;
738        select count(distinct seq) from FX_CLM_DB;
                                                                  --- AS project ---                                   11:47 Friday, June 22, 2018   8

                                                                               
                                                                       --------
                                                                          12423
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
739        quit;
NOTE: The PROCEDURE SQL printed page 8.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.13 seconds
      cpu time            0.11 seconds
      
15                                                                  The SAS System                                         11:47 Friday, June 22, 2018


740        
741        
742        
743        
744        /*
745        Collapse to fracture episodes
746        
747        Q: Why are some seq_start_date values missing?
748         */
749        proc sort
750          data = Work.fx_clm_db
751          out = Work.fractureEpisodes (drop = seq
752                                       rename = (seq_start_date = fractureEpisodeStart
753                                                 seq_end_date = fractureEpisodeEnd
754                                                 fx_site = fractureSite))
755          nodupkey;
756          by patid seq seq_start_date seq_end_date fx_site;
757        run;

NOTE: There were 90807 observations read from the data set WORK.FX_CLM_DB.
NOTE: 78384 observations with duplicate key values were deleted.
NOTE: The data set WORK.FRACTUREEPISODES has 12423 observations and 24 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.18 seconds
      cpu time            0.12 seconds
      

758        
759        proc sql;
760          create table DT.fractureEpisodesPrev as
761            select A.database,
762                   A.exposure,
763                   A.indexGNN,
764                   A.indexDate,
765                   A.ASCohortDate,
766                   A.indexID,
767                   A.age,
768                   A.sex,
769                   B.*,
770                   case
771                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
772                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
773                     else ""
774                     end as fractureType
775            from DT.indexLookup A inner join
776                 Work.fractureEpisodes B on (A.patid = B.patid);
NOTE: Table DT.FRACTUREEPISODESPREV created, with 22834 rows and 33 columns.

777          create table Work.summaryFractureEpisodesPrev as
778            select "DT.fractureEpisodesPrev" as table,
779                   fractureType, fractureSite,
780                   count(distinct patid) as countDistinctPatid,
781                   count(*) as countFractureEpisodes
782            from DT.fractureEpisodesPrev
783            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESPREV created, with 23 rows and 5 columns.

784          select * from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                                   11:47 Friday, June 22, 2018   9

                                                                                                                    count         count
                                                                                                                 Distinct      Fracture
               table                    fractureType                         fractureSite                           Patid      Episodes
               ------------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesPrev                                       (7331) pathologic nos/nec                339           844
               DT.fractureEpisodesPrev                                       (800-804) skull/face                     271           520
               DT.fractureEpisodesPrev                                       (807) rib/sternum/trachea                602          1238
               DT.fractureEpisodesPrev                                       (809) trunk bones                         18            42
               DT.fractureEpisodesPrev                                       (810) clavicle                           118           231
               DT.fractureEpisodesPrev                                       (811) scapula                             44            83
               DT.fractureEpisodesPrev                                       (814) carpal                             288           605
               DT.fractureEpisodesPrev                                       (815-817) hand/fingers                   401           760
               DT.fractureEpisodesPrev                                       (818-819) arms mult                       20            35
               DT.fractureEpisodesPrev                                       (822) patella                            271           560
               DT.fractureEpisodesPrev                                       (823, 73316) tib_fib                     270           574
               DT.fractureEpisodesPrev                                       (824) ankle                              432           984
               DT.fractureEpisodesPrev                                       (825) tarsal_metatarsal                  666          1532
               DT.fractureEpisodesPrev                                       (826) foot_phalanges                     419           831
               DT.fractureEpisodesPrev                                       (827) lower_limb                          12            19
               DT.fractureEpisodesPrev                                       (828) legs+arm/rib                         5             8
               DT.fractureEpisodesPrev                                       (829) fx_nos                             988          2171
               DT.fractureEpisodesPrev  Clinical vertebral fracture          (805, 806, 73313) spine                 1526          4693
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (808) pelvis                             331           738
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (812, 73311) humerus                     418           961
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                 649          1478
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (820, 73314) hip                        1252          2895
               DT.fractureEpisodesPrev  Non-vertebral osteoporotic fracture  (821, 73315) femur                       436          1032
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
785          select "DT.fractureEpisodesPrev" as table,
786                 sum(countDistinctPatid) as sumDistinctPatid,
787                 sum(countFractureEpisodes) as sumFractureEpisodes
788            from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                                   11:47 Friday, June 22, 2018  10

                                                                           sumDistinct   sumFracture
                                                 table                           Patid      Episodes
                                                 ---------------------------------------------------
                                                 DT.fractureEpisodesPrev          9776         22834
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
789        
790          create table DT.fractureEpisodesInc as
791            select A.database,
792                   A.ENR_END_DATE,
793                   A.DEATH_DATE,
794                   A.exposure,
795                   A.exposureStart,
796                   A.exposureEnd,
797                   A.daysExposed,
16                                                                  The SAS System                                         11:47 Friday, June 22, 2018

798                   A.exposureID,
799                   B.*,
800                   case
801                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
802                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
803                     else ""
804                     end as fractureType
805            from DT.exposureTimeline A inner join
806                 Work.fractureEpisodes B on (A.patid = B.patid  & A.exposureStart <= B.fractureEpisodeStart <= A.exposureEnd);
NOTE: Table DT.FRACTUREEPISODESINC created, with 6237 rows and 33 columns.

807          create table Work.summaryFractureEpisodesInc as
808            select "DT.fractureEpisodesInc" as table,
809                   fractureType, fractureSite,
810                   count(distinct patid) as countDistinctPatid,
811                   count(*) as countFractureEpisodes
812            from DT.fractureEpisodesInc
813            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESINC created, with 23 rows and 5 columns.

814          select * from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                                   11:47 Friday, June 22, 2018  11

                                                                                                                   count         count
                                                                                                                Distinct      Fracture
               table                   fractureType                         fractureSite                           Patid      Episodes
               -----------------------------------------------------------------------------------------------------------------------
               DT.fractureEpisodesInc                                       (7331) pathologic nos/nec                131           157
               DT.fractureEpisodesInc                                       (800-804) skull/face                     159           170
               DT.fractureEpisodesInc                                       (807) rib/sternum/trachea                392           436
               DT.fractureEpisodesInc                                       (809) trunk bones                          9             9
               DT.fractureEpisodesInc                                       (810) clavicle                            67            70
               DT.fractureEpisodesInc                                       (811) scapula                             32            34
               DT.fractureEpisodesInc                                       (814) carpal                             115           122
               DT.fractureEpisodesInc                                       (815-817) hand/fingers                   215           231
               DT.fractureEpisodesInc                                       (818-819) arms mult                       12            12
               DT.fractureEpisodesInc                                       (822) patella                             73            80
               DT.fractureEpisodesInc                                       (823, 73316) tib_fib                     118           129
               DT.fractureEpisodesInc                                       (824) ankle                              222           261
               DT.fractureEpisodesInc                                       (825) tarsal_metatarsal                  356           407
               DT.fractureEpisodesInc                                       (826) foot_phalanges                     228           235
               DT.fractureEpisodesInc                                       (827) lower_limb                           7             7
               DT.fractureEpisodesInc                                       (828) legs+arm/rib                         4             4
               DT.fractureEpisodesInc                                       (829) fx_nos                              68            74
               DT.fractureEpisodesInc  Clinical vertebral fracture          (805, 806, 73313) spine                 1035          1516
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (808) pelvis                             208           244
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (812, 73311) humerus                     251           305
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna                 353           422
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (820, 73314) hip                         761           951
               DT.fractureEpisodesInc  Non-vertebral osteoporotic fracture  (821, 73315) femur                       305           361
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
815          select "DT.fractureEpisodesInc" as table,
816                 sum(countDistinctPatid) as sumDistinctPatid,
817                 sum(countFractureEpisodes) as sumFractureEpisodes
818            from Work.summaryFractureEpisodesInc;
                                                                  --- AS project ---                                   11:47 Friday, June 22, 2018  12

                                                                           sumDistinct   sumFracture
                                                  table                          Patid      Episodes
                                                  --------------------------------------------------
                                                  DT.fractureEpisodesInc          5121          6237
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                                  queryFractures.sas
819        quit;
NOTE: The PROCEDURE SQL printed pages 9-12.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.96 seconds
      cpu time            0.54 seconds
      

820        
821        
822        
823        
824        /*
825        CLEAN UP
826        
827        proc sql;
828          drop table UCB64.tempFracDxMPCD;
829          drop table UCB64.tempFracDxUCB;
830          drop table UCB64.tempFracDxSABR;
831          drop table UCB64.tempFracPxMPCD;
832          drop table UCB64.tempFracPxUCB;
833          drop table UCB64.tempFracPxSABR;
834        quit;
835         */
836        
837        
838        proc export
839          data = Work.summaryFractureEpisodesInc
840          outfile = "data\processed\&cmt..csv"
841          dbms = csv
842          replace;
843          delimiter = '09'x;
844        run;

845         /**********************************************************************
846         *   PRODUCT:   SAS
847         *   VERSION:   9.4
848         *   CREATOR:   External File Interface
849         *   DATE:      22JUN18
850         *   DESC:      Generated SAS Datastep Code
851         *   TEMPLATE SOURCE:  (None Specified.)
852         ***********************************************************************/
853            data _null_;
854            %let _EFIERR_ = 0; /* set the ERROR detection macro variable */
855            %let _EFIREC_ = 0;     /* clear export record count macro variable */
856            file 'data\processed\queryFractures.csv' delimiter='09'x DSD DROPOVER lrecl=32767;
857            if _n_ = 1 then        /* write column names or labels */
858             do;
17                                                                  The SAS System                                         11:47 Friday, June 22, 2018

859               put
860                  "table"
861               '09'x
862                  "fractureType"
863               '09'x
864                  "fractureSite"
865               '09'x
866                  "countDistinctPatid"
867               '09'x
868                  "countFractureEpisodes"
869               ;
870             end;
871           set  WORK.SUMMARYFRACTUREEPISODESINC   end=EFIEOD;
872               format table $22. ;
873               format fractureType $35. ;
874               format fractureSite $30. ;
875               format countDistinctPatid best12. ;
876               format countFractureEpisodes best12. ;
877             do;
878               EFIOUT + 1;
879               put table $ @;
880               put fractureType $ @;
881               put fractureSite $ @;
882               put countDistinctPatid @;
883               put countFractureEpisodes ;
884               ;
885             end;
886            if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable */
887            if EFIEOD then call symputx('_EFIREC_',EFIOUT);
888            run;

NOTE: The file 'data\processed\queryFractures.csv' is:
      Filename=U:\studies\AS\pgms\bchan\data\processed\queryFractures.csv,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=22Jun2018:11:48:18,
      Create Time=22Jun2018:11:48:18

NOTE: 24 records were written to the file 'data\processed\queryFractures.csv'.
      The minimum record length was 42.
      The maximum record length was 91.
NOTE: There were 23 observations read from the data set WORK.SUMMARYFRACTUREEPISODESINC.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.03 seconds
      

23 records created in data\processed\queryFractures.csv from WORK.SUMMARYFRACTUREEPISODESINC.
  
  
NOTE: "data\processed\queryFractures.csv" file was successfully created.
NOTE: PROCEDURE EXPORT used (Total process time):
      real time           1.27 seconds
      cpu time            0.12 seconds
      

889        
890        
891        ods html close;
NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           45.65 seconds
      cpu time            38.70 seconds
      
