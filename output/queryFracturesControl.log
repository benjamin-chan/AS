1                                                          The SAS System                          10:27 Wednesday, November 8, 2017

NOTE: Copyright (c) 2002-2012 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M1) 
      Licensed to UNIVERSITY OF ALABAMA AT BIRMINGHAM - SFA - T&R, Site 70058223.
NOTE: This session is executing on the W32_ES08R2  platform.



NOTE: Updated analytical products:
      
      SAS/STAT 13.1
      SAS/ETS 13.1
      SAS/OR 13.1
      SAS/IML 13.1
      SAS/QC 13.1

NOTE: Additional host information:

 W32_ES08R2 WIN 6.1.7601 Service Pack 1 Server

--- PEER News and Updates ---

: SECURITY REMINDER :
Please remember not to copy any data files that contain PHI (protected health identifiers) to any of the shared folders.

 


NOTE: SAS initialization used:
      real time           0.28 seconds
      cpu time            0.12 seconds
      
1          *  University of Alabama at Birmingham                               *
2          *  AS project                                            *
3          **********************************************************************;
4          options pagesize=74 linesize=150 pageno=1 missing=' ' date FORMCHAR="|----|+|---+=|-/\<>*";
5          * Programmer    : Benjamin Chan <chanb@ohsu.edu>
6          * Creation date :
7          * Modify date   :
8          ;
9          %let cmt=queryFracturesControl; * type the name of your program here (without the filename extension);
10         %let pgm=&cmt..sas;
11         %include "lib\libname.sas" ;
NOTE: Libref STDC5P was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: H:\studies\osteo\data\STD_files\5pct\
NOTE: Libref STD_SABR was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\data\std_SABER\
NOTE: Libref MPSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: h:\studies\mpcd\data\stddata\
NOTE: Libref UCBSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\stddata\
NOTE: Libref UCB was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB\
NOTE: Libref DT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: V:\studies\AS\data
NOTE: Libref NDC was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: W:\onenote\references\drug ndcs\sas data
127        footnote "&pgm.";
128        * footnote2 "%sysfunc(datetime(),datetime14.)";
129        title1 '--- AS project ---';
130        **********************************************************************;
131        options macrogen mlogic mprint symbolgen;
132        options nomacrogen nomlogic nomprint nosymbolgen;
133        
134        
135        ods html
2                                                                   The SAS System                                   10:27 Wednesday, November 8, 2017

136          body = "output\&cmt..html"
137          style = Statistical;
NOTE: Writing HTML Body file: output\queryFracturesControl.html
138        
139        
140        /*
141        FRACTURES
142        
143        See "ALGORITHMS TO ENHANCE SPECIFICITY OF FRACTURE IDENTIFICATION_ 100316.docx"
144        
145        Adapted from Lang's code in "001_fx_data.sas"
146        
147        
148        From: Chen, Lang [mailto:langchen@uabmc.edu]
149        Sent: Monday, July 24, 2017 8:56 AM
150        To: Benjamin Chan <chanb@ohsu.edu>
151        Subject: RE: fracture identification algorithm
152        
153        Here it is.
154        For 001_fx_data, find all fx related claim and run the algorithm.
155        Please ignore any code after line 476
156        Modify code from line 1 -50
157        
158        For 002_fx_epi_data
159        Define fx episode.
160        
161        Final output data is fx_dgns_&firstyr._&lastyr._4. Please let me if you have any questions.
162         */
163        
164        
165        /*
166        START OF 001_fx_data.sas
167         */
168        
169        
170        /*Assign "Broad" fracture site (fx_site) for all ICD9 diagnoses, outputting separately, so some records are cloned, then combining into one
170      !  file */
171        /*No longer using matched trauma files here*/
172        
173        %macro comballfxdgns;
174            data fx_dgns;
175                set UCB.tempFracDxAllControl (where = (diagCodeType = "Fracture code"));
176                    length fx_site $30 ;
177                    fx_site = '';
178                    if strip(DX) in: ('800' '801' '802' '803' '804') then           do; fx_site='(800-804) skull/face'; output; end;
179                    if strip(DX) in: ('805', '806') or strip(DX)='73313' then       do; fx_site='(805, 806, 73313) spine'; output; end;
180                    if strip(DX) in: ('807') then                                           do; fx_site='(807) rib/sternum/trachea'; output; end;
181                    if strip(DX) in: ('808') then                                           do; fx_site='(808) pelvis'; output; end;
182                    if strip(DX) in: ('809') then                                           do; fx_site='(809) trunk bones'; output; end;
183                    if strip(DX) in: ('810') then                                           do; fx_site='(810) clavicle'; output; end;
184                    if strip(DX) in: ('811') then                                           do; fx_site='(811) scapula'; output; end;
185                    if strip(DX) in: ('812') or strip(DX)='73311' then              do; fx_site='(812, 73311) humerus'; output; end;
186                    if strip(DX) in: ('813') or strip(DX)='73312' then              do; fx_site='(813, 73312) radius_ulna'; output; end;
187                    if strip(DX) in: ('814') then                                           do; fx_site='(814) carpal'; output; end;
188                    if strip(DX) in: ('815' '816' '817') then                           do; fx_site='(815-817) hand/fingers'; output; end;
189                    if strip(DX) in: ('818' '819') then                                     do; fx_site='(818-819) arms mult'; output; end;
190                    if strip(DX) in: ('820') or strip(DX) = '73314' then                do; fx_site='(820, 73314) hip'; output; end;
191                    if strip(DX) in: ('821') or strip(DX)='73315' then              do; fx_site='(821, 73315) femur'; output; end;
192                    if strip(DX) in: ('822') then                                           do; fx_site='(822) patella'; output; end;
193                    if strip(DX) in: ('823') or strip(DX)='73316' then              do; fx_site='(823, 73316) tib_fib'; output; end;
194                    if strip(DX) in: ('824') then                                           do; fx_site='(824) ankle'; output; end;
195                    if strip(DX) in: ('825') then                                           do; fx_site='(825) tarsal_metatarsal'; output; end;
196                    if strip(DX) in: ('826') then                                           do; fx_site='(826) foot_phalanges'; output; end;
197                    if strip(DX) in: ('827') then                                           do; fx_site='(827) lower_limb'; output; end;
198                    if strip(DX) in: ('828') then                                           do; fx_site='(828) legs+arm/rib'; output; end;
199                    if strip(DX) in: ('829') then                                           do; fx_site='(829) fx_nos'; output; end;
200                    if strip(DX) in ('73310' '73319' '7331') then                 do; fx_site='(7331) pathologic nos/nec'; output; end;
201            data fx_excare;
202                set UCB.tempFracDxAllControl (where = (diagCodeType = "Extended care code"));
203                    length fx_site $30 ;
204                    fx_site = '';
205                    /*Expanded Diagnosis Codes - Fracture Aftercare Codes*/
3                                                                   The SAS System                                   10:27 Wednesday, November 8, 2017

206                    if strip(DX) in ('V5410' 'V5420') then                          do; fx_site='(812, 73311) humerus'; output;
207                                                                                                     fx_site='(813, 73312) radius_ulna'; output;
207      ! end;
208                    if strip(DX) in ('V5411' 'V5421') then                          do; fx_site='(812, 73311) humerus'; output; end;
209                    if strip(DX) in ('V5412' 'V5422') then                          do; fx_site='(813, 73312) radius_ulna'; output;
210                                                                                                     fx_site='(814) carpal'; output; end;
211                    if strip(DX) in ('V5413' 'V5423') then                          do; fx_site='(820, 73314) hip'; output; end;
212                    if strip(DX) in ('V5414' 'V5424') then                          do; fx_site='(820, 73314) hip'; output;
213                                                                                                     fx_site='(821, 73315) femur'; output;
214                                                                                                     fx_site='(822) patella'; output;
215                                                                                                     fx_site='(824) ankle'; output;
216                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
217                    if strip(DX) in ('V5415' 'V5425') then                          do; fx_site='(820, 73314) hip'; output;
218                                                                                                     fx_site='(821, 73315) femur'; output;
219                                                                                                     fx_site='(822) patella'; output; end;
220                    if strip(DX) in ('V5416' 'V5426') then                          do; fx_site='(824) ankle'; output;
221                                                                                                     fx_site='(822) patella'; output;
222                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
223                    if strip(DX) in ('V5417' 'V5427') then                          do; fx_site='(805, 806, 73313) spine'; output; end;
224                    if strip(DX) in: ('V542') then                                       do; fx_site='(7331) pathologic nos/nec'; output; end;
225                    if strip(DX) in: ('V541') then                                       do; fx_site='(829) fx_nos'; output; end;
226            run;
227        
228            /* proc sort data=fx_dgns; by patid BEGIN_DATE fx_site; run;
229            proc sort data=fx_excare; by patid BEGIN_DATE fx_site; run; */
230        %mend;
231        %comballfxdgns;

NOTE: There were 4280380 observations read from the data set UCB.TEMPFRACDXALLCONTROL.
      WHERE diagCodeType='Fracture code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_DGNS has 4280380 observations and 22 variables.
NOTE: DATA statement used (Total process time):
      real time           23.40 seconds
      cpu time            10.73 seconds
      


NOTE: There were 315402 observations read from the data set UCB.TEMPFRACDXALLCONTROL.
      WHERE diagCodeType='Extended care code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_EXCARE has 729598 observations and 22 variables.
NOTE: DATA statement used (Total process time):
      real time           1.12 seconds
      cpu time            1.10 seconds
      

232        
233        /*Now, assign a more specific fracture site (e.g., closed, other) (site) that is used in the CQ algorithms*/
234        /*Since Expanded Diagnosis Codes (V Codes) apply to sub-categories of each broad fracture site, clone records for these so they appear in
234      ! both places*/
235        
236        data fx_dgns_2;
237            set fx_dgns;
238        
239            length site $30;
240        
241            site="";
242        
243            *Spine-closed and Spine-other;
244            if fx_site='(805, 806, 73313) spine' then
245                do;
246                    site = 'spine_cls'; /*Includes V Codes and 73313 here*/
247                    if substr(strip(DX),1,3) in ('805' '806') and substr(strip(DX),1,4) ^in ('8050', '8052', '8054', '8058') then
248                        site = 'spine_oth';
249                end;
250        
251            *Pelvis-closed and Pelvis-other... No V Codes;
252            if fx_site='(808) pelvis' then
253                do;
254                    site = 'pelvis_cls';
255                    if substr(strip(DX),1,3)='808' and substr(strip(DX),1,4) ^in ('8080', '8082', '8084', '8088') then
4                                                                   The SAS System                                   10:27 Wednesday, November 8, 2017

256                        site = 'pelvis_oth';
257                end;
258        
259            *Clavicle-closed and Clavicle-other.... No V Codes;
260            if fx_site='(810) clavicle' then
261                do;
262                    site = 'clv_cls';
263                    if substr(strip(DX),1,3) = '810' and substr(strip(DX),1,4) ^in ('8100') then
264                        site = 'clv_oth';
265                end;
266        
267            *Humerus-closed and Humerus-other;
268            if fx_site='(812, 73311) humerus' then
269                do;
270                    site = 'hmrs_cls'; /*Includes V Codes and 73311 here*/
271                    if substr(strip(DX),1,3)= '812' and substr(strip(DX),1,4) ^in ('8120', '8122', '8124') then
272                        site = 'hmrs_oth';
273                end;
274        
275            *Distal radius/ulna and Radius/ulna-other;
276            if fx_site='(813, 73312) radius_ulna' then
277                do;
278                 site = 'dist4arm'; /*Includes V Codes and 73312 here*/
279                    if substr(strip(DX),1,3) = '813' and substr(strip(DX),1,4) ^in ('8134', '8135') then
280                        site = 'rad_ul_oth';
281                end;
282        
283            *Carpal... V Codes present but only one category;
284            if fx_site='(814) carpal' then
285                do;
286                    site = 'carpal';
287                 end;
288        
289            *Hip-closed and Hip-other;
290            if fx_site='(820, 73314) hip' then
291                    do;
292                    site = 'hip_cls'; /*Includes V Codes and 73314 here*/
293                    if substr(strip(DX),1,3)='820' and substr(strip(DX),1,4) ^in ('8200', '8202', '8208') then
294                        site = 'hip_oth';
295                end;
296        
297            *Other femur-closed and Other femur-other;
298            if fx_site='(821, 73315) femur' then
299                do;
300                    site = 'oth_fem_cls'; /*Includes V Codes and 73315 here*/
301                    if substr(strip(DX),1,3)='821' and substr(strip(DX),1,4) ^in ('8210', '8212') then
302                        site = 'oth_fem_oth';
303                end;
304        
305            *Tib/fib-closed and Tib/fib-other;
306            if fx_site='(823, 73316) tib_fib' then
307                do;
308                    site = 'tib_fib_cls'; /*Includes V Codes and 73316 here*/
309                    if substr(strip(DX),1,3)='823' and substr(strip(DX),1,4) ^in ('8230', '8232', '8238') then
310                        site = 'tib_fib_oth';
311                end;
312        
313            *Ankle... V Codes present but only one category;
314            if fx_site='(824) ankle' then
315                do;
316                    site = 'ankle';
317                end;
318        
319            /*Assign site for other fx_sites that do not have CQ algorithm and thus no sub categories*/
320            if site = "" then do;
321                site = fx_site;
322            end;
323        
324            label site = 'CQ Algorithm Fracture Site (Specific)';
325        
326        run;

5                                                                   The SAS System                                   10:27 Wednesday, November 8, 2017

NOTE: Invalid third argument to function SUBSTR at line 255 column 48.
database=MPCD cohort=Non-AS PATID=102482316 indexDate=07/03/2007 age=75 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=01/31/2010 controlID=28427
ENCOUNTERID=10807028445 ENC_TYPE=ED ADMIT_DATE= BEGIN_DATE=07/04/2009 DISCHARGE_DATE= END_DATE=07/04/2009 DX_TYPE=09 DX=808 PDX=O codeType=ICD9-DX
code=808 diagCodeType=Fracture code fx_site=(808) pelvis site=pelvis_oth _ERROR_=1 _N_=19983
NOTE: Invalid third argument to function SUBSTR at line 255 column 48.
database=MPCD cohort=Non-AS PATID=102482316 indexDate=07/03/2007 age=75 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=01/31/2010 controlID=28427
ENCOUNTERID=10807028445 ENC_TYPE=ED ADMIT_DATE= BEGIN_DATE=07/04/2009 DISCHARGE_DATE= END_DATE=07/04/2009 DX_TYPE=09 DX=808 PDX=P codeType=ICD9-DX
code=808 diagCodeType=Fracture code fx_site=(808) pelvis site=pelvis_oth _ERROR_=1 _N_=19984
NOTE: Invalid third argument to function SUBSTR at line 255 column 48.
database=MPCD cohort=Non-AS PATID=102482316 indexDate=07/03/2007 age=75 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=01/31/2010 controlID=28427
ENCOUNTERID=10861064444 ENC_TYPE=ED ADMIT_DATE= BEGIN_DATE=07/04/2009 DISCHARGE_DATE= END_DATE=07/04/2009 DX_TYPE=09 DX=808 PDX=O codeType=ICD9-DX
code=808 diagCodeType=Fracture code fx_site=(808) pelvis site=pelvis_oth _ERROR_=1 _N_=19989
NOTE: Invalid third argument to function SUBSTR at line 255 column 48.
database=MPCD cohort=Non-AS PATID=102482316 indexDate=07/03/2007 age=75 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=01/31/2010 controlID=28427
ENCOUNTERID=10861064444 ENC_TYPE=ED ADMIT_DATE= BEGIN_DATE=07/04/2009 DISCHARGE_DATE= END_DATE=07/04/2009 DX_TYPE=09 DX=808 PDX=P codeType=ICD9-DX
code=808 diagCodeType=Fracture code fx_site=(808) pelvis site=pelvis_oth _ERROR_=1 _N_=19990
NOTE: Invalid third argument to function SUBSTR at line 271 column 49.
database=MPCD cohort=Non-AS PATID=102501970 indexDate=07/03/2007 age=70 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2010 controlID=40946
ENCOUNTERID=10886102012 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=05/20/2010 DISCHARGE_DATE= END_DATE=05/20/2010 DX_TYPE=09 DX=812 PDX=P codeType=ICD9-DX
code=812 diagCodeType=Fracture code fx_site=(812, 73311) humerus site=hmrs_oth _ERROR_=1 _N_=29606
NOTE: Invalid third argument to function SUBSTR at line 255 column 48.
database=MPCD cohort=Non-AS PATID=103648636 indexDate=07/03/2007 age=80 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2010 controlID=70462
ENCOUNTERID=10892850787 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=04/28/2009 DISCHARGE_DATE= END_DATE=04/28/2009 DX_TYPE=09 DX=808 PDX=O codeType=ICD9-DX
code=808 diagCodeType=Fracture code fx_site=(808) pelvis site=pelvis_oth _ERROR_=1 _N_=54175
NOTE: Invalid third argument to function SUBSTR at line 255 column 48.
database=MPCD cohort=Non-AS PATID=103648636 indexDate=07/03/2007 age=80 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2010 controlID=70462
ENCOUNTERID=10892850787 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=04/28/2009 DISCHARGE_DATE= END_DATE=04/28/2009 DX_TYPE=09 DX=808 PDX=P codeType=ICD9-DX
code=808 diagCodeType=Fracture code fx_site=(808) pelvis site=pelvis_oth _ERROR_=1 _N_=54176
NOTE: Invalid third argument to function SUBSTR at line 263 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=10857526106 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=09/09/2009 DISCHARGE_DATE= END_DATE=09/09/2009 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61267
NOTE: Invalid third argument to function SUBSTR at line 263 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=10857526106 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/09/2009 DISCHARGE_DATE= END_DATE=09/09/2009 DX_TYPE=09 DX=810 PDX=O codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61268
NOTE: Invalid third argument to function SUBSTR at line 263 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=10857526106 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/09/2009 DISCHARGE_DATE= END_DATE=09/09/2009 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61269
NOTE: Invalid third argument to function SUBSTR at line 263 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=10883038575 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=09/10/2009 DISCHARGE_DATE= END_DATE=09/10/2009 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61271
NOTE: Invalid third argument to function SUBSTR at line 263 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=10883038575 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/10/2009 DISCHARGE_DATE= END_DATE=09/10/2009 DX_TYPE=09 DX=810 PDX=O codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61272
NOTE: Invalid third argument to function SUBSTR at line 263 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=10883038575 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/10/2009 DISCHARGE_DATE= END_DATE=09/10/2009 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61273
NOTE: Invalid third argument to function SUBSTR at line 263 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=11023119948 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/04/2009 DISCHARGE_DATE= END_DATE=09/04/2009 DX_TYPE=09 DX=810 PDX=O codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61276
NOTE: Invalid third argument to function SUBSTR at line 263 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=11023119948 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/04/2009 DISCHARGE_DATE= END_DATE=09/04/2009 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61277
NOTE: Invalid third argument to function SUBSTR at line 263 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=11032331831 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/08/2009 DISCHARGE_DATE= END_DATE=09/08/2009 DX_TYPE=09 DX=810 PDX=O codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61279
NOTE: Invalid third argument to function SUBSTR at line 263 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=11032331831 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/08/2009 DISCHARGE_DATE= END_DATE=09/08/2009 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61280
NOTE: Invalid third argument to function SUBSTR at line 271 column 49.
database=MPCD cohort=Non-AS PATID=103685585 indexDate=07/03/2007 age=30 SEX=M ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2008 controlID=93869
ENCOUNTERID=10853030298 ENC_TYPE=IP ADMIT_DATE=09/06/2008 BEGIN_DATE=09/06/2008 DISCHARGE_DATE= END_DATE= DX_TYPE=09 DX=812 PDX=O codeType=ICD9-DX
code=812 diagCodeType=Fracture code fx_site=(812, 73311) humerus site=hmrs_oth _ERROR_=1 _N_=73472
6                                                                   The SAS System                                   10:27 Wednesday, November 8, 2017

NOTE: Invalid third argument to function SUBSTR at line 271 column 49.
database=MPCD cohort=Non-AS PATID=103685585 indexDate=07/03/2007 age=30 SEX=M ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2008 controlID=93869
ENCOUNTERID=10888473073 ENC_TYPE=IP ADMIT_DATE=11/02/2008 BEGIN_DATE=11/02/2008 DISCHARGE_DATE= END_DATE= DX_TYPE=09 DX=812 PDX=O codeType=ICD9-DX
code=812 diagCodeType=Fracture code fx_site=(812, 73311) humerus site=hmrs_oth _ERROR_=1 _N_=73473
NOTE: Invalid third argument to function SUBSTR at line 271 column 49.
WARNING: Limit set by ERRORS= option reached.  Further errors of this type will not be printed.
database=MPCD cohort=Non-AS PATID=103685585 indexDate=07/03/2007 age=30 SEX=M ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2008 controlID=93869
ENCOUNTERID=10904456369 ENC_TYPE=IP ADMIT_DATE=08/20/2008 BEGIN_DATE=08/20/2008 DISCHARGE_DATE=08/20/2008 END_DATE=08/20/2008 DX_TYPE=09 DX=812 PDX=O
codeType=ICD9-DX code=812 diagCodeType=Fracture code fx_site=(812, 73311) humerus site=hmrs_oth _ERROR_=1 _N_=73474
NOTE: There were 4280380 observations read from the data set WORK.FX_DGNS.
NOTE: The data set WORK.FX_DGNS_2 has 4280380 observations and 23 variables.
NOTE: DATA statement used (Total process time):
      real time           4.86 seconds
      cpu time            4.60 seconds
      

327        
328        /*###########################################################################################################*/
329        /***************************************************Intermediate Fracture Diagnosis File**********************/
330        /*Combine CQ diagnosis files*******************************************************/
331        data fx_dgns_3;
332            set fx_dgns_2
333        /*    fx_excare_*/
334                ;
335        run;

NOTE: There were 4280380 observations read from the data set WORK.FX_DGNS_2.
NOTE: The data set WORK.FX_DGNS_3 has 4280380 observations and 23 variables.
NOTE: DATA statement used (Total process time):
      real time           2.52 seconds
      cpu time            2.45 seconds
      

336        
337        proc freq data=fx_dgns_3;
338            tables fx_site site;
339        run;

                                                                  --- AS project ---                             10:27 Wednesday, November 8, 2017   1

                                                                  The FREQ Procedure

                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec       31132        0.73         31132         0.73  
                                    (800-804) skull/face           137430        3.21        168562         3.94  
                                    (805, 806, 73313) spine        625951       14.62        794513        18.56  
                                    (807) rib/sternum/trachea      242968        5.68       1037481        24.24  
                                    (808) pelvis                   189936        4.44       1227417        28.68  
                                    (809) trunk bones                2210        0.05       1229627        28.73  
                                    (810) clavicle                  67860        1.59       1297487        30.31  
                                    (811) scapula                   15776        0.37       1313263        30.68  
                                    (812, 73311) humerus           390565        9.12       1703828        39.81  
                                    (813, 73312) radius_ulna       432757       10.11       2136585        49.92  
                                    (814) carpal                    78565        1.84       2215150        51.75  
                                    (815-817) hand/fingers         198826        4.65       2413976        56.40  
                                    (818-819) arms mult              6461        0.15       2420437        56.55  
                                    (820, 73314) hip               741029       17.31       3161466        73.86  
                                    (821, 73315) femur             159939        3.74       3321405        77.60  
                                    (822) patella                   62157        1.45       3383562        79.05  
                                    (823, 73316) tib_fib           178115        4.16       3561677        83.21  
                                    (824) ankle                    301583        7.05       3863260        90.26  
                                    (825) tarsal_metatarsal        261485        6.11       4124745        96.36  
                                    (826) foot_phalanges           115911        2.71       4240656        99.07  
                                    (827) lower_limb                 5172        0.12       4245828        99.19  
                                    (828) legs+arm/rib               1650        0.04       4247478        99.23  
                                    (829) fx_nos                    32902        0.77       4280380       100.00  


                                                        CQ Algorithm Fracture Site (Specific)
 
                                                                                          Cumulative    Cumulative
                                    site                         Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec       31132        0.73         31132         0.73  
                                    (800-804) skull/face           137430        3.21        168562         3.94  
                                    (807) rib/sternum/trachea      242968        5.68        411530         9.61  
                                    (809) trunk bones                2210        0.05        413740         9.67  
                                    (811) scapula                   15776        0.37        429516        10.03  
                                    (815-817) hand/fingers         198826        4.65        628342        14.68  
                                    (818-819) arms mult              6461        0.15        634803        14.83  
                                    (822) patella                   62157        1.45        696960        16.28  
                                    (825) tarsal_metatarsal        261485        6.11        958445        22.39  
                                    (826) foot_phalanges           115911        2.71       1074356        25.10  
                                    (827) lower_limb                 5172        0.12       1079528        25.22  
                                    (828) legs+arm/rib               1650        0.04       1081178        25.26  
                                    (829) fx_nos                    32902        0.77       1114080        26.03  
                                    ankle                          301583        7.05       1415663        33.07  
                                    carpal                          78565        1.84       1494228        34.91  
                                    clv_cls                         67453        1.58       1561681        36.48  
                                    clv_oth                           407        0.01       1562088        36.49  
                                    dist4arm                       312199        7.29       1874287        43.79  
                                    hip_cls                        721989       16.87       2596276        60.66  
                                    hip_oth                         19040        0.44       2615316        61.10  
                                    hmrs_cls                       385103        9.00       3000419        70.10  
                                    hmrs_oth                         5462        0.13       3005881        70.22  
                                    oth_fem_cls                    154554        3.61       3160435        73.84  
                                    oth_fem_oth                      5385        0.13       3165820        73.96  
                                    pelvis_cls                     187597        4.38       3353417        78.34  
                                    pelvis_oth                       2339        0.05       3355756        78.40  
                                    rad_ul_oth                     120558        2.82       3476314        81.22  
                                    spine_cls                      572561       13.38       4048875        94.59  
                                    spine_oth                       53390        1.25       4102265        95.84  
                                    tib_fib_cls                    170826        3.99       4273091        99.83  
                                    tib_fib_oth                      7289        0.17       4280380       100.00  
 
 
 
 
 
                                                              queryFracturesControl.sas
NOTE: There were 4280380 observations read from the data set WORK.FX_DGNS_3.
NOTE: The PROCEDURE FREQ printed page 1.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           1.96 seconds
      cpu time            1.90 seconds
      

340        
341        proc sort data=fx_dgns_3;
342            by patid ENCOUNTERID fx_site site;
343        run;

NOTE: There were 4280380 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_3 has 4280380 observations and 23 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           5.81 seconds
      cpu time            10.12 seconds
      

344        
345        
346        /*###########################################################################################################*/
347        /*************************************************************************************************************/
348        /*Look for repair procedures and assign treatment site*******************/
349        /*This code has been updated to include hip/femur replacement with matching diagnosis code, also looked in claim strip(DX) not just primary
349      !  strip(DX)
350        /*Not accepting contiguous sites until later*/
351        /*Excluding procedures from DME files*/
352        /*******************************Select All Spine Imaging Codes from STD Procedure Files for CQ=4/5 algorithms*/
353        
354        %macro fx_prcd;
355            data fx_prcd spine_xray;
356                set UCB.tempFracPxAllControl;
357        
7                                                                   The SAS System                                   10:27 Wednesday, November 8, 2017

358                    length tx_site $30;
359                    length HLAT $1;
360        
361                    if strip(px) in ('21300' '21310' '21315' '21320' '21325' '21330' '21335' '21336' '21337' '21338' '21339' '21340' '21343'
361      ! '21344' '21345' '21346' '21347' '21348'
362                                         '21355' '21356' '21360' '21365' '21366' '21385' '21386' '21387' '21390' '21395' '21400' '21401' '21406'
362      ! '21407' '21408' '21421' '21422' '21423'
363                                         '21431' '21432' '21433' '21435' '21436' '21440' '21445' '21450' '21451' '21452' '21453' '21454' '21461'
363      ! '21462' '21465' '21470'
364                                         '62000' '62005' '62010')  and lengthn(strip(px)) = 5 then do;
365                        tx_site='(800-804) skull/face'; output fx_prcd; end;
366        
367                    if strip(px) in ('22305' '22310' '22315' '22318' '22319' '22325' '22326' '22327' '22328' '22520' '22521' '22522' '22523'
367      ! '22524' '22525' '76012' '76013'
368                                         'S2360' 'S2361' 'S2362' 'S2363' '72291' '72292')  and lengthn(strip(px)) = 5 then do;
369                        tx_site = '(805, 806, 73313) spine'; output fx_prcd; end;
370        
371                    if  strip(px) in ('21493' '21494' '21495' '21800' '21805' '21810' '21820' '21825' ) then do;
372                        tx_site='(807) rib/sternum/trachea'; output fx_prcd; end;
373        
374                    if strip(px) in ('27193' '27194' '27215' '27216' '27217' '27218' '27220' '27222' '27226' '27227' '27228')  and
374      ! lengthn(strip(px)) = 5 then do;
375                        tx_site = '(808) pelvis'; output fx_prcd; end;
376        
377                    if strip(px) in ('23500' '23505' '23515')  and lengthn(strip(px)) = 5 then do;
378                        tx_site = '(810) clavicle'; output fx_prcd; end;
379        
380                    if strip(px) in ('23570' '23575' '23585') then do;
381                        tx_site= '(811) scapula'; output fx_prcd; end;
382        
383                    if strip(px) in ('23600' '23605' '23615' '23616' '23620' '23625' '23630' '23665' '24500' '24505' '24515' '24516' '24530'
383      ! '24535' '24538' '24545' '24546' '24560'
384                                 '24565' '24566' '24575' '24576' '24577' '24579' '24582')  and lengthn(strip(px)) = 5 then do;
385                        tx_site = '(812, 73311) humerus'; output fx_prcd; end;
386        
387                    if strip(px) in ('25600' '25605' '25606' '25607' '25608' '25609' '25620' '25650' '25651' '25652')  and lengthn(strip(px)) = 5
387      ! then do;
388                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
389        
390                    if strip(px) in ('24650' '24655' '24665' '24666' '24670' '24675' '24685' '25500' '25505' '25515' '25520' '25525' '25526'
390      ! '25530' '25535' '25545' '25560' '25565'
391                                 '25574' '25575')  and lengthn(strip(px)) = 5 then do;
392                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
393        
394                    if strip(px) in ('25622' '25624' '25628' '25630' '25635' '25645' '25680' '25685')  and lengthn(strip(px)) = 5 then do;
395                        tx_site = '(814) carpal'; output fx_prcd; end;
396        
397                    if strip(px) in ('26600' '26605' '26607' '26608' '26615' '26645' '26650' '26665' '26720' '26725' '26727' '26735' '26740'
397      ! '26742' '26746' '26750' '26755' '26756' '26765' )
398                               and lengthn(strip(px)) = 5 then do;
399                        tx_site='(815-817) hand/fingers'; output fx_prcd; end;
400        
401                    if '27230' <= strip(px) <= '27248' and lengthn(strip(px)) = 5 then do;
402                        tx_site = '(820, 73314) hip'; output fx_prcd; end;
403        
404                    if '27500' <= strip(px) <= '27514'  and lengthn(strip(px)) = 5 then do;
405                        tx_site = '(821, 73315) femur'; output fx_prcd; end;
406        
407                    if strip(px) in ('27520' '27524')  and lengthn(strip(px)) = 5 then do;
408                        tx_site = '(822) patella'; output fx_prcd; end;
409        
410                    if ('27530' <= strip(px) <= '27536' or '27750' <= strip(px) <= '27759' or '27780' <= strip(px) <= '27784' or '27824' <=
410      ! strip(px) <= '27828') and lengthn(strip(px)) = 5  then do;
411                        tx_site = '(823, 73316) tib_fib'; output fx_prcd; end;
412        
413                    if strip(px) in ('27760' '27762' '27766' '27786' '27788' '27792' '27808' '27810' '27814' '27816' '27818' '27822' '27823'
413      ! '28430' '28435' '28436' '28445')  and lengthn(strip(px)) = 5 then do;
414                        tx_site = '(824) ankle'; output fx_prcd; end;
415        
416                    if strip(px) in ('28320' '28322' '28400' '28405' '28406' '28415' '28420' ) and lengthn(strip(px)) = 5 then do;
417                        tx_site='(825) tarsal_metatarsal'; output fx_prcd; end;
418        
8                                                                   The SAS System                                   10:27 Wednesday, November 8, 2017

419                 /********************************Hip/Femur Additions - must be matched with DGNS to be included*/
420                 /*Hip replacement codes*/
421                    /*Hip*/
422                    if strip(px) in ('27130' '27125') and lengthn(strip(px)) = 5  then do;
423                        HLAT='1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
424        
425                    /*Codes below are the only ICD9 Procedure Codes that we are using for "repair"*/
426                    if strip(px) in ('8151' '8152') and lengthn(strip(px)) = 4 then do;
427                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
428        
429                    /*Femur repair codes, assigned to both Hip and Femur treatment sites... CHECK - MAYBE WE NEED TO DO THIS THE OTHER WAY AS
429      ! WELL*/
430                    /*Hip*/
431                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
432                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
433        
434                    /*Femur*/
435                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
436                        HLAT = '1'; tx_site = '(821, 73315) femur'; output fx_prcd; end;
437                     /*spine image*/
438                        if '72010' <= strip(px) <= '72159' or '72240' <= strip(px) <= '72285' or strip(px) = '72295' then do;   /*Spine Imaging
438      ! Codes*/
439                        tx_site='(805, 806, 73313) spine';
440                        output spine_xray; end;
441        
442            run;
443        
444            data fx_prcd;
445                set fx_prcd;
446                /*To add laterality info*/
447        /*        array hcpcs{*} hcpcs_1st_mdfr_cd hcpcs_2nd_mdfr_cd hcpcs_3rd_mdfr_cd hcpcs_4th_mdfr_cd ; */
448                if HLAT='1' then do;
449                    repair_right='0'; repair_left='0';
450                end;
451        /*        if HLAT='1' then */
452        /*            do i=1 to dim(hcpcs);*/
453        /*                if hcpcs{i} = 'RT' then repair_right='1';*/
454        /*                else if hcpcs{i} = 'LT' then repair_left='1';*/
455        /*            end;*/
456            run;
457            proc sort data=fx_prcd nodupkey; by patid ENCOUNTERID px_date tx_site; run;
458        
459            data spine_xray;
460                set spine_xray;
461                keep patid px_date tx_site  ENCOUNTERID begin_date;
462            run;
463            proc sort data=spine_xray nodupkey; by patid px_date; run;
464        %mend;
465        %fx_prcd;

NOTE: There were 1110050834 observations read from the data set UCB.TEMPFRACPXALLCONTROL.
NOTE: The data set WORK.FX_PRCD has 794441 observations and 21 variables.
NOTE: The data set WORK.SPINE_XRAY has 5729407 observations and 21 variables.
NOTE: DATA statement used (Total process time):
      real time           1:23:37.77
      cpu time            58:04.78
      


NOTE: There were 794441 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK.FX_PRCD has 794441 observations and 23 variables.
NOTE: DATA statement used (Total process time):
      real time           0.60 seconds
      cpu time            0.46 seconds
      


NOTE: There were 794441 observations read from the data set WORK.FX_PRCD.
NOTE: 54524 observations with duplicate key values were deleted.
NOTE: The data set WORK.FX_PRCD has 739917 observations and 23 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.79 seconds
9                                                                   The SAS System                                   10:27 Wednesday, November 8, 2017

      cpu time            1.15 seconds
      


NOTE: There were 5729407 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.SPINE_XRAY has 5729407 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           3.05 seconds
      cpu time            2.55 seconds
      


NOTE: There were 5729407 observations read from the data set WORK.SPINE_XRAY.
NOTE: 2284293 observations with duplicate key values were deleted.
NOTE: The data set WORK.SPINE_XRAY has 3445114 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           2.51 seconds
      cpu time            4.71 seconds
      

466        
467        
468        
469        data trauma (rename=(begin_date=trauma_dt));
470                set UCB.tempFracDxAllControl (where = (diagCodeType = "Trauma code"));
471        run;

NOTE: There were 706177 observations read from the data set UCB.TEMPFRACDXALLCONTROL.
      WHERE diagCodeType='Trauma code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.TRAUMA has 706177 observations and 21 variables.
NOTE: DATA statement used (Total process time):
      real time           20.43 seconds
      cpu time            1.20 seconds
      

472        proc sort data= trauma(keep=patid trauma_dt) nodupkey; by patid trauma_dt;run;

NOTE: There were 706177 observations read from the data set WORK.TRAUMA.
NOTE: 127172 observations with duplicate key values were deleted.
NOTE: The data set WORK.TRAUMA has 579005 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.42 seconds
      cpu time            0.57 seconds
      

473        
474        
475        /*subset the spine xray procedure claim for patients with fx diagnosis code only*/
476        /*so SAS will not run out of memory*/
477        data fx_spine_xray(keep=patid tx_site px_date ENCOUNTERID begin_date);
478        if _n_=1 then do;
479          declare hash hid(dataset:"fx_dgns_3(where=(fx_site='(805, 806, 73313) spine')))", multidata:"N", hashexp:20);
480          rc=hid.defineKey("patid");
481          rc=hid.defineDone();
482        end;
483        set spine_xray;
484        rc=hid.find();
485        if rc=0;
486        run;

NOTE: There were 625951 observations read from the data set WORK.FX_DGNS_3.
      WHERE fx_site='(805, 806, 73313) spine';
NOTE: There were 3445114 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.FX_SPINE_XRAY has 573214 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           3.97 seconds
      cpu time            3.26 seconds
      

487        /*subset the Trauma code for patients with fx diagnosis code only*/
488        /*so SAS will not run out of memory*/
10                                                                  The SAS System                                   10:27 Wednesday, November 8, 2017

489        data fx_trauma(drop=rc);
490        if _n_=1 then do;
491          declare hash hid(dataset:"fx_dgns_3", multidata:"N", hashexp:20);
492          rc=hid.defineKey("patid");
493          rc=hid.defineDone();
494        end;
495        set trauma;
496        rc=hid.find();
497        if rc=0;
498        run;

NOTE: There were 4280380 observations read from the data set WORK.FX_DGNS_3.
NOTE: There were 579005 observations read from the data set WORK.TRAUMA.
NOTE: The data set WORK.FX_TRAUMA has 283418 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           3.32 seconds
      cpu time            2.65 seconds
      

499        /************************************Link Fracture Claims (ICD9 Diagnosis) with Repair Claims (CPT/HCPCS, some ICD9 procedure
499      ! code)***************/
500        
501        data fx_dgns_4(drop=rc: px_date tx_site xray_date trauma_dt);
502        if _n_=1 then do;
503          declare hash hid(dataset:"fx_prcd", multidata:"N", hashexp:20);
504          rc=hid.defineKey("patid", "px_date", "tx_site");
505        /*  rc=hid.defineData("px_date", "tx_site");*/
506          rc=hid.defineDone();
507          declare hash hxray(dataset:"fx_spine_xray(rename=px_date=xray_date)", multidata:"Y", hashexp:20);
508          rc=hxray.defineKey("patid", "tx_site");
509          rc=hxray.defineData("xray_date");
510          rc=hxray.defineDone();
511          declare hash htrauma(dataset:"fx_trauma", multidata:"Y", hashexp:20);
512          rc=htrauma.defineKey("patid");
513          rc=htrauma.defineData("trauma_dt");
514          rc=htrauma.defineDone();
515        end;
516        if 0 then set fx_prcd(keep=patid px_date tx_site)
517                      fx_spine_xray(keep=patid px_date tx_site rename=px_date=xray_date)
518                      fx_trauma;
519        set fx_dgns_3;
520        length cq $4 spine_image trauma_date 4 trauma $1;
521        format spine_image trauma_date mmddyy10.;
522        cq="0000";
523        rc=hid.find(key:patid, key:begin_date,key:fx_site);
524        if rc^=0 then do;
525            px_date=.;
526            tx_site=" ";
527        end;
528        if enc_type="IP" then do;
529        /*CQ = 1 Inpatient claim with primary diagnosis code */
530            if pdx="P" then substr(cq,1,1)="1";
531        /*CQ = 2 Inpatient claim with secondary diagnosis code*/
532            else substr(cq,2,1)="2";
533        end; else do;
534        /*CQ = 3 outpatient diagnosis code AND carrier line with repair/replace HCPCS*/
535            if rc=0 then substr(cq,3,1)="3";
536            rc1=hxray.find(key:patid, key:fx_site);
537            do while (rc1 = 0);
538                if begin_date-10 <=xray_date<= begin_date then do;
539                    if enc_type in ("AV" "IF" "NH" "HH" "ER" "ED") then do;
540        /*CQ = 4 outpatient [Physician E&M codes] diagnosis code with spine image/x-ray within 10 day early*/
541                        substr(cq,4,1)="4";
542                        spine_image=min(spine_image,xray_date);
543                    end;
544                end;
545                rc1=hxray.find_next(key:patid, key:fx_site);
546            end;
547        end;
548        /*is there trauma dx within 14 days*/
549        rc2=htrauma.find(key:patid);
550        do while (rc2 = 0) ;
11                                                                  The SAS System                                   10:27 Wednesday, November 8, 2017

551            if 0<=abs(trauma_dt-begin_date)<=14 then do;
552                    trauma="1";
553                    trauma_date=min(trauma_date,trauma_dt);
554           end ;
555           rc2=htrauma.find_next(key:patid) ;
556        end;
557        
558        run;

NOTE: There were 739917 observations read from the data set WORK.FX_PRCD.
NOTE: There were 573214 observations read from the data set WORK.FX_SPINE_XRAY.
NOTE: There were 283418 observations read from the data set WORK.FX_TRAUMA.
NOTE: There were 4280380 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_4 has 4280380 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           12.36 seconds
      cpu time            11.62 seconds
      

559        proc freq data=fx_dgns_4; tables enc_type*cq fx_site*cq trauma/missing;run;

                                                                  --- AS project ---                             10:27 Wednesday, November 8, 2017   2

                                                                  The FREQ Procedure

                                                               Table of ENC_TYPE by cq

                                       ENC_TYPE(Encounter Type)     cq

                                       Frequency|
                                       Percent  |
                                       Row Pct  |
                                       Col Pct  |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       AV       |1753819 | 156340 | 159183 |   5006 |      0 |      0 |2074348
                                                |  40.97 |   3.65 |   3.72 |   0.12 |   0.00 |   0.00 |  48.46
                                                |  84.55 |   7.54 |   7.67 |   0.24 |   0.00 |   0.00 |
                                                |  55.23 |  56.47 |  45.34 |  69.20 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       ED       | 755714 |  94097 | 187758 |   2087 |      0 |      0 |1039656
                                                |  17.66 |   2.20 |   4.39 |   0.05 |   0.00 |   0.00 |  24.29
                                                |  72.69 |   9.05 |  18.06 |   0.20 |   0.00 |   0.00 |
                                                |  23.80 |  33.99 |  53.47 |  28.85 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       HH       |  58675 |   3950 |    292 |     19 |      0 |      0 |  62936
                                                |   1.37 |   0.09 |   0.01 |   0.00 |   0.00 |   0.00 |   1.47
                                                |  93.23 |   6.28 |   0.46 |   0.03 |   0.00 |   0.00 |
                                                |   1.85 |   1.43 |   0.08 |   0.26 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       IP       |      0 |      0 |      0 |      0 | 284735 | 185111 | 469846
                                                |   0.00 |   0.00 |   0.00 |   0.00 |   6.65 |   4.32 |  10.98
                                                |   0.00 |   0.00 |   0.00 |   0.00 |  60.60 |  39.40 |
                                                |   0.00 |   0.00 |   0.00 |   0.00 | 100.00 | 100.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       NH       | 607127 |  22462 |   3883 |    122 |      0 |      0 | 633594
                                                |  14.18 |   0.52 |   0.09 |   0.00 |   0.00 |   0.00 |  14.80
                                                |  95.82 |   3.55 |   0.61 |   0.02 |   0.00 |   0.00 |
                                                |  19.12 |   8.11 |   1.11 |   1.69 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       Total     3175335   276849   351116     7234   284735   185111  4280380
                                                   74.18     6.47     8.20     0.17     6.65     4.32   100.00


 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
                                                                  --- AS project ---                             10:27 Wednesday, November 8, 2017   3

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (7331) pathologi |  27405 |      0 |      0 |      0 |   2858 |    869 |  31132
                                   c nos/nec        |   0.64 |   0.00 |   0.00 |   0.00 |   0.07 |   0.02 |   0.73
                                                    |  88.03 |   0.00 |   0.00 |   0.00 |   9.18 |   2.79 |
                                                    |   0.86 |   0.00 |   0.00 |   0.00 |   1.00 |   0.47 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (800-804) skull/ | 108344 |      0 |  10675 |      0 |  13398 |   5013 | 137430
                                   face             |   2.53 |   0.00 |   0.25 |   0.00 |   0.31 |   0.12 |   3.21
                                                    |  78.84 |   0.00 |   7.77 |   0.00 |   9.75 |   3.65 |
                                                    |   3.41 |   0.00 |   3.04 |   0.00 |   4.71 |   2.71 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (805, 806, 73313 | 249902 | 276849 |   1195 |   7234 |  60231 |  30540 | 625951
                                   ) spine          |   5.84 |   6.47 |   0.03 |   0.17 |   1.41 |   0.71 |  14.62
                                                    |  39.92 |  44.23 |   0.19 |   1.16 |   9.62 |   4.88 |
                                                    |   7.87 | 100.00 |   0.34 | 100.00 |  21.15 |  16.50 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (807) rib/sternu | 187739 |      0 |  27391 |      0 |  21025 |   6813 | 242968
                                   m/trachea        |   4.39 |   0.00 |   0.64 |   0.00 |   0.49 |   0.16 |   5.68
                                                    |  77.27 |   0.00 |  11.27 |   0.00 |   8.65 |   2.80 |
                                                    |   5.91 |   0.00 |   7.80 |   0.00 |   7.38 |   3.68 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (808) pelvis     | 150283 |      0 |   6673 |      0 |  20605 |  12375 | 189936
                                                    |   3.51 |   0.00 |   0.16 |   0.00 |   0.48 |   0.29 |   4.44
                                                    |  79.12 |   0.00 |   3.51 |   0.00 |  10.85 |   6.52 |
                                                    |   4.73 |   0.00 |   1.90 |   0.00 |   7.24 |   6.69 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (809) trunk bone |   2076 |      0 |      0 |      0 |    125 |      9 |   2210
                                   s                |   0.05 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.05
                                                    |  93.94 |   0.00 |   0.00 |   0.00 |   5.66 |   0.41 |
                                                    |   0.07 |   0.00 |   0.00 |   0.00 |   0.04 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (810) clavicle   |  55121 |      0 |   9155 |      0 |   2940 |    644 |  67860
                                                    |   1.29 |   0.00 |   0.21 |   0.00 |   0.07 |   0.02 |   1.59
                                                    |  81.23 |   0.00 |  13.49 |   0.00 |   4.33 |   0.95 |
                                                    |   1.74 |   0.00 |   2.61 |   0.00 |   1.03 |   0.35 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (811) scapula    |  13173 |      0 |   1126 |      0 |   1208 |    269 |  15776
                                                    |   0.31 |   0.00 |   0.03 |   0.00 |   0.03 |   0.01 |   0.37
                                                    |  83.50 |   0.00 |   7.14 |   0.00 |   7.66 |   1.71 |
                                                    |   0.41 |   0.00 |   0.32 |   0.00 |   0.42 |   0.15 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total             3175335   276849   351116     7234   284735   185111  4280380
                                                       74.18     6.47     8.20     0.17     6.65     4.32   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
                                                                  --- AS project ---                             10:27 Wednesday, November 8, 2017   4

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (812, 73311) hum | 324754 |      0 |  34482 |      0 |  19101 |  12228 | 390565
                                   erus             |   7.59 |   0.00 |   0.81 |   0.00 |   0.45 |   0.29 |   9.12
                                                    |  83.15 |   0.00 |   8.83 |   0.00 |   4.89 |   3.13 |
                                                    |  10.23 |   0.00 |   9.82 |   0.00 |   6.71 |   6.61 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (813, 73312) rad | 321337 |      0 |  92818 |      0 |  12552 |   6050 | 432757
                                   ius_ulna         |   7.51 |   0.00 |   2.17 |   0.00 |   0.29 |   0.14 |  10.11
                                                    |  74.25 |   0.00 |  21.45 |   0.00 |   2.90 |   1.40 |
                                                    |  10.12 |   0.00 |  26.44 |   0.00 |   4.41 |   3.27 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (814) carpal     |  74104 |      0 |   3167 |      0 |   1169 |    125 |  78565
                                                    |   1.73 |   0.00 |   0.07 |   0.00 |   0.03 |   0.00 |   1.84
                                                    |  94.32 |   0.00 |   4.03 |   0.00 |   1.49 |   0.16 |
                                                    |   2.33 |   0.00 |   0.90 |   0.00 |   0.41 |   0.07 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (815-817) hand/f | 153777 |      0 |  41483 |      0 |   3090 |    476 | 198826
                                   ingers           |   3.59 |   0.00 |   0.97 |   0.00 |   0.07 |   0.01 |   4.65
                                                    |  77.34 |   0.00 |  20.86 |   0.00 |   1.55 |   0.24 |
                                                    |   4.84 |   0.00 |  11.81 |   0.00 |   1.09 |   0.26 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (818-819) arms m |   6325 |      0 |      0 |      0 |    124 |     12 |   6461
                                   ult              |   0.15 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.15
                                                    |  97.90 |   0.00 |   0.00 |   0.00 |   1.92 |   0.19 |
                                                    |   0.20 |   0.00 |   0.00 |   0.00 |   0.04 |   0.01 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (820, 73314) hip | 514042 |      0 |  62114 |      0 |  84287 |  80586 | 741029
                                                    |  12.01 |   0.00 |   1.45 |   0.00 |   1.97 |   1.88 |  17.31
                                                    |  69.37 |   0.00 |   8.38 |   0.00 |  11.37 |  10.87 |
                                                    |  16.19 |   0.00 |  17.69 |   0.00 |  29.60 |  43.53 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (821, 73315) fem | 131471 |      0 |   6797 |      0 |  12243 |   9428 | 159939
                                   ur               |   3.07 |   0.00 |   0.16 |   0.00 |   0.29 |   0.22 |   3.74
                                                    |  82.20 |   0.00 |   4.25 |   0.00 |   7.65 |   5.89 |
                                                    |   4.14 |   0.00 |   1.94 |   0.00 |   4.30 |   5.09 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (822) patella    |  52041 |      0 |   5619 |      0 |   2651 |   1846 |  62157
                                                    |   1.22 |   0.00 |   0.13 |   0.00 |   0.06 |   0.04 |   1.45
                                                    |  83.73 |   0.00 |   9.04 |   0.00 |   4.27 |   2.97 |
                                                    |   1.64 |   0.00 |   1.60 |   0.00 |   0.93 |   1.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total             3175335   276849   351116     7234   284735   185111  4280380
                                                       74.18     6.47     8.20     0.17     6.65     4.32   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
                                                                  --- AS project ---                             10:27 Wednesday, November 8, 2017   5

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (823, 73316) tib | 150048 |      0 |  13346 |      0 |   8670 |   6051 | 178115
                                   _fib             |   3.51 |   0.00 |   0.31 |   0.00 |   0.20 |   0.14 |   4.16
                                                    |  84.24 |   0.00 |   7.49 |   0.00 |   4.87 |   3.40 |
                                                    |   4.73 |   0.00 |   3.80 |   0.00 |   3.04 |   3.27 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (824) ankle      | 245310 |      0 |  33090 |      0 |  12764 |  10419 | 301583
                                                    |   5.73 |   0.00 |   0.77 |   0.00 |   0.30 |   0.24 |   7.05
                                                    |  81.34 |   0.00 |  10.97 |   0.00 |   4.23 |   3.45 |
                                                    |   7.73 |   0.00 |   9.42 |   0.00 |   4.48 |   5.63 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (825) tarsal_met | 254819 |      0 |   1985 |      0 |   3600 |   1081 | 261485
                                   atarsal          |   5.95 |   0.00 |   0.05 |   0.00 |   0.08 |   0.03 |   6.11
                                                    |  97.45 |   0.00 |   0.76 |   0.00 |   1.38 |   0.41 |
                                                    |   8.02 |   0.00 |   0.57 |   0.00 |   1.26 |   0.58 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (826) foot_phala | 114347 |      0 |      0 |      0 |   1352 |    212 | 115911
                                   nges             |   2.67 |   0.00 |   0.00 |   0.00 |   0.03 |   0.00 |   2.71
                                                    |  98.65 |   0.00 |   0.00 |   0.00 |   1.17 |   0.18 |
                                                    |   3.60 |   0.00 |   0.00 |   0.00 |   0.47 |   0.11 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (827) lower_limb |   5084 |      0 |      0 |      0 |     79 |      9 |   5172
                                                    |   0.12 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.12
                                                    |  98.30 |   0.00 |   0.00 |   0.00 |   1.53 |   0.17 |
                                                    |   0.16 |   0.00 |   0.00 |   0.00 |   0.03 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (828) legs+arm/r |   1321 |      0 |      0 |      0 |    285 |     44 |   1650
                                   ib               |   0.03 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   0.04
                                                    |  80.06 |   0.00 |   0.00 |   0.00 |  17.27 |   2.67 |
                                                    |   0.04 |   0.00 |   0.00 |   0.00 |   0.10 |   0.02 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (829) fx_nos     |  32512 |      0 |      0 |      0 |    378 |     12 |  32902
                                                    |   0.76 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   0.77
                                                    |  98.81 |   0.00 |   0.00 |   0.00 |   1.15 |   0.04 |
                                                    |   1.02 |   0.00 |   0.00 |   0.00 |   0.13 |   0.01 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total             3175335   276849   351116     7234   284735   185111  4280380
                                                       74.18     6.47     8.20     0.17     6.65     4.32   100.00


                                                                                Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                                        3623132       84.65       3623132        84.65  
                                             1           657248       15.35       4280380       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
NOTE: There were 4280380 observations read from the data set WORK.FX_DGNS_4.
NOTE: The PROCEDURE FREQ printed pages 2-5.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           3.60 seconds
      cpu time            3.44 seconds
      

560        
561        *goto 002_fx_epi.sas;
562        
563        
564        
565        
566        /*
567        START OF 002_fx_data.sas
568         */
569        
570        /*all the claims to define episode sequence */
571        data _dat0(keep=
572        PATID ENCOUNTERID ADMIT_DATE DISCHARGE_DATE BEGIN_DATE END_DATE DX DX_TYPE PDX  /* SOURCE */ ENC_TYPE fx_site px px_date
573        site cq spine_image trauma_date trauma );
574        set fx_dgns_4 fx_excare Fx_prcd(rename=tx_site=fx_site);
575        run;

NOTE: There were 4280380 observations read from the data set WORK.FX_DGNS_4.
NOTE: There were 729598 observations read from the data set WORK.FX_EXCARE.
NOTE: There were 739917 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK._DAT0 has 5749895 observations and 18 variables.
NOTE: DATA statement used (Total process time):
      real time           3.77 seconds
      cpu time            3.18 seconds
      

576        proc sort data=_dat0; by PATID fx_site BEGIN_DATE END_DATE; run;

NOTE: There were 5749895 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT0 has 5749895 observations and 18 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           5.70 seconds
      cpu time            11.79 seconds
      

577        /*for each claim define start and end date applicable to IP NH and NH*/
578        data _dat1;
579        set _dat0;
580        length start_date end_date 4;
581        format start_date end_date mmddyy10.;
582        by PATID fx_site BEGIN_DATE END_DATE;
583        start_date=min(ADMIT_DATE, BEGIN_DATE);
584        end_date=max(DISCHARGE_DATE, End_DATE);
585        run;
12                                                                  The SAS System                                   10:27 Wednesday, November 8, 2017


NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      43219 at 583:12   3719 at 584:10    
NOTE: There were 5749895 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT1 has 5749895 observations and 19 variables.
NOTE: DATA statement used (Total process time):
      real time           4.27 seconds
      cpu time            4.14 seconds
      

586        proc sort data=_dat1; by PATID fx_site start_date end_date; run;

NOTE: There were 5749895 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT1 has 5749895 observations and 19 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           5.75 seconds
      cpu time            11.62 seconds
      

587        
588        /* generate unique episode sequence ID */
589        data _dat2(drop=end_date_max lag_end_date_max _gap);
590        set _dat1;
591        length lag_end_date_max end_date_max 4;
592        format lag_end_date_max end_date_max mmddyy10.;
593        
594        by PATID fx_site start_date end_date;
595        retain seq 0;
596        
597        /*if current claims end date > all previouse claim end date in sequence, then update*/
598        end_date_max=max(end_date,end_date_max);
599        lag_end_date_max=lag(end_date_max);
600        
601        if first.fx_site then lag_end_date_max=.;
602        _gap=start_date-lag_end_date_max;
603        
604        /*if current claims start date >90 days after all previouse claim end date in sequence,
605        then start new sequence*/
606        if first.fx_site or start_date-lag_end_date_max>90 then do;
607            end_date_max=end_date;
608        
609            seq+1;
610        end;
611        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      3719 at 598:14      1139999 at 602:16   1139999 at 606:31   
NOTE: There were 5749895 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT2 has 5749895 observations and 20 variables.
NOTE: DATA statement used (Total process time):
      real time           4.80 seconds
      cpu time            4.71 seconds
      

612        proc sort data=_dat2; by seq;run;

NOTE: There were 5749895 observations read from the data set WORK._DAT2.
NOTE: The data set WORK._DAT2 has 5749895 observations and 20 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           4.77 seconds
      cpu time            8.22 seconds
      

613        proc sql;
614        /*episode sequence start date*/
615        create table seq_start as
616        select patid, seq, min(start_date) as seq_start_date length=4 format=mmddyy10.
617         from _dat2
618         where substr(dx,1,4) not in ('V541' 'V542')
619         group by patid, seq
13                                                                  The SAS System                                   10:27 Wednesday, November 8, 2017

620         order by patid, seq;
NOTE: Table WORK.SEQ_START created, with 1137375 rows and 3 columns.

621        /*episode sequence end date*/
622        create table seq_end as
623        select patid, seq,
624         max(start_date) as seq_end_date length=4 format=mmddyy10. from _dat2
625         group by patid, seq
626         order by patid, seq;
NOTE: Table WORK.SEQ_END created, with 1356521 rows and 3 columns.

627        quit;
NOTE: PROCEDURE SQL used (Total process time):
      real time           10.04 seconds
      cpu time            13.74 seconds
      

628        /*episode sequence case qualifier indicator and trauma*/
629        data seq_cq(keep=patid seq seq_cq seq_trauma fx_site);
630        set _dat2;
631        by patid seq;
632        length seq_cq $4 seq_trauma $1;
633        retain seq_cq seq_trauma;
634        if first.seq then do;
635            seq_cq="0000";
636            seq_trauma="0";
637        end;
638        if trauma="1" then seq_trauma=trauma;
639        do i=1 to 4;
640        if substr(cq,i,1)>substr(seq_cq,i,1) then substr(seq_cq,i,1)=substr(cq,i,1);
641        end;
642        if last.seq then output;
643        run;

NOTE: There were 5749895 observations read from the data set WORK._DAT2.
NOTE: The data set WORK.SEQ_CQ has 1356521 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           5.02 seconds
      cpu time            4.94 seconds
      

644        proc freq data=seq_cq; tables seq_cq seq_trauma fx_site; run;

                                                                  --- AS project ---                             10:27 Wednesday, November 8, 2017   6

                                                                  The FREQ Procedure

                                                                                Cumulative    Cumulative
                                             seq_cq    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0000        946439       69.77        946439        69.77  
                                             0004         58013        4.28       1004452        74.05  
                                             0030         87478        6.45       1091930        80.49  
                                             0034          2021        0.15       1093951        80.64  
                                             0200         77004        5.68       1170955        86.32  
                                             0204          7209        0.53       1178164        86.85  
                                             0230          4724        0.35       1182888        87.20  
                                             0234           202        0.01       1183090        87.22  
                                             1000         53926        3.98       1237016        91.19  
                                             1004          6778        0.50       1243794        91.69  
                                             1030         13181        0.97       1256975        92.66  
                                             1034           345        0.03       1257320        92.69  
                                             1200         71853        5.30       1329173        97.98  
                                             1204         10818        0.80       1339991        98.78  
                                             1230         16017        1.18       1356008        99.96  
                                             1234           513        0.04       1356521       100.00  


                                             seq_                               Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0          1208519       89.09       1208519        89.09  
                                             1           148002       10.91       1356521       100.00  


                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec       29364        2.16         29364         2.16  
                                    (800-804) skull/face            38524        2.84         67888         5.00  
                                    (805, 806, 73313) spine        173663       12.80        241551        17.81  
                                    (807) rib/sternum/trachea       77197        5.69        318748        23.50  
                                    (808) pelvis                    40672        3.00        359420        26.50  
                                    (809) trunk bones                 993        0.07        360413        26.57  
                                    (810) clavicle                  17224        1.27        377637        27.84  
                                    (811) scapula                    5681        0.42        383318        28.26  
                                    (812, 73311) humerus            75308        5.55        458626        33.81  
                                    (813, 73312) radius_ulna        99099        7.31        557725        41.11  
                                    (814) carpal                    37910        2.79        595635        43.91  
                                    (815-817) hand/fingers          54384        4.01        650019        47.92  
                                    (818-819) arms mult              3063        0.23        653082        48.14  
                                    (820, 73314) hip               196633       14.50        849715        62.64  
                                    (821, 73315) femur              83383        6.15        933098        68.79  
                                    (822) patella                   41084        3.03        974182        71.81  
                                    (823, 73316) tib_fib            54838        4.04       1029020        75.86  
                                    (824) ankle                     78176        5.76       1107196        81.62  
                                    (825) tarsal_metatarsal         70334        5.18       1177530        86.81  
                                    (826) foot_phalanges            40366        2.98       1217896        89.78  
                                    (827) lower_limb                 2372        0.17       1220268        89.96  
                                    (828) legs+arm/rib                692        0.05       1220960        90.01  
                                    (829) fx_nos                   135561        9.99       1356521       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
NOTE: There were 1356521 observations read from the data set WORK.SEQ_CQ.
NOTE: The PROCEDURE FREQ printed page 6.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.70 seconds
      cpu time            0.56 seconds
      

645        
646        data seq_cq_date;
647        merge seq_cq seq_start seq_end;
648        by patid seq;
649        length site_order $1;
650        if fx_site='(820, 73314) hip' then site_order='1';
651        if fx_site='(821, 73315) femur' then site_order='2';
652        if fx_site='(808) pelvis' then site_order='3';
653        if fx_site='(805, 806, 73313) spine' then site_order='4';
654        if fx_site='(812, 73311) humerus' then site_order='5';
655        if fx_site='(813, 73312) radius_ulna' then site_order='6';
656        if fx_site='(823, 73316) tib_fib' then site_order='7';
657        if fx_site='(824) ankle' then site_order='8';
658        if fx_site='(810) clavicle' then site_order='9';
659        run;

NOTE: There were 1356521 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 1137375 observations read from the data set WORK.SEQ_START.
NOTE: There were 1356521 observations read from the data set WORK.SEQ_END.
NOTE: The data set WORK.SEQ_CQ_DATE has 1356521 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           1.85 seconds
14                                                                  The SAS System                                   10:27 Wednesday, November 8, 2017

      cpu time            1.79 seconds
      

660        
661        data _tmp_combo;
662        set seq_cq_date;
663        where site_order^=" " and seq_cq^="0000" and seq_cq^=" ";
664        run;

NOTE: There were 335543 observations read from the data set WORK.SEQ_CQ_DATE.
      WHERE (site_order not = ' ') and seq_cq not in (' ', '0000');
NOTE: The data set WORK._TMP_COMBO has 335543 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.39 seconds
      cpu time            0.31 seconds
      

665        
666        * define combo or alone fx;
667        data seq_COMBO(
668        keep=patid seq seq_cq seq_start_date alone_combo fx_site site_order)
669        ;
670        if _n_=1 then do;
671            declare hash hpid(dataset:"_tmp_combo(where=(seq_cq^='0000' and seq_cq^=' ')
672                    rename=(seq_start_date=seq_start_date2  fx_site= fx_site_combo seq=seq_COMBO))", ordered: 'a', multidata:"Y");
673            rc=hpid.defineKey("patid");
674            rc=hpid.defineData("patid","seq_start_date2", "fx_site_combo", "seq_COMBO");
675            rc=hpid.defineDone();
676        end;
677        if 0 then set _tmp_combo(rename=(seq_start_date=seq_start_date2 fx_site= fx_site_combo seq=seq_COMBO));
678        set _tmp_combo(where=(seq_cq^="0000" and seq_cq^=" ") );
679        by patid seq;
680        length  index_fx_begin 4 alone_combo $5;
681        alone_combo="alone";
682            format index_fx_begin mmddyy10.;
683            index_fx_begin=seq_start_date;
684        
685         rc=hpid.find(key:patid);
686        
687         do while (rc = 0);
688         if rc=0 and abs(seq_start_date-seq_start_date2) <=30 and fx_site_combo^=fx_site then alone_combo= 'combo';
689         rc=hpid.find_next();
690         *hpid.has_next(result:r);
691        end;
692        if alone_combo="alone" then do;
693            seq_start_date2=.; fx_site_combo=" "; seq_COMBO=.;
694        end;
695        run;

NOTE: There were 335543 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: There were 335543 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.SEQ_COMBO has 335543 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           1.12 seconds
      cpu time            1.06 seconds
      

696        proc freq data=seq_COMBO; tables alone_combo; run;

                                                                  --- AS project ---                             10:27 Wednesday, November 8, 2017   7

                                                                  The FREQ Procedure

                                             alone_                             Cumulative    Cumulative
                                             combo     Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             alone       287254       85.61        287254        85.61  
                                             combo        48289       14.39        335543       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
NOTE: There were 335543 observations read from the data set WORK.SEQ_COMBO.
NOTE: The PROCEDURE FREQ printed page 7.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.15 seconds
      cpu time            0.07 seconds
      

697        
698        proc sort data = Work.seq_COMBO;
699          by patid seq_start_date;
700        run;
15                                                                  The SAS System                                   10:27 Wednesday, November 8, 2017


NOTE: There were 335543 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 335543 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.21 seconds
      cpu time            0.23 seconds
      

701        
702        data combo_seq;
703        set seq_COMBO;
704        by patid seq_start_date;
705        length combo_fx_site $30. combo_seq 4;
706        retain combo_seq 0 combo_fx_site;
707        if first.patid or seq_start_date-lag(seq_start_date) then combo_seq=1+combo_seq;
708        where seq_cq^='0000' and seq_cq^=' ';
709        if combo_fx_site=" " or ""<site_order<lag(site_order) then combo_fx_site=fx_site;
710        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      1 at 707:33   
NOTE: There were 335543 observations read from the data set WORK.SEQ_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.COMBO_SEQ has 335543 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.34 seconds
      cpu time            0.26 seconds
      

711        
712        proc sort data = Work.seq_COMBO;
713          by patid seq;
714        run;

NOTE: There were 335543 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 335543 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.21 seconds
      cpu time            0.28 seconds
      

715        
716        data FX_CLM_DB;
717        merge _dat2 seq_start seq_end seq_cq(drop=fx_site) seq_COMBO(keep=patid seq alone_combo);
718        by patid seq;
719        run;

NOTE: There were 5749895 observations read from the data set WORK._DAT2.
NOTE: There were 1137375 observations read from the data set WORK.SEQ_START.
NOTE: There were 1356521 observations read from the data set WORK.SEQ_END.
NOTE: There were 1356521 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 335543 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.FX_CLM_DB has 5749895 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           8.45 seconds
      cpu time            8.19 seconds
      

720        
721        proc sql;
722        select count(distinct seq) from FX_CLM_DB;
                                                                  --- AS project ---                             10:27 Wednesday, November 8, 2017   8

                                                                               
                                                                       --------
                                                                        1356521
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
723        quit;
NOTE: The PROCEDURE SQL printed page 8.
NOTE: PROCEDURE SQL used (Total process time):
      real time           5.47 seconds
      cpu time            5.31 seconds
      

724        
725        
726        
16                                                                  The SAS System                                   10:27 Wednesday, November 8, 2017

727        
728        /*
729        Collapse to fracture episodes
730        
731        Q: Why are some seq_start_date values missing?
732         */
733        proc sort
734          data = Work.fx_clm_db
735          out = Work.fractureEpisodes (drop = seq
736                                       rename = (seq_start_date = fractureEpisodeStart
737                                                 seq_end_date = fractureEpisodeEnd
738                                                 fx_site = fractureSite))
739          nodupkey;
740          by patid seq seq_start_date seq_end_date fx_site;
741        run;

NOTE: There were 5749895 observations read from the data set WORK.FX_CLM_DB.
NOTE: 4393374 observations with duplicate key values were deleted.
NOTE: The data set WORK.FRACTUREEPISODES has 1356521 observations and 24 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           4.10 seconds
      cpu time            7.77 seconds
      

742        
743        proc sql;
744          create table DT.fractureEpisodesPrevControl as
745            select A.database,
746                   A.cohort,
747                   A.indexDate,
748                   A.controlID,
749                   A.age,
750                   A.sex,
751                   B.*,
752                   case
753                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
754                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
755                     else ""
756                     end as fractureType
757            from DT.controlLookup A inner join
758                 Work.fractureEpisodes B on (A.patid = B.patid);
NOTE: Table DT.FRACTUREEPISODESPREVCONTROL created, with 1356521 rows and 31 columns.

759          create table Work.summaryFractureEpisodesPrev as
760            select "DT.fractureEpisodesPrevControl" as table,
761                   fractureType, fractureSite,
762                   count(distinct patid) as countDistinctPatid,
763                   count(*) as countFractureEpisodes
764            from DT.fractureEpisodesPrevControl
765            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESPREV created, with 23 rows and 5 columns.

766          select * from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                             10:27 Wednesday, November 8, 2017   9

                                                                                                                       count         count
                                                                                                                    Distinct      Fracture
           table                           fractureType                         fractureSite                           Patid      Episodes
           -------------------------------------------------------------------------------------------------------------------------------
           DT.fractureEpisodesPrevControl                                       (7331) pathologic nos/nec              26112         29364
           DT.fractureEpisodesPrevControl                                       (800-804) skull/face                   35883         38524
           DT.fractureEpisodesPrevControl                                       (807) rib/sternum/trachea              70204         77197
           DT.fractureEpisodesPrevControl                                       (809) trunk bones                        913           993
           DT.fractureEpisodesPrevControl                                       (810) clavicle                         15708         17224
           DT.fractureEpisodesPrevControl                                       (811) scapula                           5355          5681
           DT.fractureEpisodesPrevControl                                       (814) carpal                           35290         37910
           DT.fractureEpisodesPrevControl                                       (815-817) hand/fingers                 50358         54384
           DT.fractureEpisodesPrevControl                                       (818-819) arms mult                     2967          3063
           DT.fractureEpisodesPrevControl                                       (822) patella                          36027         41084
           DT.fractureEpisodesPrevControl                                       (823, 73316) tib_fib                   46512         54838
           DT.fractureEpisodesPrevControl                                       (824) ankle                            65138         78176
           DT.fractureEpisodesPrevControl                                       (825) tarsal_metatarsal                61531         70334
           DT.fractureEpisodesPrevControl                                       (826) foot_phalanges                   37667         40366
           DT.fractureEpisodesPrevControl                                       (827) lower_limb                        2244          2372
           DT.fractureEpisodesPrevControl                                       (828) legs+arm/rib                       673           692
           DT.fractureEpisodesPrevControl                                       (829) fx_nos                          114395        135561
           DT.fractureEpisodesPrevControl  Clinical vertebral fracture          (805, 806, 73313) spine               122199        173663
           DT.fractureEpisodesPrevControl  Non-vertebral osteoporotic fracture  (808) pelvis                           35621         40672
           DT.fractureEpisodesPrevControl  Non-vertebral osteoporotic fracture  (812, 73311) humerus                   60544         75308
           DT.fractureEpisodesPrevControl  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna               83252         99099
           DT.fractureEpisodesPrevControl  Non-vertebral osteoporotic fracture  (820, 73314) hip                      152250        196633
           DT.fractureEpisodesPrevControl  Non-vertebral osteoporotic fracture  (821, 73315) femur                     70727         83383
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
767          select "DT.fractureEpisodesPrevControl" as table,
768                 sum(countDistinctPatid) as sumDistinctPatid,
769                 sum(countFractureEpisodes) as sumFractureEpisodes
770            from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                             10:27 Wednesday, November 8, 2017  10

                                                                               sumDistinct   sumFracture
                                              table                                  Patid      Episodes
                                              ----------------------------------------------------------
                                              DT.fractureEpisodesPrevControl       1131570       1356521
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
771        quit;
NOTE: The PROCEDURE SQL printed pages 9-10.
NOTE: PROCEDURE SQL used (Total process time):
      real time           15.83 seconds
      cpu time            17.23 seconds
      

772        
773        
774        
775        
776        proc export
777          data = Work.summaryFractureEpisodesPrev
778          outfile = "data\processed\&cmt..csv"
779          dbms = csv
17                                                                  The SAS System                                   10:27 Wednesday, November 8, 2017

780          replace;
781          delimiter = '09'x;
782        run;

783         /**********************************************************************
784         *   PRODUCT:   SAS
785         *   VERSION:   9.4
786         *   CREATOR:   External File Interface
787         *   DATE:      08NOV17
788         *   DESC:      Generated SAS Datastep Code
789         *   TEMPLATE SOURCE:  (None Specified.)
790         ***********************************************************************/
791            data _null_;
792            %let _EFIERR_ = 0; /* set the ERROR detection macro variable */
793            %let _EFIREC_ = 0;     /* clear export record count macro variable */
794            file 'data\processed\queryFracturesControl.csv' delimiter='09'x DSD DROPOVER lrecl=32767;
795            if _n_ = 1 then        /* write column names or labels */
796             do;
797               put
798                  "table"
799               '09'x
800                  "fractureType"
801               '09'x
802                  "fractureSite"
803               '09'x
804                  "countDistinctPatid"
805               '09'x
806                  "countFractureEpisodes"
807               ;
808             end;
809           set  WORK.SUMMARYFRACTUREEPISODESPREV   end=EFIEOD;
810               format table $30. ;
811               format fractureType $35. ;
812               format fractureSite $30. ;
813               format countDistinctPatid best12. ;
814               format countFractureEpisodes best12. ;
815             do;
816               EFIOUT + 1;
817               put table $ @;
818               put fractureType $ @;
819               put fractureSite $ @;
820               put countDistinctPatid @;
821               put countFractureEpisodes ;
822               ;
823             end;
824            if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable */
825            if EFIEOD then call symputx('_EFIREC_',EFIOUT);
826            run;

NOTE: The file 'data\processed\queryFracturesControl.csv' is:
      Filename=U:\studies\AS\pgms\bchan\data\processed\queryFracturesControl.csv,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=08Nov2017:11:53:49,
      Create Time=08Nov2017:11:53:49

NOTE: 24 records were written to the file 'data\processed\queryFracturesControl.csv'.
      The minimum record length was 55.
      The maximum record length was 103.
NOTE: There were 23 observations read from the data set WORK.SUMMARYFRACTUREEPISODESPREV.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
      

23 records created in data\processed\queryFracturesControl.csv from WORK.SUMMARYFRACTUREEPISODESPREV.
  
  
NOTE: "data\processed\queryFracturesControl.csv" file was successfully created.
NOTE: PROCEDURE EXPORT used (Total process time):
      real time           0.76 seconds
      cpu time            0.07 seconds
      
18                                                                  The SAS System                                   10:27 Wednesday, November 8, 2017


827        
828        
829        ods html close;
NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           1:26:33.49
      cpu time            1:00:53.35
      
