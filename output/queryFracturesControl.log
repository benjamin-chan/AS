1                                          The SAS System                11:48 Friday, June 22, 2018

NOTE: Copyright (c) 2016 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M5) 
      Licensed to UNIVERSITY OF ALABAMA AT BIRMINGHAM - SFA - T&R, Site 70086550.
NOTE: This session is executing on the X64_DS08R2  platform.



NOTE: Updated analytical products:
      
      SAS/STAT 14.3
      SAS/ETS 14.3
      SAS/IML 14.3
      SAS/QC 14.3

NOTE: Additional host information:

 X64_DS08R2 WIN 6.1.7601 Service Pack 1 Server

--- PEER News and Updates ---

: SECURITY REMINDER :
Please remember not to copy any data files that contain PHI (protected health identifiers) to any 
of the shared folders.

 


NOTE: SAS initialization used:
      real time           0.37 seconds
      cpu time            0.34 seconds
      
1          *  University of Alabama at Birmingham                               *
2          *  AS project                                            *
3          **********************************************************************;
4          options pagesize=74 linesize=150 pageno=1 missing=' ' date FORMCHAR="|----|+|---+=|-/\<>*";
5          * Programmer    : Benjamin Chan <chanb@ohsu.edu>
6          * Creation date :
7          * Modify date   :
8          ;
9          %let cmt=queryFracturesControl; * type the name of your program here (without the filename extension);
10         %let pgm=&cmt..sas;
11         %include "lib\libname.sas" ;
NOTE: Libref STDC5P was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: H:\studies\osteo\data\STD_files\5pct\
NOTE: Libref STD_SABR was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\data\std_SABER\
NOTE: Libref MPSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\mpcd\data\stddata\
NOTE: Libref UCBSTD was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\stddata\
NOTE: Libref UCB was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB\
NOTE: Libref UCB64 was successfully assigned as follows: 
      Engine:        SPDE 
      Physical Name: q:\studies\AS\data\UCB64\
NOTE: Libref DT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: V:\studies\AS\data
NOTE: Libref NDC was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: W:\onenote\references\drug ndcs\sas data
143        footnote "&pgm.";
144        * footnote2 "%sysfunc(datetime(),datetime14.)";
145        title1 '--- AS project ---';
146        **********************************************************************;
147        options macrogen mlogic mprint symbolgen;
148        options nomacrogen nomlogic nomprint nosymbolgen;
2                                                                   The SAS System                                         11:48 Friday, June 22, 2018

149        
150        
151        ods html
152          body = "output\&cmt..html"
153          style = Statistical;
NOTE: Writing HTML Body file: output\queryFracturesControl.html
154        
155        
156        /*
157        FRACTURES
158        
159        See "ALGORITHMS TO ENHANCE SPECIFICITY OF FRACTURE IDENTIFICATION_ 100316.docx"
160        
161        Adapted from Lang's code in "001_fx_data.sas"
162        
163        
164        From: Chen, Lang [mailto:langchen@uabmc.edu]
165        Sent: Monday, July 24, 2017 8:56 AM
166        To: Benjamin Chan <chanb@ohsu.edu>
167        Subject: RE: fracture identification algorithm
168        
169        Here it is.
170        For 001_fx_data, find all fx related claim and run the algorithm.
171        Please ignore any code after line 476
172        Modify code from line 1 -50
173        
174        For 002_fx_epi_data
175        Define fx episode.
176        
177        Final output data is fx_dgns_&firstyr._&lastyr._4. Please let me if you have any questions.
178         */
179        
180        
181        /*
182        START OF 001_fx_data.sas
183         */
184        
185        
186        /*Assign "Broad" fracture site (fx_site) for all ICD9 diagnoses, outputting separately, so some records are cloned, then combining into one
186      !  file */
187        /*No longer using matched trauma files here*/
188        
189        %macro comballfxdgns;
190            data fx_dgns;
191                set UCB64.tempFracDxAllControl (where = (diagCodeType = "Fracture code"));
192                    length fx_site $30 ;
193                    fx_site = '';
194                    if strip(DX) in: ('800' '801' '802' '803' '804') then           do; fx_site='(800-804) skull/face'; output; end;
195                    if strip(DX) in: ('805', '806') or strip(DX)='73313' then       do; fx_site='(805, 806, 73313) spine'; output; end;
196                    if strip(DX) in: ('807') then                                           do; fx_site='(807) rib/sternum/trachea'; output; end;
197                    if strip(DX) in: ('808') then                                           do; fx_site='(808) pelvis'; output; end;
198                    if strip(DX) in: ('809') then                                           do; fx_site='(809) trunk bones'; output; end;
199                    if strip(DX) in: ('810') then                                           do; fx_site='(810) clavicle'; output; end;
200                    if strip(DX) in: ('811') then                                           do; fx_site='(811) scapula'; output; end;
201                    if strip(DX) in: ('812') or strip(DX)='73311' then              do; fx_site='(812, 73311) humerus'; output; end;
202                    if strip(DX) in: ('813') or strip(DX)='73312' then              do; fx_site='(813, 73312) radius_ulna'; output; end;
203                    if strip(DX) in: ('814') then                                           do; fx_site='(814) carpal'; output; end;
204                    if strip(DX) in: ('815' '816' '817') then                           do; fx_site='(815-817) hand/fingers'; output; end;
205                    if strip(DX) in: ('818' '819') then                                     do; fx_site='(818-819) arms mult'; output; end;
206                    if strip(DX) in: ('820') or strip(DX) = '73314' then                do; fx_site='(820, 73314) hip'; output; end;
207                    if strip(DX) in: ('821') or strip(DX)='73315' then              do; fx_site='(821, 73315) femur'; output; end;
208                    if strip(DX) in: ('822') then                                           do; fx_site='(822) patella'; output; end;
209                    if strip(DX) in: ('823') or strip(DX)='73316' then              do; fx_site='(823, 73316) tib_fib'; output; end;
210                    if strip(DX) in: ('824') then                                           do; fx_site='(824) ankle'; output; end;
211                    if strip(DX) in: ('825') then                                           do; fx_site='(825) tarsal_metatarsal'; output; end;
212                    if strip(DX) in: ('826') then                                           do; fx_site='(826) foot_phalanges'; output; end;
213                    if strip(DX) in: ('827') then                                           do; fx_site='(827) lower_limb'; output; end;
214                    if strip(DX) in: ('828') then                                           do; fx_site='(828) legs+arm/rib'; output; end;
215                    if strip(DX) in: ('829') then                                           do; fx_site='(829) fx_nos'; output; end;
216                    if strip(DX) in ('73310' '73319' '7331') then                 do; fx_site='(7331) pathologic nos/nec'; output; end;
217            data fx_excare;
218                set UCB64.tempFracDxAllControl (where = (diagCodeType = "Extended care code"));
3                                                                   The SAS System                                         11:48 Friday, June 22, 2018

219                    length fx_site $30 ;
220                    fx_site = '';
221                    /*Expanded Diagnosis Codes - Fracture Aftercare Codes*/
222                    if strip(DX) in ('V5410' 'V5420') then                          do; fx_site='(812, 73311) humerus'; output;
223                                                                                                     fx_site='(813, 73312) radius_ulna'; output;
223      ! end;
224                    if strip(DX) in ('V5411' 'V5421') then                          do; fx_site='(812, 73311) humerus'; output; end;
225                    if strip(DX) in ('V5412' 'V5422') then                          do; fx_site='(813, 73312) radius_ulna'; output;
226                                                                                                     fx_site='(814) carpal'; output; end;
227                    if strip(DX) in ('V5413' 'V5423') then                          do; fx_site='(820, 73314) hip'; output; end;
228                    if strip(DX) in ('V5414' 'V5424') then                          do; fx_site='(820, 73314) hip'; output;
229                                                                                                     fx_site='(821, 73315) femur'; output;
230                                                                                                     fx_site='(822) patella'; output;
231                                                                                                     fx_site='(824) ankle'; output;
232                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
233                    if strip(DX) in ('V5415' 'V5425') then                          do; fx_site='(820, 73314) hip'; output;
234                                                                                                     fx_site='(821, 73315) femur'; output;
235                                                                                                     fx_site='(822) patella'; output; end;
236                    if strip(DX) in ('V5416' 'V5426') then                          do; fx_site='(824) ankle'; output;
237                                                                                                     fx_site='(822) patella'; output;
238                                                                                                     fx_site='(823, 73316) tib_fib'; output; end;
239                    if strip(DX) in ('V5417' 'V5427') then                          do; fx_site='(805, 806, 73313) spine'; output; end;
240                    if strip(DX) in: ('V542') then                                       do; fx_site='(7331) pathologic nos/nec'; output; end;
241                    if strip(DX) in: ('V541') then                                       do; fx_site='(829) fx_nos'; output; end;
242            run;
243        
244            /* proc sort data=fx_dgns; by patid BEGIN_DATE fx_site; run;
245            proc sort data=fx_excare; by patid BEGIN_DATE fx_site; run; */
246        %mend;
247        %comballfxdgns;

NOTE: There were 3691133 observations read from the data set UCB64.TEMPFRACDXALLCONTROL.
      WHERE diagCodeType='Fracture code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_DGNS has 3691133 observations and 22 variables.
NOTE: DATA statement used (Total process time):
      real time           5.77 seconds
      cpu time            8.11 seconds
      


NOTE: There were 278482 observations read from the data set UCB64.TEMPFRACDXALLCONTROL.
      WHERE diagCodeType='Extended care code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.FX_EXCARE has 638026 observations and 22 variables.
NOTE: DATA statement used (Total process time):
      real time           1.25 seconds
      cpu time            1.65 seconds
      

248        
249        /*Now, assign a more specific fracture site (e.g., closed, other) (site) that is used in the CQ algorithms*/
250        /*Since Expanded Diagnosis Codes (V Codes) apply to sub-categories of each broad fracture site, clone records for these so they appear in
250      ! both places*/
251        
252        data fx_dgns_2;
253            set fx_dgns;
254        
255            length site $30;
256        
257            site="";
258        
259            *Spine-closed and Spine-other;
260            if fx_site='(805, 806, 73313) spine' then
261                do;
262                    site = 'spine_cls'; /*Includes V Codes and 73313 here*/
263                    if substr(strip(DX),1,3) in ('805' '806') and substr(strip(DX),1,4) ^in ('8050', '8052', '8054', '8058') then
264                        site = 'spine_oth';
265                end;
266        
267            *Pelvis-closed and Pelvis-other... No V Codes;
268            if fx_site='(808) pelvis' then
4                                                                   The SAS System                                         11:48 Friday, June 22, 2018

269                do;
270                    site = 'pelvis_cls';
271                    if substr(strip(DX),1,3)='808' and substr(strip(DX),1,4) ^in ('8080', '8082', '8084', '8088') then
272                        site = 'pelvis_oth';
273                end;
274        
275            *Clavicle-closed and Clavicle-other.... No V Codes;
276            if fx_site='(810) clavicle' then
277                do;
278                    site = 'clv_cls';
279                    if substr(strip(DX),1,3) = '810' and substr(strip(DX),1,4) ^in ('8100') then
280                        site = 'clv_oth';
281                end;
282        
283            *Humerus-closed and Humerus-other;
284            if fx_site='(812, 73311) humerus' then
285                do;
286                    site = 'hmrs_cls'; /*Includes V Codes and 73311 here*/
287                    if substr(strip(DX),1,3)= '812' and substr(strip(DX),1,4) ^in ('8120', '8122', '8124') then
288                        site = 'hmrs_oth';
289                end;
290        
291            *Distal radius/ulna and Radius/ulna-other;
292            if fx_site='(813, 73312) radius_ulna' then
293                do;
294                 site = 'dist4arm'; /*Includes V Codes and 73312 here*/
295                    if substr(strip(DX),1,3) = '813' and substr(strip(DX),1,4) ^in ('8134', '8135') then
296                        site = 'rad_ul_oth';
297                end;
298        
299            *Carpal... V Codes present but only one category;
300            if fx_site='(814) carpal' then
301                do;
302                    site = 'carpal';
303                 end;
304        
305            *Hip-closed and Hip-other;
306            if fx_site='(820, 73314) hip' then
307                    do;
308                    site = 'hip_cls'; /*Includes V Codes and 73314 here*/
309                    if substr(strip(DX),1,3)='820' and substr(strip(DX),1,4) ^in ('8200', '8202', '8208') then
310                        site = 'hip_oth';
311                end;
312        
313            *Other femur-closed and Other femur-other;
314            if fx_site='(821, 73315) femur' then
315                do;
316                    site = 'oth_fem_cls'; /*Includes V Codes and 73315 here*/
317                    if substr(strip(DX),1,3)='821' and substr(strip(DX),1,4) ^in ('8210', '8212') then
318                        site = 'oth_fem_oth';
319                end;
320        
321            *Tib/fib-closed and Tib/fib-other;
322            if fx_site='(823, 73316) tib_fib' then
323                do;
324                    site = 'tib_fib_cls'; /*Includes V Codes and 73316 here*/
325                    if substr(strip(DX),1,3)='823' and substr(strip(DX),1,4) ^in ('8230', '8232', '8238') then
326                        site = 'tib_fib_oth';
327                end;
328        
329            *Ankle... V Codes present but only one category;
330            if fx_site='(824) ankle' then
331                do;
332                    site = 'ankle';
333                end;
334        
335            /*Assign site for other fx_sites that do not have CQ algorithm and thus no sub categories*/
336            if site = "" then do;
337                site = fx_site;
338            end;
339        
340            label site = 'CQ Algorithm Fracture Site (Specific)';
5                                                                   The SAS System                                         11:48 Friday, June 22, 2018

341        
342        run;

NOTE: Invalid third argument to function SUBSTR at line 271 column 48.
database=MPCD cohort=Non-AS PATID=102482316 indexDate=07/03/2007 age=75 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=01/31/2010 controlID=28427
ENCOUNTERID=10807028445 ENC_TYPE=ED ADMIT_DATE= BEGIN_DATE=07/04/2009 DISCHARGE_DATE= END_DATE=07/04/2009 DX_TYPE=09 DX=808 PDX=O codeType=ICD9-DX
code=808 diagCodeType=Fracture code fx_site=(808) pelvis site=pelvis_oth _ERROR_=1 _N_=19983
NOTE: Invalid third argument to function SUBSTR at line 271 column 48.
database=MPCD cohort=Non-AS PATID=102482316 indexDate=07/03/2007 age=75 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=01/31/2010 controlID=28427
ENCOUNTERID=10807028445 ENC_TYPE=ED ADMIT_DATE= BEGIN_DATE=07/04/2009 DISCHARGE_DATE= END_DATE=07/04/2009 DX_TYPE=09 DX=808 PDX=P codeType=ICD9-DX
code=808 diagCodeType=Fracture code fx_site=(808) pelvis site=pelvis_oth _ERROR_=1 _N_=19984
NOTE: Invalid third argument to function SUBSTR at line 271 column 48.
database=MPCD cohort=Non-AS PATID=102482316 indexDate=07/03/2007 age=75 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=01/31/2010 controlID=28427
ENCOUNTERID=10861064444 ENC_TYPE=ED ADMIT_DATE= BEGIN_DATE=07/04/2009 DISCHARGE_DATE= END_DATE=07/04/2009 DX_TYPE=09 DX=808 PDX=O codeType=ICD9-DX
code=808 diagCodeType=Fracture code fx_site=(808) pelvis site=pelvis_oth _ERROR_=1 _N_=19989
NOTE: Invalid third argument to function SUBSTR at line 271 column 48.
database=MPCD cohort=Non-AS PATID=102482316 indexDate=07/03/2007 age=75 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=01/31/2010 controlID=28427
ENCOUNTERID=10861064444 ENC_TYPE=ED ADMIT_DATE= BEGIN_DATE=07/04/2009 DISCHARGE_DATE= END_DATE=07/04/2009 DX_TYPE=09 DX=808 PDX=P codeType=ICD9-DX
code=808 diagCodeType=Fracture code fx_site=(808) pelvis site=pelvis_oth _ERROR_=1 _N_=19990
NOTE: Invalid third argument to function SUBSTR at line 287 column 49.
database=MPCD cohort=Non-AS PATID=102501970 indexDate=07/03/2007 age=70 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2010 controlID=40946
ENCOUNTERID=10886102012 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=05/20/2010 DISCHARGE_DATE= END_DATE=05/20/2010 DX_TYPE=09 DX=812 PDX=P codeType=ICD9-DX
code=812 diagCodeType=Fracture code fx_site=(812, 73311) humerus site=hmrs_oth _ERROR_=1 _N_=29606
NOTE: Invalid third argument to function SUBSTR at line 271 column 48.
database=MPCD cohort=Non-AS PATID=103648636 indexDate=07/03/2007 age=80 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2010 controlID=70462
ENCOUNTERID=10892850787 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=04/28/2009 DISCHARGE_DATE= END_DATE=04/28/2009 DX_TYPE=09 DX=808 PDX=O codeType=ICD9-DX
code=808 diagCodeType=Fracture code fx_site=(808) pelvis site=pelvis_oth _ERROR_=1 _N_=54175
NOTE: Invalid third argument to function SUBSTR at line 271 column 48.
database=MPCD cohort=Non-AS PATID=103648636 indexDate=07/03/2007 age=80 SEX=F ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2010 controlID=70462
ENCOUNTERID=10892850787 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=04/28/2009 DISCHARGE_DATE= END_DATE=04/28/2009 DX_TYPE=09 DX=808 PDX=P codeType=ICD9-DX
code=808 diagCodeType=Fracture code fx_site=(808) pelvis site=pelvis_oth _ERROR_=1 _N_=54176
NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=10857526106 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=09/09/2009 DISCHARGE_DATE= END_DATE=09/09/2009 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61267
NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=10857526106 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/09/2009 DISCHARGE_DATE= END_DATE=09/09/2009 DX_TYPE=09 DX=810 PDX=O codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61268
NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=10857526106 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/09/2009 DISCHARGE_DATE= END_DATE=09/09/2009 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61269
NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=10883038575 ENC_TYPE=AV ADMIT_DATE= BEGIN_DATE=09/10/2009 DISCHARGE_DATE= END_DATE=09/10/2009 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61271
NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=10883038575 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/10/2009 DISCHARGE_DATE= END_DATE=09/10/2009 DX_TYPE=09 DX=810 PDX=O codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61272
NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=10883038575 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/10/2009 DISCHARGE_DATE= END_DATE=09/10/2009 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61273
NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=11023119948 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/04/2009 DISCHARGE_DATE= END_DATE=09/04/2009 DX_TYPE=09 DX=810 PDX=O codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61276
NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=11023119948 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/04/2009 DISCHARGE_DATE= END_DATE=09/04/2009 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61277
NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=11032331831 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/08/2009 DISCHARGE_DATE= END_DATE=09/08/2009 DX_TYPE=09 DX=810 PDX=O codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61279
NOTE: Invalid third argument to function SUBSTR at line 279 column 50.
database=MPCD cohort=Non-AS PATID=103662395 indexDate=10/01/2009 age=65 SEX=M ENR_START_DATE=04/01/2009 ENR_END_DATE=12/31/2010 controlID=79181
ENCOUNTERID=11032331831 ENC_TYPE=NH ADMIT_DATE= BEGIN_DATE=09/08/2009 DISCHARGE_DATE= END_DATE=09/08/2009 DX_TYPE=09 DX=810 PDX=P codeType=ICD9-DX
code=810 diagCodeType=Fracture code fx_site=(810) clavicle site=clv_oth _ERROR_=1 _N_=61280
NOTE: Invalid third argument to function SUBSTR at line 287 column 49.
6                                                                   The SAS System                                         11:48 Friday, June 22, 2018

database=MPCD cohort=Non-AS PATID=103685585 indexDate=07/03/2007 age=30 SEX=M ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2008 controlID=93869
ENCOUNTERID=10853030298 ENC_TYPE=IP ADMIT_DATE=09/06/2008 BEGIN_DATE=09/06/2008 DISCHARGE_DATE= END_DATE= DX_TYPE=09 DX=812 PDX=O codeType=ICD9-DX
code=812 diagCodeType=Fracture code fx_site=(812, 73311) humerus site=hmrs_oth _ERROR_=1 _N_=73472
NOTE: Invalid third argument to function SUBSTR at line 287 column 49.
database=MPCD cohort=Non-AS PATID=103685585 indexDate=07/03/2007 age=30 SEX=M ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2008 controlID=93869
ENCOUNTERID=10888473073 ENC_TYPE=IP ADMIT_DATE=11/02/2008 BEGIN_DATE=11/02/2008 DISCHARGE_DATE= END_DATE= DX_TYPE=09 DX=812 PDX=O codeType=ICD9-DX
code=812 diagCodeType=Fracture code fx_site=(812, 73311) humerus site=hmrs_oth _ERROR_=1 _N_=73473
NOTE: Invalid third argument to function SUBSTR at line 287 column 49.
WARNING: Limit set by ERRORS= option reached.  Further errors of this type will not be printed.
database=MPCD cohort=Non-AS PATID=103685585 indexDate=07/03/2007 age=30 SEX=M ENR_START_DATE=01/01/2007 ENR_END_DATE=12/31/2008 controlID=93869
ENCOUNTERID=10904456369 ENC_TYPE=IP ADMIT_DATE=08/20/2008 BEGIN_DATE=08/20/2008 DISCHARGE_DATE=08/20/2008 END_DATE=08/20/2008 DX_TYPE=09 DX=812 PDX=O
codeType=ICD9-DX code=812 diagCodeType=Fracture code fx_site=(812, 73311) humerus site=hmrs_oth _ERROR_=1 _N_=73474
NOTE: There were 3691133 observations read from the data set WORK.FX_DGNS.
NOTE: The data set WORK.FX_DGNS_2 has 3691133 observations and 23 variables.
NOTE: DATA statement used (Total process time):
      real time           3.35 seconds
      cpu time            3.30 seconds
      

343        
344        /*###########################################################################################################*/
345        /***************************************************Intermediate Fracture Diagnosis File**********************/
346        /*Combine CQ diagnosis files*******************************************************/
347        data fx_dgns_3;
348            set fx_dgns_2
349        /*    fx_excare_*/
350                ;
351        run;

NOTE: There were 3691133 observations read from the data set WORK.FX_DGNS_2.
NOTE: The data set WORK.FX_DGNS_3 has 3691133 observations and 23 variables.
NOTE: DATA statement used (Total process time):
      real time           2.84 seconds
      cpu time            2.08 seconds
      

352        
353        proc freq data=fx_dgns_3;
354            tables fx_site site;
355        run;

                                                                  --- AS project ---                                   11:48 Friday, June 22, 2018   1

                                                                  The FREQ Procedure

                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec       27815        0.75         27815         0.75  
                                    (800-804) skull/face           107165        2.90        134980         3.66  
                                    (805, 806, 73313) spine        566649       15.35        701629        19.01  
                                    (807) rib/sternum/trachea      205313        5.56        906942        24.57  
                                    (808) pelvis                   179129        4.85       1086071        29.42  
                                    (809) trunk bones                2057        0.06       1088128        29.48  
                                    (810) clavicle                  55725        1.51       1143853        30.99  
                                    (811) scapula                   13314        0.36       1157167        31.35  
                                    (812, 73311) humerus           346489        9.39       1503656        40.74  
                                    (813, 73312) radius_ulna       377669       10.23       1881325        50.97  
                                    (814) carpal                    66727        1.81       1948052        52.78  
                                    (815-817) hand/fingers         149166        4.04       2097218        56.82  
                                    (818-819) arms mult              5665        0.15       2102883        56.97  
                                    (820, 73314) hip               705177       19.10       2808060        76.08  
                                    (821, 73315) femur             141127        3.82       2949187        79.90  
                                    (822) patella                   52681        1.43       3001868        81.33  
                                    (823, 73316) tib_fib           135046        3.66       3136914        84.99  
                                    (824) ankle                    234648        6.36       3371562        91.34  
                                    (825) tarsal_metatarsal        200611        5.43       3572173        96.78  
                                    (826) foot_phalanges            84435        2.29       3656608        99.06  
                                    (827) lower_limb                 3900        0.11       3660508        99.17  
                                    (828) legs+arm/rib               1347        0.04       3661855        99.21  
                                    (829) fx_nos                    29278        0.79       3691133       100.00  


                                                        CQ Algorithm Fracture Site (Specific)
 
                                                                                          Cumulative    Cumulative
                                    site                         Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec       27815        0.75         27815         0.75  
                                    (800-804) skull/face           107165        2.90        134980         3.66  
                                    (807) rib/sternum/trachea      205313        5.56        340293         9.22  
                                    (809) trunk bones                2057        0.06        342350         9.27  
                                    (811) scapula                   13314        0.36        355664         9.64  
                                    (815-817) hand/fingers         149166        4.04        504830        13.68  
                                    (818-819) arms mult              5665        0.15        510495        13.83  
                                    (822) patella                   52681        1.43        563176        15.26  
                                    (825) tarsal_metatarsal        200611        5.43        763787        20.69  
                                    (826) foot_phalanges            84435        2.29        848222        22.98  
                                    (827) lower_limb                 3900        0.11        852122        23.09  
                                    (828) legs+arm/rib               1347        0.04        853469        23.12  
                                    (829) fx_nos                    29278        0.79        882747        23.92  
                                    ankle                          234648        6.36       1117395        30.27  
                                    carpal                          66727        1.81       1184122        32.08  
                                    clv_cls                         55376        1.50       1239498        33.58  
                                    clv_oth                           349        0.01       1239847        33.59  
                                    dist4arm                       276446        7.49       1516293        41.08  
                                    hip_cls                        686923       18.61       2203216        59.69  
                                    hip_oth                         18254        0.49       2221470        60.18  
                                    hmrs_cls                       341693        9.26       2563163        69.44  
                                    hmrs_oth                         4796        0.13       2567959        69.57  
                                    oth_fem_cls                    136426        3.70       2704385        73.27  
                                    oth_fem_oth                      4701        0.13       2709086        73.39  
                                    pelvis_cls                     176961        4.79       2886047        78.19  
                                    pelvis_oth                       2168        0.06       2888215        78.25  
                                    rad_ul_oth                     101223        2.74       2989438        80.99  
                                    spine_cls                      521439       14.13       3510877        95.12  
                                    spine_oth                       45210        1.22       3556087        96.34  
                                    tib_fib_cls                    130133        3.53       3686220        99.87  
                                    tib_fib_oth                      4913        0.13       3691133       100.00  
 
 
 
 
 
                                                              queryFracturesControl.sas
NOTE: There were 3691133 observations read from the data set WORK.FX_DGNS_3.
NOTE: The PROCEDURE FREQ printed page 1.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           1.30 seconds
      cpu time            1.24 seconds
      

356        
357        proc sort data=fx_dgns_3;
358            by patid ENCOUNTERID fx_site site;
359        run;

NOTE: There were 3691133 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_3 has 3691133 observations and 23 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           4.29 seconds
      cpu time            7.22 seconds
      

360        
361        
362        /*###########################################################################################################*/
363        /*************************************************************************************************************/
364        /*Look for repair procedures and assign treatment site*******************/
365        /*This code has been updated to include hip/femur replacement with matching diagnosis code, also looked in claim strip(DX) not just primary
365      !  strip(DX)
366        /*Not accepting contiguous sites until later*/
367        /*Excluding procedures from DME files*/
368        /*******************************Select All Spine Imaging Codes from STD Procedure Files for CQ=4/5 algorithms*/
369        
370        %macro fx_prcd;
7                                                                   The SAS System                                         11:48 Friday, June 22, 2018

371            data fx_prcd spine_xray;
372                set UCB64.tempFracPxAllControl;
373        
374                    length tx_site $30;
375                    length HLAT $1;
376        
377                    if strip(px) in ('21300' '21310' '21315' '21320' '21325' '21330' '21335' '21336' '21337' '21338' '21339' '21340' '21343'
377      ! '21344' '21345' '21346' '21347' '21348'
378                                         '21355' '21356' '21360' '21365' '21366' '21385' '21386' '21387' '21390' '21395' '21400' '21401' '21406'
378      ! '21407' '21408' '21421' '21422' '21423'
379                                         '21431' '21432' '21433' '21435' '21436' '21440' '21445' '21450' '21451' '21452' '21453' '21454' '21461'
379      ! '21462' '21465' '21470'
380                                         '62000' '62005' '62010')  and lengthn(strip(px)) = 5 then do;
381                        tx_site='(800-804) skull/face'; output fx_prcd; end;
382        
383                    if strip(px) in ('22305' '22310' '22315' '22318' '22319' '22325' '22326' '22327' '22328' '22520' '22521' '22522' '22523'
383      ! '22524' '22525' '76012' '76013'
384                                         'S2360' 'S2361' 'S2362' 'S2363' '72291' '72292')  and lengthn(strip(px)) = 5 then do;
385                        tx_site = '(805, 806, 73313) spine'; output fx_prcd; end;
386        
387                    if  strip(px) in ('21493' '21494' '21495' '21800' '21805' '21810' '21820' '21825' ) then do;
388                        tx_site='(807) rib/sternum/trachea'; output fx_prcd; end;
389        
390                    if strip(px) in ('27193' '27194' '27215' '27216' '27217' '27218' '27220' '27222' '27226' '27227' '27228')  and
390      ! lengthn(strip(px)) = 5 then do;
391                        tx_site = '(808) pelvis'; output fx_prcd; end;
392        
393                    if strip(px) in ('23500' '23505' '23515')  and lengthn(strip(px)) = 5 then do;
394                        tx_site = '(810) clavicle'; output fx_prcd; end;
395        
396                    if strip(px) in ('23570' '23575' '23585') then do;
397                        tx_site= '(811) scapula'; output fx_prcd; end;
398        
399                    if strip(px) in ('23600' '23605' '23615' '23616' '23620' '23625' '23630' '23665' '24500' '24505' '24515' '24516' '24530'
399      ! '24535' '24538' '24545' '24546' '24560'
400                                 '24565' '24566' '24575' '24576' '24577' '24579' '24582')  and lengthn(strip(px)) = 5 then do;
401                        tx_site = '(812, 73311) humerus'; output fx_prcd; end;
402        
403                    if strip(px) in ('25600' '25605' '25606' '25607' '25608' '25609' '25620' '25650' '25651' '25652')  and lengthn(strip(px)) = 5
403      ! then do;
404                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
405        
406                    if strip(px) in ('24650' '24655' '24665' '24666' '24670' '24675' '24685' '25500' '25505' '25515' '25520' '25525' '25526'
406      ! '25530' '25535' '25545' '25560' '25565'
407                                 '25574' '25575')  and lengthn(strip(px)) = 5 then do;
408                        tx_site = '(813, 73312) radius_ulna'; output fx_prcd; end; /*Procedure codes are the same for both categories*/
409        
410                    if strip(px) in ('25622' '25624' '25628' '25630' '25635' '25645' '25680' '25685')  and lengthn(strip(px)) = 5 then do;
411                        tx_site = '(814) carpal'; output fx_prcd; end;
412        
413                    if strip(px) in ('26600' '26605' '26607' '26608' '26615' '26645' '26650' '26665' '26720' '26725' '26727' '26735' '26740'
413      ! '26742' '26746' '26750' '26755' '26756' '26765' )
414                               and lengthn(strip(px)) = 5 then do;
415                        tx_site='(815-817) hand/fingers'; output fx_prcd; end;
416        
417                    if '27230' <= strip(px) <= '27248' and lengthn(strip(px)) = 5 then do;
418                        tx_site = '(820, 73314) hip'; output fx_prcd; end;
419        
420                    if '27500' <= strip(px) <= '27514'  and lengthn(strip(px)) = 5 then do;
421                        tx_site = '(821, 73315) femur'; output fx_prcd; end;
422        
423                    if strip(px) in ('27520' '27524')  and lengthn(strip(px)) = 5 then do;
424                        tx_site = '(822) patella'; output fx_prcd; end;
425        
426                    if ('27530' <= strip(px) <= '27536' or '27750' <= strip(px) <= '27759' or '27780' <= strip(px) <= '27784' or '27824' <=
426      ! strip(px) <= '27828') and lengthn(strip(px)) = 5  then do;
427                        tx_site = '(823, 73316) tib_fib'; output fx_prcd; end;
428        
429                    if strip(px) in ('27760' '27762' '27766' '27786' '27788' '27792' '27808' '27810' '27814' '27816' '27818' '27822' '27823'
429      ! '28430' '28435' '28436' '28445')  and lengthn(strip(px)) = 5 then do;
430                        tx_site = '(824) ankle'; output fx_prcd; end;
431        
8                                                                   The SAS System                                         11:48 Friday, June 22, 2018

432                    if strip(px) in ('28320' '28322' '28400' '28405' '28406' '28415' '28420' ) and lengthn(strip(px)) = 5 then do;
433                        tx_site='(825) tarsal_metatarsal'; output fx_prcd; end;
434        
435                 /********************************Hip/Femur Additions - must be matched with DGNS to be included*/
436                 /*Hip replacement codes*/
437                    /*Hip*/
438                    if strip(px) in ('27130' '27125') and lengthn(strip(px)) = 5  then do;
439                        HLAT='1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
440        
441                    /*Codes below are the only ICD9 Procedure Codes that we are using for "repair"*/
442                    if strip(px) in ('8151' '8152') and lengthn(strip(px)) = 4 then do;
443                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
444        
445                    /*Femur repair codes, assigned to both Hip and Femur treatment sites... CHECK - MAYBE WE NEED TO DO THIS THE OTHER WAY AS
445      ! WELL*/
446                    /*Hip*/
447                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
448                        HLAT = '1'; tx_site = '(820, 73314) hip'; output fx_prcd; end;
449        
450                    /*Femur*/
451                    if strip(px) in ('7855' '7905' '7915' '7925' '7935' '7965') and lengthn(strip(px)) = 4 then do;
452                        HLAT = '1'; tx_site = '(821, 73315) femur'; output fx_prcd; end;
453                     /*spine image*/
454                        if '72010' <= strip(px) <= '72159' or '72240' <= strip(px) <= '72285' or strip(px) = '72295' then do;   /*Spine Imaging
454      ! Codes*/
455                        tx_site='(805, 806, 73313) spine';
456                        output spine_xray; end;
457        
458            run;
459        
460            data fx_prcd;
461                set fx_prcd;
462                /*To add laterality info*/
463        /*        array hcpcs{*} hcpcs_1st_mdfr_cd hcpcs_2nd_mdfr_cd hcpcs_3rd_mdfr_cd hcpcs_4th_mdfr_cd ; */
464                if HLAT='1' then do;
465                    repair_right='0'; repair_left='0';
466                end;
467        /*        if HLAT='1' then */
468        /*            do i=1 to dim(hcpcs);*/
469        /*                if hcpcs{i} = 'RT' then repair_right='1';*/
470        /*                else if hcpcs{i} = 'LT' then repair_left='1';*/
471        /*            end;*/
472            run;
473            proc sort data=fx_prcd nodupkey; by patid ENCOUNTERID px_date tx_site; run;
474        
475            data spine_xray;
476                set spine_xray;
477                keep patid px_date tx_site  ENCOUNTERID begin_date;
478            run;
479            proc sort data=spine_xray nodupkey; by patid px_date; run;
480        %mend;
481        %fx_prcd;

NOTE: There were 885852125 observations read from the data set UCB64.TEMPFRACPXALLCONTROL.
NOTE: The data set WORK.FX_PRCD has 709067 observations and 21 variables.
NOTE: The data set WORK.SPINE_XRAY has 4491016 observations and 21 variables.
NOTE: DATA statement used (Total process time):
      real time           23:17.65
      cpu time            23:17.34
      


NOTE: There were 709067 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK.FX_PRCD has 709067 observations and 23 variables.
NOTE: DATA statement used (Total process time):
      real time           0.59 seconds
      cpu time            0.54 seconds
      


NOTE: There were 709067 observations read from the data set WORK.FX_PRCD.
NOTE: 50407 observations with duplicate key values were deleted.
9                                                                   The SAS System                                         11:48 Friday, June 22, 2018

NOTE: The data set WORK.FX_PRCD has 658660 observations and 23 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.97 seconds
      cpu time            1.45 seconds
      


NOTE: There were 4491016 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.SPINE_XRAY has 4491016 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           2.17 seconds
      cpu time            1.90 seconds
      


NOTE: There were 4491016 observations read from the data set WORK.SPINE_XRAY.
NOTE: 1718366 observations with duplicate key values were deleted.
NOTE: The data set WORK.SPINE_XRAY has 2772650 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           1.67 seconds
      cpu time            4.55 seconds
      

482        
483        
484        
485        data trauma (rename=(begin_date=trauma_dt));
486                set UCB64.tempFracDxAllControl (where = (diagCodeType = "Trauma code"));
487        run;

NOTE: There were 451534 observations read from the data set UCB64.TEMPFRACDXALLCONTROL.
      WHERE diagCodeType='Trauma code';
NOTE: Parallel WHERE evaluation suppressed due to sort order on table.
NOTE: The data set WORK.TRAUMA has 451534 observations and 21 variables.
NOTE: DATA statement used (Total process time):
      real time           1.33 seconds
      cpu time            1.52 seconds
      

488        proc sort data= trauma(keep=patid trauma_dt) nodupkey; by patid trauma_dt;run;

NOTE: There were 451534 observations read from the data set WORK.TRAUMA.
NOTE: 80485 observations with duplicate key values were deleted.
NOTE: The data set WORK.TRAUMA has 371049 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.39 seconds
      cpu time            0.62 seconds
      

489        
490        
491        /*subset the spine xray procedure claim for patients with fx diagnosis code only*/
492        /*so SAS will not run out of memory*/
493        data fx_spine_xray(keep=patid tx_site px_date ENCOUNTERID begin_date);
494        if _n_=1 then do;
495          declare hash hid(dataset:"fx_dgns_3(where=(fx_site='(805, 806, 73313) spine')))", multidata:"N", hashexp:20);
496          rc=hid.defineKey("patid");
497          rc=hid.defineDone();
498        end;
499        set spine_xray;
500        rc=hid.find();
501        if rc=0;
502        run;

NOTE: There were 566649 observations read from the data set WORK.FX_DGNS_3.
      WHERE fx_site='(805, 806, 73313) spine';
NOTE: There were 2772650 observations read from the data set WORK.SPINE_XRAY.
NOTE: The data set WORK.FX_SPINE_XRAY has 501413 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           2.79 seconds
      cpu time            2.74 seconds
      
10                                                                  The SAS System                                         11:48 Friday, June 22, 2018


503        /*subset the Trauma code for patients with fx diagnosis code only*/
504        /*so SAS will not run out of memory*/
505        data fx_trauma(drop=rc);
506        if _n_=1 then do;
507          declare hash hid(dataset:"fx_dgns_3", multidata:"N", hashexp:20);
508          rc=hid.defineKey("patid");
509          rc=hid.defineDone();
510        end;
511        set trauma;
512        rc=hid.find();
513        if rc=0;
514        run;

NOTE: There were 3691133 observations read from the data set WORK.FX_DGNS_3.
NOTE: There were 371049 observations read from the data set WORK.TRAUMA.
NOTE: The data set WORK.FX_TRAUMA has 188030 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           1.68 seconds
      cpu time            1.65 seconds
      

515        /************************************Link Fracture Claims (ICD9 Diagnosis) with Repair Claims (CPT/HCPCS, some ICD9 procedure
515      ! code)***************/
516        
517        data fx_dgns_4(drop=rc: px_date tx_site xray_date trauma_dt);
518        if _n_=1 then do;
519          declare hash hid(dataset:"fx_prcd", multidata:"N", hashexp:20);
520          rc=hid.defineKey("patid", "px_date", "tx_site");
521        /*  rc=hid.defineData("px_date", "tx_site");*/
522          rc=hid.defineDone();
523          declare hash hxray(dataset:"fx_spine_xray(rename=px_date=xray_date)", multidata:"Y", hashexp:20);
524          rc=hxray.defineKey("patid", "tx_site");
525          rc=hxray.defineData("xray_date");
526          rc=hxray.defineDone();
527          declare hash htrauma(dataset:"fx_trauma", multidata:"Y", hashexp:20);
528          rc=htrauma.defineKey("patid");
529          rc=htrauma.defineData("trauma_dt");
530          rc=htrauma.defineDone();
531        end;
532        if 0 then set fx_prcd(keep=patid px_date tx_site)
533                      fx_spine_xray(keep=patid px_date tx_site rename=px_date=xray_date)
534                      fx_trauma;
535        set fx_dgns_3;
536        length cq $4 spine_image trauma_date 4 trauma $1;
537        format spine_image trauma_date mmddyy10.;
538        cq="0000";
539        rc=hid.find(key:patid, key:begin_date,key:fx_site);
540        if rc^=0 then do;
541            px_date=.;
542            tx_site=" ";
543        end;
544        if enc_type="IP" then do;
545        /*CQ = 1 Inpatient claim with primary diagnosis code */
546            if pdx="P" then substr(cq,1,1)="1";
547        /*CQ = 2 Inpatient claim with secondary diagnosis code*/
548            else substr(cq,2,1)="2";
549        end; else do;
550        /*CQ = 3 outpatient diagnosis code AND carrier line with repair/replace HCPCS*/
551            if rc=0 then substr(cq,3,1)="3";
552            rc1=hxray.find(key:patid, key:fx_site);
553            do while (rc1 = 0);
554                if begin_date-10 <=xray_date<= begin_date then do;
555                    if enc_type in ("AV" "IF" "NH" "HH" "ER" "ED") then do;
556        /*CQ = 4 outpatient [Physician E&M codes] diagnosis code with spine image/x-ray within 10 day early*/
557                        substr(cq,4,1)="4";
558                        spine_image=min(spine_image,xray_date);
559                    end;
560                end;
561                rc1=hxray.find_next(key:patid, key:fx_site);
562            end;
563        end;
11                                                                  The SAS System                                         11:48 Friday, June 22, 2018

564        /*is there trauma dx within 14 days*/
565        rc2=htrauma.find(key:patid);
566        do while (rc2 = 0) ;
567            if 0<=abs(trauma_dt-begin_date)<=14 then do;
568                    trauma="1";
569                    trauma_date=min(trauma_date,trauma_dt);
570           end ;
571           rc2=htrauma.find_next(key:patid) ;
572        end;
573        
574        run;

NOTE: There were 658660 observations read from the data set WORK.FX_PRCD.
NOTE: There were 501413 observations read from the data set WORK.FX_SPINE_XRAY.
NOTE: There were 188030 observations read from the data set WORK.FX_TRAUMA.
NOTE: There were 3691133 observations read from the data set WORK.FX_DGNS_3.
NOTE: The data set WORK.FX_DGNS_4 has 3691133 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           5.96 seconds
      cpu time            5.89 seconds
      

575        proc freq data=fx_dgns_4; tables enc_type*cq fx_site*cq trauma/missing;run;

                                                                  --- AS project ---                                   11:48 Friday, June 22, 2018   2

                                                                  The FREQ Procedure

                                                               Table of ENC_TYPE by cq

                                       ENC_TYPE(Encounter Type)     cq

                                       Frequency|
                                       Percent  |
                                       Row Pct  |
                                       Col Pct  |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       AV       |1482290 | 144401 | 142063 |   4743 |      0 |      0 |1773497
                                                |  40.16 |   3.91 |   3.85 |   0.13 |   0.00 |   0.00 |  48.05
                                                |  83.58 |   8.14 |   8.01 |   0.27 |   0.00 |   0.00 |
                                                |  54.73 |  56.76 |  47.29 |  69.71 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       ED       | 601816 |  84456 | 154286 |   1922 |      0 |      0 | 842480
                                                |  16.30 |   2.29 |   4.18 |   0.05 |   0.00 |   0.00 |  22.82
                                                |  71.43 |  10.02 |  18.31 |   0.23 |   0.00 |   0.00 |
                                                |  22.22 |  33.20 |  51.36 |  28.25 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       HH       |  53295 |   3820 |    279 |     19 |      0 |      0 |  57413
                                                |   1.44 |   0.10 |   0.01 |   0.00 |   0.00 |   0.00 |   1.56
                                                |  92.83 |   6.65 |   0.49 |   0.03 |   0.00 |   0.00 |
                                                |   1.97 |   1.50 |   0.09 |   0.28 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       IP       |      0 |      0 |      0 |      0 | 251600 | 169562 | 421162
                                                |   0.00 |   0.00 |   0.00 |   0.00 |   6.82 |   4.59 |  11.41
                                                |   0.00 |   0.00 |   0.00 |   0.00 |  59.74 |  40.26 |
                                                |   0.00 |   0.00 |   0.00 |   0.00 | 100.00 | 100.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       NH       | 570929 |  21735 |   3797 |    120 |      0 |      0 | 596581
                                                |  15.47 |   0.59 |   0.10 |   0.00 |   0.00 |   0.00 |  16.16
                                                |  95.70 |   3.64 |   0.64 |   0.02 |   0.00 |   0.00 |
                                                |  21.08 |   8.54 |   1.26 |   1.76 |   0.00 |   0.00 |
                                       ---------+--------+--------+--------+--------+--------+--------+
                                       Total     2708330   254412   300425     6804   251600   169562  3691133
                                                   73.37     6.89     8.14     0.18     6.82     4.59   100.00


 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
                                                                  --- AS project ---                                   11:48 Friday, June 22, 2018   3

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (7331) pathologi |  24581 |      0 |      0 |      0 |   2434 |    800 |  27815
                                   c nos/nec        |   0.67 |   0.00 |   0.00 |   0.00 |   0.07 |   0.02 |   0.75
                                                    |  88.37 |   0.00 |   0.00 |   0.00 |   8.75 |   2.88 |
                                                    |   0.91 |   0.00 |   0.00 |   0.00 |   0.97 |   0.47 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (800-804) skull/ |  84409 |      0 |   8065 |      0 |  10647 |   4044 | 107165
                                   face             |   2.29 |   0.00 |   0.22 |   0.00 |   0.29 |   0.11 |   2.90
                                                    |  78.77 |   0.00 |   7.53 |   0.00 |   9.94 |   3.77 |
                                                    |   3.12 |   0.00 |   2.68 |   0.00 |   4.23 |   2.38 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (805, 806, 73313 | 221274 | 254412 |   1101 |   6804 |  54468 |  28590 | 566649
                                   ) spine          |   5.99 |   6.89 |   0.03 |   0.18 |   1.48 |   0.77 |  15.35
                                                    |  39.05 |  44.90 |   0.19 |   1.20 |   9.61 |   5.05 |
                                                    |   8.17 | 100.00 |   0.37 | 100.00 |  21.65 |  16.86 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (807) rib/sternu | 160035 |      0 |  21218 |      0 |  17895 |   6165 | 205313
                                   m/trachea        |   4.34 |   0.00 |   0.57 |   0.00 |   0.48 |   0.17 |   5.56
                                                    |  77.95 |   0.00 |  10.33 |   0.00 |   8.72 |   3.00 |
                                                    |   5.91 |   0.00 |   7.06 |   0.00 |   7.11 |   3.64 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (808) pelvis     | 141725 |      0 |   6315 |      0 |  19219 |  11870 | 179129
                                                    |   3.84 |   0.00 |   0.17 |   0.00 |   0.52 |   0.32 |   4.85
                                                    |  79.12 |   0.00 |   3.53 |   0.00 |  10.73 |   6.63 |
                                                    |   5.23 |   0.00 |   2.10 |   0.00 |   7.64 |   7.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (809) trunk bone |   1939 |      0 |      0 |      0 |    110 |      8 |   2057
                                   s                |   0.05 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.06
                                                    |  94.26 |   0.00 |   0.00 |   0.00 |   5.35 |   0.39 |
                                                    |   0.07 |   0.00 |   0.00 |   0.00 |   0.04 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (810) clavicle   |  45465 |      0 |   7152 |      0 |   2534 |    574 |  55725
                                                    |   1.23 |   0.00 |   0.19 |   0.00 |   0.07 |   0.02 |   1.51
                                                    |  81.59 |   0.00 |  12.83 |   0.00 |   4.55 |   1.03 |
                                                    |   1.68 |   0.00 |   2.38 |   0.00 |   1.01 |   0.34 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (811) scapula    |  11130 |      0 |    956 |      0 |    994 |    234 |  13314
                                                    |   0.30 |   0.00 |   0.03 |   0.00 |   0.03 |   0.01 |   0.36
                                                    |  83.60 |   0.00 |   7.18 |   0.00 |   7.47 |   1.76 |
                                                    |   0.41 |   0.00 |   0.32 |   0.00 |   0.40 |   0.14 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total             2708330   254412   300425     6804   251600   169562  3691133
                                                       73.37     6.89     8.14     0.18     6.82     4.59   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
                                                                  --- AS project ---                                   11:48 Friday, June 22, 2018   4

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (812, 73311) hum | 288279 |      0 |  30249 |      0 |  16876 |  11085 | 346489
                                   erus             |   7.81 |   0.00 |   0.82 |   0.00 |   0.46 |   0.30 |   9.39
                                                    |  83.20 |   0.00 |   8.73 |   0.00 |   4.87 |   3.20 |
                                                    |  10.64 |   0.00 |  10.07 |   0.00 |   6.71 |   6.54 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (813, 73312) rad | 278188 |      0 |  82921 |      0 |  11147 |   5413 | 377669
                                   ius_ulna         |   7.54 |   0.00 |   2.25 |   0.00 |   0.30 |   0.15 |  10.23
                                                    |  73.66 |   0.00 |  21.96 |   0.00 |   2.95 |   1.43 |
                                                    |  10.27 |   0.00 |  27.60 |   0.00 |   4.43 |   3.19 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (814) carpal     |  63219 |      0 |   2388 |      0 |   1010 |    110 |  66727
                                                    |   1.71 |   0.00 |   0.06 |   0.00 |   0.03 |   0.00 |   1.81
                                                    |  94.74 |   0.00 |   3.58 |   0.00 |   1.51 |   0.16 |
                                                    |   2.33 |   0.00 |   0.79 |   0.00 |   0.40 |   0.06 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (815-817) hand/f | 114631 |      0 |  31729 |      0 |   2434 |    372 | 149166
                                   ingers           |   3.11 |   0.00 |   0.86 |   0.00 |   0.07 |   0.01 |   4.04
                                                    |  76.85 |   0.00 |  21.27 |   0.00 |   1.63 |   0.25 |
                                                    |   4.23 |   0.00 |  10.56 |   0.00 |   0.97 |   0.22 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (818-819) arms m |   5551 |      0 |      0 |      0 |    105 |      9 |   5665
                                   ult              |   0.15 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.15
                                                    |  97.99 |   0.00 |   0.00 |   0.00 |   1.85 |   0.16 |
                                                    |   0.20 |   0.00 |   0.00 |   0.00 |   0.04 |   0.01 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (820, 73314) hip | 488704 |      0 |  60297 |      0 |  79318 |  76858 | 705177
                                                    |  13.24 |   0.00 |   1.63 |   0.00 |   2.15 |   2.08 |  19.10
                                                    |  69.30 |   0.00 |   8.55 |   0.00 |  11.25 |  10.90 |
                                                    |  18.04 |   0.00 |  20.07 |   0.00 |  31.53 |  45.33 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (821, 73315) fem | 116901 |      0 |   5776 |      0 |  10323 |   8127 | 141127
                                   ur               |   3.17 |   0.00 |   0.16 |   0.00 |   0.28 |   0.22 |   3.82
                                                    |  82.83 |   0.00 |   4.09 |   0.00 |   7.31 |   5.76 |
                                                    |   4.32 |   0.00 |   1.92 |   0.00 |   4.10 |   4.79 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (822) patella    |  44106 |      0 |   4766 |      0 |   2215 |   1594 |  52681
                                                    |   1.19 |   0.00 |   0.13 |   0.00 |   0.06 |   0.04 |   1.43
                                                    |  83.72 |   0.00 |   9.05 |   0.00 |   4.20 |   3.03 |
                                                    |   1.63 |   0.00 |   1.59 |   0.00 |   0.88 |   0.94 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total             2708330   254412   300425     6804   251600   169562  3691133
                                                       73.37     6.89     8.14     0.18     6.82     4.59   100.00
                                   (Continued)
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
                                                                  --- AS project ---                                   11:48 Friday, June 22, 2018   5

                                                                  The FREQ Procedure

                                                                Table of fx_site by cq

                                   fx_site           cq

                                   Frequency        |
                                   Percent          |
                                   Row Pct          |
                                   Col Pct          |0000    |0004    |0030    |0034    |0200    |1000    |  Total
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (823, 73316) tib | 113911 |      0 |  10522 |      0 |   6118 |   4495 | 135046
                                   _fib             |   3.09 |   0.00 |   0.29 |   0.00 |   0.17 |   0.12 |   3.66
                                                    |  84.35 |   0.00 |   7.79 |   0.00 |   4.53 |   3.33 |
                                                    |   4.21 |   0.00 |   3.50 |   0.00 |   2.43 |   2.65 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (824) ankle      | 191211 |      0 |  25610 |      0 |   9592 |   8235 | 234648
                                                    |   5.18 |   0.00 |   0.69 |   0.00 |   0.26 |   0.22 |   6.36
                                                    |  81.49 |   0.00 |  10.91 |   0.00 |   4.09 |   3.51 |
                                                    |   7.06 |   0.00 |   8.52 |   0.00 |   3.81 |   4.86 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (825) tarsal_met | 195922 |      0 |   1360 |      0 |   2558 |    771 | 200611
                                   atarsal          |   5.31 |   0.00 |   0.04 |   0.00 |   0.07 |   0.02 |   5.43
                                                    |  97.66 |   0.00 |   0.68 |   0.00 |   1.28 |   0.38 |
                                                    |   7.23 |   0.00 |   0.45 |   0.00 |   1.02 |   0.45 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (826) foot_phala |  83318 |      0 |      0 |      0 |    962 |    155 |  84435
                                   nges             |   2.26 |   0.00 |   0.00 |   0.00 |   0.03 |   0.00 |   2.29
                                                    |  98.68 |   0.00 |   0.00 |   0.00 |   1.14 |   0.18 |
                                                    |   3.08 |   0.00 |   0.00 |   0.00 |   0.38 |   0.09 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (827) lower_limb |   3835 |      0 |      0 |      0 |     58 |      7 |   3900
                                                    |   0.10 |   0.00 |   0.00 |   0.00 |   0.00 |   0.00 |   0.11
                                                    |  98.33 |   0.00 |   0.00 |   0.00 |   1.49 |   0.18 |
                                                    |   0.14 |   0.00 |   0.00 |   0.00 |   0.02 |   0.00 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (828) legs+arm/r |   1064 |      0 |      0 |      0 |    247 |     36 |   1347
                                   ib               |   0.03 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   0.04
                                                    |  78.99 |   0.00 |   0.00 |   0.00 |  18.34 |   2.67 |
                                                    |   0.04 |   0.00 |   0.00 |   0.00 |   0.10 |   0.02 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   (829) fx_nos     |  28932 |      0 |      0 |      0 |    336 |     10 |  29278
                                                    |   0.78 |   0.00 |   0.00 |   0.00 |   0.01 |   0.00 |   0.79
                                                    |  98.82 |   0.00 |   0.00 |   0.00 |   1.15 |   0.03 |
                                                    |   1.07 |   0.00 |   0.00 |   0.00 |   0.13 |   0.01 |
                                   -----------------+--------+--------+--------+--------+--------+--------+
                                   Total             2708330   254412   300425     6804   251600   169562  3691133
                                                       73.37     6.89     8.14     0.18     6.82     4.59   100.00


                                                                                Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                                        3149603       85.33       3149603        85.33  
                                             1           541530       14.67       3691133       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
NOTE: There were 3691133 observations read from the data set WORK.FX_DGNS_4.
NOTE: The PROCEDURE FREQ printed pages 2-5.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           2.15 seconds
      cpu time            1.99 seconds
      

576        
577        *goto 002_fx_epi.sas;
578        
579        
580        
581        
582        /*
583        START OF 002_fx_data.sas
584         */
585        
586        /*all the claims to define episode sequence */
587        data _dat0(keep=
588        PATID ENCOUNTERID ADMIT_DATE DISCHARGE_DATE BEGIN_DATE END_DATE DX DX_TYPE PDX  /* SOURCE */ ENC_TYPE fx_site px px_date
589        site cq spine_image trauma_date trauma );
590        set fx_dgns_4 fx_excare Fx_prcd(rename=tx_site=fx_site);
591        run;

NOTE: There were 3691133 observations read from the data set WORK.FX_DGNS_4.
NOTE: There were 638026 observations read from the data set WORK.FX_EXCARE.
NOTE: There were 658660 observations read from the data set WORK.FX_PRCD.
NOTE: The data set WORK._DAT0 has 4987819 observations and 18 variables.
NOTE: DATA statement used (Total process time):
      real time           2.20 seconds
      cpu time            2.16 seconds
      

592        proc sort data=_dat0; by PATID fx_site BEGIN_DATE END_DATE; run;

NOTE: There were 4987819 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT0 has 4987819 observations and 18 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           3.62 seconds
      cpu time            8.03 seconds
      

593        /*for each claim define start and end date applicable to IP NH and NH*/
594        data _dat1;
595        set _dat0;
596        length start_date end_date 4;
597        format start_date end_date mmddyy10.;
598        by PATID fx_site BEGIN_DATE END_DATE;
12                                                                  The SAS System                                         11:48 Friday, June 22, 2018

599        start_date=min(ADMIT_DATE, BEGIN_DATE);
600        end_date=max(DISCHARGE_DATE, End_DATE);
601        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      34733 at 599:12   3143 at 600:10    
NOTE: There were 4987819 observations read from the data set WORK._DAT0.
NOTE: The data set WORK._DAT1 has 4987819 observations and 19 variables.
NOTE: DATA statement used (Total process time):
      real time           2.51 seconds
      cpu time            2.48 seconds
      

602        proc sort data=_dat1; by PATID fx_site start_date end_date; run;

NOTE: There were 4987819 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT1 has 4987819 observations and 19 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           3.31 seconds
      cpu time            6.98 seconds
      

603        
604        /* generate unique episode sequence ID */
605        data _dat2(drop=end_date_max lag_end_date_max _gap);
606        set _dat1;
607        length lag_end_date_max end_date_max 4;
608        format lag_end_date_max end_date_max mmddyy10.;
609        
610        by PATID fx_site start_date end_date;
611        retain seq 0;
612        
613        /*if current claims end date > all previouse claim end date in sequence, then update*/
614        end_date_max=max(end_date,end_date_max);
615        lag_end_date_max=lag(end_date_max);
616        
617        if first.fx_site then lag_end_date_max=.;
618        _gap=start_date-lag_end_date_max;
619        
620        /*if current claims start date >90 days after all previouse claim end date in sequence,
621        then start new sequence*/
622        if first.fx_site or start_date-lag_end_date_max>90 then do;
623            end_date_max=end_date;
624        
625            seq+1;
626        end;
627        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      3143 at 614:14     981679 at 618:16   981679 at 622:31   
NOTE: There were 4987819 observations read from the data set WORK._DAT1.
NOTE: The data set WORK._DAT2 has 4987819 observations and 20 variables.
NOTE: DATA statement used (Total process time):
      real time           3.40 seconds
      cpu time            3.37 seconds
      

628        proc sort data=_dat2; by seq;run;

NOTE: There were 4987819 observations read from the data set WORK._DAT2.
NOTE: The data set WORK._DAT2 has 4987819 observations and 20 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           3.50 seconds
      cpu time            6.13 seconds
      

629        proc sql;
630        /*episode sequence start date*/
631        create table seq_start as
632        select patid, seq, min(start_date) as seq_start_date length=4 format=mmddyy10.
13                                                                  The SAS System                                         11:48 Friday, June 22, 2018

633         from _dat2
634         where substr(dx,1,4) not in ('V541' 'V542')
635         group by patid, seq
636         order by patid, seq;
NOTE: Table WORK.SEQ_START created, with 978045 rows and 3 columns.

637        /*episode sequence end date*/
638        create table seq_end as
639        select patid, seq,
640         max(start_date) as seq_end_date length=4 format=mmddyy10. from _dat2
641         group by patid, seq
642         order by patid, seq;
NOTE: Table WORK.SEQ_END created, with 1166306 rows and 3 columns.

643        quit;
NOTE: PROCEDURE SQL used (Total process time):
      real time           5.56 seconds
      cpu time            11.51 seconds
      

644        /*episode sequence case qualifier indicator and trauma*/
645        data seq_cq(keep=patid seq seq_cq seq_trauma fx_site);
646        set _dat2;
647        by patid seq;
648        length seq_cq $4 seq_trauma $1;
649        retain seq_cq seq_trauma;
650        if first.seq then do;
651            seq_cq="0000";
652            seq_trauma="0";
653        end;
654        if trauma="1" then seq_trauma=trauma;
655        do i=1 to 4;
656        if substr(cq,i,1)>substr(seq_cq,i,1) then substr(seq_cq,i,1)=substr(cq,i,1);
657        end;
658        if last.seq then output;
659        run;

NOTE: There were 4987819 observations read from the data set WORK._DAT2.
NOTE: The data set WORK.SEQ_CQ has 1166306 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           2.04 seconds
      cpu time            1.99 seconds
      

660        proc freq data=seq_cq; tables seq_cq seq_trauma fx_site; run;

                                                                  --- AS project ---                                   11:48 Friday, June 22, 2018   6

                                                                  The FREQ Procedure

                                                                                Cumulative    Cumulative
                                             seq_cq    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0000        804032       68.94        804032        68.94  
                                             0004         52769        4.52        856801        73.46  
                                             0030         72225        6.19        929026        79.66  
                                             0034          1908        0.16        930934        79.82  
                                             0200         65978        5.66        996912        85.48  
                                             0204          6560        0.56       1003472        86.04  
                                             0230          4052        0.35       1007524        86.39  
                                             0234           181        0.02       1007705        86.40  
                                             1000         50109        4.30       1057814        90.70  
                                             1004          6474        0.56       1064288        91.25  
                                             1030         12275        1.05       1076563        92.31  
                                             1034           319        0.03       1076882        92.33  
                                             1200         64467        5.53       1141349        97.86  
                                             1204         10017        0.86       1151366        98.72  
                                             1230         14461        1.24       1165827        99.96  
                                             1234           479        0.04       1166306       100.00  


                                             seq_                               Cumulative    Cumulative
                                             trauma    Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             0          1049233       89.96       1049233        89.96  
                                             1           117073       10.04       1166306       100.00  


                                                                                          Cumulative    Cumulative
                                    fx_site                      Frequency     Percent     Frequency      Percent
                                    ------------------------------------------------------------------------------
                                    (7331) pathologic nos/nec       26799        2.30         26799         2.30  
                                    (800-804) skull/face            30483        2.61         57282         4.91  
                                    (805, 806, 73313) spine        156551       13.42        213833        18.33  
                                    (807) rib/sternum/trachea       64947        5.57        278780        23.90  
                                    (808) pelvis                    37845        3.24        316625        27.15  
                                    (809) trunk bones                 907        0.08        317532        27.23  
                                    (810) clavicle                  14343        1.23        331875        28.46  
                                    (811) scapula                    4871        0.42        336746        28.87  
                                    (812, 73311) humerus            66267        5.68        403013        34.55  
                                    (813, 73312) radius_ulna        85913        7.37        488926        41.92  
                                    (814) carpal                    32392        2.78        521318        44.70  
                                    (815-817) hand/fingers          41703        3.58        563021        48.27  
                                    (818-819) arms mult              2592        0.22        565613        48.50  
                                    (820, 73314) hip               181683       15.58        747296        64.07  
                                    (821, 73315) femur              75878        6.51        823174        70.58  
                                    (822) patella                   33661        2.89        856835        73.47  
                                    (823, 73316) tib_fib            41915        3.59        898750        77.06  
                                    (824) ankle                     60616        5.20        959366        82.26  
                                    (825) tarsal_metatarsal         55303        4.74       1014669        87.00  
                                    (826) foot_phalanges            30668        2.63       1045337        89.63  
                                    (827) lower_limb                 1783        0.15       1047120        89.78  
                                    (828) legs+arm/rib                565        0.05       1047685        89.83  
                                    (829) fx_nos                   118621       10.17       1166306       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
NOTE: There were 1166306 observations read from the data set WORK.SEQ_CQ.
NOTE: The PROCEDURE FREQ printed page 6.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.57 seconds
      cpu time            0.51 seconds
      

661        
662        data seq_cq_date;
663        merge seq_cq seq_start seq_end;
664        by patid seq;
665        length site_order $1;
666        if fx_site='(820, 73314) hip' then site_order='1';
667        if fx_site='(821, 73315) femur' then site_order='2';
668        if fx_site='(808) pelvis' then site_order='3';
669        if fx_site='(805, 806, 73313) spine' then site_order='4';
670        if fx_site='(812, 73311) humerus' then site_order='5';
671        if fx_site='(813, 73312) radius_ulna' then site_order='6';
672        if fx_site='(823, 73316) tib_fib' then site_order='7';
673        if fx_site='(824) ankle' then site_order='8';
674        if fx_site='(810) clavicle' then site_order='9';
675        run;

NOTE: There were 1166306 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 978045 observations read from the data set WORK.SEQ_START.
NOTE: There were 1166306 observations read from the data set WORK.SEQ_END.
14                                                                  The SAS System                                         11:48 Friday, June 22, 2018

NOTE: The data set WORK.SEQ_CQ_DATE has 1166306 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.98 seconds
      cpu time            0.96 seconds
      

676        
677        data _tmp_combo;
678        set seq_cq_date;
679        where site_order^=" " and seq_cq^="0000" and seq_cq^=" ";
680        run;

NOTE: There were 302103 observations read from the data set WORK.SEQ_CQ_DATE.
      WHERE (site_order not = ' ') and seq_cq not in (' ', '0000');
NOTE: The data set WORK._TMP_COMBO has 302103 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.39 seconds
      cpu time            0.37 seconds
      

681        
682        * define combo or alone fx;
683        data seq_COMBO(
684        keep=patid seq seq_cq seq_start_date alone_combo fx_site site_order)
685        ;
686        if _n_=1 then do;
687            declare hash hpid(dataset:"_tmp_combo(where=(seq_cq^='0000' and seq_cq^=' ')
688                    rename=(seq_start_date=seq_start_date2  fx_site= fx_site_combo seq=seq_COMBO))", ordered: 'a', multidata:"Y");
689            rc=hpid.defineKey("patid");
690            rc=hpid.defineData("patid","seq_start_date2", "fx_site_combo", "seq_COMBO");
691            rc=hpid.defineDone();
692        end;
693        if 0 then set _tmp_combo(rename=(seq_start_date=seq_start_date2 fx_site= fx_site_combo seq=seq_COMBO));
694        set _tmp_combo(where=(seq_cq^="0000" and seq_cq^=" ") );
695        by patid seq;
696        length  index_fx_begin 4 alone_combo $5;
697        alone_combo="alone";
698            format index_fx_begin mmddyy10.;
699            index_fx_begin=seq_start_date;
700        
701         rc=hpid.find(key:patid);
702        
703         do while (rc = 0);
704         if rc=0 and abs(seq_start_date-seq_start_date2) <=30 and fx_site_combo^=fx_site then alone_combo= 'combo';
705         rc=hpid.find_next();
706         *hpid.has_next(result:r);
707        end;
708        if alone_combo="alone" then do;
709            seq_start_date2=.; fx_site_combo=" "; seq_COMBO=.;
710        end;
711        run;

NOTE: There were 302103 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: There were 302103 observations read from the data set WORK._TMP_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.SEQ_COMBO has 302103 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.70 seconds
      cpu time            0.70 seconds
      

712        proc freq data=seq_COMBO; tables alone_combo; run;

                                                                  --- AS project ---                                   11:48 Friday, June 22, 2018   7

                                                                  The FREQ Procedure

                                             alone_                             Cumulative    Cumulative
                                             combo     Frequency     Percent     Frequency      Percent
                                             -----------------------------------------------------------
                                             alone       258502       85.57        258502        85.57  
                                             combo        43601       14.43        302103       100.00  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
NOTE: There were 302103 observations read from the data set WORK.SEQ_COMBO.
NOTE: The PROCEDURE FREQ printed page 7.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.14 seconds
      cpu time            0.07 seconds
      

713        
15                                                                  The SAS System                                         11:48 Friday, June 22, 2018

714        proc sort data = Work.seq_COMBO;
715          by patid seq_start_date;
716        run;

NOTE: There were 302103 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 302103 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.23 seconds
      cpu time            0.42 seconds
      

717        
718        data combo_seq;
719        set seq_COMBO;
720        by patid seq_start_date;
721        length combo_fx_site $30. combo_seq 4;
722        retain combo_seq 0 combo_fx_site;
723        if first.patid or seq_start_date-lag(seq_start_date) then combo_seq=1+combo_seq;
724        where seq_cq^='0000' and seq_cq^=' ';
725        if combo_fx_site=" " or ""<site_order<lag(site_order) then combo_fx_site=fx_site;
726        run;

NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      1 at 723:33   
NOTE: There were 302103 observations read from the data set WORK.SEQ_COMBO.
      WHERE seq_cq not in (' ', '0000');
NOTE: The data set WORK.COMBO_SEQ has 302103 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.26 seconds
      cpu time            0.23 seconds
      

727        
728        proc sort data = Work.seq_COMBO;
729          by patid seq;
730        run;

NOTE: There were 302103 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.SEQ_COMBO has 302103 observations and 7 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.23 seconds
      cpu time            0.46 seconds
      

731        
732        data FX_CLM_DB;
733        merge _dat2 seq_start seq_end seq_cq(drop=fx_site) seq_COMBO(keep=patid seq alone_combo);
734        by patid seq;
735        run;

NOTE: There were 4987819 observations read from the data set WORK._DAT2.
NOTE: There were 978045 observations read from the data set WORK.SEQ_START.
NOTE: There were 1166306 observations read from the data set WORK.SEQ_END.
NOTE: There were 1166306 observations read from the data set WORK.SEQ_CQ.
NOTE: There were 302103 observations read from the data set WORK.SEQ_COMBO.
NOTE: The data set WORK.FX_CLM_DB has 4987819 observations and 25 variables.
NOTE: DATA statement used (Total process time):
      real time           5.28 seconds
      cpu time            5.25 seconds
      

736        
737        proc sql;
738        select count(distinct seq) from FX_CLM_DB;
                                                                  --- AS project ---                                   11:48 Friday, June 22, 2018   8

                                                                               
                                                                       --------
                                                                        1166306
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
739        quit;
NOTE: The PROCEDURE SQL printed page 8.
NOTE: PROCEDURE SQL used (Total process time):
      real time           2.74 seconds
      cpu time            2.72 seconds
      

16                                                                  The SAS System                                         11:48 Friday, June 22, 2018

740        
741        
742        
743        
744        /*
745        Collapse to fracture episodes
746        
747        Q: Why are some seq_start_date values missing?
748         */
749        proc sort
750          data = Work.fx_clm_db
751          out = Work.fractureEpisodes (drop = seq
752                                       rename = (seq_start_date = fractureEpisodeStart
753                                                 seq_end_date = fractureEpisodeEnd
754                                                 fx_site = fractureSite))
755          nodupkey;
756          by patid seq seq_start_date seq_end_date fx_site;
757        run;

NOTE: There were 4987819 observations read from the data set WORK.FX_CLM_DB.
NOTE: 3821513 observations with duplicate key values were deleted.
NOTE: The data set WORK.FRACTUREEPISODES has 1166306 observations and 24 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           3.18 seconds
      cpu time            6.69 seconds
      

758        
759        proc sql;
760          create table DT.fractureEpisodesPrevControl as
761            select A.database,
762                   A.cohort,
763                   A.indexDate,
764                   A.controlID,
765                   A.age,
766                   A.sex,
767                   B.*,
768                   case
769                     when prxmatch("/spine/", B.fractureSite) then "Clinical vertebral fracture"
770                     when prxmatch("/(hip)|(pelvis)|(femur)|(humerus)|(radius)|(ulna)/", B.fractureSite) then "Non-vertebral osteoporotic fracture"
771                     else ""
772                     end as fractureType
773            from DT.controlLookup A inner join
774                 Work.fractureEpisodes B on (A.patid = B.patid);
NOTE: Table DT.FRACTUREEPISODESPREVCONTROL created, with 1166306 rows and 31 columns.

775          create table Work.summaryFractureEpisodesPrev as
776            select "DT.fractureEpisodesPrevControl" as table,
777                   fractureType, fractureSite,
778                   count(distinct patid) as countDistinctPatid,
779                   count(*) as countFractureEpisodes
780            from DT.fractureEpisodesPrevControl
781            group by fractureType, fractureSite;
NOTE: Table WORK.SUMMARYFRACTUREEPISODESPREV created, with 23 rows and 5 columns.

782          select * from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                                   11:48 Friday, June 22, 2018   9

                                                                                                                       count         count
                                                                                                                    Distinct      Fracture
           table                           fractureType                         fractureSite                           Patid      Episodes
           -------------------------------------------------------------------------------------------------------------------------------
           DT.fractureEpisodesPrevControl                                       (7331) pathologic nos/nec              23856         26799
           DT.fractureEpisodesPrevControl                                       (800-804) skull/face                   28724         30483
           DT.fractureEpisodesPrevControl                                       (807) rib/sternum/trachea              59348         64947
           DT.fractureEpisodesPrevControl                                       (809) trunk bones                        834           907
           DT.fractureEpisodesPrevControl                                       (810) clavicle                         13269         14343
           DT.fractureEpisodesPrevControl                                       (811) scapula                           4592          4871
           DT.fractureEpisodesPrevControl                                       (814) carpal                           30291         32392
           DT.fractureEpisodesPrevControl                                       (815-817) hand/fingers                 39052         41703
           DT.fractureEpisodesPrevControl                                       (818-819) arms mult                     2513          2592
           DT.fractureEpisodesPrevControl                                       (822) patella                          29674         33661
           DT.fractureEpisodesPrevControl                                       (823, 73316) tib_fib                   36285         41915
           DT.fractureEpisodesPrevControl                                       (824) ankle                            51124         60616
           DT.fractureEpisodesPrevControl                                       (825) tarsal_metatarsal                49016         55303
           DT.fractureEpisodesPrevControl                                       (826) foot_phalanges                   28802         30668
           DT.fractureEpisodesPrevControl                                       (827) lower_limb                        1690          1783
           DT.fractureEpisodesPrevControl                                       (828) legs+arm/rib                       553           565
           DT.fractureEpisodesPrevControl                                       (829) fx_nos                          100082        118621
           DT.fractureEpisodesPrevControl  Clinical vertebral fracture          (805, 806, 73313) spine               110342        156551
           DT.fractureEpisodesPrevControl  Non-vertebral osteoporotic fracture  (808) pelvis                           33263         37845
           DT.fractureEpisodesPrevControl  Non-vertebral osteoporotic fracture  (812, 73311) humerus                   53417         66267
           DT.fractureEpisodesPrevControl  Non-vertebral osteoporotic fracture  (813, 73312) radius_ulna               72309         85913
           DT.fractureEpisodesPrevControl  Non-vertebral osteoporotic fracture  (820, 73314) hip                      140770        181683
           DT.fractureEpisodesPrevControl  Non-vertebral osteoporotic fracture  (821, 73315) femur                     64834         75878
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
783          select "DT.fractureEpisodesPrevControl" as table,
784                 sum(countDistinctPatid) as sumDistinctPatid,
785                 sum(countFractureEpisodes) as sumFractureEpisodes
786            from Work.summaryFractureEpisodesPrev;
                                                                  --- AS project ---                                   11:48 Friday, June 22, 2018  10

                                                                               sumDistinct   sumFracture
                                              table                                  Patid      Episodes
                                              ----------------------------------------------------------
                                              DT.fractureEpisodesPrevControl        974640       1166306
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                                              queryFracturesControl.sas
787        quit;
NOTE: The PROCEDURE SQL printed pages 9-10.
NOTE: PROCEDURE SQL used (Total process time):
      real time           7.76 seconds
      cpu time            10.32 seconds
      

788        
789        
790        
791        
792        proc export
17                                                                  The SAS System                                         11:48 Friday, June 22, 2018

793          data = Work.summaryFractureEpisodesPrev
794          outfile = "data\processed\&cmt..csv"
795          dbms = csv
796          replace;
797          delimiter = '09'x;
798        run;

799         /**********************************************************************
800         *   PRODUCT:   SAS
801         *   VERSION:   9.4
802         *   CREATOR:   External File Interface
803         *   DATE:      22JUN18
804         *   DESC:      Generated SAS Datastep Code
805         *   TEMPLATE SOURCE:  (None Specified.)
806         ***********************************************************************/
807            data _null_;
808            %let _EFIERR_ = 0; /* set the ERROR detection macro variable */
809            %let _EFIREC_ = 0;     /* clear export record count macro variable */
810            file 'data\processed\queryFracturesControl.csv' delimiter='09'x DSD DROPOVER lrecl=32767;
811            if _n_ = 1 then        /* write column names or labels */
812             do;
813               put
814                  "table"
815               '09'x
816                  "fractureType"
817               '09'x
818                  "fractureSite"
819               '09'x
820                  "countDistinctPatid"
821               '09'x
822                  "countFractureEpisodes"
823               ;
824             end;
825           set  WORK.SUMMARYFRACTUREEPISODESPREV   end=EFIEOD;
826               format table $30. ;
827               format fractureType $35. ;
828               format fractureSite $30. ;
829               format countDistinctPatid best12. ;
830               format countFractureEpisodes best12. ;
831             do;
832               EFIOUT + 1;
833               put table $ @;
834               put fractureType $ @;
835               put fractureSite $ @;
836               put countDistinctPatid @;
837               put countFractureEpisodes ;
838               ;
839             end;
840            if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable */
841            if EFIEOD then call symputx('_EFIREC_',EFIOUT);
842            run;

NOTE: The file 'data\processed\queryFracturesControl.csv' is:
      Filename=U:\studies\AS\pgms\bchan\data\processed\queryFracturesControl.csv,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=22Jun2018:12:13:05,
      Create Time=22Jun2018:12:13:05

NOTE: 24 records were written to the file 'data\processed\queryFracturesControl.csv'.
      The minimum record length was 55.
      The maximum record length was 103.
NOTE: There were 23 observations read from the data set WORK.SUMMARYFRACTUREEPISODESPREV.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.01 seconds
      

23 records created in data\processed\queryFracturesControl.csv from WORK.SUMMARYFRACTUREEPISODESPREV.
  
  
NOTE: "data\processed\queryFracturesControl.csv" file was successfully created.
NOTE: PROCEDURE EXPORT used (Total process time):
18                                                                  The SAS System                                         11:48 Friday, June 22, 2018

      real time           0.28 seconds
      cpu time            0.15 seconds
      

843        
844        
845        ods html close;
NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           24:46.47
      cpu time            25:16.53
      
